ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 1.
Hexadecimal [24-Bits]



                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019 
                                      3 ; This file is part of PABasic 
                                      4 ;
                                      5 ;     PABasic is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     PABasic is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with PABasic.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 ;--------------------------------------
                                     19 ;   Implementation of Tiny BASIC
                                     20 ;   REF: https://en.wikipedia.org/wiki/Li-Chen_Wang#Palo_Alto_Tiny_BASIC
                                     21 ;   Palo Alto BASIC is 4th version of TinyBasic
                                     22 ;   DATE: 2019-12-17
                                     23 ;
                                     24 ;--------------------------------------------------
                                     25 
                                     26 
                                     27 
                                     28 
                                     29     .module TBI_STM8
                                     30 
                                        	.include "inc/nucleo_8s208.inc"
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of MONA 
                                        ;
                                        ;     MONA is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     MONA is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                        ; NUCLEO-8S208RB board specific definitions
                                        ; Date: 2019/10/29
                                        ; author: Jacques Deschênes, copyright 2018,2019
                                        ; licence: GPLv3
                                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                        
                                        ; mcu on board is stm8s208rbt6
                                        
                                        ; crystal on board is 8Mhz
                                 
                                        
                                        ; LED2 is user LED
                                        ; connected to PC5 via Q2 -> 2N7002 MOSFET
                                 
                                 
                                 
                                        
                                        ; B1 on schematic is user button
                                        ; connected to PE4
                                        ; external pullup resistor R6 4k7 and debounce capacitor C5 100nF
                                 
                                 
                                 
                                        
                                        
                                        	.include "inc/stm8s208.inc"
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of MONA 
                                        ;
                                        ;     MONA is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     MONA is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                        ; 2019/10/18
                                        ; STM8S208RB µC registers map
                                        ; sdas source file
                                        ; author: Jacques Deschênes, copyright 2018,2019
                                        ; licence: GPLv3
                                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                        	.module stm8s208rb
                                        
                                        ;;;;;;;;;;;;
                                        ; bits
                                        ;;;;;;;;;;;;
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                         	
                                        ;;;;;;;;;;;;
                                        ; bits masks
                                        ;;;;;;;;;;;;
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; HSI oscillator frequency 16Mhz
                                 
                                        ; LSI oscillator frequency 128Khz
                                 
                                        
                                        ; controller memory regions
                                 
                                 
                                        ; STM8S208RB have 128K flash
                                 
                                        ; erase block size 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; options bytes
                                        ; this one can be programmed only from SWIM  (ICP)
                                 
                                        ; these can be programmed at runtime (IAP)
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; option registers usage
                                        ; read out protection, value 0xAA enable ROP
                                 
                                        ; user boot code, {0..0x3e} 512 bytes row
                                 
                                 
                                        ; alternate function register
                                 
                                 
                                        ; miscelinous options
                                 
                                 
                                        ; clock options
                                 
                                 
                                        ; HSE clock startup delay
                                 
                                 
                                        ; flash wait state
                                 
                                 
                                        
                                        ; watchdog options bits
                                 
                                 
                                 
                                 
                                        ; NWDGOPT bits
                                 
                                 
                                 
                                 
                                        
                                        ; CLKOPT bits
                                 
                                 
                                 
                                 
                                        
                                        ; AFR option, remapable functions
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; device ID = (read only)
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        
                                 
                                 
                                        ; PORTS SFR OFFSET
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; GPIO
                                        ; gpio register offset to base
                                 
                                 
                                 
                                 
                                 
                                 
                                         
                                        ; port A
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port B
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port C
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port D
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port E
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port F
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port G
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port H not present on LQFP48/LQFP64 package
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port I ; only bit 0 on LQFP64 package, not present on LQFP48
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; input modes CR1
                                 
                                 
                                        ; output mode CR1
                                 
                                 
                                        ; input modes CR2
                                 
                                 
                                        ; output speed CR2
                                 
                                 
                                        
                                        
                                        ; Flash memory
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; data memory unlock keys
                                 
                                 
                                        ; flash memory unlock keys
                                 
                                 
                                        ; FLASH_CR1 bits
                                 
                                 
                                 
                                 
                                        ; FLASH_CR2 bits
                                 
                                 
                                 
                                 
                                 
                                        ; FLASH_FPR bits
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; FLASH_NFPR bits
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; FLASH_IAPSR bits
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Interrupt control
                                 
                                 
                                        
                                        ; Reset Status
                                 
                                        
                                        ; Clock Registers
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Peripherals clock gating
                                        ; CLK_PCKENR1 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; CLK_PCKENR2
                                 
                                 
                                 
                                        
                                        ; Clock bits
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                        ; clock source
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Watchdog
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Beeper
                                        ; beeper output is alternate function AFR7 on PD4
                                        ; connected to CN9-6
                                 
                                 
                                 
                                 
                                        
                                        ; SPI
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; I2C
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                        
                                        ; Precalculated values, all in KHz
                                 
                                 
                                        ;
                                        ; Fast I2C mode max rise time = 300ns
                                        ; I2C_FREQR = 16 = (MHz) => tMASTER = 1/16 = 62.5 ns
                                        ; TRISER = = (300/62.5) + 1 = floor(4.8) + 1 = 5.
                                        
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                        ;
                                        ; Standard I2C mode max rise time = 1000ns
                                        ; I2C_FREQR = 16 = (MHz) => tMASTER = 1/16 = 62.5 ns
                                        ; TRISER = = (1000/62.5) + 1 = floor(16) + 1 = 17.
                                        
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                        
                                        ; baudrate constant for brr_value table access
                                        ; to be used by uart_init 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; UART registers offset from
                                        ; base address 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; uart identifier
                                        ; to be used by uart_init
                                 
                                 
                                        
                                        ; pins used by uart 
                                 
                                 
                                 
                                 
                                        ; uart port base address 
                                 
                                 
                                        
                                        ; UART1 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; UART3
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; UART Status Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Uart Control Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        ; LIN mode config register
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; TIMERS
                                        ; Timer 1 - 16-bit timer with complementary PWM outputs
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Control Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Slave Mode Control bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer External Trigger Enable bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Interrupt Enable bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Status Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Event Generation Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 1 - channel configured in output
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 1 - channel configured in input
                                 
                                 
                                 
                                 
                                 
                                 
                                        ;  TIM1_CCMR1_CC1S1 = (1)
                                 
                                        
                                        ; Capture/Compare Mode Register 2 - channel configured in output
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 2 - channel configured in input
                                 
                                 
                                 
                                 
                                 
                                 
                                        ;  TIM1_CCMR2_CC2S1 = (1)
                                 
                                        
                                        ; Capture/Compare Mode Register 3 - channel configured in output
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 3 - channel configured in input
                                 
                                 
                                 
                                 
                                 
                                 
                                        ;  TIM1_CCMR3_CC3S1 = (1)
                                 
                                        
                                        ; Capture/Compare Mode Register 4 - channel configured in output
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 4 - channel configured in input
                                 
                                 
                                 
                                 
                                 
                                 
                                        ;  TIM1_CCMR4_CC4S1 = (1)
                                 
                                        
                                        ; Timer 2 - 16-bit timer
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer 3
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; TIM3_CR1  fields
                                 
                                 
                                 
                                 
                                 
                                        ; TIM3_CCR2  fields
                                 
                                 
                                 
                                        ; TIM3_CCER1 fields
                                 
                                 
                                 
                                 
                                        ; TIM3_CCER2 fields
                                 
                                 
                                        
                                        ; Timer 4
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer 4 bitmasks
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                        
                                 
                                        
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; ADC2
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                         
                                        ; ADC bitmasks
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                        
                                        ; beCAN
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        
                                        ; CPU
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; global configuration register
                                 
                                 
                                 
                                        
                                        ; interrupt control registers
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; SWIM, control and status register
                                 
                                        ; debug registers
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Interrupt Numbers
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Interrupt Vectors
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Condition code register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        	.include "inc/ascii.inc"
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of MONA 
                                        ;
                                        ;     MONA is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     MONA is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        
                                        ;-------------------------------------------------------
                                        ;     ASCII control  values
                                        ;     CTRL_x   are VT100 keyboard values  
                                        ;-------------------------------------------------------
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        	.include "inc/gen_macros.inc" 
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of STM8_NUCLEO 
                                        ;
                                        ;     STM8_NUCLEO is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     STM8_NUCLEO is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with STM8_NUCLEO.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        ;--------------------------------------
                                        ;   console Input/Output module
                                        ;   DATE: 2019-12-11
                                        ;    
                                        ;   General usage macros.   
                                        ;
                                        ;--------------------------------------
                                        
                                            ; reserve space on stack
                                            ; for local variabls
                                            .macro _vars n 
                                            
                                            ; free space on stack
                                            .macro _drop n 
                                        
                                            ; declare ARG_OFS for arguments 
                                            ; displacement on stack. This 
                                            ; value depend on local variables 
                                            ; size.
                                            .macro _argofs n 
                                        
                                            ; declare a function argument 
                                            ; position relative to stack pointer 
                                            ; _argofs must be called before it.
                                            .macro _arg name ofs 
                                        	.include "pab_macros.inc" 
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of STM8_NUCLEO 
                                        ;
                                        ;     STM8_NUCLEO is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     STM8_NUCLEO is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with STM8_NUCLEO.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        ;--------------------------------------
                                 
                                 
                                                ; keyword types 
                                 
                                 
                                 
                                 
                                        
                                        ;--------------------------------------
                                        ;   constantes related to Arduino 
                                        ;   API mapping 
                                        ;-------------------------------------
                                 
                                 
                                        
                                        ;--------------------------------------
                                        ;       token attribute
                                        ;--------------------------------------
                                                ; bits 4:5 identify token group 
                                                ; 0x0n -> miscelinous 
                                                ; 0x1n -> +|- operators 
                                                ; 0x2n -> *|/|% operators
                                                ; 0x3n -> relational operators 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                                ; don't change these token values 
                                                ; values chosen to be used as a mask.
                                                ; bits 7:6  always 0 
                                                ; bits 5:4 identify group 
                                                ; bits 3:0 token identifier inside group  
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ;--------------------------------------
                                        ;   error codes 
                                        ;--------------------------------------
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                            
                                        ;--------------------------------------
                                        ;   assembler flags 
                                        ;-------------------------------------
                                 
                                        
                                        
                                            .macro _usec_dly n 
                                            
                                        ;---------------------------------------
                                        ;  data stack macros 
                                        ;---------------------------------------
                                 
                                        
                                            ; move dp up 1 element 
                                            .macro _dp_up 
                                        
                                            ;move dp down 1 element
                                            .macro _dp_down 
                                        
                                            ; load X register with 
                                            ; entry point of dictionary
                                            ; before calling 'search_dict'
                                            .macro _ldx_dict dict_name
                                        
                                        ;-------------------------------
                                        ;  macros used to help debugging
                                        ;-------------------------------
                                 
                                            .macro _dbg 
                                        
                                            .macro _nodbg
                                        
                                 
                                 
                                 
                                 
                                            .macro _dbg_save_regs 
                                        
                                            .macro _dbg_restore_regs 
                                        
                                            .macro _dbg_getc 
                                        
                                            .macro _dbg_putc 
                                        
                                            .macro _dbg_puts 
                                        
                                            .macro _dbg_prti24 
                                        
                                            .macro _dbg_prt_regs
                                        
                                            .macro _dbg_peek addr 
                                        
                                            .macro _dbg_parser_init 
                                        
                                            .macro _dbg_readln
                                        
                                            .macro _dbg_number
                                        
                                            .macro _dbg_nextword
                                        
                                            .macro _dbg_dots 
                                        
                                            .macro _dbg_trap
                                        
                                            .macro _dbg_mark n  
                                            
                                            .macro _dbg_prt_var var 
                                        
                                            .macro _dbg_show 
                                        
                                     37     .list 
                                     38 
      000000                         39 _dbg 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 2.
Hexadecimal [24-Bits]



                           000001     1     DEBUG=1
                                     40 
                                     41 ;--------------------------------------
                                     42     .area DATA 
                                     43 ;--------------------------------------	
                                     44 
                           000050    45 	TIB_SIZE=80
                           000028    46     PAD_SIZE=40
                           000040    47 	DSTACK_SIZE=64 
                           000080    48 	STACK_SIZE=128
                           0017FF    49 	STACK_EMPTY=RAM_SIZE-1  
                           000000    50 	FRUN=0 ; flags run code in variable flags
                           000001    51 	FTRAP=1 ; inside trap handler 
                           000002    52 	FFOR=2 ; FOR loop in preparation 
                           000003    53 	FSLEEP=3 ; halt produit par la commande SLEEP 
                           000004    54 	FBREAK=4 ; break point flag 
                           000005    55 	FCOMP=5  ; compiling flags 
                                     56 
      000000                         57 in.w:  .blkb 1 ; parser position in text line
      000001                         58 in:    .blkb 1 ; low byte of in.w
      000002                         59 in.saved: .blkb 1 ; set by get_token before parsing next token, used by unget_token
      000003                         60 count: .blkb 1 ; current BASIC line length and tib text length  
      000004                         61 basicptr:  .blkb 2  ; point to current BASIC line 
      000006                         62 base:  .blkb 1 ; nemeric base used to print integer 
      000007                         63 acc24: .blkb 1 ; 24 bit accumulator
      000008                         64 acc16: .blkb 1 ; 16 bit accumulator, middle byte of acc24
      000009                         65 acc8:  .blkb 1 ;  8 bit accumulator, least byte of acc24 
      00000A                         66 ticks: .blkw 1 ; milliseconds ticks counter (see Timer4UpdateHandler)
      00000C                         67 seedx: .blkw 1  ; xorshift 16 seed x  used by RND() function 
      00000E                         68 seedy: .blkw 1  ; xorshift 16 seed y  used by RND() funcion
      000010                         69 farptr: .blkb 1 ; 24 bits pointer used by file system
      000011                         70 ptr16:  .blkb 1 ; 16 bits pointer ,  middle byte of farptr
      000012                         71 ptr8:   .blkb 1 ; 8 bits pointer, least byte of farptr 
      000013                         72 ffree: .blkb 3 ; flash free address ; file system free space pointer
      000016                         73 dstkptr: .blkw 1  ; data stack pointer 
      000018                         74 txtbgn: .ds 2 ; tokenized BASIC text beginning address 
      00001A                         75 txtend: .ds 2 ; tokenized BASIC text end address 
      00001C                         76 loop_depth: .ds 1 ; FOR loop depth, level of nested loop. Conformity check   
      00001D                         77 array_size: .ds 2 ; array size 
      00001F                         78 flags: .ds 1 ; various boolean flags
      000020                         79 tab_width: .ds 1 ; print colon width (4)
      000021                         80 vars: .ds 2*26 ; BASIC variables A-Z, keep it as but last .
                                     81 ; keep as last variable 
      000055                         82 free_ram: ; from here RAM free for BASIC text 
                                     83 
                                     84 ;-----------------------------------
                                     85     .area SSEG (ABS)
                                     86 ;-----------------------------------	
      0016C8                         87     .org RAM_SIZE-STACK_SIZE-TIB_SIZE-PAD_SIZE-DSTACK_SIZE 
      0016C8                         88 tib: .ds TIB_SIZE             ; transaction input buffer
      001718                         89 pad: .ds PAD_SIZE             ; working buffer
      001740                         90 dstack: .ds DSTACK_SIZE 	  ; data stack used by FOR...NEXT 
      001780                         91 dstack_unf: ; dstack underflow ; data stack bottom 
      001780                         92 stack_full: .ds STACK_SIZE   ; control stack 
      001800                         93 stack_unf: ; stack underflow ; control_stack bottom 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 3.
Hexadecimal [24-Bits]



                                     94 
                                     95 
                                     96 ;--------------------------------------
                                     97     .area HOME 
                                     98 ;--------------------------------------
      000000 82 00 05 54             99     int cold_start
                           000001   100 .if DEBUG
      000004 82 00 00 0A            101 	int TrapHandler 		;TRAP  software interrupt
                           000000   102 .else
                                    103 	int NonHandledInterrupt ;TRAP  software interrupt
                                    104 .endif
      000008 82 00 00 09            105 	int NonHandledInterrupt ;int0 TLI   external top level interrupt
      00000C 82 00 00 09            106 	int NonHandledInterrupt ;int1 AWU   auto wake up from halt
      000010 82 00 00 09            107 	int NonHandledInterrupt ;int2 CLK   clock controller
      000014 82 00 00 09            108 	int NonHandledInterrupt ;int3 EXTI0 gpio A external interrupts
      000018 82 00 00 09            109 	int NonHandledInterrupt ;int4 EXTI1 gpio B external interrupts
      00001C 82 00 00 09            110 	int NonHandledInterrupt ;int5 EXTI2 gpio C external interrupts
      000020 82 00 00 09            111 	int NonHandledInterrupt ;int6 EXTI3 gpio D external interrupts
      000024 82 00 00 25            112 	int UserButtonHandler   ;int7 EXTI4 gpio E external interrupts
      000028 82 00 00 09            113 	int NonHandledInterrupt ;int8 beCAN RX interrupt
      00002C 82 00 00 09            114 	int NonHandledInterrupt ;int9 beCAN TX/ER/SC interrupt
      000030 82 00 00 09            115 	int NonHandledInterrupt ;int10 SPI End of transfer
      000034 82 00 00 09            116 	int NonHandledInterrupt ;int11 TIM1 update/overflow/underflow/trigger/break
      000038 82 00 00 09            117 	int NonHandledInterrupt ;int12 TIM1 capture/compare
      00003C 82 00 00 09            118 	int NonHandledInterrupt ;int13 TIM2 update /overflow
      000040 82 00 00 09            119 	int NonHandledInterrupt ;int14 TIM2 capture/compare
      000044 82 00 00 09            120 	int NonHandledInterrupt ;int15 TIM3 Update/overflow
      000048 82 00 00 09            121 	int NonHandledInterrupt ;int16 TIM3 Capture/compare
      00004C 82 00 00 09            122 	int NonHandledInterrupt ;int17 UART1 TX completed
      000050 82 00 00 09            123 	int NonHandledInterrupt ;int18 UART1 RX full
      000054 82 00 00 09            124 	int NonHandledInterrupt ;int19 I2C 
      000058 82 00 00 09            125 	int NonHandledInterrupt ;int20 UART3 TX completed
      00005C 82 00 00 09            126 	int NonHandledInterrupt ;int21 UART3 RX full
      000060 82 00 00 09            127 	int NonHandledInterrupt ;int22 ADC2 end of conversion
      000064 82 00 00 19            128 	int Timer4UpdateHandler	;int23 TIM4 update/overflow used as msec ticks counter
      000068 82 00 00 09            129 	int NonHandledInterrupt ;int24 flash writing EOP/WR_PG_DIS
      00006C 82 00 00 09            130 	int NonHandledInterrupt ;int25  not used
      000070 82 00 00 09            131 	int NonHandledInterrupt ;int26  not used
      000074 82 00 00 09            132 	int NonHandledInterrupt ;int27  not used
      000078 82 00 00 09            133 	int NonHandledInterrupt ;int28  not used
      00007C 82 00 00 09            134 	int NonHandledInterrupt ;int29  not used
                                    135 
                                    136 ;---------------------------------------
                                    137     .area CODE
                                    138 ;---------------------------------------
                           000001   139 .if DEBUG
      000000 53 54 4D 38 5F 54 42   140 .asciz "STM8_TBI" ; I like to put module name here.
             49 00
                                    141 .endif 
                                    142 
      000009                        143 NonHandledInterrupt:
      000009 71                     144     .byte 0x71  ; reinitialize MCU
                                    145 
                                    146 
                                    147 ;------------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 4.
Hexadecimal [24-Bits]



                                    148 ; software interrupt handler  
                                    149 ;------------------------------------
                           000001   150 .if DEBUG 
      00000A                        151 TrapHandler:
      00000A 72 12 00 1F      [ 1]  152 	bset flags,#FTRAP 
      00000E CD 08 9A         [ 4]  153 	call print_registers
      000011 CD 0B 05         [ 4]  154 	call cmd_itf
      000014 72 13 00 1F      [ 1]  155 	bres flags,#FTRAP 	
      000018 80               [11]  156 	iret
                                    157 .endif 
                                    158 
      000019                        159 Timer4UpdateHandler:
      000019 72 5F 53 42      [ 1]  160 	clr TIM4_SR 
      00001D CE 00 0A         [ 2]  161 	ldw x,ticks
      000020 5C               [ 1]  162 	incw x
      000021 CF 00 0A         [ 2]  163 	ldw ticks,x 
      000024 80               [11]  164 	iret 
                                    165 
                                    166 
                                    167 ;------------------------------------
                                    168 ; Triggered by pressing USER UserButton 
                                    169 ; on NUCLEO card.
                                    170 ;------------------------------------
      000025                        171 UserButtonHandler:
                                    172 ; wait button release
      000025 5F               [ 1]  173 	clrw x
      000026 5A               [ 2]  174 1$: decw x 
      000027 26 FD            [ 1]  175 	jrne 1$
      000029 72 09 50 15 F8   [ 2]  176 	btjf USR_BTN_PORT,#USR_BTN_BIT, 1$
                                    177 ; if MCU suspended by SLEEP resume program
      00002E 72 07 00 1F 05   [ 2]  178     btjf flags,#FSLEEP,2$
      000033 72 17 00 1F      [ 1]  179 	bres flags,#FSLEEP 
      000037 80               [11]  180 	iret
      000038 72 00 00 1F 03   [ 2]  181 2$:	btjt flags,#FRUN,4$
      00003D CC 00 76         [ 2]  182 	jp 9$ 
      000040                        183 4$:	; program interrupted by user 
      000040 72 11 00 1F      [ 1]  184 	bres flags,#FRUN 
      000044 AE 00 7E         [ 2]  185 	ldw x,#USER_ABORT
      000047 CD 01 B8         [ 4]  186 	call puts 
      00004A CE 00 04         [ 2]  187 	ldw x,basicptr
      00004D FE               [ 2]  188 	ldw x,(x)
                                    189 ; print line number 
      00004E 35 0A 00 06      [ 1]  190 	mov base,#10 
      000052 35 06 00 20      [ 1]  191 	mov tab_width,#6
      000056 CD 09 8D         [ 4]  192 	call print_int  	
      000059 CE 00 04         [ 2]  193 	ldw x,basicptr 
      00005C 1C 00 03         [ 2]  194 	addw x,#3  
      00005F CD 01 B8         [ 4]  195 	call puts 
      000062 A6 0D            [ 1]  196 	ld a,#CR 
      000064 CD 01 A6         [ 4]  197 	call putc
      000067 5F               [ 1]  198 	clrw x  
      000068 C6 00 01         [ 1]  199 	ld a,in 
      00006B AB 03            [ 1]  200 	add a,#3 ; adjustment for line number display 
      00006D 97               [ 1]  201 	ld xl,a 
      00006E CD 01 E0         [ 4]  202 	call spaces 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 5.
Hexadecimal [24-Bits]



      000071 A6 5E            [ 1]  203 	ld a,#'^
      000073 CD 01 A6         [ 4]  204 	call putc 
      000076                        205 9$:
      000076 AE 17 FF         [ 2]  206     ldw x,#STACK_EMPTY 
      000079 94               [ 1]  207     ldw sp,x
      00007A 9A               [ 1]  208 	rim 
      00007B CC 07 68         [ 2]  209 	jp warm_start
                                    210 
      00007E 0A 50 72 6F 67 72 61   211 USER_ABORT: .asciz "\nProgram aborted by user.\n"
             6D 20 61 62 6F 72 74
             65 64 20 62 79 20 75
             73 65 72 2E 0A 00
                                    212 
                                    213 ;----------------------------------------
                                    214 ; inialize MCU clock 
                                    215 ; input:
                                    216 ;   A 		source  HSI | 1 HSE 
                                    217 ;   XL      CLK_CKDIVR , clock divisor 
                                    218 ; output:
                                    219 ;   none 
                                    220 ;----------------------------------------
      000099                        221 clock_init:	
      000099 C1 50 C3         [ 1]  222 	cp a,CLK_CMSR 
      00009C 27 0C            [ 1]  223 	jreq 2$ ; no switching required 
                                    224 ; select clock source 
      00009E 72 12 50 C5      [ 1]  225 	bset CLK_SWCR,#CLK_SWCR_SWEN
      0000A2 C7 50 C4         [ 1]  226 	ld CLK_SWR,a
      0000A5 C1 50 C3         [ 1]  227 1$:	cp a,CLK_CMSR
      0000A8 26 FB            [ 1]  228 	jrne 1$
      0000AA                        229 2$: 	
                                    230 ; HSI and cpu clock divisor 
      0000AA 9F               [ 1]  231 	ld a,xl 
      0000AB C7 50 C6         [ 1]  232 	ld CLK_CKDIVR,a  
      0000AE 81               [ 4]  233 	ret
                                    234 
                                    235 ;---------------------------------
                                    236 ; TIM4 is configured to generate an 
                                    237 ; interrupt every millisecond 
                                    238 ;----------------------------------
      0000AF                        239 timer4_init:
      0000AF 72 18 50 C7      [ 1]  240 	bset CLK_PCKENR1,#CLK_PCKENR1_TIM4
      0000B3 35 07 53 45      [ 1]  241 	mov TIM4_PSCR,#7 ; prescale 128  
      0000B7 35 7D 53 46      [ 1]  242 	mov TIM4_ARR,#125 ; set for 1msec.
      0000BB 35 05 53 40      [ 1]  243 	mov TIM4_CR1,#((1<<TIM4_CR1_CEN)|(1<<TIM4_CR1_URS))
      0000BF 72 10 53 41      [ 1]  244 	bset TIM4_IER,#TIM4_IER_UIE 
      0000C3 81               [ 4]  245 	ret
                                    246 
                                    247 
                                    248 ;----------------------------------
                                    249 ; unlock EEPROM for writing/erasing
                                    250 ; wait endlessly for FLASH_IAPSR_DUL bit.
                                    251 ; input:
                                    252 ;  none
                                    253 ; output:
                                    254 ;  none 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 6.
Hexadecimal [24-Bits]



                                    255 ;----------------------------------
      0000C4                        256 unlock_eeprom:
      0000C4 35 AE 50 64      [ 1]  257 	mov FLASH_DUKR,#FLASH_DUKR_KEY1
      0000C8 35 56 50 64      [ 1]  258     mov FLASH_DUKR,#FLASH_DUKR_KEY2
      0000CC 72 07 50 5F FB   [ 2]  259 	btjf FLASH_IAPSR,#FLASH_IAPSR_DUL,.
      0000D1 81               [ 4]  260 	ret
                                    261 
                                    262 ;----------------------------------
                                    263 ; unlock FLASH for writing/erasing
                                    264 ; wait endlessly for FLASH_IAPSR_PUL bit.
                                    265 ; input:
                                    266 ;  none
                                    267 ; output:
                                    268 ;  none
                                    269 ;----------------------------------
      0000D2                        270 unlock_flash:
      0000D2 35 56 50 62      [ 1]  271 	mov FLASH_PUKR,#FLASH_PUKR_KEY1
      0000D6 35 AE 50 62      [ 1]  272 	mov FLASH_PUKR,#FLASH_PUKR_KEY2
      0000DA 72 03 50 5F FB   [ 2]  273 	btjf FLASH_IAPSR,#FLASH_IAPSR_PUL,.
      0000DF 81               [ 4]  274 	ret
                                    275 
                           000000   276 	BLOCK_ERASE=0
                                    277 ;----------------------------
                                    278 ; erase block code must be 
                                    279 ;executed from RAM
                                    280 ;-----------------------------
                           000000   281 .if BLOCK_ERASE 
                                    282 ; this code is copied to RAM 
                                    283 erase_start:
                                    284 	clr a 
                                    285     bset FLASH_CR2,#FLASH_CR2_ERASE
                                    286     bres FLASH_NCR2,#FLASH_CR2_ERASE
                                    287 	ldf [farptr],a
                                    288     inc farptr+2 
                                    289     ldf [farptr],a
                                    290     inc farptr+2 
                                    291     ldf [farptr],a
                                    292     inc farptr+2 
                                    293     ldf [farptr],a
                                    294 	btjf FLASH_IAPSR,#FLASH_IAPSR_EOP,.
                                    295 	ret
                                    296 erase_end:
                                    297 
                                    298 ; copy erase_start in RAM 
                                    299 move_code_in_ram:
                                    300 	ldw x,#erase_end 
                                    301 	subw x,#erase_start
                                    302 	ldw acc16,x 
                                    303 	ldw x,#pad 
                                    304 	ldw y,#erase_start 
                                    305 	call move 
                                    306 	ret 
                                    307 
                                    308 ;-----------------------------------
                                    309 ; erase flash or EEPROM block 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 7.
Hexadecimal [24-Bits]



                                    310 ; a block is 128 bytes 
                                    311 ; input:
                                    312 ;   farptr  address block begin
                                    313 ; output:
                                    314 ;   none
                                    315 ;--------------------------------------
                                    316 erase_block:
                                    317 	ldw x,farptr+1 
                                    318 	pushw x 
                                    319 	call move_code_in_ram 
                                    320 	popw x 
                                    321 	ldw farptr+1,x 
                                    322 	tnz farptr
                                    323 	jrne erase_flash 
                                    324 	ldw x,#FLASH_BASE 
                                    325 	cpw x,farptr+1 
                                    326 	jrpl erase_flash 
                                    327 ; erase eeprom block
                                    328 	call unlock_eeprom 
                                    329 	sim 
                                    330 	call pad   
                                    331 	bres FLASH_IAPSR,#FLASH_IAPSR_DUL
                                    332 	rim 
                                    333 	ret 
                                    334 ; erase flash block:
                                    335 erase_flash:
                                    336 	call unlock_flash 
                                    337 	bset FLASH_CR2,#FLASH_CR2_ERASE
                                    338 	bres FLASH_NCR2,#FLASH_CR2_ERASE
                                    339 	clr a 
                                    340 	sim 
                                    341 	call pad 
                                    342     bres FLASH_IAPSR,#FLASH_IAPSR_PUL
                                    343 	rim 
                                    344 	ret 
                                    345 .endif ; BLOCK_ERASE 
                                    346 
                                    347 
                                    348 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
                                    349 ; write a byte to FLASH or EEPROM 
                                    350 ; input:
                                    351 ;    a  		byte to write
                                    352 ;    farptr  	address
                                    353 ;    x          farptr[x]
                                    354 ; output:
                                    355 ;    none
                                    356 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    357 	; variables locales
                           000001   358 	BTW = 1   ; byte to write offset on stack
                           000002   359 	OPT = 2   ; OPTION flag offset on stack
                           000002   360 	VSIZE = 2
      0000E0                        361 write_byte:
      0000E0 90 89            [ 2]  362 	pushw y
      0000E2                        363 	_vars VSIZE
      0000E2 52 02            [ 2]    1     sub sp,#VSIZE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 8.
Hexadecimal [24-Bits]



      0000E4 6B 01            [ 1]  364 	ld (BTW,sp),a ; byte to write 
      0000E6 0F 02            [ 1]  365 	clr (OPT,sp)  ; OPTION flag
                                    366 ; put addr[15:0] in Y, for bounds check.
      0000E8 90 CE 00 11      [ 2]  367 	ldw y,farptr+1   ; Y=addr15:0
                                    368 ; check addr[23:16], if <> 0 then it is extened flash memory
      0000EC 72 5D 00 10      [ 1]  369 	tnz farptr 
      0000F0 26 14            [ 1]  370 	jrne write_flash
      0000F2 90 A3 22 80      [ 2]  371     cpw y,#user_space
      0000F6 24 0E            [ 1]  372     jruge write_flash
      0000F8 90 A3 40 00      [ 2]  373 	cpw y,#EEPROM_BASE  
      0000FC 25 52            [ 1]  374     jrult write_exit
      0000FE 90 A3 48 00      [ 2]  375 	cpw y,#OPTION_BASE
      000102 25 18            [ 1]  376 	jrult write_eeprom
      000104 20 4A            [ 2]  377     jra write_exit
                                    378 ; write program memory
      000106                        379 write_flash:
      000106 CD 00 D2         [ 4]  380 	call unlock_flash 
      000109 9B               [ 1]  381 1$:	sim 
      00010A 7B 01            [ 1]  382 	ld a,(BTW,sp)
      00010C 92 A7 00 10      [ 4]  383 	ldf ([farptr],x),a ; farptr[x]=A
      000110 72 05 50 5F FB   [ 2]  384 	btjf FLASH_IAPSR,#FLASH_IAPSR_EOP,.
      000115 9A               [ 1]  385     rim 
      000116 72 13 50 5F      [ 1]  386     bres FLASH_IAPSR,#FLASH_IAPSR_PUL
      00011A 20 34            [ 2]  387     jra write_exit
                                    388 ; write eeprom and option
      00011C                        389 write_eeprom:
      00011C CD 00 C4         [ 4]  390 	call unlock_eeprom
                                    391 	; check for data eeprom or option eeprom
      00011F 90 A3 48 00      [ 2]  392 	cpw y,#OPTION_BASE
      000123 2B 08            [ 1]  393 	jrmi 1$
      000125 90 A3 48 80      [ 2]  394 	cpw y,#OPTION_END+1
      000129 2A 02            [ 1]  395 	jrpl 1$
      00012B 03 02            [ 1]  396 	cpl (OPT,sp)
      00012D                        397 1$: 
      00012D 0D 02            [ 1]  398     tnz (OPT,sp)
      00012F 27 08            [ 1]  399     jreq 2$
                                    400 	; pour modifier une option il faut modifier ces 2 bits
      000131 72 1E 50 5B      [ 1]  401     bset FLASH_CR2,#FLASH_CR2_OPT
      000135 72 1F 50 5C      [ 1]  402     bres FLASH_NCR2,#FLASH_CR2_OPT 
      000139                        403 2$: 
      000139 7B 01            [ 1]  404     ld a,(BTW,sp)
      00013B 92 A7 00 10      [ 4]  405     ldf ([farptr],x),a
      00013F 0D 02            [ 1]  406     tnz (OPT,sp)
      000141 27 08            [ 1]  407     jreq 3$
      000143 5C               [ 1]  408     incw x
      000144 7B 01            [ 1]  409     ld a,(BTW,sp)
      000146 43               [ 1]  410     cpl a
      000147 92 A7 00 10      [ 4]  411     ldf ([farptr],x),a
      00014B 72 05 50 5F FB   [ 2]  412 3$: btjf FLASH_IAPSR,#FLASH_IAPSR_EOP,.
      000150                        413 write_exit:
      000150                        414 	_drop VSIZE 
      000150 5B 02            [ 2]    1     addw sp,#VSIZE 
      000152 90 85            [ 2]  415 	popw y
      000154 81               [ 4]  416     ret
                                    417 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 9.
Hexadecimal [24-Bits]



                                    418 ;--------------------------------------------
                                    419 ; write a data block to eeprom or flash 
                                    420 ; input:
                                    421 ;   Y        source address   
                                    422 ;   X        array index  destination  farptr[x]
                                    423 ;   BSIZE    block size bytes 
                                    424 ;   farptr   write address , byte* 
                                    425 ; output:
                                    426 ;	X 		after last byte written 
                                    427 ;   Y 		after last byte read 
                                    428 ;  farptr   point after block
                                    429 ;---------------------------------------------
      000155                        430 	_argofs 2 
                           000004     1     ARG_OFS=2+2 
      000155                        431 	_arg BSIZE 1  ; block size
                           000005     1     BSIZE=ARG_OFS+1 
                                    432 	; local var 
                           000001   433 	XSAVE=1 
                           000002   434 	VSIZE=2 
      000155                        435 write_block:
      000155                        436 	_vars VSIZE
      000155 52 02            [ 2]    1     sub sp,#VSIZE 
      000157 1F 01            [ 2]  437 	ldw (XSAVE,sp),x 
      000159 1E 05            [ 2]  438 	ldw x,(BSIZE,sp) 
      00015B 27 13            [ 1]  439 	jreq 9$
      00015D 1E 01            [ 2]  440 1$:	ldw x,(XSAVE,sp)
      00015F 90 F6            [ 1]  441 	ld a,(y)
      000161 CD 00 E0         [ 4]  442 	call write_byte 
      000164 5C               [ 1]  443 	incw x 
      000165 90 5C            [ 1]  444 	incw y 
      000167 1F 01            [ 2]  445 	ldw (XSAVE,sp),x
      000169 1E 05            [ 2]  446 	ldw x,(BSIZE,sp)
      00016B 5A               [ 2]  447 	decw x
      00016C 1F 05            [ 2]  448 	ldw (BSIZE,sp),x 
      00016E 26 ED            [ 1]  449 	jrne 1$
      000170                        450 9$:
      000170 1E 01            [ 2]  451 	ldw x,(XSAVE,sp)
      000172 CD 1A 8D         [ 4]  452 	call incr_farptr
      000175                        453 	_drop VSIZE
      000175 5B 02            [ 2]    1     addw sp,#VSIZE 
      000177 81               [ 4]  454 	ret 
                                    455 
                                    456 
                                    457 ;---------------------------------------------
                                    458 ;   UART3 subroutines
                                    459 ;---------------------------------------------
                                    460 
                                    461 ;---------------------------------------------
                                    462 ; initialize UART3, 115200 8N1
                                    463 ; input:
                                    464 ;	none
                                    465 ; output:
                                    466 ;   none
                                    467 ;---------------------------------------------
      000178                        468 uart3_init:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 10.
Hexadecimal [24-Bits]



      000178 72 16 50 C7      [ 1]  469 	bset CLK_PCKENR1,#CLK_PCKENR1_UART3 
                                    470 	; configure tx pin
      00017C 72 1A 50 11      [ 1]  471 	bset PD_DDR,#BIT5 ; tx pin
      000180 72 1A 50 12      [ 1]  472 	bset PD_CR1,#BIT5 ; push-pull output
      000184 72 1A 50 13      [ 1]  473 	bset PD_CR2,#BIT5 ; fast output
      000188                        474 uart3_set_baud: 
                                    475 ; baud rate 115200 Fmaster=8Mhz  8000000/115200=69=0x45
                                    476 ; 1) check clock source, HSI at 16Mhz or HSE at 8Mhz  
      000188 A6 E1            [ 1]  477 	ld a,#CLK_SWR_HSI
      00018A C1 50 C3         [ 1]  478 	cp a,CLK_CMSR 
      00018D 27 0A            [ 1]  479 	jreq hsi_clock 
      00018F                        480 hse_clock: ; 8 Mhz 	
      00018F 35 05 52 43      [ 1]  481 	mov UART3_BRR2,#0x05 ; must be loaded first
      000193 35 04 52 42      [ 1]  482 	mov UART3_BRR1,#0x4
      000197 20 08            [ 2]  483 	jra uart_enable
      000199                        484 hsi_clock: ; 16 Mhz 	
      000199 35 0B 52 43      [ 1]  485 	mov UART3_BRR2,#0x0b ; must be loaded first
      00019D 35 08 52 42      [ 1]  486 	mov UART3_BRR1,#0x08
      0001A1                        487 uart_enable:	
      0001A1 35 0C 52 45      [ 1]  488 	mov UART3_CR2,#((1<<UART_CR2_TEN)|(1<<UART_CR2_REN));
      0001A5 81               [ 4]  489 	ret
                                    490 	
                                    491 ;---------------------------------
                                    492 ; send character to UART3 
                                    493 ; input:
                                    494 ;   A 
                                    495 ; output:
                                    496 ;   none 
                                    497 ;--------------------------------	
      0001A6                        498 putc:
      0001A6 72 0F 52 40 FB   [ 2]  499 	btjf UART3_SR,#UART_SR_TXE,.
      0001AB C7 52 41         [ 1]  500 	ld UART3_DR,a 
      0001AE 81               [ 4]  501 	ret 
                                    502 
                                    503 ;---------------------------------
                                    504 ; wait character from UART3 
                                    505 ; input:
                                    506 ;   none
                                    507 ; output:
                                    508 ;   A 			char  
                                    509 ;--------------------------------	
      0001AF                        510 getc:
      0001AF 72 0B 52 40 FB   [ 2]  511 	btjf UART3_SR,#UART_SR_RXNE,.
      0001B4 C6 52 41         [ 1]  512 	ld a,UART3_DR 
      0001B7 81               [ 4]  513 	ret 
                                    514 
                                    515 ;-----------------------------
                                    516 ; send an ASCIZ string to UART3 
                                    517 ; input: 
                                    518 ;   x 		char * 
                                    519 ; output:
                                    520 ;   none 
                                    521 ;-------------------------------
      0001B8                        522 puts:
      0001B8 F6               [ 1]  523     ld a,(x)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 11.
Hexadecimal [24-Bits]



      0001B9 27 06            [ 1]  524 	jreq 1$
      0001BB CD 01 A6         [ 4]  525 	call putc 
      0001BE 5C               [ 1]  526 	incw x 
      0001BF 20 F7            [ 2]  527 	jra puts 
      0001C1 81               [ 4]  528 1$:	ret 
                                    529 
                                    530 
                                    531 ;---------------------------
                                    532 ; delete character at left 
                                    533 ; of cursor on terminal 
                                    534 ; input:
                                    535 ;   none 
                                    536 ; output:
                                    537 ;	none 
                                    538 ;---------------------------
      0001C2                        539 bksp:
      0001C2 A6 08            [ 1]  540 	ld a,#BSP 
      0001C4 CD 01 A6         [ 4]  541 	call putc 
      0001C7 A6 20            [ 1]  542 	ld a,#SPACE 
      0001C9 CD 01 A6         [ 4]  543 	call putc 
      0001CC A6 08            [ 1]  544 	ld a,#BSP 
      0001CE CD 01 A6         [ 4]  545 	call putc 
      0001D1 81               [ 4]  546 	ret 
                                    547 ;---------------------------
                                    548 ; delete n character left of cursor 
                                    549 ; at terminal.
                                    550 ; input: 
                                    551 ;   A   	number of characters to delete.
                                    552 ; output:
                                    553 ;    none 
                                    554 ;--------------------------	
      0001D2                        555 delete:
      0001D2 88               [ 1]  556 	push a 
      0001D3 0D 01            [ 1]  557 0$:	tnz (1,sp)
      0001D5 27 07            [ 1]  558 	jreq 1$
      0001D7 CD 01 C2         [ 4]  559 	call bksp 
      0001DA 0A 01            [ 1]  560 	dec (1,sp)
      0001DC 20 F5            [ 2]  561 	jra 0$
      0001DE 84               [ 1]  562 1$:	pop a 
      0001DF 81               [ 4]  563 	ret
                                    564 
                                    565 ;--------------------------
                                    566 ; print n spaces on terminal
                                    567 ; input:
                                    568 ;  X 		number of spaces 
                                    569 ; output:
                                    570 ;	none 
                                    571 ;---------------------------
      0001E0                        572 spaces:
      0001E0 A6 20            [ 1]  573 	ld a,#SPACE 
      0001E2 5D               [ 2]  574 1$:	tnzw x
      0001E3 27 06            [ 1]  575 	jreq 9$
      0001E5 CD 01 A6         [ 4]  576 	call putc 
      0001E8 5A               [ 2]  577 	decw x
      0001E9 20 F7            [ 2]  578 	jra 1$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 12.
Hexadecimal [24-Bits]



      0001EB                        579 9$: 
      0001EB 81               [ 4]  580 	ret 
                                    581 
                           000001   582 .if DEBUG 
                                    583 ;---------------------------------
                                    584 ;; print actual registers states 
                                    585 ;; as pushed on stack 
                                    586 ;; {Y,X,CC,A}
                                    587 ;---------------------------------
      0001EC                        588 	_argofs 0  
                           000002     1     ARG_OFS=2+0 
      0001EC                        589 	_arg R_Y 1 
                           000003     1     R_Y=ARG_OFS+1 
      0001EC                        590 	_arg R_X 3
                           000005     1     R_X=ARG_OFS+3 
      0001EC                        591 	_arg R_A 5
                           000007     1     R_A=ARG_OFS+5 
      0001EC                        592 	_arg R_CC 6
                           000008     1     R_CC=ARG_OFS+6 
      0001EC                        593 prt_regs:
      0001EC AE 02 2F         [ 2]  594 	ldw x,#regs_state 
      0001EF CD 01 B8         [ 4]  595 	call puts
                                    596 ; register PC
      0001F2 16 01            [ 2]  597 	ldw y,(1,sp)
      0001F4 AE 09 2A         [ 2]  598 	ldw x,#REG_EPC 
      0001F7 CD 08 7B         [ 4]  599 	call prt_reg16 
                                    600 ; register CC 
      0001FA 7B 08            [ 1]  601 	ld a,(R_CC,sp)
      0001FC AE 09 3B         [ 2]  602 	ldw x,#REG_CC 
      0001FF CD 08 56         [ 4]  603 	call prt_reg8 
                                    604 ; register A 
      000202 7B 07            [ 1]  605 	ld a,(R_A,sp)
      000204 AE 09 37         [ 2]  606 	ldw x,#REG_A 
      000207 CD 08 56         [ 4]  607 	call prt_reg8 
                                    608 ; register X 
      00020A 16 05            [ 2]  609 	ldw y,(R_X,sp)
      00020C AE 09 33         [ 2]  610 	ldw x,#REG_X 
      00020F CD 08 7B         [ 4]  611 	call prt_reg16 
                                    612 ; register Y 
      000212 16 03            [ 2]  613 	ldw y,(R_Y,sp)
      000214 AE 09 2F         [ 2]  614 	ldw x,#REG_Y 
      000217 CD 08 7B         [ 4]  615 	call prt_reg16 
                                    616 ; register SP 
      00021A 90 96            [ 1]  617 	ldw y,sp
      00021C 72 A9 00 08      [ 2]  618 	addw y,#6+ARG_OFS  
      000220 AE 09 40         [ 2]  619 	ldw x,#REG_SP
      000223 CD 08 7B         [ 4]  620 	call prt_reg16
      000226 A6 0D            [ 1]  621 	ld a,#CR 
      000228 CD 01 A6         [ 4]  622 	call putc
      00022B CD 01 A6         [ 4]  623 	call putc   
      00022E 81               [ 4]  624 	ret 
                                    625 
      00022F 0A 72 65 67 69 73 74   626 regs_state: .asciz "\nregisters state\n--------------------\n"
             65 72 73 20 73 74 61
             74 65 0A 2D 2D 2D 2D
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 13.
Hexadecimal [24-Bits]



             2D 2D 2D 2D 2D 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 0A 00
                                    627 
                                    628 
                                    629 ;--------------------
                                    630 ; print content at address in hex.
                                    631 ; input:
                                    632 ;   X 	address to peek 
                                    633 ; output:
                                    634 ;	none 
                                    635 ;--------------------	
      000256                        636 prt_peek:
      000256 89               [ 2]  637 	pushw x 
      000257 CF 00 08         [ 2]  638 	ldw acc16,x 
      00025A 72 5F 00 07      [ 1]  639 	clr acc24 
      00025E 5F               [ 1]  640 	clrw x 
      00025F A6 10            [ 1]  641 	ld a,#16 
      000261 CD 09 45         [ 4]  642 	call prti24 
      000264 A6 3A            [ 1]  643 	ld a,#': 
      000266 CD 01 A6         [ 4]  644 	call putc 
      000269 A6 20            [ 1]  645 	ld a,#SPACE 
      00026B CD 01 A6         [ 4]  646 	call putc 
      00026E 85               [ 2]  647 	popw x 
      00026F F6               [ 1]  648 	ld a,(x)
      000270 C7 00 09         [ 1]  649 	ld acc8,a 
      000273 5F               [ 1]  650 	clrw x 
      000274 A6 10            [ 1]  651 	ld a,#16 
      000276 CD 09 45         [ 4]  652 	call prti24
      000279 81               [ 4]  653 	ret 
                                    654 .endif ; DEBUG  
                                    655 
                                    656 ;-------------------------------------
                                    657 ; retrun string length
                                    658 ; input:
                                    659 ;   X         .asciz  
                                    660 ; output:
                                    661 ;   X         length 
                                    662 ;-------------------------------------
      00027A                        663 strlen:
      00027A 90 93            [ 1]  664 	ldw y,x 
      00027C 5F               [ 1]  665 	clrw x 
      00027D 90 7D            [ 1]  666 1$:	tnz (y) 
      00027F 27 05            [ 1]  667 	jreq 9$ 
      000281 5C               [ 1]  668 	incw x
      000282 90 5C            [ 1]  669 	incw y 
      000284 20 F7            [ 2]  670 	jra 1$ 
      000286 81               [ 4]  671 9$: ret 
                                    672 
                                    673 ;------------------------------------
                                    674 ; compare 2 strings
                                    675 ; input:
                                    676 ;   X 		char* first string 
                                    677 ;   Y       char* second string 
                                    678 ; output:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 14.
Hexadecimal [24-Bits]



                                    679 ;   A 		0|1 
                                    680 ;-------------------------------------
      000287                        681 strcmp:
      000287 F6               [ 1]  682 	ld a,(x)
      000288 27 0B            [ 1]  683 	jreq 5$ 
      00028A 90 F1            [ 1]  684 	cp a,(y) 
      00028C 26 05            [ 1]  685 	jrne 4$ 
      00028E 5C               [ 1]  686 	incw x 
      00028F 90 5C            [ 1]  687 	incw y 
      000291 20 F4            [ 2]  688 	jra strcmp 
      000293                        689 4$: ; not same  
      000293 4F               [ 1]  690 	clr a 
      000294 81               [ 4]  691 	ret 
      000295                        692 5$: ; same 
      000295 A6 01            [ 1]  693 	ld a,#1 
      000297 81               [ 4]  694 	ret 
                                    695 
                                    696 
                                    697 ;---------------------------------------
                                    698 ;  copy src to dest 
                                    699 ; input:
                                    700 ;   X 		dest 
                                    701 ;   Y 		src 
                                    702 ; output: 
                                    703 ;   X 		dest 
                                    704 ;----------------------------------
      000298                        705 strcpy:
      000298 89               [ 2]  706 	pushw x 
      000299 90 F6            [ 1]  707 1$: ld a,(y)
      00029B 27 06            [ 1]  708 	jreq 9$ 
      00029D F7               [ 1]  709 	ld (x),a 
      00029E 5C               [ 1]  710 	incw x 
      00029F 90 5C            [ 1]  711 	incw y 
      0002A1 20 F6            [ 2]  712 	jra 1$ 
      0002A3 7F               [ 1]  713 9$:	clr (x)
      0002A4 85               [ 2]  714 	popw x 
      0002A5 81               [ 4]  715 	ret 
                                    716 
                                    717 ;---------------------------------------
                                    718 ; move memory block 
                                    719 ; input:
                                    720 ;   X 		destination 
                                    721 ;   Y 	    source 
                                    722 ;   acc16	size 
                                    723 ; output:
                                    724 ;   none 
                                    725 ;--------------------------------------
                           000001   726 	INCR=1 ; increament high byte 
                           000002   727 	LB=2 ; increament low byte 
                           000002   728 	VSIZE=2
      0002A6                        729 move:
      0002A6                        730 	_vars VSIZE 
      0002A6 52 02            [ 2]    1     sub sp,#VSIZE 
      0002A8 0F 01            [ 1]  731 	clr (INCR,sp)
      0002AA 0F 02            [ 1]  732 	clr (LB,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 15.
Hexadecimal [24-Bits]



      0002AC 90 89            [ 2]  733 	pushw y 
      0002AE 13 01            [ 2]  734 	cpw x,(1,sp) ; compare DEST to SRC 
      0002B0 90 85            [ 2]  735 	popw y 
      0002B2 27 31            [ 1]  736 	jreq move_exit ; x==y 
      0002B4 2B 0E            [ 1]  737 	jrmi move_down
      0002B6                        738 move_up: ; start from top address with incr=-1
      0002B6 72 BB 00 08      [ 2]  739 	addw x,acc16
      0002BA 72 B9 00 08      [ 2]  740 	addw y,acc16
      0002BE 03 01            [ 1]  741 	cpl (INCR,sp)
      0002C0 03 02            [ 1]  742 	cpl (LB,sp)   ; increment = -1 
      0002C2 20 05            [ 2]  743 	jra move_loop  
      0002C4                        744 move_down: ; start from bottom address with incr=1 
      0002C4 5A               [ 2]  745     decw x 
      0002C5 90 5A            [ 2]  746 	decw y
      0002C7 0C 02            [ 1]  747 	inc (LB,sp) ; incr=1 
      0002C9                        748 move_loop:	
      0002C9 C6 00 08         [ 1]  749     ld a, acc16 
      0002CC CA 00 09         [ 1]  750 	or a, acc8
      0002CF 27 14            [ 1]  751 	jreq move_exit 
      0002D1 72 FB 01         [ 2]  752 	addw x,(INCR,sp)
      0002D4 72 F9 01         [ 2]  753 	addw y,(INCR,sp) 
      0002D7 90 F6            [ 1]  754 	ld a,(y)
      0002D9 F7               [ 1]  755 	ld (x),a 
      0002DA 89               [ 2]  756 	pushw x 
      0002DB CE 00 08         [ 2]  757 	ldw x,acc16 
      0002DE 5A               [ 2]  758 	decw x 
      0002DF CF 00 08         [ 2]  759 	ldw acc16,x 
      0002E2 85               [ 2]  760 	popw x 
      0002E3 20 E4            [ 2]  761 	jra move_loop
      0002E5                        762 move_exit:
      0002E5                        763 	_drop VSIZE
      0002E5 5B 02            [ 2]    1     addw sp,#VSIZE 
      0002E7 81               [ 4]  764 	ret 	
                                    765 
                                    766 ;-------------------------------------
                                    767 ; search text area for a line with 
                                    768 ; same number as line#  
                                    769 ; input:
                                    770 ;	X 			line# 
                                    771 ; output:
                                    772 ;   X 			addr of line | 0 
                                    773 ;   Y           line#|insert address if not found  
                                    774 ;-------------------------------------
                           000001   775 	LL=1 ; line length 
                           000002   776 	LB=2 ; line length low byte 
                           000002   777 	VSIZE=2 
      0002E8                        778 search_lineno:
      0002E8                        779 	_vars VSIZE
      0002E8 52 02            [ 2]    1     sub sp,#VSIZE 
      0002EA 0F 01            [ 1]  780 	clr (LL,sp)
      0002EC 90 CE 00 18      [ 2]  781 	ldw y,txtbgn
      0002F0                        782 search_ln_loop:
      0002F0 90 C3 00 1A      [ 2]  783 	cpw y,txtend 
      0002F4 2A 10            [ 1]  784 	jrpl 8$
      0002F6 90 F3            [ 1]  785 	cpw x,(y)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 16.
Hexadecimal [24-Bits]



      0002F8 27 0E            [ 1]  786 	jreq 9$
      0002FA 2B 0A            [ 1]  787 	jrmi 8$ 
      0002FC 90 E6 02         [ 1]  788 	ld a,(2,y)
      0002FF 6B 02            [ 1]  789 	ld (LB,sp),a 
      000301 72 F9 01         [ 2]  790 	addw y,(LL,sp)
      000304 20 EA            [ 2]  791 	jra search_ln_loop 
      000306                        792 8$: 
      000306 5F               [ 1]  793 	clrw x 	
      000307 51               [ 1]  794 	exgw x,y 
      000308                        795 9$: _drop VSIZE
      000308 5B 02            [ 2]    1     addw sp,#VSIZE 
      00030A 51               [ 1]  796 	exgw x,y   
      00030B 81               [ 4]  797 	ret 
                                    798 
                                    799 ;-------------------------------------
                                    800 ; delete line at addr
                                    801 ; move new line to insert with end of text 
                                    802 ; otherwise it would be overwritten.
                                    803 ; input:
                                    804 ;   X 		addr of line i.e DEST for move 
                                    805 ;-------------------------------------
                           000001   806 	LLEN=1
                           000003   807 	SRC=3
                           000004   808 	VSIZE=4
      00030C                        809 del_line: 
      00030C                        810 	_vars VSIZE 
      00030C 52 04            [ 2]    1     sub sp,#VSIZE 
      00030E E6 02            [ 1]  811 	ld a,(2,x) ; line length
      000310 6B 02            [ 1]  812 	ld (LLEN+1,sp),a 
      000312 0F 01            [ 1]  813 	clr (LLEN,sp)
      000314 90 93            [ 1]  814 	ldw y,x  
      000316 72 F9 01         [ 2]  815 	addw y,(LLEN,sp) ;SRC  
      000319 17 03            [ 2]  816 	ldw (SRC,sp),y  ;save source 
      00031B 90 CE 00 1A      [ 2]  817 	ldw y,txtend 
      00031F 90 E6 02         [ 1]  818 	ld a,(2,y)
      000322 90 5F            [ 1]  819 	clrw y 
      000324 90 97            [ 1]  820 	ld yl,a  
      000326 72 B9 00 1A      [ 2]  821 	addw y,txtend
      00032A 72 F2 03         [ 2]  822 	subw y,(SRC,sp) ; y=count 
      00032D 90 CF 00 08      [ 2]  823 	ldw acc16,y 
      000331 16 03            [ 2]  824 	ldw y,(SRC,sp)    ; source
      000333 CD 02 A6         [ 4]  825 	call move
      000336 90 CE 00 1A      [ 2]  826 	ldw y,txtend 
      00033A 72 F2 01         [ 2]  827 	subw y,(LLEN,sp)
      00033D 90 CF 00 1A      [ 2]  828 	ldw txtend,y  
      000341                        829 	_drop VSIZE     
      000341 5B 04            [ 2]    1     addw sp,#VSIZE 
      000343 81               [ 4]  830 	ret 
                                    831 
                                    832 ;---------------------------------------------
                                    833 ; create a gap in text area 
                                    834 ; move new line to insert in gap with end of text
                                    835 ; otherwise it would be overwritten.
                                    836 ; input:
                                    837 ;    X 			addr gap start 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 17.
Hexadecimal [24-Bits]



                                    838 ;    Y 			gap length 
                                    839 ; output:
                                    840 ;    X 			addr gap start 
                                    841 ;--------------------------------------------
                           000001   842 	DEST=1
                           000003   843 	SRC=3
                           000005   844 	LEN=5
                           000006   845 	VSIZE=6 
      000344                        846 create_gap:
      000344                        847 	_vars VSIZE
      000344 52 06            [ 2]    1     sub sp,#VSIZE 
      000346 1F 03            [ 2]  848 	ldw (SRC,sp),x 
      000348 17 05            [ 2]  849 	ldw (LEN,sp),y 
      00034A 90 CF 00 08      [ 2]  850 	ldw acc16,y 
      00034E 90 93            [ 1]  851 	ldw y,x ; SRC
      000350 72 BB 00 08      [ 2]  852 	addw x,acc16  
      000354 1F 01            [ 2]  853 	ldw (DEST,sp),x 
                                    854 ;compute size to move 	
      000356 CE 00 1A         [ 2]  855 	ldw x,txtend 
      000359 E6 02            [ 1]  856 	ld a,(2,x) ; pending line length 
      00035B C7 00 09         [ 1]  857 	ld acc8,a 
      00035E 72 5F 00 08      [ 1]  858 	clr acc16 
      000362 72 BB 00 08      [ 2]  859 	addw x,acc16 
      000366 72 F0 03         [ 2]  860 	subw x,(SRC,sp)
      000369 CF 00 08         [ 2]  861 	ldw acc16,x ; size to move
      00036C 1E 01            [ 2]  862 	ldw x,(DEST,sp) 
      00036E CD 02 A6         [ 4]  863 	call move
      000371 CE 00 1A         [ 2]  864 	ldw x,txtend
      000374 72 FB 05         [ 2]  865 	addw x,(LEN,sp)
      000377 CF 00 1A         [ 2]  866 	ldw txtend,x
      00037A                        867 9$:	_drop VSIZE 
      00037A 5B 06            [ 2]    1     addw sp,#VSIZE 
      00037C 81               [ 4]  868 	ret 
                                    869 
                                    870 
                                    871 ;--------------------------------------------
                                    872 ; insert line in tib into text area 
                                    873 ; first search for already existing 
                                    874 ; replace existing 
                                    875 ; if strlen(tib)==0 delete existing 
                                    876 ; input:
                                    877 ;   ptr16 				pointer to tokenized line  
                                    878 ; output:
                                    879 ;   none
                                    880 ;---------------------------------------------
                           000001   881 	DEST=1  ; text area insertion address 
                           000003   882 	SRC=3   ; str to insert address 
                           000005   883 	LINENO=5 ; line number 
                           000007   884 	LLEN=7 ; line length 
                           000008   885 	VSIZE=8  
      00037D                        886 insert_line:
      00037D                        887 	_vars VSIZE 
      00037D 52 08            [ 2]    1     sub sp,#VSIZE 
      00037F CE 00 11         [ 2]  888 	ldw x,ptr16  
      000382 C3 00 18         [ 2]  889 	cpw x,txtbgn 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 18.
Hexadecimal [24-Bits]



      000385 26 0D            [ 1]  890 	jrne 0$
                                    891 ;first text line 
      000387 AE 00 02         [ 2]  892 	ldw x,#2 
      00038A 72 D6 00 11      [ 4]  893 	ld a,([ptr16],x)
      00038E 5F               [ 1]  894 	clrw x 
      00038F 97               [ 1]  895 	ld xl,a
      000390 1F 07            [ 2]  896 	ldw (LLEN,sp),x  
      000392 20 45            [ 2]  897 	jra 5$
      000394 72 CE 00 11      [ 5]  898 0$:	ldw x,[ptr16]
                                    899 ; new line number
      000398 1F 05            [ 2]  900 	ldw (LINENO,sp),x 
      00039A AE 00 02         [ 2]  901 	ldw x,#2 
      00039D 72 D6 00 11      [ 4]  902 	ld a,([ptr16],x)
      0003A1 97               [ 1]  903 	ld xl,a
                                    904 ; new line length
      0003A2 1F 07            [ 2]  905 	ldw (LLEN,sp),x
                                    906 ; check if that line number already exit 	
      0003A4 1E 05            [ 2]  907 	ldw x,(LINENO,sp)
      0003A6 CD 02 E8         [ 4]  908 	call search_lineno 
      0003A9 5D               [ 2]  909 	tnzw x 
      0003AA 26 04            [ 1]  910 	jrne 2$
                                    911 ; line doesn't exit
                                    912 ; it will be inserted at this point.  	
      0003AC 17 01            [ 2]  913 	ldw (DEST,sp),y 
      0003AE 20 05            [ 2]  914 	jra 3$
                                    915 ; line exit delete it.
                                    916 ; it will be replaced by new one 	
      0003B0 1F 01            [ 2]  917 2$: ldw (DEST,sp),x 
      0003B2 CD 03 0C         [ 4]  918 	call del_line
      0003B5                        919 3$: 
                                    920 ; insert new line or leave if LLEN==3
                                    921 ; LLEN==3 means empty line 
      0003B5 A6 03            [ 1]  922 	ld a,#3
      0003B7 11 08            [ 1]  923 	cp a,(LLEN+1,sp)
      0003B9 27 27            [ 1]  924 	jreq insert_ln_exit ; empty line exit.
                                    925 ; if insertion point at txtend 
                                    926 ; no move required 
      0003BB 1E 01            [ 2]  927 	ldw x,(DEST,sp)
      0003BD C3 00 1A         [ 2]  928 	cpw x,txtend 
      0003C0 2A 17            [ 1]  929 	jrpl 5$ 
                                    930 ; must create a gap
                                    931 ; at insertion point  
      0003C2 1E 01            [ 2]  932 	ldw x,(DEST,sp)
      0003C4 16 07            [ 2]  933 	ldw y,(LLEN,sp)
      0003C6 CD 03 44         [ 4]  934 	call create_gap 
                                    935 ; move new line in gap 
      0003C9 1E 07            [ 2]  936 	ldw x,(LLEN,sp)
      0003CB CF 00 08         [ 2]  937 	ldw acc16,x 
      0003CE 90 CE 00 1A      [ 2]  938 	ldw y,txtend ;SRC 
      0003D2 1E 01            [ 2]  939 	ldw x,(DEST,sp) ; dest address 
      0003D4 CD 02 A6         [ 4]  940 	call move 
      0003D7 20 09            [ 2]  941 	jra insert_ln_exit  
      0003D9                        942 5$: ; no move required 
      0003D9 1E 07            [ 2]  943 	ldw x,(LLEN,sp) 
      0003DB 72 BB 00 1A      [ 2]  944 	addw x,txtend 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 19.
Hexadecimal [24-Bits]



      0003DF CF 00 1A         [ 2]  945 	ldw txtend,x 
      0003E2                        946 insert_ln_exit:	
      0003E2                        947 	_drop VSIZE
      0003E2 5B 08            [ 2]    1     addw sp,#VSIZE 
      0003E4 81               [ 4]  948 	ret
                                    949 
                                    950 
                                    951 ;-----------------------------
                                    952 ; check if text buffer full
                                    953 ; input:
                                    954 ;   ptr16     addr start tokenize line 
                                    955 ;   X         buffer index 
                                    956 ; output:
                                    957 ;   none 
                                    958 ;-----------------------------------
      0003E5                        959 check_full:
      0003E5 72 BB 00 11      [ 2]  960 	addw x,ptr16 
      0003E9 A3 16 C8         [ 2]  961 	cpw x,#tib 
      0003EC 25 05            [ 1]  962 	jrult 1$
      0003EE A6 01            [ 1]  963 	ld a,#ERR_MEM_FULL
      0003F0 CC 07 16         [ 2]  964 	jp tb_error 
      0003F3 81               [ 4]  965 1$: ret 
                                    966 
                                    967 
                                    968 ;-----------------------------------
                                    969 ; create token list form text line 
                                    970 ; save this list in text area
                                    971 ; input:
                                    972 ;   none
                                    973 ; output:
                                    974 ;   basicptr     token list buffer
                                    975 ;   line# 		 BASIC line number 
                                    976 ;   in.w  		 cleared 
                                    977 ;-----------------------------------
                                    978 	.macro _incr_ptr16 n 
                                    979 	ldw x,#n 
                                    980 	addw x,ptr16 
                                    981 	ldw ptr16,x 
                                    982 	.endm 
                                    983 
                           000001   984 	XSAVE=1
                           000003   985 	BUFIDX=3
                           000004   986 	VSIZE=4
      0003F4                        987 compile:
      0003F4                        988 	_vars VSIZE 
      0003F4 52 04            [ 2]    1     sub sp,#VSIZE 
      0003F6 72 1A 00 1F      [ 1]  989 	bset flags,#FCOMP 
      0003FA CE 00 1A         [ 2]  990 	ldw x,txtend
      0003FD CF 00 11         [ 2]  991 	ldw ptr16,x 
      000400 5F               [ 1]  992 	clrw x 
      000401 AE 00 03         [ 2]  993 	ldw x,#3
      000404 1F 03            [ 2]  994 	ldw (BUFIDX,sp),X  
      000406 CD 03 E5         [ 4]  995 	call check_full
      000409 5F               [ 1]  996 	clrw x 
      00040A 72 CF 00 11      [ 5]  997 	ldw [ptr16],x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 20.
Hexadecimal [24-Bits]



      00040E CD 0C F4         [ 4]  998 	call get_token
      000411 1F 01            [ 2]  999 	ldw (XSAVE,sp),x 
      000413 A1 04            [ 1] 1000 	cp a,#TK_INTGR 
      000415 26 11            [ 1] 1001 	jrne 3$
      000417 A3 00 00         [ 2] 1002 	cpw x,#0  
      00041A 22 03            [ 1] 1003 	jrugt 1$
      00041C CC 07 14         [ 2] 1004 	jp syntax_error 
      00041F 72 CF 00 11      [ 5] 1005 1$:	ldw [ptr16],x; line number
      000423 CD 0C F4         [ 4] 1006 2$:	call get_token
      000426 1F 01            [ 2] 1007 	ldw (XSAVE,sp),x 
      000428 A1 00            [ 1] 1008 3$:	cp a,#TK_NONE 
      00042A 26 03            [ 1] 1009 	jrne 30$
      00042C CC 04 BF         [ 2] 1010 	jp 9$
      00042F                       1011 30$: 	 
      00042F 1E 03            [ 2] 1012 	ldw x,(BUFIDX,sp)
      000431 CD 03 E5         [ 4] 1013 	call check_full 
      000434 16 03            [ 2] 1014 	ldw y,(BUFIDX,sp) 
      000436 91 D7 11         [ 4] 1015 	ld ([ptr16],y),a ; token attribute 
      000439 90 5C            [ 1] 1016 	incw y
      00043B 17 03            [ 2] 1017 	ldw (BUFIDX,sp),y
      00043D A1 01            [ 1] 1018 	cp a,#TK_COLON 
      00043F 26 02            [ 1] 1019 	jrne 31$
      000441 20 E0            [ 2] 1020 	jra 2$ 
      000443                       1021 31$:
      000443 A1 03            [ 1] 1022 	cp a,#TK_CHAR
      000445 26 0C            [ 1] 1023 	jrne 32$ 
      000447 1E 01            [ 2] 1024 	ldw x,(XSAVE,sp)
      000449 9F               [ 1] 1025 	ld a,xl 
      00044A 91 D7 11         [ 4] 1026 	ld ([ptr16],y),a
      00044D 90 5C            [ 1] 1027 	incw y 
      00044F 17 03            [ 2] 1028 	ldw (BUFIDX,sp),y 
      000451 20 D0            [ 2] 1029 	jra 2$ 
      000453                       1030 32$:
      000453 A1 02            [ 1] 1031 	cp a,#TK_ARRAY 
      000455 27 CC            [ 1] 1032 	jreq 2$ 
      000457 A1 0A            [ 1] 1033 	cp a,#TK_QSTR 
      000459 26 25            [ 1] 1034 	jrne 4$
      00045B AE 17 18         [ 2] 1035 	ldw x,#pad 
      00045E CD 02 7A         [ 4] 1036 	call strlen
      000461 5C               [ 1] 1037 	incw x  
      000462 CD 03 E5         [ 4] 1038 	call check_full 
      000465 90 AE 17 18      [ 2] 1039 	ldw y,#pad 
      000469 CE 00 11         [ 2] 1040 	ldw x,ptr16
      00046C 72 FB 03         [ 2] 1041 	addw x,(BUFIDX,sp)	
      00046F CD 02 98         [ 4] 1042 	call strcpy 
      000472 AE 17 18         [ 2] 1043 	ldw x,#pad 
      000475 CD 02 7A         [ 4] 1044 	call strlen 
      000478 5C               [ 1] 1045 	incw x
      000479 72 FB 03         [ 2] 1046 	addw x,(BUFIDX,sp) 
      00047C 1F 03            [ 2] 1047 	ldw (BUFIDX,sp),x
      00047E 20 A3            [ 2] 1048 	jra 2$  
      000480 A1 04            [ 1] 1049 4$: cp a,#TK_INTGR
      000482 25 9F            [ 1] 1050 	jrult 2$
      000484 A1 09            [ 1] 1051 	cp a,#TK_CONST 
      000486 22 9B            [ 1] 1052 	Jrugt 2$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 21.
Hexadecimal [24-Bits]



      000488 1E 01            [ 2] 1053 	ldw x,(XSAVE,sp) 
      00048A 16 03            [ 2] 1054 	ldw y,(BUFIDX,sp)
      00048C 91 DF 11         [ 5] 1055 	ldw ([ptr16],y),x
      00048F A3 17 07         [ 2] 1056 	cpw x,#rem 
      000492 26 22            [ 1] 1057 	jrne 5$	
                                   1058 ; comment advance in.w to eol 
      000494 72 A9 00 02      [ 2] 1059 	addw y,#2 ; skip exec address 
      000498 17 03            [ 2] 1060 	ldw (BUFIDX,sp),y 
      00049A CE 00 11         [ 2] 1061 	ldw x,ptr16 
      00049D 72 FB 03         [ 2] 1062 	addw x,(BUFIDX,sp)
      0004A0 90 CE 00 00      [ 2] 1063 	ldw y,in.w 
      0004A4 72 A9 16 C8      [ 2] 1064 	addw y,#tib 
      0004A8 CD 02 98         [ 4] 1065 	call strcpy 	
      0004AB CD 02 7A         [ 4] 1066 	call strlen 
      0004AE 5C               [ 1] 1067 	incw x ; skip string 0. 
      0004AF 72 FB 03         [ 2] 1068 	addw x,(BUFIDX,sp)
      0004B2 1F 03            [ 2] 1069 	ldw (BUFIDX,sp),x 
      0004B4 20 09            [ 2] 1070 	jra 9$
      0004B6 72 A9 00 02      [ 2] 1071 5$:	addw y,#2 
      0004BA 17 03            [ 2] 1072 	ldw (BUFIDX,sp),y 
      0004BC CC 04 23         [ 2] 1073 	jp 2$
      0004BF                       1074 9$: 
      0004BF AE 00 02         [ 2] 1075 	ldw x,#2
      0004C2 16 03            [ 2] 1076 	ldw y,(BUFIDX,sp)
      0004C4 90 9F            [ 1] 1077 	ld a,yl 
      0004C6 72 D7 00 11      [ 4] 1078 	ld ([ptr16],x),a  	
      0004CA 72 CE 00 11      [ 5] 1079 	ldw x,[ptr16]
      0004CE 27 09            [ 1] 1080 	jreq 10$
      0004D0 CD 03 7D         [ 4] 1081 	call insert_line
      0004D3 72 5F 00 03      [ 1] 1082 	clr  count 
      0004D7 20 0F            [ 2] 1083 	jra  11$ 
      0004D9                       1084 10$: 
      0004D9 CE 00 11         [ 2] 1085 	ldw x,ptr16 
      0004DC CF 00 04         [ 2] 1086 	ldw basicptr,x 
      0004DF E6 02            [ 1] 1087 	ld a,(2,x)
      0004E1 C7 00 03         [ 1] 1088 	ld count,a 
      0004E4 35 03 00 01      [ 1] 1089 	mov in,#3 
      0004E8                       1090 11$:
      0004E8                       1091 	_drop VSIZE 
      0004E8 5B 04            [ 2]    1     addw sp,#VSIZE 
      0004EA 72 1B 00 1F      [ 1] 1092 	bres flags,#FCOMP 
      0004EE 81               [ 4] 1093 	ret 
                                   1094 
                                   1095 
                                   1096 ;------------------------------------
                                   1097 ;  set all variables to zero 
                                   1098 ; input:
                                   1099 ;   none 
                                   1100 ; output:
                                   1101 ;	none
                                   1102 ;------------------------------------
      0004EF                       1103 clear_vars:
      0004EF AE 00 21         [ 2] 1104 	ldw x,#vars 
      0004F2 90 AE 00 34      [ 2] 1105 	ldw y,#2*26 
      0004F6 7F               [ 1] 1106 1$:	clr (x)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 22.
Hexadecimal [24-Bits]



      0004F7 5C               [ 1] 1107 	incw x 
      0004F8 90 5A            [ 2] 1108 	decw y 
      0004FA 26 FA            [ 1] 1109 	jrne 1$
      0004FC 81               [ 4] 1110 	ret 
                                   1111 
                                   1112 ;-------------------------------------
                                   1113 ; check if A is a letter
                                   1114 ; input:
                                   1115 ;   A 			character to test 
                                   1116 ; output:
                                   1117 ;   C flag      1 true, 0 false 
                                   1118 ;-------------------------------------
      0004FD                       1119 is_alpha:
      0004FD A1 41            [ 1] 1120 	cp a,#'A 
      0004FF 8C               [ 1] 1121 	ccf
      000500 24 0B            [ 1] 1122 	jrnc 9$ 
      000502 A1 5B            [ 1] 1123 	cp a,#'Z+1 
      000504 25 07            [ 1] 1124 	jrc 9$ 
      000506 A1 61            [ 1] 1125 	cp a,#'a 
      000508 8C               [ 1] 1126 	ccf 
      000509 24 02            [ 1] 1127 	jrnc 9$
      00050B A1 7B            [ 1] 1128 	cp a,#'z+1   
      00050D 81               [ 4] 1129 9$: ret 	
                                   1130 
                                   1131 ;-------------------------------------
                                   1132 ;  program initialization entry point 
                                   1133 ;-------------------------------------
                           000001  1134 	MAJOR=1
                           000000  1135 	MINOR=0
      00050E 0A 0A 54 69 6E 79 20  1136 software: .asciz "\n\nTiny BASIC for STM8\nCopyright, Jacques Deschenes 2019,2020\nversion "
             42 41 53 49 43 20 66
             6F 72 20 53 54 4D 38
             0A 43 6F 70 79 72 69
             67 68 74 2C 20 4A 61
             63 71 75 65 73 20 44
             65 73 63 68 65 6E 65
             73 20 32 30 31 39 2C
             32 30 32 30 0A 76 65
             72 73 69 6F 6E 20 00
      000554                       1137 cold_start:
                                   1138 ;set stack 
      000554 AE 17 FF         [ 2] 1139 	ldw x,#STACK_EMPTY
      000557 94               [ 1] 1140 	ldw sp,x   
                                   1141 ; clear all ram 
      000558 7F               [ 1] 1142 0$: clr (x)
      000559 5A               [ 2] 1143 	decw x 
      00055A 26 FC            [ 1] 1144 	jrne 0$
                                   1145 ; activate pull up on all inputs 
      00055C A6 FF            [ 1] 1146 	ld a,#255 
      00055E C7 50 03         [ 1] 1147 	ld PA_CR1,a 
      000561 C7 50 08         [ 1] 1148 	ld PB_CR1,a 
      000564 C7 50 0D         [ 1] 1149 	ld PC_CR1,a 
      000567 C7 50 12         [ 1] 1150 	ld PD_CR1,a 
      00056A C7 50 17         [ 1] 1151 	ld PE_CR1,a 
      00056D C7 50 1C         [ 1] 1152 	ld PF_CR1,a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 23.
Hexadecimal [24-Bits]



      000570 C7 50 21         [ 1] 1153 	ld PG_CR1,a 
      000573 C7 50 2B         [ 1] 1154 	ld PI_CR1,a 
                                   1155 ; disable schmitt triggers on Arduino CN4 analog inputs
      000576 55 00 3F 54 07   [ 1] 1156 	mov ADC_TDRL,0x3f
                                   1157 ; disable peripherals clocks
      00057B 72 5F 50 C7      [ 1] 1158 	clr CLK_PCKENR1 
      00057F 72 5F 50 CA      [ 1] 1159 	clr CLK_PCKENR2 
                                   1160 			
                                   1161 ; select internal clock no divisor: 16 Mhz 	
      000583 A6 E1            [ 1] 1162 	ld a,#CLK_SWR_HSI 
      000585 5F               [ 1] 1163 	clrw x  
      000586 CD 00 99         [ 4] 1164     call clock_init 
      000589 CD 00 AF         [ 4] 1165 	call timer4_init
                                   1166 ; UART3 at 115200 BAUD
      00058C CD 01 78         [ 4] 1167 	call uart3_init
                                   1168 ; activate PE_4 (user button interrupt)
      00058F 72 18 50 18      [ 1] 1169     bset PE_CR2,#USR_BTN_BIT 
                                   1170 ; display system information
      000593 AE 05 0E         [ 2] 1171 	ldw x,#software 
      000596 CD 01 B8         [ 4] 1172 	call puts 
      000599 A6 01            [ 1] 1173 	ld a,#MAJOR 
      00059B C7 00 09         [ 1] 1174 	ld acc8,a 
      00059E 5F               [ 1] 1175 	clrw x 
      00059F CF 00 07         [ 2] 1176 	ldw acc24,x 
      0005A2 A6 0A            [ 1] 1177 	ld a,#10 
      0005A4 CD 09 45         [ 4] 1178 	call prti24 
      0005A7 A6 2E            [ 1] 1179 	ld a,#'.
      0005A9 CD 01 A6         [ 4] 1180 	call putc 
      0005AC A6 00            [ 1] 1181 	ld a,#MINOR 
      0005AE C7 00 09         [ 1] 1182 	ld acc8,a 
      0005B1 5F               [ 1] 1183 	clrw x 
      0005B2 CF 00 07         [ 2] 1184 	ldw acc24,x 
      0005B5 A6 0A            [ 1] 1185 	ld a,#10 
      0005B7 CD 09 45         [ 4] 1186 	call prti24 
      0005BA A6 0D            [ 1] 1187 	ld a,#CR 
      0005BC CD 01 A6         [ 4] 1188 	call putc 
      0005BF CD 1A 9B         [ 4] 1189 	call seek_fdrive 
                                   1190 ; configure LD2 pin 
      0005C2 72 1A 50 0D      [ 1] 1191     bset PC_CR1,#LED2_BIT
      0005C6 72 1A 50 0E      [ 1] 1192     bset PC_CR2,#LED2_BIT
      0005CA 72 1A 50 0C      [ 1] 1193     bset PC_DDR,#LED2_BIT
      0005CE 9A               [ 1] 1194 	rim 
      0005CF 72 5C 00 0F      [ 1] 1195 	inc seedy+1 
      0005D3 72 5C 00 0D      [ 1] 1196 	inc seedx+1 
      0005D7 CD 05 E6         [ 4] 1197 	call clear_basic
      0005DA CD 13 74         [ 4] 1198 	call ubound 
      0005DD CD 0F 93         [ 4] 1199 	call dpop 
      0005E0 CF 00 1D         [ 2] 1200 	ldw array_size,x 
      0005E3 CC 07 68         [ 2] 1201     jp warm_start 
                                   1202 
                                   1203 ;---------------------------
                                   1204 ; reset BASIC text variables 
                                   1205 ; and clear variables 
                                   1206 ;---------------------------
      0005E6                       1207 clear_basic:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 24.
Hexadecimal [24-Bits]



      0005E6 72 5F 00 03      [ 1] 1208 	clr count 
      0005EA AE 00 55         [ 2] 1209 	ldw x,#free_ram 
      0005ED CF 00 18         [ 2] 1210 	ldw txtbgn,x 
      0005F0 CF 00 1A         [ 2] 1211 	ldw txtend,x 
      0005F3 CD 04 EF         [ 4] 1212 	call clear_vars 
      0005F6 81               [ 4] 1213 	ret 
                                   1214 
                                   1215 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                   1216 ;;   Tiny BASIC error messages     ;;
                                   1217 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      0005F7                       1218 err_msg:
      0005F7 00 00 06 0F 06 1D 06  1219 	.word 0,err_mem_full, err_syntax, err_math_ovf, err_div0,err_no_line    
             2C 06 46 06 56
      000603 06 6D 06 84 06 9F 06  1220 	.word err_run_only,err_cmd_only,err_duplicate,err_not_file,err_bad_value
             B1 06 C3
      00060D 06 D0                 1221 	.word err_no_access 
                                   1222 
      00060F 0A 4D 65 6D 6F 72 79  1223 err_mem_full: .asciz "\nMemory full\n" 
             20 66 75 6C 6C 0A 00
      00061D 0A 73 79 6E 74 61 78  1224 err_syntax: .asciz "\nsyntax error\n" 
             20 65 72 72 6F 72 0A
             00
      00062C 0A 6D 61 74 68 20 6F  1225 err_math_ovf: .asciz "\nmath operation overflow\n"
             70 65 72 61 74 69 6F
             6E 20 6F 76 65 72 66
             6C 6F 77 0A 00
      000646 0A 64 69 76 69 73 69  1226 err_div0: .asciz "\ndivision by 0\n" 
             6F 6E 20 62 79 20 30
             0A 00
      000656 0A 69 6E 76 61 6C 69  1227 err_no_line: .asciz "\ninvalid line number.\n"
             64 20 6C 69 6E 65 20
             6E 75 6D 62 65 72 2E
             0A 00
      00066D 0A 72 75 6E 20 74 69  1228 err_run_only: .asciz "\nrun time only usage.\n" 
             6D 65 20 6F 6E 6C 79
             20 75 73 61 67 65 2E
             0A 00
      000684 0A 63 6F 6D 6D 61 6E  1229 err_cmd_only: .asciz "\ncommand line only usage.\n"
             64 20 6C 69 6E 65 20
             6F 6E 6C 79 20 75 73
             61 67 65 2E 0A 00
      00069F 0A 64 75 70 6C 69 63  1230 err_duplicate: .asciz "\nduplicate name.\n"
             61 74 65 20 6E 61 6D
             65 2E 0A 00
      0006B1 0A 46 69 6C 65 20 6E  1231 err_not_file: .asciz "\nFile not found.\n"
             6F 74 20 66 6F 75 6E
             64 2E 0A 00
      0006C3 0A 62 61 64 20 76 61  1232 err_bad_value: .asciz "\nbad value.\n"
             6C 75 65 2E 0A 00
      0006D0 0A 46 69 6C 65 20 69  1233 err_no_access: .asciz "\nFile in extended memory, can't be run from there.\n" 
             6E 20 65 78 74 65 6E
             64 65 64 20 6D 65 6D
             6F 72 79 2C 20 63 61
             6E 27 74 20 62 65 20
             72 75 6E 20 66 72 6F
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 25.
Hexadecimal [24-Bits]



             6D 20 74 68 65 72 65
             2E 0A 00
                                   1234 
      000704 6C 61 73 74 20 74 6F  1235 rt_msg: .asciz "last token id: "
             6B 65 6E 20 69 64 3A
             20 00
                                   1236 
      000714                       1237 syntax_error:
      000714 A6 02            [ 1] 1238 	ld a,#ERR_SYNTAX 
                                   1239 
      000716                       1240 tb_error:
      000716 AE 05 F7         [ 2] 1241 	ldw x, #err_msg 
      000719 72 5F 00 08      [ 1] 1242 	clr acc16 
      00071D 48               [ 1] 1243 	sll a
      00071E 72 59 00 08      [ 1] 1244 	rlc acc16  
      000722 C7 00 09         [ 1] 1245 	ld acc8, a 
      000725 72 BB 00 08      [ 2] 1246 	addw x,acc16 
      000729 FE               [ 2] 1247 	ldw x,(x)
      00072A CD 01 B8         [ 4] 1248 	call puts
      00072D 72 0B 00 1F 18   [ 2] 1249 	btjf flags,#FCOMP, 1$
      000732 AE 16 C8         [ 2] 1250 	ldw x,#tib
      000735 CD 01 B8         [ 4] 1251 	call puts 
      000738 A6 0D            [ 1] 1252 	ld a,#CR 
      00073A CD 01 A6         [ 4] 1253 	call putc
      00073D CE 00 00         [ 2] 1254 	ldw x,in.w
      000740 CD 01 E0         [ 4] 1255 	call spaces
      000743 A6 5E            [ 1] 1256 	ld a,#'^
      000745 CD 01 A6         [ 4] 1257 	call putc 
      000748 20 1A            [ 2] 1258 	jra 6$
      00074A CE 00 04         [ 2] 1259 1$:	ldw x,basicptr
      00074D CD 14 91         [ 4] 1260 	call prt_basic_line
      000750 AE 07 04         [ 2] 1261 	ldw x,#rt_msg 
      000753 CD 01 B8         [ 4] 1262 	call puts 
      000756 5F               [ 1] 1263 	clrw x 
      000757 C6 00 02         [ 1] 1264 	ld a,in.saved 
      00075A 97               [ 1] 1265 	ld xl,a 
      00075B 72 D6 00 04      [ 4] 1266 	ld a,([basicptr],x)
      00075F 5F               [ 1] 1267 	clrw x 
      000760 97               [ 1] 1268 	ld xl,a 
      000761 CD 09 8D         [ 4] 1269 	call print_int 
      000764 AE 17 FF         [ 2] 1270 6$: ldw x,#STACK_EMPTY 
      000767 94               [ 1] 1271     ldw sp,x
      000768                       1272 warm_start:
      000768 72 5F 00 1F      [ 1] 1273 	clr flags 
      00076C 72 5F 00 1C      [ 1] 1274 	clr loop_depth 
      000770 AE 17 80         [ 2] 1275 	ldw x,#dstack_unf 
      000773 CF 00 16         [ 2] 1276 	ldw dstkptr,x 
      000776 35 04 00 20      [ 1] 1277 	mov tab_width,#TAB_WIDTH 
      00077A 35 0A 00 06      [ 1] 1278 	mov base,#10 
      00077E AE 16 C8         [ 2] 1279 	ldw x,#tib 
      000781 CF 00 04         [ 2] 1280 	ldw basicptr,x 
                                   1281 ;----------------------------
                                   1282 ;   BASIC interpreter
                                   1283 ;----------------------------
      000784                       1284 interp:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 26.
Hexadecimal [24-Bits]



      000784 72 5F 00 00      [ 1] 1285 	clr in.w
      000788 72 01 00 1F 23   [ 2] 1286 	btjf flags,#FRUN,4$ 
                                   1287 ; running program
                                   1288 ; goto next basic line 
      00078D CE 00 04         [ 2] 1289 	ldw x,basicptr
      000790 E6 02            [ 1] 1290 	ld a,(2,x) ; line length 
      000792 C7 00 09         [ 1] 1291 	ld acc8,a 
      000795 72 5F 00 08      [ 1] 1292 	clr acc16 
      000799 72 BB 00 08      [ 2] 1293 	addw x,acc16
      00079D C3 00 1A         [ 2] 1294 	cpw x,txtend 
      0007A0 2A C6            [ 1] 1295 	jrpl warm_start
      0007A2 CF 00 04         [ 2] 1296 	ldw basicptr,x ; start of next line  
      0007A5 E6 02            [ 1] 1297 	ld a,(2,x)
      0007A7 C7 00 03         [ 1] 1298 	ld count,a 
      0007AA 35 03 00 01      [ 1] 1299 	mov in,#3 ; skip first 3 bytes of line 
      0007AE 20 14            [ 2] 1300 	jra interp_loop 
      0007B0                       1301 4$: ; commande line mode 	
      0007B0 72 5F 00 01      [ 1] 1302 	clr in
      0007B4 A6 0D            [ 1] 1303 	ld a,#CR 
      0007B6 CD 01 A6         [ 4] 1304 	call putc 
      0007B9 A6 3E            [ 1] 1305 	ld a,#'> 
      0007BB CD 01 A6         [ 4] 1306 	call putc 
      0007BE CD 0A 7B         [ 4] 1307 	call readln
      0007C1 CD 03 F4         [ 4] 1308 	call compile
      0007C4                       1309 interp_loop:  
      0007C4 C6 00 01         [ 1] 1310 	ld a,in 
      0007C7 C1 00 03         [ 1] 1311 	cp a,count  
      0007CA 2A B8            [ 1] 1312 	jrpl interp
      0007CC CD 07 F4         [ 4] 1313 	call next_token
      0007CF A1 01            [ 1] 1314 	cp a,#TK_COLON 
      0007D1 27 F1            [ 1] 1315 	jreq interp_loop 
      0007D3 A1 00            [ 1] 1316 	cp a,#TK_NONE 
                                   1317 ;	jreq interp 
      0007D5                       1318 1$:
      0007D5 A1 05            [ 1] 1319 	cp a,#TK_VAR
      0007D7 26 05            [ 1] 1320 	jrne 2$
      0007D9 CD 13 A0         [ 4] 1321 	call let02  
      0007DC 20 E6            [ 2] 1322 	jra interp_loop 
      0007DE                       1323 2$:	
      0007DE A1 02            [ 1] 1324 	cp a,#TK_ARRAY 
      0007E0 26 08            [ 1] 1325 	jrne 3$
      0007E2 CD 11 E7         [ 4] 1326 	call get_array_element
      0007E5 CD 13 A0         [ 4] 1327 	call let02 
      0007E8 20 DA            [ 2] 1328 	jra interp_loop 
      0007EA                       1329 3$:
      0007EA A1 06            [ 1] 1330 	cp a,#TK_CMD
      0007EC 26 03            [ 1] 1331 	jrne 4$
      0007EE FD               [ 4] 1332 	call (x) 
      0007EF 20 D3            [ 2] 1333 	jra interp_loop 
      0007F1                       1334 4$:	
      0007F1 CC 07 14         [ 2] 1335 	jp syntax_error 
                                   1336 
                                   1337 ;--------------------------
                                   1338 ; extract next token from
                                   1339 ; token list 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 27.
Hexadecimal [24-Bits]



                                   1340 ; basicptr -> base address 
                                   1341 ; in  -> offset in list array 
                                   1342 ; output:
                                   1343 ;   A 		token attribute
                                   1344 ;   X 		token value if there is one
                                   1345 ;----------------------------------------
      0007F4                       1346 next_token:
      0007F4 C6 00 01         [ 1] 1347 	ld a,in 
      0007F7 C0 00 03         [ 1] 1348 	sub a,count 
      0007FA 27 3B            [ 1] 1349 	jreq 9$
      0007FC 55 00 01 00 02   [ 1] 1350 	mov in.saved,in
      000801 CE 00 04         [ 2] 1351 	ldw x,basicptr 
      000804 72 D6 00 00      [ 4] 1352 	ld a,([in.w],x)
      000808 72 5C 00 01      [ 1] 1353 	inc in 
      00080C A1 02            [ 1] 1354 	cp a,#TK_ARRAY  
      00080E 23 27            [ 2] 1355 	jrule 9$
      000810 A1 03            [ 1] 1356 	cp a,#TK_CHAR
      000812 26 0D            [ 1] 1357 	jrne 1$
      000814 72 D6 00 00      [ 4] 1358 	ld a,([in.w],x)
      000818 72 5C 00 01      [ 1] 1359 	inc in
      00081C 5F               [ 1] 1360 	clrw x 
      00081D 97               [ 1] 1361 	ld xl,a 
      00081E A6 03            [ 1] 1362 	ld a,#TK_CHAR
      000820 81               [ 4] 1363 	ret 
      000821 A1 0A            [ 1] 1364 1$:	cp a,#TK_QSTR 
      000823 25 06            [ 1] 1365 	jrult 2$
      000825 72 BB 00 00      [ 2] 1366 	addw x,in.w 
      000829 20 0C            [ 2] 1367 	jra 9$
      00082B 72 DE 00 00      [ 5] 1368 2$: ldw x,([in.w],x)
      00082F 72 5C 00 01      [ 1] 1369 	inc in 
      000833 72 5C 00 01      [ 1] 1370 	inc in
      000837 81               [ 4] 1371 9$: ret	
                                   1372 
                                   1373 
                                   1374 ;----------------------------------------
                                   1375 ;   DEBUG support functions
                                   1376 ;----------------------------------------
                           000001  1377 .if DEBUG 
                                   1378 ; turn LED on 
      000838                       1379 ledon:
      000838 72 1A 50 0A      [ 1] 1380     bset PC_ODR,#LED2_BIT
      00083C 81               [ 4] 1381     ret 
                                   1382 
                                   1383 ; turn LED off 
      00083D                       1384 ledoff:
      00083D 72 1B 50 0A      [ 1] 1385     bres PC_ODR,#LED2_BIT 
      000841 81               [ 4] 1386     ret 
                                   1387 
                                   1388 ; invert LED status 
      000842                       1389 ledtoggle:
      000842 A6 20            [ 1] 1390     ld a,#LED2_MASK
      000844 C8 50 0A         [ 1] 1391     xor a,PC_ODR
      000847 C7 50 0A         [ 1] 1392     ld PC_ODR,a
      00084A 81               [ 4] 1393     ret 
                                   1394 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 28.
Hexadecimal [24-Bits]



      00084B                       1395 left_paren:
      00084B A6 20            [ 1] 1396 	ld a,#SPACE 
      00084D CD 01 A6         [ 4] 1397 	call putc
      000850 A6 28            [ 1] 1398 	ld a,#'( 
      000852 CD 01 A6         [ 4] 1399 	call putc 	
      000855 81               [ 4] 1400 	ret 
                                   1401 
                                   1402 ;------------------------------
                                   1403 ; print 8 bit register 
                                   1404 ; input:
                                   1405 ;   X  point to register name 
                                   1406 ;   A  register value to print 
                                   1407 ; output:
                                   1408 ;   none
                                   1409 ;------------------------------- 
      000856                       1410 prt_reg8:
      000856 88               [ 1] 1411 	push a 
      000857 CD 01 B8         [ 4] 1412 	call puts 
      00085A 7B 01            [ 1] 1413 	ld a,(1,sp) 
      00085C C7 00 09         [ 1] 1414 	ld acc8,a 
      00085F 5F               [ 1] 1415 	clrw x 
      000860 97               [ 1] 1416 	ld xl,a 
      000861 35 10 00 06      [ 1] 1417 	mov base,#16
      000865 CD 09 8D         [ 4] 1418 	call print_int 
      000868 CD 08 4B         [ 4] 1419 	call left_paren 
      00086B 84               [ 1] 1420 	pop a 
      00086C 5F               [ 1] 1421 	clrw x 
      00086D 97               [ 1] 1422 	ld xl,a 
      00086E 35 0A 00 06      [ 1] 1423 	mov base,#10 
      000872 CD 09 8D         [ 4] 1424 	call print_int  
      000875 A6 29            [ 1] 1425 	ld a,#') 
      000877 CD 01 A6         [ 4] 1426 	call putc
      00087A 81               [ 4] 1427 	ret
                                   1428 
                                   1429 ;--------------------------------
                                   1430 ; print 16 bits register 
                                   1431 ; input:
                                   1432 ;   X   point register name 
                                   1433 ;   Y   register value to print 
                                   1434 ; output:
                                   1435 ;  none
                                   1436 ;--------------------------------
      00087B                       1437 prt_reg16: 
      00087B 90 89            [ 2] 1438 	pushw y 
      00087D CD 01 B8         [ 4] 1439 	call puts 
      000880 1E 01            [ 2] 1440 	ldw x,(1,sp) 
      000882 35 10 00 06      [ 1] 1441 	mov base,#16 
      000886 CD 09 8D         [ 4] 1442 	call print_int  
      000889 CD 08 4B         [ 4] 1443 	call left_paren 
      00088C 85               [ 2] 1444 	popw x 
      00088D 35 0A 00 06      [ 1] 1445 	mov base,#10 
      000891 CD 09 8D         [ 4] 1446 	call print_int  
      000894 A6 29            [ 1] 1447 	ld a,#') 
      000896 CD 01 A6         [ 4] 1448 	call putc
      000899 81               [ 4] 1449 	ret 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 29.
Hexadecimal [24-Bits]



                                   1450 
                                   1451 ;------------------------------------
                                   1452 ; print registers contents saved on
                                   1453 ; stack by trap interrupt.
                                   1454 ;------------------------------------
      00089A                       1455 print_registers:
      00089A AE 08 ED         [ 2] 1456 	ldw x,#STATES
      00089D CD 01 B8         [ 4] 1457 	call puts
                                   1458 ; print EPC 
      0008A0 AE 09 2A         [ 2] 1459 	ldw x, #REG_EPC
      0008A3 CD 01 B8         [ 4] 1460 	call puts 
      0008A6 7B 0B            [ 1] 1461 	ld a, (11,sp)
      0008A8 C7 00 09         [ 1] 1462 	ld acc8,a 
      0008AB 7B 0A            [ 1] 1463 	ld a, (10,sp) 
      0008AD C7 00 08         [ 1] 1464 	ld acc16,a 
      0008B0 7B 09            [ 1] 1465 	ld a,(9,sp) 
      0008B2 C7 00 07         [ 1] 1466 	ld acc24,a
      0008B5 5F               [ 1] 1467 	clrw x  
      0008B6 A6 10            [ 1] 1468 	ld a,#16
      0008B8 CD 09 45         [ 4] 1469 	call prti24  
                                   1470 ; print X
      0008BB AE 09 33         [ 2] 1471 	ldw x,#REG_X
      0008BE 16 05            [ 2] 1472 	ldw y,(5,sp)
      0008C0 CD 08 7B         [ 4] 1473 	call prt_reg16  
                                   1474 ; print Y 
      0008C3 AE 09 2F         [ 2] 1475 	ldw x,#REG_Y
      0008C6 16 07            [ 2] 1476 	ldw y, (7,sp)
      0008C8 CD 08 7B         [ 4] 1477 	call prt_reg16  
                                   1478 ; print A 
      0008CB AE 09 37         [ 2] 1479 	ldw x,#REG_A
      0008CE 7B 04            [ 1] 1480 	ld a, (4,sp) 
      0008D0 CD 08 56         [ 4] 1481 	call prt_reg8
                                   1482 ; print CC 
      0008D3 AE 09 3B         [ 2] 1483 	ldw x,#REG_CC 
      0008D6 7B 03            [ 1] 1484 	ld a, (3,sp) 
      0008D8 CD 08 56         [ 4] 1485 	call prt_reg8 
                                   1486 ; print SP 
      0008DB AE 09 40         [ 2] 1487 	ldw x,#REG_SP
      0008DE 90 96            [ 1] 1488 	ldw y,sp 
      0008E0 72 A9 00 0C      [ 2] 1489 	addw y,#12
      0008E4 CD 08 7B         [ 4] 1490 	call prt_reg16  
      0008E7 A6 0A            [ 1] 1491 	ld a,#'\n' 
      0008E9 CD 01 A6         [ 4] 1492 	call putc
      0008EC 81               [ 4] 1493 	ret
                                   1494 
      0008ED 0A 52 65 67 69 73 74  1495 STATES:  .asciz "\nRegisters state at abort point.\n--------------------------\n"
             65 72 73 20 73 74 61
             74 65 20 61 74 20 61
             62 6F 72 74 20 70 6F
             69 6E 74 2E 0A 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 2D 0A 00
      00092A 45 50 43 3A 00        1496 REG_EPC: .asciz "EPC:"
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 30.
Hexadecimal [24-Bits]



      00092F 0A 59 3A 00           1497 REG_Y:   .asciz "\nY:" 
      000933 0A 58 3A 00           1498 REG_X:   .asciz "\nX:"
      000937 0A 41 3A 00           1499 REG_A:   .asciz "\nA:" 
      00093B 0A 43 43 3A 00        1500 REG_CC:  .asciz "\nCC:"
      000940 0A 53 50 3A 00        1501 REG_SP:  .asciz "\nSP:"
                                   1502 .endif ; DEBUG 
                                   1503 
                                   1504 ;------------------------------------
                                   1505 ; print integer in acc24 
                                   1506 ; input:
                                   1507 ;	acc24 		integer to print 
                                   1508 ;	A 			numerical base for conversion 
                                   1509 ;               if bit 7 is set add a space at print end.
                                   1510 ;   XL 			field width, 0 -> no fill.
                                   1511 ;  output:
                                   1512 ;    none 
                                   1513 ;------------------------------------
                           000001  1514 	WIDTH = 1
                           000002  1515 	BASE = 2
                           000003  1516 	ADD_SPACE=3 ; add a space after number 
                           000003  1517 	VSIZE = 3
      000945                       1518 prti24:
      000945                       1519 	_vars VSIZE 
      000945 52 03            [ 2]    1     sub sp,#VSIZE 
      000947 0F 03            [ 1] 1520 	clr (ADD_SPACE,sp)
      000949 A5 80            [ 1] 1521 	bcp a,#0x80 
      00094B 27 02            [ 1] 1522 	jreq 0$ 
      00094D 03 03            [ 1] 1523 	cpl (ADD_SPACE,sp)
      00094F A4 1F            [ 1] 1524 0$:	and a,#31 
      000951 6B 02            [ 1] 1525 	ld (BASE,sp),a
      000953 9F               [ 1] 1526 	ld a,xl
      000954 6B 01            [ 1] 1527 	ld (WIDTH,sp),a 
      000956 7B 02            [ 1] 1528 	ld a, (BASE,sp)  
      000958 CD 09 E9         [ 4] 1529     call itoa  ; conversion entier en  .asciz
      00095B 7B 01            [ 1] 1530 1$: ld a,(WIDTH,sp)
      00095D 27 1F            [ 1] 1531 	jreq 4$
      00095F C7 00 09         [ 1] 1532 	ld acc8,a 
      000962 89               [ 2] 1533 	pushw x 
      000963 CD 02 7A         [ 4] 1534 	call strlen 
      000966 9F               [ 1] 1535 	ld a,xl 
      000967 85               [ 2] 1536 	popw x 
      000968 31 00 09         [ 3] 1537 	exg a,acc8 
      00096B C0 00 09         [ 1] 1538 	sub a,acc8 
      00096E 2B 0E            [ 1] 1539 	jrmi 4$
      000970 6B 01            [ 1] 1540 	ld (WIDTH,sp),a 
      000972 A6 20            [ 1] 1541 	ld  a,#SPACE
      000974 0D 01            [ 1] 1542 3$: tnz (WIDTH,sp)
      000976 27 06            [ 1] 1543 	jreq 4$
      000978 5A               [ 2] 1544 	decw x 
      000979 F7               [ 1] 1545 	ld (x),a 
      00097A 0A 01            [ 1] 1546 	dec (WIDTH,sp) 
      00097C 20 F6            [ 2] 1547 	jra 3$
      00097E                       1548 4$: 
      00097E CD 01 B8         [ 4] 1549 	call puts 
      000981 0D 03            [ 1] 1550 	tnz (ADD_SPACE,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 31.
Hexadecimal [24-Bits]



      000983 27 05            [ 1] 1551 	jreq 5$
      000985 A6 20            [ 1] 1552     ld a,#SPACE 
      000987 CD 01 A6         [ 4] 1553 	call putc 
      00098A                       1554 5$: _drop VSIZE 
      00098A 5B 03            [ 2]    1     addw sp,#VSIZE 
      00098C 81               [ 4] 1555     ret	
                                   1556 
                                   1557 ;-----------------------------------
                                   1558 ; print a 16 bit integer 
                                   1559 ; using variable 'base' as conversion
                                   1560 ; format.
                                   1561 ; input:
                                   1562 ;   X       integer to print 
                                   1563 ;   base    conversion base 
                                   1564 ; output:
                                   1565 ;   none 
                                   1566 ;-----------------------------------
                           000001  1567 	SIGN=1
                           000001  1568 	VSIZE=1
      00098D                       1569 print_int: 
      00098D                       1570 	_vars VSIZE 
      00098D 52 01            [ 2]    1     sub sp,#VSIZE 
      00098F 0F 01            [ 1] 1571 	clr (SIGN,sp)
      000991 90 AE 17 3F      [ 2] 1572 	ldw y,#pad+PAD_SIZE-1 
      000995 90 7F            [ 1] 1573 	clr (y)
      000997 C6 00 06         [ 1] 1574 	ld a,base  
      00099A A1 0A            [ 1] 1575 	cp a,#10 
      00099C 26 06            [ 1] 1576 	jrne 1$ 
      00099E 5D               [ 2] 1577 	tnzw x 
      00099F 2A 03            [ 1] 1578 	jrpl 1$ 
      0009A1 03 01            [ 1] 1579 	cpl (SIGN,sp)
      0009A3 50               [ 2] 1580 	negw x 	 
      0009A4                       1581 1$:	
      0009A4 C6 00 06         [ 1] 1582 	ld a,base 
      0009A7 62               [ 2] 1583 	div x,a 
      0009A8 AB 30            [ 1] 1584 	add a,#'0 
      0009AA A1 3A            [ 1] 1585 	cp a,#'9+1 
      0009AC 2B 02            [ 1] 1586 	jrmi 2$ 
      0009AE AB 07            [ 1] 1587 	add a,#7 
      0009B0 90 5A            [ 2] 1588 2$: decw y 
      0009B2 90 F7            [ 1] 1589 	ld (y),a 
      0009B4 5D               [ 2] 1590 	tnzw x 
      0009B5 26 ED            [ 1] 1591 	jrne 1$ 
      0009B7 A6 10            [ 1] 1592 	ld a,#16 
      0009B9 C1 00 06         [ 1] 1593 	cp a,base 
      0009BC 26 08            [ 1] 1594 	jrne 3$
      0009BE A6 24            [ 1] 1595 	ld a,#'$
      0009C0 90 5A            [ 2] 1596 	decw y  
      0009C2 90 F7            [ 1] 1597 	ld (y),a
      0009C4 20 0A            [ 2] 1598 	jra 9$ 
      0009C6 0D 01            [ 1] 1599 3$: tnz (SIGN,sp)
      0009C8 27 06            [ 1] 1600 	jreq 9$ 
      0009CA A6 2D            [ 1] 1601 	ld a,#'-
      0009CC 90 5A            [ 2] 1602 	decw y  
      0009CE 90 F7            [ 1] 1603 	ld (y),a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 32.
Hexadecimal [24-Bits]



      0009D0                       1604 9$:	
      0009D0 93               [ 1] 1605 	ldw x,y 
      0009D1 1D 17 3F         [ 2] 1606 	subw x,#pad+PAD_SIZE-1 
      0009D4 50               [ 2] 1607 	negw x  
      0009D5                       1608 10$:
      0009D5 90 5A            [ 2] 1609 	decw y 
      0009D7 A6 20            [ 1] 1610 	ld a,#SPACE 
      0009D9 90 F7            [ 1] 1611 	ld (y),a
      0009DB 5C               [ 1] 1612 	incw x 
      0009DC 9F               [ 1] 1613 	ld a,xl 
      0009DD C1 00 20         [ 1] 1614 	cp a,tab_width
      0009E0 2B F3            [ 1] 1615 	jrmi 10$ 
      0009E2                       1616 12$:
      0009E2 93               [ 1] 1617     ldw x,y 
      0009E3 CD 01 B8         [ 4] 1618 	call puts  
      0009E6                       1619 	_drop VSIZE 
      0009E6 5B 01            [ 2]    1     addw sp,#VSIZE 
      0009E8 81               [ 4] 1620 	ret 
                                   1621 
                                   1622 ;------------------------------------
                                   1623 ; convert integer in acc24 to string
                                   1624 ; input:
                                   1625 ;   A	  	base
                                   1626 ;	acc24	integer to convert
                                   1627 ; output:
                                   1628 ;   X  		pointer to string
                                   1629 ;------------------------------------
                           000001  1630 	SIGN=1  ; integer sign 
                           000002  1631 	BASE=2  ; numeric base 
                           000002  1632 	VSIZE=2  ;locals size
      0009E9                       1633 itoa:
      0009E9 52 02            [ 2] 1634 	sub sp,#VSIZE
      0009EB 6B 02            [ 1] 1635 	ld (BASE,sp), a  ; base
      0009ED 0F 01            [ 1] 1636 	clr (SIGN,sp)    ; sign
      0009EF A1 0A            [ 1] 1637 	cp a,#10
      0009F1 26 0A            [ 1] 1638 	jrne 1$
                                   1639 	; base 10 string display with negative sign if bit 23==1
      0009F3 72 0F 00 07 05   [ 2] 1640 	btjf acc24,#7,1$
      0009F8 03 01            [ 1] 1641 	cpl (SIGN,sp)
      0009FA CD 0A 58         [ 4] 1642 	call neg_acc24
      0009FD                       1643 1$:
                                   1644 ; initialize string pointer 
      0009FD AE 17 3F         [ 2] 1645 	ldw x,#pad+PAD_SIZE-1
      000A00 7F               [ 1] 1646 	clr (x)
      000A01                       1647 itoa_loop:
      000A01 7B 02            [ 1] 1648     ld a,(BASE,sp)
      000A03 CD 0A 30         [ 4] 1649     call divu24_8 ; acc24/A 
      000A06 AB 30            [ 1] 1650     add a,#'0  ; remainder of division
      000A08 A1 3A            [ 1] 1651     cp a,#'9+1
      000A0A 2B 02            [ 1] 1652     jrmi 2$
      000A0C AB 07            [ 1] 1653     add a,#7 
      000A0E 5A               [ 2] 1654 2$: decw x
      000A0F F7               [ 1] 1655     ld (x),a
                                   1656 	; if acc24==0 conversion done
      000A10 C6 00 07         [ 1] 1657 	ld a,acc24
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 33.
Hexadecimal [24-Bits]



      000A13 CA 00 08         [ 1] 1658 	or a,acc16
      000A16 CA 00 09         [ 1] 1659 	or a,acc8
      000A19 26 E6            [ 1] 1660     jrne itoa_loop
                                   1661 	;conversion done, next add '$' or '-' as required
      000A1B 7B 02            [ 1] 1662 	ld a,(BASE,sp)
      000A1D A1 10            [ 1] 1663 	cp a,#16
      000A1F 27 08            [ 1] 1664 	jreq 8$
      000A21 7B 01            [ 1] 1665 	ld a,(SIGN,sp)
      000A23 27 08            [ 1] 1666     jreq 10$
      000A25 A6 2D            [ 1] 1667     ld a,#'-
      000A27 20 02            [ 2] 1668 	jra 9$ 
      000A29 A6 24            [ 1] 1669 8$: ld a,#'$ 
      000A2B 5A               [ 2] 1670 9$: decw x
      000A2C F7               [ 1] 1671     ld (x),a
      000A2D                       1672 10$:
      000A2D 5B 02            [ 2] 1673 	addw sp,#VSIZE
      000A2F 81               [ 4] 1674 	ret
                                   1675 
                                   1676 ;-------------------------------------
                                   1677 ; divide uint24_t by uint8_t
                                   1678 ; used to convert uint24_t to string
                                   1679 ; input:
                                   1680 ;	acc24	dividend
                                   1681 ;   A 		divisor
                                   1682 ; output:
                                   1683 ;   acc24	quotient
                                   1684 ;   A		remainder
                                   1685 ;------------------------------------- 
                                   1686 ; offset  on sp of arguments and locals
                           000001  1687 	U8   = 1   ; divisor on stack
                           000001  1688 	VSIZE =1
      000A30                       1689 divu24_8:
      000A30 89               [ 2] 1690 	pushw x ; save x
      000A31 88               [ 1] 1691 	push a 
                                   1692 	; ld dividend UU:MM bytes in X
      000A32 C6 00 07         [ 1] 1693 	ld a, acc24
      000A35 95               [ 1] 1694 	ld xh,a
      000A36 C6 00 08         [ 1] 1695 	ld a,acc24+1
      000A39 97               [ 1] 1696 	ld xl,a
      000A3A 7B 01            [ 1] 1697 	ld a,(U8,SP) ; divisor
      000A3C 62               [ 2] 1698 	div x,a ; UU:MM/U8
      000A3D 88               [ 1] 1699 	push a  ;save remainder
      000A3E 9E               [ 1] 1700 	ld a,xh
      000A3F C7 00 07         [ 1] 1701 	ld acc24,a
      000A42 9F               [ 1] 1702 	ld a,xl
      000A43 C7 00 08         [ 1] 1703 	ld acc24+1,a
      000A46 84               [ 1] 1704 	pop a
      000A47 95               [ 1] 1705 	ld xh,a
      000A48 C6 00 09         [ 1] 1706 	ld a,acc24+2
      000A4B 97               [ 1] 1707 	ld xl,a
      000A4C 7B 01            [ 1] 1708 	ld a,(U8,sp) ; divisor
      000A4E 62               [ 2] 1709 	div x,a  ; R:LL/U8
      000A4F 6B 01            [ 1] 1710 	ld (U8,sp),a ; save remainder
      000A51 9F               [ 1] 1711 	ld a,xl
      000A52 C7 00 09         [ 1] 1712 	ld acc24+2,a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 34.
Hexadecimal [24-Bits]



      000A55 84               [ 1] 1713 	pop a
      000A56 85               [ 2] 1714 	popw x
      000A57 81               [ 4] 1715 	ret
                                   1716 
                                   1717 ;------------------------------------
                                   1718 ;  two's complement acc24
                                   1719 ;  input:
                                   1720 ;		acc24 variable
                                   1721 ;  output:
                                   1722 ;		acc24 variable
                                   1723 ;-------------------------------------
      000A58                       1724 neg_acc24:
      000A58 72 53 00 09      [ 1] 1725 	cpl acc24+2
      000A5C 72 53 00 08      [ 1] 1726 	cpl acc24+1
      000A60 72 53 00 07      [ 1] 1727 	cpl acc24
      000A64 A6 01            [ 1] 1728 	ld a,#1
      000A66 CB 00 09         [ 1] 1729 	add a,acc24+2
      000A69 C7 00 09         [ 1] 1730 	ld acc24+2,a
      000A6C 4F               [ 1] 1731 	clr a
      000A6D C9 00 08         [ 1] 1732 	adc a,acc24+1
      000A70 C7 00 08         [ 1] 1733 	ld acc24+1,a 
      000A73 4F               [ 1] 1734 	clr a 
      000A74 C9 00 07         [ 1] 1735 	adc a,acc24 
      000A77 C7 00 07         [ 1] 1736 	ld acc24,a 
      000A7A 81               [ 4] 1737 	ret
                                   1738 
                                   1739 
                                   1740 ;------------------------------------
                                   1741 ; read a line of text from terminal
                                   1742 ; input:
                                   1743 ;	none
                                   1744 ; local variable on stack:
                                   1745 ;	LL  line length
                                   1746 ;   RXCHAR last received chaaracte 
                                   1747 ; output:
                                   1748 ;   text in tib  buffer
                                   1749 ;------------------------------------
                                   1750 	; local variables
                           000001  1751 	LL_HB=1
                           000001  1752 	RXCHAR = 1 ; last char received
                           000002  1753 	LL = 2  ; accepted line length
                           000002  1754 	VSIZE=2 
      000A7B                       1755 readln:
      000A7B 5F               [ 1] 1756 	clrw x 
      000A7C 89               [ 2] 1757 	pushw x 
      000A7D 90 AE 16 C8      [ 2] 1758  	ldw y,#tib ; input buffer
      000A81                       1759 readln_loop:
      000A81 CD 01 AF         [ 4] 1760 	call getc
      000A84 6B 01            [ 1] 1761 	ld (RXCHAR,sp),a
      000A86 A1 0D            [ 1] 1762 	cp a,#CR
      000A88 26 03            [ 1] 1763 	jrne 1$
      000A8A CC 0A F6         [ 2] 1764 	jp readln_quit
      000A8D A1 0A            [ 1] 1765 1$:	cp a,#NL
      000A8F 27 65            [ 1] 1766 	jreq readln_quit
      000A91 A1 08            [ 1] 1767 	cp a,#BSP
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 35.
Hexadecimal [24-Bits]



      000A93 27 3D            [ 1] 1768 	jreq del_back
      000A95 A1 04            [ 1] 1769 	cp a,#CTRL_D
      000A97 27 2A            [ 1] 1770 	jreq del_ln
      000A99 A1 12            [ 1] 1771 	cp a,#CTRL_R 
      000A9B 27 06            [ 1] 1772 	jreq reprint 
                                   1773 ;	cp a,#'[
                                   1774 ;	jreq ansi_seq
      000A9D                       1775 final_test:
      000A9D A1 20            [ 1] 1776 	cp a,#SPACE
      000A9F 2A 40            [ 1] 1777 	jrpl accept_char
      000AA1 20 DE            [ 2] 1778 	jra readln_loop
      000AA3                       1779 ansi_seq:
                                   1780 ;	call getc
                                   1781 ;	cp a,#'C 
                                   1782 ;	jreq rigth_arrow
                                   1783 ;	cp a,#'D 
                                   1784 ;	jreq left_arrow 
                                   1785 ;	jra final_test
      000AA3                       1786 right_arrow:
                                   1787 ;	ld a,#BSP 
                                   1788 ;	call putc 
                                   1789 ;	jra realn_loop 
      000AA3                       1790 left_arrow:
                                   1791 
                                   1792 ;	jra readln_loop
      000AA3                       1793 reprint: 
      000AA3 0D 02            [ 1] 1794 	tnz (LL,sp)
      000AA5 26 DA            [ 1] 1795 	jrne readln_loop
      000AA7 AE 16 C8         [ 2] 1796 	ldw x,#tib 
      000AAA CD 02 7A         [ 4] 1797 	call strlen 
      000AAD 90 AE 16 C8      [ 2] 1798 	ldw y,#tib 
      000AB1 9F               [ 1] 1799 	ld a,xl
      000AB2 27 CD            [ 1] 1800 	jreq readln_loop
      000AB4 6B 02            [ 1] 1801 	ld (LL,sp),a 
      000AB6 AE 16 C8         [ 2] 1802 	ldw x,#tib 
      000AB9 CD 01 B8         [ 4] 1803 	call puts
      000ABC 0F 01            [ 1] 1804 	clr (LL_HB,sp)
      000ABE 72 F9 01         [ 2] 1805 	addw y,(LL_HB,sp)
      000AC1 20 BE            [ 2] 1806 	jra readln_loop 
      000AC3                       1807 del_ln:
      000AC3 7B 02            [ 1] 1808 	ld a,(LL,sp)
      000AC5 CD 01 D2         [ 4] 1809 	call delete
      000AC8 90 AE 16 C8      [ 2] 1810 	ldw y,#tib
      000ACC 90 7F            [ 1] 1811 	clr (y)
      000ACE 0F 02            [ 1] 1812 	clr (LL,sp)
      000AD0 20 AF            [ 2] 1813 	jra readln_loop
      000AD2                       1814 del_back:
      000AD2 0D 02            [ 1] 1815     tnz (LL,sp)
      000AD4 27 AB            [ 1] 1816     jreq readln_loop
      000AD6 0A 02            [ 1] 1817     dec (LL,sp)
      000AD8 90 5A            [ 2] 1818     decw y
      000ADA 90 7F            [ 1] 1819     clr  (y)
      000ADC CD 01 C2         [ 4] 1820     call bksp 
      000ADF 20 A0            [ 2] 1821     jra readln_loop	
      000AE1                       1822 accept_char:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 36.
Hexadecimal [24-Bits]



      000AE1 A6 4F            [ 1] 1823 	ld a,#TIB_SIZE-1
      000AE3 11 02            [ 1] 1824 	cp a, (LL,sp)
      000AE5 27 9A            [ 1] 1825 	jreq readln_loop
      000AE7 7B 01            [ 1] 1826 	ld a,(RXCHAR,sp)
      000AE9 90 F7            [ 1] 1827 	ld (y),a
      000AEB 0C 02            [ 1] 1828 	inc (LL,sp)
      000AED 90 5C            [ 1] 1829 	incw y
      000AEF 90 7F            [ 1] 1830 	clr (y)
      000AF1 CD 01 A6         [ 4] 1831 	call putc 
      000AF4 20 8B            [ 2] 1832 	jra readln_loop
      000AF6                       1833 readln_quit:
      000AF6 90 7F            [ 1] 1834 	clr (y)
      000AF8 7B 02            [ 1] 1835 	ld a,(LL,sp)
      000AFA C7 00 03         [ 1] 1836 	ld count,a 
      000AFD                       1837 	_drop VSIZE 
      000AFD 5B 02            [ 2]    1     addw sp,#VSIZE 
      000AFF A6 0D            [ 1] 1838 	ld a,#CR
      000B01 CD 01 A6         [ 4] 1839 	call putc
      000B04 81               [ 4] 1840 	ret
                                   1841 
                           000001  1842 .if DEBUG 	
                                   1843 ;----------------------------
                                   1844 ; command interface
                                   1845 ; only 3 commands:
                                   1846 ;  'q' to resume application
                                   1847 ;  'p [addr]' to print memory values 
                                   1848 ;  's addr' to print string 
                                   1849 ;----------------------------
                                   1850 ;local variable 
                           000001  1851 	PSIZE=1
                           000001  1852 	VSIZE=1 
      000B05                       1853 cmd_itf:
      000B05 52 01            [ 2] 1854 	sub sp,#VSIZE 
      000B07 72 5F 00 10      [ 1] 1855 	clr farptr 
      000B0B 72 5F 00 11      [ 1] 1856 	clr farptr+1 
      000B0F 72 5F 00 12      [ 1] 1857 	clr farptr+2  
      000B13                       1858 repl:
      000B13 A6 0D            [ 1] 1859 	ld a,#CR 
      000B15 CD 01 A6         [ 4] 1860 	call putc 
      000B18 A6 3F            [ 1] 1861 	ld a,#'? 
      000B1A CD 01 A6         [ 4] 1862 	call putc
      000B1D 72 5F 00 00      [ 1] 1863 	clr in.w 
      000B21 72 5F 00 01      [ 1] 1864 	clr in 
      000B25 CD 0A 7B         [ 4] 1865 	call readln
      000B28 90 AE 16 C8      [ 2] 1866 	ldw y,#tib  
      000B2C 90 F6            [ 1] 1867 	ld a,(y)
      000B2E 27 E3            [ 1] 1868 	jreq repl  
      000B30 72 5C 00 01      [ 1] 1869 	inc in 
      000B34 CD 0E B5         [ 4] 1870 	call to_upper 
      000B37 A1 51            [ 1] 1871 	cp a,#'Q 
      000B39 26 17            [ 1] 1872 	jrne test_p
      000B3B                       1873 repl_exit:
      000B3B 72 5F 16 C8      [ 1] 1874 	clr tib 
      000B3F 72 5F 00 03      [ 1] 1875 	clr count 
      000B43 72 5F 00 01      [ 1] 1876 	clr in 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 37.
Hexadecimal [24-Bits]



      000B47                       1877 	_drop #VSIZE 	
      000B47 5B 01            [ 2]    1     addw sp,##VSIZE 
      000B49 81               [ 4] 1878 	ret  
      000B4A                       1879 invalid:
      000B4A AE 0B C8         [ 2] 1880 	ldw x,#invalid_cmd 
      000B4D CD 01 B8         [ 4] 1881 	call puts 
      000B50 20 C1            [ 2] 1882 	jra repl 
      000B52                       1883 test_p:	
      000B52 A1 50            [ 1] 1884     cp a,#'P 
      000B54 27 11            [ 1] 1885 	jreq mem_peek
      000B56 A1 53            [ 1] 1886     cp a,#'S 
      000B58 26 F0            [ 1] 1887 	jrne invalid 
      000B5A                       1888 print_string:	
      000B5A CD 0C F4         [ 4] 1889 	call get_token
      000B5D A1 04            [ 1] 1890 	cp a,#TK_INTGR 
      000B5F 26 E9            [ 1] 1891 	jrne invalid 
      000B61 CD 01 B8         [ 4] 1892 	call puts
      000B64 CC 0B 13         [ 2] 1893 	jp repl 	
      000B67                       1894 mem_peek:
      000B67 A6 20            [ 1] 1895 	ld a,#SPACE 
      000B69 CD 0F 6D         [ 4] 1896 	call skip  	 
      000B6C 72 B9 00 00      [ 2] 1897 	addw y,in.w 
      000B70 AE 17 18         [ 2] 1898 	ldw x,#pad 
      000B73 CD 02 98         [ 4] 1899 	call strcpy
      000B76 CD 0E C1         [ 4] 1900 	call atoi24 	
      000B79 C6 00 07         [ 1] 1901 	ld a, acc24 
      000B7C CA 00 08         [ 1] 1902 	or a,acc16 
      000B7F CA 00 09         [ 1] 1903 	or a,acc8 
      000B82 26 02            [ 1] 1904 	jrne 1$ 
      000B84 20 0C            [ 2] 1905 	jra peek_byte  
      000B86 CE 00 07         [ 2] 1906 1$:	ldw x,acc24 
      000B89 CF 00 10         [ 2] 1907 	ldw farptr,x 
      000B8C C6 00 09         [ 1] 1908 	ld a,acc8 
      000B8F C7 00 12         [ 1] 1909 	ld farptr+2,a 
      000B92                       1910 peek_byte:
      000B92 CD 0B D7         [ 4] 1911 	call print_farptr 
      000B95 A6 08            [ 1] 1912 	ld a,#8 
      000B97 6B 01            [ 1] 1913 	ld (PSIZE,sp),a 
      000B99 5F               [ 1] 1914 	clrw x 
      000B9A CD 0B F2         [ 4] 1915 1$:	call fetchc  
      000B9D 89               [ 2] 1916 	pushw x 
      000B9E C7 00 09         [ 1] 1917 	ld acc8,a 
      000BA1 5F               [ 1] 1918 	clrw x 
      000BA2 CF 00 07         [ 2] 1919 	ldw acc24,x 
      000BA5 A6 90            [ 1] 1920 	ld a,#16+128
      000BA7 CD 09 45         [ 4] 1921 	call prti24
      000BAA 85               [ 2] 1922 	popw x 
      000BAB 0A 01            [ 1] 1923 	dec (PSIZE,sp)
      000BAD 26 EB            [ 1] 1924 	jrne 1$ 
      000BAF A6 08            [ 1] 1925 	ld a,#8 
      000BB1 CB 00 12         [ 1] 1926 	add a,farptr+2 
      000BB4 C7 00 12         [ 1] 1927 	ld farptr+2,a
      000BB7 4F               [ 1] 1928 	clr a 
      000BB8 C9 00 11         [ 1] 1929 	adc a,farptr+1 
      000BBB C7 00 11         [ 1] 1930 	ld farptr+1,a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 38.
Hexadecimal [24-Bits]



      000BBE 4F               [ 1] 1931 	clr a 
      000BBF C9 00 10         [ 1] 1932 	adc a,farptr 
      000BC2 C7 00 10         [ 1] 1933 	ld farptr,a 
      000BC5 CC 0B 13         [ 2] 1934 	jp repl  
                                   1935 
      000BC8 6E 6F 74 20 61 20 63  1936 invalid_cmd: .asciz "not a command\n" 
             6F 6D 6D 61 6E 64 0A
             00
                                   1937 
                                   1938 ;----------------------------
                                   1939 ; display farptr address
                                   1940 ;----------------------------
      000BD7                       1941 print_farptr:
      000BD7 C6 00 12         [ 1] 1942 	ld a ,farptr+2 
      000BDA C7 00 09         [ 1] 1943 	ld acc8,a 
      000BDD CE 00 10         [ 2] 1944 	ldw x,farptr 
      000BE0 CF 00 07         [ 2] 1945 	ldw acc24,x 
      000BE3 5F               [ 1] 1946 	clrw x 
      000BE4 A6 10            [ 1] 1947 	ld a,#16 
      000BE6 CD 09 45         [ 4] 1948 	call prti24
      000BE9 A6 20            [ 1] 1949 	ld a,#SPACE 
      000BEB CD 01 A6         [ 4] 1950 	call putc 
      000BEE CD 01 A6         [ 4] 1951 	call putc 
      000BF1 81               [ 4] 1952 	ret
                                   1953 
                                   1954 ;------------------------------------
                                   1955 ; get byte at address farptr[X]
                                   1956 ; input:
                                   1957 ;	 farptr   address to peek
                                   1958 ;    X		  farptr index 	
                                   1959 ; output:
                                   1960 ;	 A 		  byte from memory  
                                   1961 ;    x		  incremented by 1
                                   1962 ;------------------------------------
      000BF2                       1963 fetchc: ; @C
      000BF2 92 AF 00 10      [ 5] 1964 	ldf a,([farptr],x)
      000BF6 5C               [ 1] 1965 	incw x
      000BF7 81               [ 4] 1966 	ret
                                   1967 
                                   1968 
                                   1969 ;------------------------------------
                                   1970 ; expect a number from command line 
                                   1971 ; next argument
                                   1972 ;  input:
                                   1973 ;	  none
                                   1974 ;  output:
                                   1975 ;    acc24   int24_t 
                                   1976 ;------------------------------------
      000BF8                       1977 number::
      000BF8 CD 0C F4         [ 4] 1978 	call get_token
      000BFB CD 0E C1         [ 4] 1979 	call atoi24
      000BFE 81               [ 4] 1980 	ret
                                   1981 .endif ; DEBUG 
                                   1982 
                                   1983 ;------------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 39.
Hexadecimal [24-Bits]



                                   1984 ; parse quoted string 
                                   1985 ; input:
                                   1986 ;   Y 	pointer to tib 
                                   1987 ;   X   pointer to pad
                                   1988 ; output:
                                   1989 ;	pad   parsed string
                                   1990 ;   TOS  char* to pad  
                                   1991 ;------------------------------------
                           000001  1992 	PREV = 1
                           000002  1993 	CURR =2 
                           000002  1994 	VSIZE=2 
      000BFF                       1995 parse_quote: ; { -- addr }
      000BFF                       1996 	_vars VSIZE 
      000BFF 52 02            [ 2]    1     sub sp,#VSIZE 
      000C01 4F               [ 1] 1997 	clr a
      000C02 6B 01            [ 1] 1998 1$:	ld (PREV,sp),a 
      000C04 72 5C 00 01      [ 1] 1999 2$:	inc in
      000C08 91 D6 00         [ 4] 2000 	ld a,([in.w],y)
      000C0B 27 24            [ 1] 2001 	jreq 6$
      000C0D 6B 02            [ 1] 2002 	ld (CURR,sp),a 
      000C0F A6 5C            [ 1] 2003 	ld a,#'\
      000C11 11 01            [ 1] 2004 	cp a, (PREV,sp)
      000C13 26 0A            [ 1] 2005 	jrne 3$
      000C15 0F 01            [ 1] 2006 	clr (PREV,sp)
      000C17 7B 02            [ 1] 2007 	ld a,(CURR,sp)
      000C19 AD 1F            [ 4] 2008 	callr convert_escape
      000C1B F7               [ 1] 2009 	ld (x),a 
      000C1C 5C               [ 1] 2010 	incw x 
      000C1D 20 E5            [ 2] 2011 	jra 2$
      000C1F                       2012 3$:
      000C1F 7B 02            [ 1] 2013 	ld a,(CURR,sp)
      000C21 A1 5C            [ 1] 2014 	cp a,#'\'
      000C23 27 DD            [ 1] 2015 	jreq 1$
      000C25 A1 22            [ 1] 2016 	cp a,#'"
      000C27 27 04            [ 1] 2017 	jreq 5$ 
      000C29 F7               [ 1] 2018 	ld (x),a 
      000C2A 5C               [ 1] 2019 	incw x 
      000C2B 20 D7            [ 2] 2020 	jra 2$
      000C2D 72 5C 00 01      [ 1] 2021 5$:	inc in 
      000C31 7F               [ 1] 2022 6$: clr (x)
      000C32 AE 17 18         [ 2] 2023 	ldw x,#pad 
      000C35                       2024 	_drop VSIZE
      000C35 5B 02            [ 2]    1     addw sp,#VSIZE 
      000C37 A6 0A            [ 1] 2025 	ld a,#TK_QSTR  
      000C39 81               [ 4] 2026 	ret 
                                   2027 
                                   2028 ;---------------------------------------
                                   2029 ; called by parse_quote
                                   2030 ; subtitute escaped character 
                                   2031 ; by their ASCII value .
                                   2032 ; input:
                                   2033 ;   A  character following '\'
                                   2034 ; output:
                                   2035 ;   A  substitued char or same if not valid.
                                   2036 ;---------------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 40.
Hexadecimal [24-Bits]



      000C3A                       2037 convert_escape:
      000C3A 89               [ 2] 2038 	pushw x 
      000C3B AE 0C 4F         [ 2] 2039 	ldw x,#escaped 
      000C3E F1               [ 1] 2040 1$:	cp a,(x)
      000C3F 27 06            [ 1] 2041 	jreq 2$
      000C41 7D               [ 1] 2042 	tnz (x)
      000C42 27 09            [ 1] 2043 	jreq 3$
      000C44 5C               [ 1] 2044 	incw x 
      000C45 20 F7            [ 2] 2045 	jra 1$
      000C47 1D 0C 4F         [ 2] 2046 2$: subw x,#escaped 
      000C4A 9F               [ 1] 2047 	ld a,xl 
      000C4B AB 07            [ 1] 2048 	add a,#7
      000C4D 85               [ 2] 2049 3$:	popw x 
      000C4E 81               [ 4] 2050 	ret 
                                   2051 
      000C4F 61 62 74 6E 76 66 72  2052 escaped: .asciz "abtnvfr"
             00
                                   2053 
                                   2054 ;-------------------------
                                   2055 ; integer parser 
                                   2056 ; input:
                                   2057 ;   X 		point to pad 
                                   2058 ;   Y 		point to tib 
                                   2059 ;   A 	    first digit|'$' 
                                   2060 ; output:  
                                   2061 ;   pad     number string 
                                   2062 ;   X 		integer 
                                   2063 ;   A 		TK_INTGR
                                   2064 ;-------------------------
                           000001  2065 	BASE=1
                           000002  2066 	TCHAR=2 
                           000002  2067 	VSIZE=2 
      000C57                       2068 parse_integer: ; { -- n }
      000C57 4B 00            [ 1] 2069 	push #0 ; TCHAR 
      000C59 A1 24            [ 1] 2070 	cp a,#'$
      000C5B 27 04            [ 1] 2071 	jreq 1$ 
      000C5D 4B 0A            [ 1] 2072 	push #10 ; BASE=10 
      000C5F 20 02            [ 2] 2073 	jra 2$ 
      000C61 4B 10            [ 1] 2074 1$: push #16  ; BASE=16
      000C63 F7               [ 1] 2075 2$:	ld (x),a 
      000C64 5C               [ 1] 2076 	incw x 
      000C65 72 5C 00 01      [ 1] 2077 	inc in 
      000C69 91 D6 00         [ 4] 2078 	ld a,([in.w],y)
      000C6C CD 0E B5         [ 4] 2079 	call to_upper 
      000C6F 6B 02            [ 1] 2080 	ld (TCHAR,sp),a 
      000C71 CD 0E AC         [ 4] 2081 	call is_digit 
      000C74 25 ED            [ 1] 2082 	jrc 2$
      000C76 A6 10            [ 1] 2083 	ld a,#16 
      000C78 11 01            [ 1] 2084 	cp a,(BASE,sp)
      000C7A 26 0A            [ 1] 2085 	jrne 3$ 
      000C7C 7B 02            [ 1] 2086 	ld a,(TCHAR,sp)
      000C7E A1 41            [ 1] 2087 	cp a,#'A 
      000C80 2B 04            [ 1] 2088 	jrmi 3$ 
      000C82 A1 47            [ 1] 2089 	cp a,#'G 
      000C84 2B DD            [ 1] 2090 	jrmi 2$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 41.
Hexadecimal [24-Bits]



      000C86 7F               [ 1] 2091 3$:	clr (x)
      000C87 CD 0E C1         [ 4] 2092 	call atoi24
      000C8A CE 00 08         [ 2] 2093 	ldw x,acc16 
      000C8D A6 04            [ 1] 2094 	ld a,#TK_INTGR
      000C8F                       2095 	_drop VSIZE  
      000C8F 5B 02            [ 2]    1     addw sp,#VSIZE 
      000C91 81               [ 4] 2096 	ret 	
                                   2097 
                                   2098 ;-------------------------
                                   2099 ; binary integer parser 
                                   2100 ; input:
                                   2101 ;   X 		point to pad 
                                   2102 ;   Y 		point to tib 
                                   2103 ;   A 	    '%' 
                                   2104 ; output:  
                                   2105 ;   pad     number string 
                                   2106 ;   X 		integer 
                                   2107 ;   A 		TK_INTGR
                                   2108 ;   TOS     integer 
                                   2109 ;-------------------------
                           000001  2110 	BINARY=1
                           000002  2111 	VSIZE=2
      000C92                       2112 parse_binary: ; { -- n }
      000C92 4B 00            [ 1] 2113 	push #0
      000C94 4B 00            [ 1] 2114 	push #0
      000C96 F7               [ 1] 2115 1$: ld (x),a 
      000C97 5C               [ 1] 2116 	incw x 
      000C98 72 5C 00 01      [ 1] 2117 	inc in 
      000C9C 91 D6 00         [ 4] 2118 	ld a,([in.w],y)
      000C9F A1 30            [ 1] 2119 	cp a,#'0 
      000CA1 27 06            [ 1] 2120 	jreq 2$
      000CA3 A1 31            [ 1] 2121 	cp a,#'1 
      000CA5 27 02            [ 1] 2122 	jreq 2$ 
      000CA7 20 09            [ 2] 2123 	jra bin_exit 
      000CA9 A0 30            [ 1] 2124 2$: sub a,#'0	
      000CAB 46               [ 1] 2125 	rrc a 
      000CAC 09 02            [ 1] 2126 	rlc (BINARY+1,sp)
      000CAE 09 01            [ 1] 2127 	rlc (BINARY,sp)
      000CB0 20 E4            [ 2] 2128 	jra 1$  
      000CB2                       2129 bin_exit:
      000CB2 7F               [ 1] 2130 	clr (x)
      000CB3 1E 01            [ 2] 2131 	ldw x,(BINARY,sp)
      000CB5 A6 04            [ 1] 2132 	ld a,#TK_INTGR 	
      000CB7                       2133 	_drop VSIZE 
      000CB7 5B 02            [ 2]    1     addw sp,#VSIZE 
      000CB9 81               [ 4] 2134 	ret
                                   2135 
                                   2136 ;---------------------------
                                   2137 ;  token begin with a letter,
                                   2138 ;  is keyword or variable. 	
                                   2139 ; input:
                                   2140 ;   X 		point to pad 
                                   2141 ;   Y 		point to text
                                   2142 ;   A 	    first letter  
                                   2143 ; output:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 42.
Hexadecimal [24-Bits]



                                   2144 ;   X		exec_addr|var_addr 
                                   2145 ;   A 		TK_CMD 
                                   2146 ;   pad 	keyword|var_name  
                                   2147 ;   TOS     exec_addr|var_addr 
                                   2148 ;--------------------------  
      000CBA                       2149 parse_keyword: ; { -- exec_addr|var_addr}
      000CBA CD 0E B5         [ 4] 2150 	call to_upper 
      000CBD F7               [ 1] 2151 	ld (x),a 
      000CBE 5C               [ 1] 2152 	incw x 
      000CBF 72 5C 00 01      [ 1] 2153 	inc in 
      000CC3 91 D6 00         [ 4] 2154 	ld a,([in.w],y)
      000CC6 CD 04 FD         [ 4] 2155 	call is_alpha 
      000CC9 25 EF            [ 1] 2156 	jrc parse_keyword 
      000CCB 7F               [ 1] 2157 1$: clr (x)
      000CCC 72 5D 17 19      [ 1] 2158 	tnz pad+1 
      000CD0 26 15            [ 1] 2159 	jrne 2$
                                   2160 ; one letter variable name 
      000CD2 C6 17 18         [ 1] 2161 	ld a,pad 
      000CD5 A0 41            [ 1] 2162 	sub a,#'A 
      000CD7 48               [ 1] 2163 	sll a 
      000CD8 88               [ 1] 2164 	push a 
      000CD9 4B 00            [ 1] 2165 	push #0
      000CDB AE 00 21         [ 2] 2166 	ldw x,#vars 
      000CDE 72 FB 01         [ 2] 2167 	addw x,(1,sp) ; X=var address 
      000CE1                       2168 	_drop 2 
      000CE1 5B 02            [ 2]    1     addw sp,#2 
      000CE3 A6 05            [ 1] 2169 	ld a,#TK_VAR 
      000CE5 20 0C            [ 2] 2170 	jra 4$ 
      000CE7                       2171 2$: ; check for keyword, otherwise syntax error.
      000CE7                       2172 	_ldx_dict kword_dict
      000CE7 AE 22 73         [ 2]    1     ldw x,#kword_dict+2
      000CEA CD 11 51         [ 4] 2173 	call search_dict
      000CED 4D               [ 1] 2174 	tnz a
      000CEE 26 03            [ 1] 2175 	jrne 4$ 
      000CF0 CC 07 14         [ 2] 2176 	jp syntax_error
      000CF3 81               [ 4] 2177 4$:	ret  	
                                   2178 
                                   2179 
                                   2180 ;------------------------------------
                                   2181 ; Command line tokenizer
                                   2182 ; scan text for next token
                                   2183 ; move token in 'pad'
                                   2184 ; input: 
      000CF4                       2185 	none: 
                                   2186 ; use:
                                   2187 ;	Y   pointer to text
                                   2188 ;   X	pointer to pad 
                                   2189 ;   in.w   index in text buffer
                                   2190 ; output:
                                   2191 ;   A       token attribute 
                                   2192 ;   pad 	token as .asciz
                                   2193 ;   X 		token value   
                                   2194 ;------------------------------------
                                   2195 	; use to check special character 
                                   2196 	.macro _case c t  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 43.
Hexadecimal [24-Bits]



                                   2197 	ld a,#c 
                                   2198 	cp a,(TCHAR,sp) 
                                   2199 	jrne t
                                   2200 	.endm 
                                   2201 
                           000001  2202 	TCHAR=1
                           000002  2203 	ATTRIB=2 
                           000002  2204 	VSIZE=2
      000CF4                       2205 get_token: 
      000CF4 90 AE 16 C8      [ 2] 2206 	ldw y,#tib    	
      000CF8 C6 00 01         [ 1] 2207 	ld a,in 
      000CFB C1 00 03         [ 1] 2208 	cp a,count 
      000CFE 2B 03            [ 1] 2209 	jrmi 1$
      000D00 A6 00            [ 1] 2210 	ld a,#TK_NONE 
      000D02 81               [ 4] 2211 	ret 
      000D03                       2212 1$:	
      000D03                       2213 	_vars VSIZE
      000D03 52 02            [ 2]    1     sub sp,#VSIZE 
      000D05 AE 17 18         [ 2] 2214 	ldw x, #pad
      000D08 A6 20            [ 1] 2215 	ld a,#SPACE
      000D0A CD 0F 6D         [ 4] 2216 	call skip
      000D0D 55 00 01 00 02   [ 1] 2217 	mov in.saved,in 
      000D12 91 D6 00         [ 4] 2218 	ld a,([in.w],y)
      000D15 26 07            [ 1] 2219 	jrne str_tst
      000D17 72 5F 17 18      [ 1] 2220 	clr pad 
      000D1B CC 0E A9         [ 2] 2221 	jp token_exit ; end of line 
                                   2222 
      000D1E                       2223 str_tst: ; check for quoted string  	
      000D1E CD 0E B5         [ 4] 2224 	call to_upper 
      000D21 6B 01            [ 1] 2225 	ld (TCHAR,sp),a 
      000D23                       2226 	_case '"' nbr_tst
      000D23 A6 22            [ 1]    1 	ld a,#'"' 
      000D25 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D27 26 06            [ 1]    3 	jrne nbr_tst
      000D29 CD 0B FF         [ 4] 2227 	call parse_quote
      000D2C CC 0E A9         [ 2] 2228 	jp token_exit
      000D2F                       2229 nbr_tst: ; check for number 
      000D2F A6 24            [ 1] 2230 	ld a,#'$'
      000D31 11 01            [ 1] 2231 	cp a,(TCHAR,sp) 
      000D33 27 13            [ 1] 2232 	jreq 1$
      000D35 A6 26            [ 1] 2233 	ld a,#'&
      000D37 11 01            [ 1] 2234 	cp a,(TCHAR,sp)
      000D39 26 06            [ 1] 2235 	jrne 0$
      000D3B CD 0C 92         [ 4] 2236 	call parse_binary ; expect binary integer 
      000D3E CC 0E A9         [ 2] 2237 	jp token_exit 
      000D41 7B 01            [ 1] 2238 0$:	ld a,(TCHAR,sp)
      000D43 CD 0E AC         [ 4] 2239 	call is_digit
      000D46 24 06            [ 1] 2240 	jrnc 3$
      000D48 CD 0C 57         [ 4] 2241 1$:	call parse_integer 
      000D4B CC 0E A9         [ 2] 2242 	jp token_exit 
      000D4E                       2243 3$: 
      000D4E                       2244 	_case '(' bkslsh_tst 
      000D4E A6 28            [ 1]    1 	ld a,#'(' 
      000D50 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D52 26 05            [ 1]    3 	jrne bkslsh_tst
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 44.
Hexadecimal [24-Bits]



      000D54 A6 0B            [ 1] 2245 	ld a,#TK_LPAREN
      000D56 CC 0E 99         [ 2] 2246 	jp token_char   	
      000D59                       2247 bkslsh_tst:
      000D59                       2248 	_case '\',rparnt_tst
      000D59 A6 5C            [ 1]    1 	ld a,#'\' 
      000D5B 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D5D 26 18            [ 1]    3 	jrne rparnt_tst
      000D5F 7B 01            [ 1] 2249 	ld a,(TCHAR,sp)
      000D61 F7               [ 1] 2250 	ld (x),a 
      000D62 5C               [ 1] 2251 	incw x 
      000D63 72 5C 00 01      [ 1] 2252 	inc in 
      000D67 91 D6 00         [ 4] 2253 	ld a,([in.w],y)
      000D6A F7               [ 1] 2254 	ld (x),a 
      000D6B 5C               [ 1] 2255 	incw x 
      000D6C 72 5C 00 01      [ 1] 2256 	inc in  
      000D70 7F               [ 1] 2257 	clr (x) 
      000D71 97               [ 1] 2258 	ld xl,a 
      000D72 A6 03            [ 1] 2259 	ld a,#TK_CHAR 
      000D74 CC 0E A9         [ 2] 2260 	jp token_exit 
      000D77                       2261 rparnt_tst:		
      000D77                       2262 	_case ')' colon_tst 
      000D77 A6 29            [ 1]    1 	ld a,#')' 
      000D79 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D7B 26 05            [ 1]    3 	jrne colon_tst
      000D7D A6 0C            [ 1] 2263 	ld a,#TK_RPAREN 
      000D7F CC 0E 99         [ 2] 2264 	jp token_char 
      000D82                       2265 colon_tst:
      000D82                       2266 	_case ':' comma_tst 
      000D82 A6 3A            [ 1]    1 	ld a,#':' 
      000D84 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D86 26 05            [ 1]    3 	jrne comma_tst
      000D88 A6 01            [ 1] 2267 	ld a,#TK_COLON 
      000D8A CC 0E 99         [ 2] 2268 	jp token_char 
      000D8D                       2269 comma_tst:
      000D8D                       2270 	_case COMMA sharp_tst 
      000D8D A6 2C            [ 1]    1 	ld a,#COMMA 
      000D8F 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D91 26 05            [ 1]    3 	jrne sharp_tst
      000D93 A6 0D            [ 1] 2271 	ld a,#TK_COMMA
      000D95 CC 0E 99         [ 2] 2272 	jp token_char
      000D98                       2273 sharp_tst:
      000D98                       2274 	_case SHARP dash_tst 
      000D98 A6 23            [ 1]    1 	ld a,#SHARP 
      000D9A 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D9C 26 05            [ 1]    3 	jrne dash_tst
      000D9E A6 0E            [ 1] 2275 	ld a,#TK_SHARP
      000DA0 CC 0E 99         [ 2] 2276 	jp token_char  	 	 
      000DA3                       2277 dash_tst: 	
      000DA3                       2278 	_case '-' at_tst 
      000DA3 A6 2D            [ 1]    1 	ld a,#'-' 
      000DA5 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DA7 26 05            [ 1]    3 	jrne at_tst
      000DA9 A6 11            [ 1] 2279 	ld a,#TK_MINUS  
      000DAB CC 0E 99         [ 2] 2280 	jp token_char 
      000DAE                       2281 at_tst:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 45.
Hexadecimal [24-Bits]



      000DAE                       2282 	_case '@' qmark_tst 
      000DAE A6 40            [ 1]    1 	ld a,#'@' 
      000DB0 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DB2 26 05            [ 1]    3 	jrne qmark_tst
      000DB4 A6 02            [ 1] 2283 	ld a,#TK_ARRAY 
      000DB6 CC 0E 99         [ 2] 2284 	jp token_char
      000DB9                       2285 qmark_tst:
      000DB9                       2286 	_case '?' tick_tst 
      000DB9 A6 3F            [ 1]    1 	ld a,#'?' 
      000DBB 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DBD 26 11            [ 1]    3 	jrne tick_tst
      000DBF 7B 01            [ 1] 2287 	ld a,(TCHAR,sp)
      000DC1 F7               [ 1] 2288 	ld (x),a 
      000DC2 5C               [ 1] 2289 	incw x 
      000DC3 7F               [ 1] 2290 	clr (x)
      000DC4 72 5C 00 01      [ 1] 2291 	inc in 
      000DC8 A6 06            [ 1] 2292 	ld a,#TK_CMD 
      000DCA AE 16 02         [ 2] 2293 	ldw x,#print 
      000DCD CC 0E A9         [ 2] 2294 	jp token_exit
      000DD0                       2295 tick_tst: ; ignore comment 
      000DD0                       2296 	_case TICK plus_tst 
      000DD0 A6 27            [ 1]    1 	ld a,#TICK 
      000DD2 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DD4 26 0C            [ 1]    3 	jrne plus_tst
      000DD6 72 5C 00 01      [ 1] 2297 	inc in 
      000DDA A6 06            [ 1] 2298 	ld a,#TK_CMD 
      000DDC AE 17 07         [ 2] 2299 	ldw x,#rem 
      000DDF CC 0E A9         [ 2] 2300 	jp token_exit 
      000DE2                       2301 plus_tst:
      000DE2                       2302 	_case '+' star_tst 
      000DE2 A6 2B            [ 1]    1 	ld a,#'+' 
      000DE4 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DE6 26 05            [ 1]    3 	jrne star_tst
      000DE8 A6 10            [ 1] 2303 	ld a,#TK_PLUS  
      000DEA CC 0E 99         [ 2] 2304 	jp token_char 
      000DED                       2305 star_tst:
      000DED                       2306 	_case '*' slash_tst 
      000DED A6 2A            [ 1]    1 	ld a,#'*' 
      000DEF 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DF1 26 05            [ 1]    3 	jrne slash_tst
      000DF3 A6 20            [ 1] 2307 	ld a,#TK_MULT 
      000DF5 CC 0E 99         [ 2] 2308 	jp token_char 
      000DF8                       2309 slash_tst: 
      000DF8                       2310 	_case '/' prcnt_tst 
      000DF8 A6 2F            [ 1]    1 	ld a,#'/' 
      000DFA 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DFC 26 05            [ 1]    3 	jrne prcnt_tst
      000DFE A6 21            [ 1] 2311 	ld a,#TK_DIV 
      000E00 CC 0E 99         [ 2] 2312 	jp token_char 
      000E03                       2313 prcnt_tst:
      000E03                       2314 	_case '%' eql_tst 
      000E03 A6 25            [ 1]    1 	ld a,#'%' 
      000E05 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000E07 26 05            [ 1]    3 	jrne eql_tst
      000E09 A6 22            [ 1] 2315 	ld a,#TK_MOD
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 46.
Hexadecimal [24-Bits]



      000E0B CC 0E 99         [ 2] 2316 	jp token_char  
                                   2317 ; 1 or 2 character tokens 	
      000E0E                       2318 eql_tst:
      000E0E                       2319 	_case '=' gt_tst 		
      000E0E A6 3D            [ 1]    1 	ld a,#'=' 
      000E10 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000E12 26 05            [ 1]    3 	jrne gt_tst
      000E14 A6 32            [ 1] 2320 	ld a,#TK_EQUAL
      000E16 CC 0E 99         [ 2] 2321 	jp token_char 
      000E19                       2322 gt_tst:
      000E19                       2323 	_case '>' lt_tst 
      000E19 A6 3E            [ 1]    1 	ld a,#'>' 
      000E1B 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000E1D 26 33            [ 1]    3 	jrne lt_tst
      000E1F A6 31            [ 1] 2324 	ld a,#TK_GT 
      000E21 6B 02            [ 1] 2325 	ld (ATTRIB,sp),a 
      000E23 72 5C 00 01      [ 1] 2326 	inc in 
      000E27 91 D6 00         [ 4] 2327 	ld a,([in.w],y)
      000E2A A1 3D            [ 1] 2328 	cp a,#'=
      000E2C 26 0C            [ 1] 2329 	jrne 1$
      000E2E 7B 01            [ 1] 2330 	ld a,(TCHAR,sp)
      000E30 F7               [ 1] 2331 	ld (x),a
      000E31 5C               [ 1] 2332 	incw x 
      000E32 A6 3D            [ 1] 2333 	ld a,#'=
      000E34 6B 01            [ 1] 2334 	ld (TCHAR,sp),a 
      000E36 A6 33            [ 1] 2335 	ld a,#TK_GE 
      000E38 20 5F            [ 2] 2336 	jra token_char  
      000E3A A1 3C            [ 1] 2337 1$: cp a,#'<
      000E3C 26 0C            [ 1] 2338 	jrne 2$
      000E3E 7B 01            [ 1] 2339 	ld a,(TCHAR,sp)
      000E40 F7               [ 1] 2340 	ld (x),a
      000E41 5C               [ 1] 2341 	incw x 
      000E42 A6 3C            [ 1] 2342 	ld a,#'<	
      000E44 6B 01            [ 1] 2343 	ld (TCHAR,sp),a 
      000E46 A6 35            [ 1] 2344 	ld a,#TK_NE 
      000E48 20 4F            [ 2] 2345 	jra token_char 
      000E4A 72 5A 00 01      [ 1] 2346 2$: dec in
      000E4E 7B 02            [ 1] 2347 	ld a,(ATTRIB,sp)
      000E50 20 47            [ 2] 2348 	jra token_char 
      000E52                       2349 lt_tst:
      000E52                       2350 	_case '<' other
      000E52 A6 3C            [ 1]    1 	ld a,#'<' 
      000E54 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000E56 26 32            [ 1]    3 	jrne other
      000E58 A6 34            [ 1] 2351 	ld a,#TK_LT 
      000E5A 6B 02            [ 1] 2352 	ld (ATTRIB,sp),a 
      000E5C 72 5C 00 01      [ 1] 2353 	inc in 
      000E60 91 D6 00         [ 4] 2354 	ld a,([in.w],y)
      000E63 A1 3D            [ 1] 2355 	cp a,#'=
      000E65 26 0B            [ 1] 2356 	jrne 1$
      000E67 7B 01            [ 1] 2357 	ld a,(TCHAR,sp)
      000E69 F7               [ 1] 2358 	ld (x),a 
      000E6A A6 3D            [ 1] 2359 	ld a,#'=
      000E6C 6B 01            [ 1] 2360 	ld (TCHAR,sp),a 
      000E6E A6 36            [ 1] 2361 	ld a,#TK_LE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 47.
Hexadecimal [24-Bits]



      000E70 20 27            [ 2] 2362 	jra token_char 
      000E72 A1 3E            [ 1] 2363 1$: cp a,#'>
      000E74 26 0C            [ 1] 2364 	jrne 2$
      000E76 7B 01            [ 1] 2365 	ld a,(TCHAR,sp)
      000E78 F7               [ 1] 2366 	ld (x),a 
      000E79 5C               [ 1] 2367 	incw x 
      000E7A A6 3E            [ 1] 2368 	ld a,#'>
      000E7C 6B 01            [ 1] 2369 	ld (TCHAR,sp),a 
      000E7E A6 35            [ 1] 2370 	ld a,#TK_NE 
      000E80 20 17            [ 2] 2371 	jra token_char 
      000E82 72 5A 00 01      [ 1] 2372 2$: dec in 
      000E86 7B 02            [ 1] 2373 	ld a,(ATTRIB,sp)
      000E88 20 0F            [ 2] 2374 	jra token_char 	
      000E8A                       2375 other: ; not a special character 	 
      000E8A 7B 01            [ 1] 2376 	ld a,(TCHAR,sp)
      000E8C CD 04 FD         [ 4] 2377 	call is_alpha 
      000E8F 25 03            [ 1] 2378 	jrc 30$ 
      000E91 CC 07 14         [ 2] 2379 	jp syntax_error 
      000E94                       2380 30$: 
      000E94 CD 0C BA         [ 4] 2381 	call parse_keyword
      000E97 20 10            [ 2] 2382 	jra token_exit 
      000E99                       2383 token_char:
      000E99 6B 02            [ 1] 2384 	ld (ATTRIB,sp),a 
      000E9B 7B 01            [ 1] 2385 	ld a,(TCHAR,sp)
      000E9D F7               [ 1] 2386 	ld (x),a 
      000E9E 5C               [ 1] 2387 	incw x 
      000E9F 7F               [ 1] 2388 	clr(x)
      000EA0 72 5C 00 01      [ 1] 2389 	inc in 
      000EA4 7B 02            [ 1] 2390 	ld a,(ATTRIB,sp)
      000EA6 AE 17 18         [ 2] 2391 	ldw x,#pad 
      000EA9                       2392 token_exit:
      000EA9                       2393 	_drop VSIZE 
      000EA9 5B 02            [ 2]    1     addw sp,#VSIZE 
      000EAB 81               [ 4] 2394 	ret
                                   2395 
                                   2396 
                                   2397 
                                   2398 ;------------------------------------
                                   2399 ; check if character in {'0'..'9'}
                                   2400 ; input:
                                   2401 ;    A  character to test
                                   2402 ; output:
                                   2403 ;    Carry  0 not digit | 1 digit
                                   2404 ;------------------------------------
      000EAC                       2405 is_digit:
      000EAC A1 30            [ 1] 2406 	cp a,#'0
      000EAE 25 03            [ 1] 2407 	jrc 1$
      000EB0 A1 3A            [ 1] 2408     cp a,#'9+1
      000EB2 8C               [ 1] 2409 	ccf 
      000EB3 8C               [ 1] 2410 1$:	ccf 
      000EB4 81               [ 4] 2411     ret
                                   2412 
                                   2413 ;------------------------------------
                                   2414 ; convert alpha to uppercase
                                   2415 ; input:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 48.
Hexadecimal [24-Bits]



                                   2416 ;    a  character to convert
                                   2417 ; output:
                                   2418 ;    a  uppercase character
                                   2419 ;------------------------------------
      000EB5                       2420 to_upper::
      000EB5 A1 61            [ 1] 2421 	cp a,#'a
      000EB7 2A 01            [ 1] 2422 	jrpl 1$
      000EB9 81               [ 4] 2423 0$:	ret
      000EBA A1 7A            [ 1] 2424 1$: cp a,#'z	
      000EBC 22 FB            [ 1] 2425 	jrugt 0$
      000EBE A0 20            [ 1] 2426 	sub a,#32
      000EC0 81               [ 4] 2427 	ret
                                   2428 	
                                   2429 ;------------------------------------
                                   2430 ; convert pad content in integer
                                   2431 ; input:
                                   2432 ;    pad		.asciz to convert
                                   2433 ; output:
                                   2434 ;    acc24      int24_t
                                   2435 ;------------------------------------
                                   2436 	; local variables
                           000001  2437 	SIGN=1 ; 1 byte, 
                           000002  2438 	BASE=2 ; 1 byte, numeric base used in conversion
                           000003  2439 	TEMP=3 ; 1 byte, temporary storage
                           000003  2440 	VSIZE=3 ; 3 bytes reserved for local storage
      000EC1                       2441 atoi24:
      000EC1 89               [ 2] 2442 	pushw x ;save x
      000EC2 52 03            [ 2] 2443 	sub sp,#VSIZE
                                   2444 	; acc24=0 
      000EC4 72 5F 00 07      [ 1] 2445 	clr acc24    
      000EC8 72 5F 00 08      [ 1] 2446 	clr acc16
      000ECC 72 5F 00 09      [ 1] 2447 	clr acc8 
      000ED0 C6 17 18         [ 1] 2448 	ld a, pad 
      000ED3 27 5A            [ 1] 2449 	jreq atoi_exit
      000ED5 0F 01            [ 1] 2450 	clr (SIGN,sp)
      000ED7 A6 0A            [ 1] 2451 	ld a,#10
      000ED9 6B 02            [ 1] 2452 	ld (BASE,sp),a ; default base decimal
      000EDB AE 17 18         [ 2] 2453 	ldw x,#pad ; pointer to string to convert
      000EDE F6               [ 1] 2454 	ld a,(x)
      000EDF 27 47            [ 1] 2455 	jreq 9$  ; completed if 0
      000EE1 A1 2D            [ 1] 2456 	cp a,#'-
      000EE3 26 04            [ 1] 2457 	jrne 1$
      000EE5 03 01            [ 1] 2458 	cpl (SIGN,sp)
      000EE7 20 08            [ 2] 2459 	jra 2$
      000EE9 A1 24            [ 1] 2460 1$: cp a,#'$
      000EEB 26 06            [ 1] 2461 	jrne 3$
      000EED A6 10            [ 1] 2462 	ld a,#16
      000EEF 6B 02            [ 1] 2463 	ld (BASE,sp),a
      000EF1 5C               [ 1] 2464 2$:	incw x
      000EF2 F6               [ 1] 2465 	ld a,(x)
      000EF3                       2466 3$:	
      000EF3 A1 61            [ 1] 2467 	cp a,#'a
      000EF5 2B 02            [ 1] 2468 	jrmi 4$
      000EF7 A0 20            [ 1] 2469 	sub a,#32
      000EF9 A1 30            [ 1] 2470 4$:	cp a,#'0
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 49.
Hexadecimal [24-Bits]



      000EFB 2B 2B            [ 1] 2471 	jrmi 9$
      000EFD A0 30            [ 1] 2472 	sub a,#'0
      000EFF A1 0A            [ 1] 2473 	cp a,#10
      000F01 2B 06            [ 1] 2474 	jrmi 5$
      000F03 A0 07            [ 1] 2475 	sub a,#7
      000F05 11 02            [ 1] 2476 	cp a,(BASE,sp)
      000F07 2A 1F            [ 1] 2477 	jrpl 9$
      000F09 6B 03            [ 1] 2478 5$:	ld (TEMP,sp),a
      000F0B 7B 02            [ 1] 2479 	ld a,(BASE,sp)
      000F0D CD 0F 33         [ 4] 2480 	call mulu24_8
      000F10 7B 03            [ 1] 2481 	ld a,(TEMP,sp)
      000F12 CB 00 09         [ 1] 2482 	add a,acc24+2
      000F15 C7 00 09         [ 1] 2483 	ld acc24+2,a
      000F18 4F               [ 1] 2484 	clr a
      000F19 C9 00 08         [ 1] 2485 	adc a,acc24+1
      000F1C C7 00 08         [ 1] 2486 	ld acc24+1,a
      000F1F 4F               [ 1] 2487 	clr a
      000F20 C9 00 07         [ 1] 2488 	adc a,acc24
      000F23 C7 00 07         [ 1] 2489 	ld acc24,a
      000F26 20 C9            [ 2] 2490 	jra 2$
      000F28 0D 01            [ 1] 2491 9$:	tnz (SIGN,sp)
      000F2A 27 03            [ 1] 2492     jreq atoi_exit
      000F2C CD 0A 58         [ 4] 2493     call neg_acc24
      000F2F                       2494 atoi_exit: 
      000F2F 5B 03            [ 2] 2495 	addw sp,#VSIZE
      000F31 85               [ 2] 2496 	popw x ; restore x
      000F32 81               [ 4] 2497 	ret
                                   2498 
                                   2499 ;--------------------------------------
                                   2500 ; unsigned multiply uint24_t by uint8_t
                                   2501 ; use to convert numerical string to uint24_t
                                   2502 ; input:
                                   2503 ;	acc24	uint24_t 
                                   2504 ;   A		uint8_t
                                   2505 ; output:
                                   2506 ;   acc24   A*acc24
                                   2507 ;-------------------------------------
                                   2508 ; local variables offset  on sp
                           000003  2509 	U8   = 3   ; A pushed on stack
                           000002  2510 	OVFL = 2  ; multiplicaton overflow low byte
                           000001  2511 	OVFH = 1  ; multiplication overflow high byte
                           000003  2512 	VSIZE = 3
      000F33                       2513 mulu24_8:
      000F33 89               [ 2] 2514 	pushw x    ; save X
                                   2515 	; local variables
      000F34 88               [ 1] 2516 	push a     ; U8
      000F35 5F               [ 1] 2517 	clrw x     ; initialize overflow to 0
      000F36 89               [ 2] 2518 	pushw x    ; multiplication overflow
                                   2519 ; multiply low byte.
      000F37 C6 00 09         [ 1] 2520 	ld a,acc24+2
      000F3A 97               [ 1] 2521 	ld xl,a
      000F3B 7B 03            [ 1] 2522 	ld a,(U8,sp)
      000F3D 42               [ 4] 2523 	mul x,a
      000F3E 9F               [ 1] 2524 	ld a,xl
      000F3F C7 00 09         [ 1] 2525 	ld acc24+2,a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 50.
Hexadecimal [24-Bits]



      000F42 9E               [ 1] 2526 	ld a, xh
      000F43 6B 02            [ 1] 2527 	ld (OVFL,sp),a
                                   2528 ; multipy middle byte
      000F45 C6 00 08         [ 1] 2529 	ld a,acc24+1
      000F48 97               [ 1] 2530 	ld xl,a
      000F49 7B 03            [ 1] 2531 	ld a, (U8,sp)
      000F4B 42               [ 4] 2532 	mul x,a
                                   2533 ; add overflow to this partial product
      000F4C 72 FB 01         [ 2] 2534 	addw x,(OVFH,sp)
      000F4F 9F               [ 1] 2535 	ld a,xl
      000F50 C7 00 08         [ 1] 2536 	ld acc24+1,a
      000F53 4F               [ 1] 2537 	clr a
      000F54 A9 00            [ 1] 2538 	adc a,#0
      000F56 6B 01            [ 1] 2539 	ld (OVFH,sp),a
      000F58 9E               [ 1] 2540 	ld a,xh
      000F59 6B 02            [ 1] 2541 	ld (OVFL,sp),a
                                   2542 ; multiply most signficant byte	
      000F5B C6 00 07         [ 1] 2543 	ld a, acc24
      000F5E 97               [ 1] 2544 	ld xl, a
      000F5F 7B 03            [ 1] 2545 	ld a, (U8,sp)
      000F61 42               [ 4] 2546 	mul x,a
      000F62 72 FB 01         [ 2] 2547 	addw x, (OVFH,sp)
      000F65 9F               [ 1] 2548 	ld a, xl
      000F66 C7 00 07         [ 1] 2549 	ld acc24,a
      000F69 5B 03            [ 2] 2550     addw sp,#VSIZE
      000F6B 85               [ 2] 2551 	popw x
      000F6C 81               [ 4] 2552 	ret
                                   2553 
                                   2554 ;------------------------------------
                                   2555 ; skip character c in text starting from 'in'
                                   2556 ; input:
                                   2557 ;	 y 		point to text buffer
                                   2558 ;    a 		character to skip
                                   2559 ; output:  
                                   2560 ;	'in' ajusted to new position
                                   2561 ;------------------------------------
                           000001  2562 	C = 1 ; local var
      000F6D                       2563 skip:
      000F6D 88               [ 1] 2564 	push a
      000F6E 91 D6 00         [ 4] 2565 1$:	ld a,([in.w],y)
      000F71 27 0A            [ 1] 2566 	jreq 2$
      000F73 11 01            [ 1] 2567 	cp a,(C,sp)
      000F75 26 06            [ 1] 2568 	jrne 2$
      000F77 72 5C 00 01      [ 1] 2569 	inc in
      000F7B 20 F1            [ 2] 2570 	jra 1$
      000F7D                       2571 2$: _drop 1 
      000F7D 5B 01            [ 2]    1     addw sp,#1 
      000F7F 81               [ 4] 2572 	ret
                                   2573 	
                                   2574 ;------------------------------
                                   2575 ; restore 'in.w' variable to 
                                   2576 ; its value before last call
                                   2577 ; to get_token.
                                   2578 ;------------------------------
      000F80                       2579 unget_token:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 51.
Hexadecimal [24-Bits]



      000F80 55 00 02 00 01   [ 1] 2580 	mov in,in.saved
      000F85 81               [ 4] 2581 	ret 
                                   2582 
                                   2583 
                                   2584 ;******************************
                                   2585 ;  data stack manipulation
                                   2586 ;*****************************
                                   2587 ;----------------------	
                                   2588 ; push X on data stack 
                                   2589 ; input:
                                   2590 ;	X 
                                   2591 ; output:
                                   2592 ;	none 
                                   2593 ;----------------------	
      000F86                       2594 dpush:
      000F86                       2595     _dp_down
      000F86 72 5A 00 17      [ 1]    1     dec dstkptr+1 
      000F8A 72 5A 00 17      [ 1]    2     dec dstkptr+1
      000F8E 72 CF 00 16      [ 5] 2596     ldw [dstkptr],x  
      000F92 81               [ 4] 2597 	ret 
                                   2598 
                                   2599 
                                   2600 ;----------------------	
                                   2601 ; pop data stack in X 
                                   2602 ; input:
                                   2603 ;	none
                                   2604 ; output:
                                   2605 ;	X   
                                   2606 ;----------------------	
      000F93                       2607 dpop: 
      000F93 72 CE 00 16      [ 5] 2608     ldw x, [dstkptr]
      000F97                       2609 	_dp_up
      000F97 72 5C 00 17      [ 1]    1     inc dstkptr+1
      000F9B 72 5C 00 17      [ 1]    2     inc dstkptr+1
      000F9F 81               [ 4] 2610 	ret 
                                   2611 
                                   2612 ;-----------------------------
                                   2613 ; swap top 2 elements of dstack
                                   2614 ;  {n1 n2 -- n2 n1 }
                                   2615 ;-----------------------------
      000FA0                       2616 dswap:
      000FA0 72 CE 00 16      [ 5] 2617 	ldw x,[dstkptr]
      000FA4 89               [ 2] 2618 	pushw x 
      000FA5 AE 00 02         [ 2] 2619 	ldw x,#2 
      000FA8 72 DE 00 16      [ 5] 2620 	ldw x,([dstkptr],x) 
      000FAC 72 CF 00 16      [ 5] 2621 	ldw [dstkptr],x 
      000FB0 AE 00 02         [ 2] 2622 	ldw x,#2
      000FB3 90 85            [ 2] 2623 	popw y 
      000FB5 72 DF 00 16      [ 5] 2624 	ldw ([dstkptr],x),y 
      000FB9 81               [ 4] 2625 	ret
                                   2626 
                                   2627 ;-----------------------------
                                   2628 ; drop TOS 
                                   2629 ;-----------------------------
      000FBA                       2630 ddrop: ; { n -- }
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 52.
Hexadecimal [24-Bits]



      000FBA                       2631 	_dp_up 
      000FBA 72 5C 00 17      [ 1]    1     inc dstkptr+1
      000FBE 72 5C 00 17      [ 1]    2     inc dstkptr+1
      000FC2 81               [ 4] 2632 	ret
                                   2633 	
                                   2634 ;-----------------------------
                                   2635 ; duplicate TOS 
                                   2636 ;  dstack: { ix...n -- ix...n n }
                                   2637 ;-----------------------------
      000FC3                       2638 ddup:
      000FC3 72 CE 00 16      [ 5] 2639 	ldw x,[dstkptr]
      000FC7                       2640 	_dp_down
      000FC7 72 5A 00 17      [ 1]    1     dec dstkptr+1 
      000FCB 72 5A 00 17      [ 1]    2     dec dstkptr+1
      000FCF 72 CF 00 16      [ 5] 2641     ldw [dstkptr],x  
      000FD3 81               [ 4] 2642 	ret 
                                   2643 
                                   2644 
                                   2645 ;----------------------------------
                                   2646 ; pick value n from dstack 
                                   2647 ; put it on TOS
                                   2648 ; dstack: {ix,..,p -- ix,...,np }
                                   2649 ;-----------------------------------
      000FD4                       2650 dpick:
      000FD4 72 CE 00 16      [ 5] 2651 	ldw x,[dstkptr]
      000FD8 58               [ 2] 2652 	sllw x 
      000FD9 72 BB 00 16      [ 2] 2653 	addw x,dstkptr 
      000FDD FE               [ 2] 2654 	ldw x,(x)
      000FDE 72 CF 00 16      [ 5] 2655 	ldw [dstkptr],x 
      000FE2 81               [ 4] 2656 	ret
                                   2657 
                                   2658 ;---------------------------
                                   2659 ;  fetch variable in X 
                                   2660 ;  dstack:{ addr -- value }
                                   2661 ;---------------------------
      000FE3                       2662 fetch:
      000FE3 72 CE 00 16      [ 5] 2663 	ldw x,[dstkptr]
      000FE7 FE               [ 2] 2664 	ldw x,(x)
      000FE8 72 CF 00 16      [ 5] 2665 	ldw [dstkptr],x
      000FEC 81               [ 4] 2666 	ret 
                                   2667 
                                   2668 ;----------------------------
                                   2669 ; store variable 
                                   2670 ; dstack: {addr value -- }
                                   2671 ;----------------------------
      000FED                       2672 store:
      000FED CD 0F 93         [ 4] 2673 	call dpop 
      000FF0 90 93            [ 1] 2674 	ldw y,x   ; y=value 
      000FF2 CD 0F 93         [ 4] 2675 	call dpop 
      000FF5 FF               [ 2] 2676 	ldw (x),y 
      000FF6 81               [ 4] 2677 	ret 
                                   2678 
                                   2679 ;---------------------------------
                                   2680 ; drop n elements from data stack 
                                   2681 ; input: 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 53.
Hexadecimal [24-Bits]



                                   2682 ;   X 		n 
                                   2683 ; output:
                                   2684 ;   none 
                                   2685 ;-------------------------------------
      000FF7                       2686 ddrop_n:
      000FF7 90 89            [ 2] 2687 	pushw y 
      000FF9 90 CE 00 16      [ 2] 2688 	ldw y,dstkptr 
      000FFD 58               [ 2] 2689 	sllw x 
      000FFE 89               [ 2] 2690 	pushw x 
      000FFF 72 F9 01         [ 2] 2691 	addw y,(1,sp)
      001002 90 CF 00 16      [ 2] 2692 	ldw dstkptr,y 
      001006 85               [ 2] 2693 	popw x 
      001007 90 85            [ 2] 2694 	popw y
      001009 81               [ 4] 2695 	ret 
                                   2696 
      00100A 0A 64 73 74 61 63 6B  2697 dstk_prompt: .asciz "\ndstack: " 
             3A 20 00
                                   2698 ;----------------------------
                                   2699 ; print dstack content 
                                   2700 ;---------------------------
                           000001  2701 	XSAVE=1
                           000002  2702 	VSIZE=2
      001014                       2703 dots:
      001014                       2704 	_vars VSIZE 
      001014 52 02            [ 2]    1     sub sp,#VSIZE 
      001016 AE 10 0A         [ 2] 2705 	ldw x,#dstk_prompt 
      001019 CD 01 B8         [ 4] 2706 	call puts
      00101C AE 17 7E         [ 2] 2707 	ldw x,#dstack_unf-CELL_SIZE
      00101F 35 0A 00 06      [ 1] 2708 	mov base,#10 
      001023 C3 00 16         [ 2] 2709 1$:	cpw x,dstkptr 
      001026 25 0D            [ 1] 2710 	jrult 4$ 
      001028 1F 01            [ 2] 2711 	ldw (XSAVE,sp),x
      00102A FE               [ 2] 2712 	ldw  x,(x)
      00102B CD 09 8D         [ 4] 2713 	call print_int 
      00102E 1E 01            [ 2] 2714 	ldw x,(XSAVE,sp)
      001030 1D 00 02         [ 2] 2715 	subw x,#CELL_SIZE 
      001033 20 EE            [ 2] 2716 	jra 1$ 
      001035 A6 0D            [ 1] 2717 4$: ld a,#CR 
      001037 CD 01 A6         [ 4] 2718 	call putc 
      00103A                       2719 	_drop VSIZE
      00103A 5B 02            [ 2]    1     addw sp,#VSIZE 
      00103C 4F               [ 1] 2720 	clr a 
      00103D 81               [ 4] 2721 	ret
                                   2722 
      00103E 0A 63 74 61 63 6B 3A  2723 cstk_prompt: .asciz "\nctack: "
             20 00
                                   2724 ;--------------------------------
                                   2725 ; print cstack content
                                   2726 ;--------------------------------
                           000001  2727 	XSAVE=1
                           000002  2728 	VSIZE=2 
      001047                       2729 dotr:
      001047                       2730 	_vars VSIZE 
      001047 52 02            [ 2]    1     sub sp,#VSIZE 
      001049 AE 10 3E         [ 2] 2731 	ldw x,#cstk_prompt
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 54.
Hexadecimal [24-Bits]



      00104C CD 01 B8         [ 4] 2732 	call puts 
      00104F 96               [ 1] 2733 	ldw x,sp 
      001050 1C 00 07         [ 2] 2734 	addw x,#7 ; ignore XSAVE and 2 levels of return address.
      001053 1F 01            [ 2] 2735 	ldw (XSAVE,sp),x  
      001055 AE 17 FE         [ 2] 2736 	ldw x,#RAM_SIZE-2
      001058 35 10 00 06      [ 1] 2737 	mov base,#16
      00105C                       2738 dotr_loop:
      00105C 13 01            [ 2] 2739 	cpw x,(XSAVE,sp)
      00105E 2B 0B            [ 1] 2740 	jrmi 9$
      001060 89               [ 2] 2741 	pushw x  
      001061 FE               [ 2] 2742 	ldw x,(x)
      001062 CD 09 8D         [ 4] 2743 	call print_int 
      001065 85               [ 2] 2744 	popw x  
      001066 1D 00 02         [ 2] 2745 	subw x,#CELL_SIZE
      001069 20 F1            [ 2] 2746 	jra dotr_loop 
      00106B A6 0D            [ 1] 2747 9$:	ld a,#CR 
      00106D CD 01 A6         [ 4] 2748 	call putc 
      001070                       2749 	_drop VSIZE 
      001070 5B 02            [ 2]    1     addw sp,#VSIZE 
      001072 4F               [ 1] 2750 	clr a 
      001073 81               [ 4] 2751 	ret
                                   2752 
                                   2753 
                                   2754 ;--------------------------------
                                   2755 ;  add 2 integers
                                   2756 ;  input:
                                   2757 ;    N1     on cstack 
                                   2758 ;    N2     on cstack 
                                   2759 ;  output:
                                   2760 ;    X 		n2+n1 
                                   2761 ;--------------------------------
                                   2762 	;arugments on cstack 
      001074                       2763 	_argofs 0 
                           000002     1     ARG_OFS=2+0 
      001074                       2764 	_arg N1 1 
                           000003     1     N1=ARG_OFS+1 
      001074                       2765 	_arg N2 3 
                           000005     1     N2=ARG_OFS+3 
      001074                       2766 add:
      001074 1E 05            [ 2] 2767 	ldw x ,(N2,sp)
      001076 72 FB 03         [ 2] 2768 	addw x,(N1,sp)
      001079 1F 03            [ 2] 2769 	ldw (N1,sp),x 
      00107B 81               [ 4] 2770 	ret 
                                   2771 
                                   2772 ;--------------------------------
                                   2773 ;  substract 2 ntegers
                                   2774 ;  input:
                                   2775 ;    N1     on cstack 
                                   2776 ;    N2     on cstack 
                                   2777 ;  output:
                                   2778 ;    X 		n2+n1 
                                   2779 ;--------------------------------
      00107C                       2780 	_argofs 0 
                           000002     1     ARG_OFS=2+0 
      00107C                       2781 	_arg N1 1 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 55.
Hexadecimal [24-Bits]



                           000003     1     N1=ARG_OFS+1 
      00107C                       2782 	_arg N2 3 
                           000005     1     N2=ARG_OFS+3 
      00107C                       2783 substract:
      00107C 1E 05            [ 2] 2784 	ldw x,(N2,sp)
      00107E 72 F0 03         [ 2] 2785 	subw x,(N1,sp)
      001081 81               [ 4] 2786 	ret 
                                   2787 
                                   2788 ;-------------------------------------
                                   2789 ; multiply 2 integers
                                   2790 ; product overflow is ignored unless
                                   2791 ; MATH_OVF assembler flag is set to 1
                                   2792 ; input:
                                   2793 ;  	N1      on cstack
                                   2794 ;   N2 		on cstack 
                                   2795 ; output:
                                   2796 ;	X        N1*N2 
                                   2797 ;-------------------------------------
                                   2798 	;arguments 
      001082                       2799 	_argofs 3
                           000005     1     ARG_OFS=2+3 
      001082                       2800 	_arg N1_HB 1
                           000006     1     N1_HB=ARG_OFS+1 
      001082                       2801 	_arg N1_LB 2
                           000007     1     N1_LB=ARG_OFS+2 
      001082                       2802 	_arg N2_HB 3
                           000008     1     N2_HB=ARG_OFS+3 
      001082                       2803 	_arg N2_LB 4 
                           000009     1     N2_LB=ARG_OFS+4 
                                   2804    ; local variables 
                           000001  2805 	SIGN=1
                           000002  2806 	PROD=2
                           000003  2807 	VSIZE=3
      001082                       2808 multiply:
      001082                       2809 	_vars VSIZE 
      001082 52 03            [ 2]    1     sub sp,#VSIZE 
      001084 0F 01            [ 1] 2810 	clr (SIGN,sp)
      001086 1E 06            [ 2] 2811 	ldw x,(N1_HB,sp)
      001088 9E               [ 1] 2812 	ld a,xh  
      001089 A5 80            [ 1] 2813 	bcp a,#0x80 
      00108B 27 05            [ 1] 2814 	jreq 2$
      00108D 03 01            [ 1] 2815 	cpl (SIGN,sp)
      00108F 50               [ 2] 2816 	negw x 
      001090 1F 06            [ 2] 2817 	ldw (N1_HB,sp),x 
      001092 1E 08            [ 2] 2818 2$: ldw x,(N2_HB,sp)
      001094 9E               [ 1] 2819 	ld a,xh  
      001095 A5 80            [ 1] 2820 	bcp a,#0x80 
      001097 27 05            [ 1] 2821 	jreq 3$
      001099 03 01            [ 1] 2822 	cpl (SIGN,sp)
      00109B 50               [ 2] 2823 	negw x 
      00109C 1F 08            [ 2] 2824 	ldw (N2_HB,sp),x 
                                   2825 ; N1_LB * N2_LB 	
      00109E 7B 07            [ 1] 2826 3$:	ld a,(N1_LB,sp)
      0010A0 97               [ 1] 2827 	ld xl,a 
      0010A1 7B 09            [ 1] 2828 	ld a,(N2_LB,sp) 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 56.
Hexadecimal [24-Bits]



      0010A3 42               [ 4] 2829 	mul x,a 
                           000000  2830 .if MATH_OVF 	
                                   2831 	ld a,xh 
                                   2832 	bcp a,#0x80 
                                   2833 	jreq 4$ 
                                   2834 	ld a,#ERR_MATH_OVF 
                                   2835 	jp tb_error
                                   2836 .endif 	 
      0010A4 1F 02            [ 2] 2837 4$:	ldw (PROD,sp),x
                                   2838 ; N1_LB * N2_HB	 
      0010A6 7B 07            [ 1] 2839 	ld a,(N1_LB,sp) 
      0010A8 97               [ 1] 2840 	ld xl,a 
      0010A9 7B 08            [ 1] 2841 	ld a,(N2_HB,sp)
      0010AB 42               [ 4] 2842 	mul x,a
      0010AC 9F               [ 1] 2843 	ld a,xl 
      0010AD 1B 02            [ 1] 2844 	add a,(PROD,sp)
                           000000  2845 .if MATH_OVF 	
                                   2846 	bcp a,#0x80 
                                   2847 	jreq 5$ 
                                   2848 	ld a,#ERR_MATH_OVF 
                                   2849 	jp tb_error
                                   2850 .endif 	 
      0010AF 6B 02            [ 1] 2851 5$:	ld (PROD,sp),a 
                                   2852 ; N1_HB * N2_LB 
      0010B1 7B 06            [ 1] 2853 	ld a,(N1_HB,sp)
      0010B3 97               [ 1] 2854 	ld xl,a 
      0010B4 7B 09            [ 1] 2855 	ld a,(N2_LB,sp)
      0010B6 42               [ 4] 2856 	mul x,a 
      0010B7 9F               [ 1] 2857 	ld a,xl 
      0010B8 1B 02            [ 1] 2858 	add a,(PROD,sp)
                           000000  2859 .if MATH_OVF 	
                                   2860 	bcp a,#0x80 
                                   2861 	jreq 6$ 
                                   2862 	ld a,#ERR_MATH_OVF 
                                   2863 	jp tb_error
                                   2864 .endif 	 
      0010BA 6B 02            [ 1] 2865 6$:	ld (PROD,sp),a 
                                   2866 ; N1_HB * N2_HB 	
                                   2867 ; it is pointless to multiply N1_HB*N2_HB 
                                   2868 ; as this product is over 65535 or 0 
                                   2869 ;
                                   2870 ; sign adjust product
      0010BC 0D 01            [ 1] 2871 	tnz (SIGN,sp)
      0010BE 27 05            [ 1] 2872 	jreq 7$
      0010C0 1E 02            [ 2] 2873 	ldw x, (PROD,sp)
      0010C2 50               [ 2] 2874 	negw x
      0010C3 1F 02            [ 2] 2875 	ldw (PROD,sp),x  
      0010C5                       2876 7$: 
      0010C5 1E 02            [ 2] 2877 	ldw x,(PROD,sp) 
      0010C7                       2878 	_drop VSIZE 
      0010C7 5B 03            [ 2]    1     addw sp,#VSIZE 
      0010C9 81               [ 4] 2879 	ret
                                   2880 
                                   2881 ;----------------------------------
                                   2882 ;  euclidian divide n2/n1 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 57.
Hexadecimal [24-Bits]



                                   2883 ; input:
                                   2884 ;    N2 	on cstack
                                   2885 ;    N1 	on cstack
                                   2886 ; output:
                                   2887 ;    X      n2/n1 
                                   2888 ;    Y      remainder 
                                   2889 ;----------------------------------
      0010CA                       2890 	_argofs 2
                           000004     1     ARG_OFS=2+2 
      0010CA                       2891 	_arg DIVISR 1
                           000005     1     DIVISR=ARG_OFS+1 
      0010CA                       2892 	_arg DIVIDND 3
                           000007     1     DIVIDND=ARG_OFS+3 
                                   2893 	; local variables
                           000001  2894 	SQUOT=1 ; sign quotient
                           000002  2895 	SDIVD=2 ; sign dividend  
                           000002  2896 	VSIZE=2
      0010CA                       2897 divide:
      0010CA                       2898 	_vars VSIZE 
      0010CA 52 02            [ 2]    1     sub sp,#VSIZE 
      0010CC 0F 01            [ 1] 2899 	clr (SQUOT,sp)
      0010CE 0F 02            [ 1] 2900 	clr (SDIVD,sp)
                                   2901 ; check for 0 divisor
      0010D0 1E 05            [ 2] 2902 	ldw x,(DIVISR,sp)
      0010D2 5D               [ 2] 2903 	tnzw x 
      0010D3 26 05            [ 1] 2904     jrne 0$
      0010D5 A6 04            [ 1] 2905 	ld a,#ERR_DIV0 
      0010D7 CC 07 16         [ 2] 2906 	jp tb_error 
                                   2907 ; check divisor sign 	
      0010DA 9E               [ 1] 2908 0$:	ld a,xh 
      0010DB A5 80            [ 1] 2909 	bcp a,#0x80 
      0010DD 27 03            [ 1] 2910 	jreq 1$
      0010DF 03 01            [ 1] 2911 	cpl (SQUOT,sp)
      0010E1 50               [ 2] 2912 	negw x 
      0010E2 1F 05            [ 2] 2913 1$:	ldw (DIVISR,sp),x
                                   2914 ; check dividend sign 	 
      0010E4 1E 07            [ 2] 2915     ldw x,(DIVIDND,sp)
      0010E6 9E               [ 1] 2916 	ld a,xh 
      0010E7 A5 80            [ 1] 2917 	bcp a,#0x80 
      0010E9 27 05            [ 1] 2918 	jreq 2$ 
      0010EB 03 01            [ 1] 2919 	cpl (SQUOT,sp)
      0010ED 03 02            [ 1] 2920 	cpl (SDIVD,sp)
      0010EF 50               [ 2] 2921 	negw x 
      0010F0 16 05            [ 2] 2922 2$:	ldw y,(DIVISR,sp)
      0010F2 65               [ 2] 2923 	divw x,y
      0010F3 90 CF 00 08      [ 2] 2924 	ldw acc16,y 
                                   2925 ; if sign dividend is negative and remainder!=0 inc divisor 	 
      0010F7 0D 02            [ 1] 2926 	tnz (SDIVD,sp)
      0010F9 27 0B            [ 1] 2927 	jreq 7$
      0010FB 90 5D            [ 2] 2928 	tnzw y 
      0010FD 27 07            [ 1] 2929 	jreq 7$
      0010FF 5C               [ 1] 2930 	incw x
      001100 16 05            [ 2] 2931 	ldw y,(DIVISR,sp)
      001102 72 B2 00 08      [ 2] 2932 	subw y,acc16
      001106 0D 01            [ 1] 2933 7$: tnz (SQUOT,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 58.
Hexadecimal [24-Bits]



      001108 27 01            [ 1] 2934 	jreq 9$ 	 
      00110A 50               [ 2] 2935 8$:	negw x 
      00110B                       2936 9$: 
      00110B                       2937 	_drop VSIZE 
      00110B 5B 02            [ 2]    1     addw sp,#VSIZE 
      00110D 81               [ 4] 2938 	ret 
                                   2939 
                                   2940 
                                   2941 ;----------------------------------
                                   2942 ;  remainder resulting from euclidian 
                                   2943 ;  division of n2/n1 
                                   2944 ; input:
                                   2945 ;   N1 		cstack 
                                   2946 ;   N2      cstack
                                   2947 ; output:
                                   2948 ;   X       N2%N1 
                                   2949 ;----------------------------------
                           000003  2950 	N1=3
                           000005  2951 	N2=5
                           000004  2952 	VSIZE=4
      00110E                       2953 modulo:
      00110E 1E 03            [ 2] 2954 	Ldw x,(N1,sp)
      001110 16 05            [ 2] 2955 	ldw y,(N2,sp)
      001112                       2956 	_vars VSIZE 
      001112 52 04            [ 2]    1     sub sp,#VSIZE 
      001114 1F 01            [ 2] 2957 	ldw (1,sp),x 
      001116 17 03            [ 2] 2958 	ldw (3,sp),y 
      001118 CD 10 CA         [ 4] 2959 	call divide 
      00111B 93               [ 1] 2960 	ldw x,y
      00111C                       2961 	_drop VSIZE 
      00111C 5B 04            [ 2]    1     addw sp,#VSIZE 
      00111E 81               [ 4] 2962 	ret 
                                   2963 
                                   2964 
                                   2965 ;----------------------------------
                                   2966 ; search in kword_dict command name
                                   2967 ;  from its execution address 
                                   2968 ; input:
                                   2969 ;   X       	execution address 
                                   2970 ; output:
                                   2971 ;   X 			cstr*  | 0 
                                   2972 ;--------------------------------
                           000001  2973 	XADR=1 
                           000003  2974 	LINK=3 
                           000004  2975 	VSIZE=4
      00111F                       2976 cmd_name:
      00111F                       2977 	_vars VSIZE 
      00111F 52 04            [ 2]    1     sub sp,#VSIZE 
      001121 72 5F 00 08      [ 1] 2978 	clr acc16 
      001125 1F 01            [ 2] 2979 	ldw (XADR,sp),x  
      001127 AE 22 71         [ 2] 2980 	ldw x,#kword_dict	
      00112A 1F 03            [ 2] 2981 1$:	ldw (LINK,sp),x
      00112C E6 02            [ 1] 2982 	ld a,(2,x)
      00112E A4 0F            [ 1] 2983 	and a,#15 
      001130 C7 00 09         [ 1] 2984 	ld acc8,a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 59.
Hexadecimal [24-Bits]



      001133 1C 00 03         [ 2] 2985 	addw x,#3
      001136 72 BB 00 08      [ 2] 2986 	addw x,acc16
      00113A FE               [ 2] 2987 	ldw x,(x) ; execution address 
      00113B 13 01            [ 2] 2988 	cpw x,(XADR,sp)
      00113D 27 0A            [ 1] 2989 	jreq 2$
      00113F 1E 03            [ 2] 2990 	ldw x,(LINK,sp)
      001141 FE               [ 2] 2991 	ldw x,(x) 
      001142 1D 00 02         [ 2] 2992 	subw x,#2  
      001145 26 E3            [ 1] 2993 	jrne 1$
      001147 20 05            [ 2] 2994 	jra 9$
      001149 1E 03            [ 2] 2995 2$: ldw x,(LINK,sp)
      00114B 1C 00 02         [ 2] 2996 	addw x,#2 	
      00114E                       2997 9$:	_drop VSIZE
      00114E 5B 04            [ 2]    1     addw sp,#VSIZE 
      001150 81               [ 4] 2998 	ret
                                   2999 
                                   3000 
                                   3001 ;---------------------------------
                                   3002 ; input:
                                   3003 ;	X 		dictionary entry point 
                                   3004 ;  pad		.asciz name to search 
                                   3005 ; output:
                                   3006 ;  A 		TK_CMD|TK_IFUNC|TK_NONE 
                                   3007 ;  X		execution address | 0 
                                   3008 ;---------------------------------
                           000001  3009 	NLEN=1 ; cmd length 
                           000002  3010 	YSAVE=2
                           000003  3011 	VSIZE=3 
      001151                       3012 search_dict:
      001151                       3013 	_vars VSIZE 
      001151 52 03            [ 2]    1     sub sp,#VSIZE 
      001153 90 93            [ 1] 3014 	ldw y,x 
      001155                       3015 search_next:	
      001155 90 F6            [ 1] 3016 	ld a,(y)
      001157 A4 0F            [ 1] 3017 	and a,#0xf 
      001159 6B 01            [ 1] 3018 	ld (NLEN,sp),a  
      00115B AE 17 18         [ 2] 3019 	ldw x,#pad 
      00115E 17 02            [ 2] 3020 	ldw (YSAVE,sp),y
      001160 90 5C            [ 1] 3021 	incw y  
      001162                       3022 cp_loop:
      001162 F6               [ 1] 3023 	ld a,(x)
      001163 27 1E            [ 1] 3024 	jreq str_match 
      001165 0D 01            [ 1] 3025 	tnz (NLEN,sp)
      001167 27 0B            [ 1] 3026 	jreq no_match  
      001169 90 F1            [ 1] 3027 	cp a,(y)
      00116B 26 07            [ 1] 3028 	jrne no_match 
      00116D 90 5C            [ 1] 3029 	incw y 
      00116F 5C               [ 1] 3030 	incw x
      001170 0A 01            [ 1] 3031 	dec (NLEN,sp)
      001172 20 EE            [ 2] 3032 	jra cp_loop 
      001174                       3033 no_match:
      001174 16 02            [ 2] 3034 	ldw y,(YSAVE,sp) 
      001176 72 A2 00 02      [ 2] 3035 	subw y,#2 ; move Y to link field
      00117A 4B 00            [ 1] 3036 	push #TK_NONE 
      00117C 90 FE            [ 2] 3037 	ldw y,(y) ; next word link 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 60.
Hexadecimal [24-Bits]



      00117E 84               [ 1] 3038 	pop a ; TK_NONE 
      00117F 27 21            [ 1] 3039 	jreq search_exit  ; not found  
                                   3040 ;try next 
      001181 20 D2            [ 2] 3041 	jra search_next
      001183                       3042 str_match:
      001183 16 02            [ 2] 3043 	ldw y,(YSAVE,sp)
      001185 90 F6            [ 1] 3044 	ld a,(y)
      001187 6B 01            [ 1] 3045 	ld (NLEN,sp),a ; needed to test keyword type  
      001189 A4 0F            [ 1] 3046 	and a,#0xf 
                                   3047 ; move y to procedure address field 	
      00118B 4C               [ 1] 3048 	inc a 
      00118C C7 00 09         [ 1] 3049 	ld acc8,a 
      00118F 72 5F 00 08      [ 1] 3050 	clr acc16 
      001193 72 B9 00 08      [ 2] 3051 	addw y,acc16 
      001197 90 FE            [ 2] 3052 	ldw y,(y) ; routine entry point 
                                   3053 ;determine keyword type bits 7:6 
      001199 7B 01            [ 1] 3054 	ld a,(NLEN,sp)
      00119B 4E               [ 1] 3055 	swap a 
      00119C A4 0C            [ 1] 3056 	and a,#0xc
      00119E 44               [ 1] 3057 	srl a
      00119F 44               [ 1] 3058 	srl a 
      0011A0 AB 06            [ 1] 3059 	add a,#6
      0011A2                       3060 search_exit: 
      0011A2 93               [ 1] 3061 	ldw x,y ; x=routine address 
      0011A3                       3062 	_drop VSIZE 	 
      0011A3 5B 03            [ 2]    1     addw sp,#VSIZE 
      0011A5 81               [ 4] 3063 	ret 
                                   3064 
                                   3065 ;---------------------
                                   3066 ; check if next token
                                   3067 ;  is of expected type 
                                   3068 ; input:
                                   3069 ;   A 		 expected token attribute
                                   3070 ;  ouput:
                                   3071 ;   none     if fail call tb_error 
                                   3072 ;--------------------
      0011A6                       3073 expect:
      0011A6 88               [ 1] 3074 	push a 
      0011A7 CD 07 F4         [ 4] 3075 	call next_token 
      0011AA 11 01            [ 1] 3076 	cp a,(1,sp)
      0011AC 27 03            [ 1] 3077 	jreq 1$
      0011AE CC 07 14         [ 2] 3078 	jp syntax_error
      0011B1 84               [ 1] 3079 1$: pop a 
      0011B2 81               [ 4] 3080 	ret 
                                   3081 
                                   3082 
                                   3083 ;-------------------------------
                                   3084 ; parse embedded BASIC routines 
                                   3085 ; arguments list.
                                   3086 ; arg_list::=  rel[','rel]*
                                   3087 ; all arguments are of integer type
                                   3088 ; input:
                                   3089 ;   none
                                   3090 ; output:
                                   3091 ;   A 			number of arguments pushed on dstack  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 61.
Hexadecimal [24-Bits]



                                   3092 ;--------------------------------
                           000001  3093 	ARG_CNT=1 
      0011B3                       3094 arg_list:
      0011B3 4B 00            [ 1] 3095 	push #0  
      0011B5 CD 12 F9         [ 4] 3096 1$: call relation
      0011B8 A1 00            [ 1] 3097 	cp a,#TK_NONE 
      0011BA 27 19            [ 1] 3098 	jreq 5$
      0011BC A1 04            [ 1] 3099 	cp a,#TK_INTGR
      0011BE 26 12            [ 1] 3100 	jrne 4$
      0011C0 CD 0F 86         [ 4] 3101 3$: call dpush 
      0011C3 0C 01            [ 1] 3102     inc (ARG_CNT,sp)
      0011C5 CD 07 F4         [ 4] 3103 	call next_token 
      0011C8 A1 00            [ 1] 3104 	cp a,#TK_NONE 
      0011CA 27 09            [ 1] 3105 	jreq 5$ 
      0011CC A1 0D            [ 1] 3106 	cp a,#TK_COMMA 
      0011CE 26 02            [ 1] 3107 	jrne 4$
      0011D0 20 E3            [ 2] 3108 	jra 1$ 
      0011D2 CD 0F 80         [ 4] 3109 4$:	call unget_token 
      0011D5 84               [ 1] 3110 5$:	pop a 
      0011D6 81               [ 4] 3111 	ret 
                                   3112 
                                   3113 
      0011D7                       3114 func_args:
      0011D7 A6 0B            [ 1] 3115 	ld a,#TK_LPAREN 
      0011D9 CD 11 A6         [ 4] 3116 	call expect 
      0011DC CD 11 B3         [ 4] 3117 	call arg_list 
      0011DF 88               [ 1] 3118 	push a 
      0011E0 A6 0C            [ 1] 3119 	ld a,#TK_RPAREN 
      0011E2 CD 11 A6         [ 4] 3120 	call expect 
      0011E5 84               [ 1] 3121 	pop a 
      0011E6 81               [ 4] 3122 	ret 
                                   3123 
                                   3124 
                                   3125 ;--------------------------------
                                   3126 ;   BASIC commnands 
                                   3127 ;--------------------------------
                                   3128 
                                   3129 ;--------------------------------
                                   3130 ;  arithmetic and relational 
                                   3131 ;  routines
                                   3132 ;  operators precedence
                                   3133 ;  highest to lowest
                                   3134 ;  operators on same row have 
                                   3135 ;  same precedence and are executed
                                   3136 ;  from left to right.
                                   3137 ;	'*','/','%'
                                   3138 ;   '-','+'
                                   3139 ;   '=','>','<','>=','<=','<>','><'
                                   3140 ;   '<>' and '><' are equivalent for not equal.
                                   3141 ;--------------------------------
                                   3142 
                                   3143 ;---------------------
                                   3144 ; return array element
                                   3145 ; address from @(expr)
                                   3146 ; input:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 62.
Hexadecimal [24-Bits]



                                   3147 ;   A 		TK_ARRAY
                                   3148 ; output:
                                   3149 ;   A 		TK_INTGR
                                   3150 ;	X 		element address 
                                   3151 ;----------------------
      0011E7                       3152 get_array_element:
      0011E7 CD 11 D7         [ 4] 3153 	call func_args 
      0011EA A1 01            [ 1] 3154 	cp a,#1
      0011EC 27 03            [ 1] 3155 	jreq 1$
      0011EE CC 07 14         [ 2] 3156 	jp syntax_error
      0011F1 CD 0F 93         [ 4] 3157 1$: call dpop  
                                   3158 	; check for bounds 
      0011F4 C3 00 1D         [ 2] 3159 	cpw x,array_size 
      0011F7 23 05            [ 2] 3160 	jrule 3$
                                   3161 ; bounds {1..array_size}	
      0011F9 A6 0A            [ 1] 3162 2$: ld a,#ERR_BAD_VALUE 
      0011FB CC 07 16         [ 2] 3163 	jp tb_error 
      0011FE 5D               [ 2] 3164 3$: tnzw  x
      0011FF 27 F8            [ 1] 3165 	jreq 2$ 
      001201 58               [ 2] 3166 	sllw x 
      001202 89               [ 2] 3167 	pushw x 
      001203 AE 16 C8         [ 2] 3168 	ldw x,#tib
      001206 72 F0 01         [ 2] 3169 	subw x,(1,sp)
      001209                       3170 	_drop 2   
      001209 5B 02            [ 2]    1     addw sp,#2 
      00120B A6 04            [ 1] 3171 	ld a,#TK_INTGR
      00120D 81               [ 4] 3172 	ret 
                                   3173 
                                   3174 ;***********************************
                                   3175 ;   expression parse,execute 
                                   3176 ;***********************************
                                   3177 ;-----------------------------------
                                   3178 ; factor ::= ['+'|'-'|e] var | @ |
                                   3179 ;			 integer | function |
                                   3180 ;			 '('relation')' 
                                   3181 ; output:
                                   3182 ;   A    token attribute 
                                   3183 ;   X 	 integer
                                   3184 ; ---------------------------------
                           000001  3185 	NEG=1
                           000001  3186 	VSIZE=1
      00120E                       3187 factor:
      00120E                       3188 	_vars VSIZE 
      00120E 52 01            [ 2]    1     sub sp,#VSIZE 
      001210 CD 07 F4         [ 4] 3189 	call next_token
      001213 A1 02            [ 1] 3190 	cp a,#CMD_END 
      001215 2B 4E            [ 1] 3191 	jrmi 20$
      001217 6B 01            [ 1] 3192 1$:	ld (NEG,sp),a 
      001219 A4 30            [ 1] 3193 	and a,#TK_GRP_MASK
      00121B A1 10            [ 1] 3194 	cp a,#TK_GRP_ADD 
      00121D 27 04            [ 1] 3195 	jreq 2$
      00121F 7B 01            [ 1] 3196 	ld a,(NEG,sp)
      001221 20 03            [ 2] 3197 	jra 4$  
      001223                       3198 2$:	
      001223 CD 07 F4         [ 4] 3199 	call next_token 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 63.
Hexadecimal [24-Bits]



      001226                       3200 4$:	
      001226 A1 07            [ 1] 3201 	cp a,#TK_IFUNC 
      001228 26 03            [ 1] 3202 	jrne 5$ 
      00122A FD               [ 4] 3203 	call (x) 
      00122B 20 2F            [ 2] 3204 	jra 18$ 
      00122D                       3205 5$:
      00122D A1 04            [ 1] 3206 	cp a,#TK_INTGR
      00122F 26 02            [ 1] 3207 	jrne 6$
      001231 20 29            [ 2] 3208 	jra 18$
      001233                       3209 6$:
      001233 A1 02            [ 1] 3210 	cp a,#TK_ARRAY
      001235 26 06            [ 1] 3211 	jrne 10$
      001237 CD 11 E7         [ 4] 3212 	call get_array_element
      00123A FE               [ 2] 3213 	ldw x,(x)
      00123B 20 1F            [ 2] 3214 	jra 18$ 
      00123D                       3215 10$:
      00123D A1 05            [ 1] 3216 	cp a,#TK_VAR 
      00123F 26 03            [ 1] 3217 	jrne 11$
      001241 FE               [ 2] 3218 	ldw x,(x)
      001242 20 18            [ 2] 3219 	jra 18$
      001244                       3220 11$: 
      001244 A1 09            [ 1] 3221 	cp a,#TK_CONST 
      001246 27 14            [ 1] 3222 	jreq 18$
      001248                       3223 12$:			
      001248 A1 0B            [ 1] 3224 	cp a,#TK_LPAREN
      00124A 26 0A            [ 1] 3225 	jrne 16$
      00124C CD 12 F9         [ 4] 3226 	call relation
      00124F A6 0C            [ 1] 3227 	ld a,#TK_RPAREN 
      001251 CD 11 A6         [ 4] 3228 	call expect
      001254 20 06            [ 2] 3229 	jra 18$	
      001256                       3230 16$:
      001256 CD 0F 80         [ 4] 3231 	call unget_token
      001259 4F               [ 1] 3232 	clr a 
      00125A 20 09            [ 2] 3233 	jra 20$ 
      00125C                       3234 18$: 
      00125C A6 11            [ 1] 3235 	ld a,#TK_MINUS 
      00125E 11 01            [ 1] 3236 	cp a,(NEG,sp)
      001260 26 01            [ 1] 3237 	jrne 19$
      001262 50               [ 2] 3238 	negw x
      001263                       3239 19$:
      001263 A6 04            [ 1] 3240 	ld a,#TK_INTGR
      001265                       3241 20$:
      001265                       3242 	_drop VSIZE
      001265 5B 01            [ 2]    1     addw sp,#VSIZE 
      001267 81               [ 4] 3243 	ret
                                   3244 
                                   3245 ;-----------------------------------
                                   3246 ; term ::= factor [['*'|'/'|'%'] factor]* 
                                   3247 ; output:
                                   3248 ;   A    	token attribute 
                                   3249 ;	X		integer
                                   3250 ;-----------------------------------
                           000001  3251 	N1=1
                           000003  3252 	N2=3
                           000005  3253 	MULOP=5
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 64.
Hexadecimal [24-Bits]



                           000005  3254 	VSIZE=5
      001268                       3255 term:
      001268                       3256 	_vars VSIZE
      001268 52 05            [ 2]    1     sub sp,#VSIZE 
      00126A CD 12 0E         [ 4] 3257 	call factor
      00126D A1 02            [ 1] 3258 	cp a,#CMD_END
      00126F 2B 41            [ 1] 3259 	jrmi term_exit
      001271                       3260 term01:	 ; check for  operator 
      001271 1F 03            [ 2] 3261 	ldw (N2,sp),x  ; save first factor 
      001273 CD 07 F4         [ 4] 3262 	call next_token
      001276 A1 02            [ 1] 3263 	cp a,#2
      001278 2B 34            [ 1] 3264 	jrmi 9$
      00127A 6B 05            [ 1] 3265 0$:	ld (MULOP,sp),a
      00127C A4 30            [ 1] 3266 	and a,#TK_GRP_MASK
      00127E A1 20            [ 1] 3267 	cp a,#TK_GRP_MULT
      001280 27 07            [ 1] 3268 	jreq 1$
      001282 7B 05            [ 1] 3269 	ld a,(MULOP,sp) 
      001284 CD 0F 80         [ 4] 3270 	call unget_token 
      001287 20 25            [ 2] 3271 	jra 9$
      001289                       3272 1$:	; got *|/|%
      001289 CD 12 0E         [ 4] 3273 	call factor
      00128C A1 04            [ 1] 3274 	cp a,#TK_INTGR
      00128E 27 03            [ 1] 3275 	jreq 2$ 
      001290 CC 07 14         [ 2] 3276 	jp syntax_error
      001293 1F 01            [ 2] 3277 2$:	ldw (N1,sp),x  
      001295 7B 05            [ 1] 3278 	ld a,(MULOP,sp) 
      001297 A1 20            [ 1] 3279 	cp a,#TK_MULT 
      001299 26 05            [ 1] 3280 	jrne 3$
      00129B CD 10 82         [ 4] 3281 	call multiply 
      00129E 20 D1            [ 2] 3282 	jra term01
      0012A0 A1 21            [ 1] 3283 3$: cp a,#TK_DIV 
      0012A2 26 05            [ 1] 3284 	jrne 4$ 
      0012A4 CD 10 CA         [ 4] 3285 	call divide 
      0012A7 20 C8            [ 2] 3286 	jra term01 
      0012A9 CD 11 0E         [ 4] 3287 4$: call modulo
      0012AC 20 C3            [ 2] 3288 	jra term01 
      0012AE 1E 03            [ 2] 3289 9$: ldw x,(N2,sp)  
      0012B0 A6 04            [ 1] 3290 	ld a,#TK_INTGR 	
      0012B2                       3291 term_exit:
      0012B2                       3292 	_drop VSIZE 
      0012B2 5B 05            [ 2]    1     addw sp,#VSIZE 
      0012B4 81               [ 4] 3293 	ret 
                                   3294 
                                   3295 ;-------------------------------
                                   3296 ;  expr ::= term [['+'|'-'] term]*
                                   3297 ;  result range {-32768..32767}
                                   3298 ;  output:
                                   3299 ;   A    token attribute 
                                   3300 ;   X	 integer   
                                   3301 ;-------------------------------
                           000001  3302 	N1=1 
                           000003  3303 	N2=3
                           000005  3304 	OP=5 
                           000005  3305 	VSIZE=5 
      0012B5                       3306 expression:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 65.
Hexadecimal [24-Bits]



      0012B5                       3307 	_vars VSIZE 
      0012B5 52 05            [ 2]    1     sub sp,#VSIZE 
      0012B7 CD 12 68         [ 4] 3308 	call term
      0012BA A1 02            [ 1] 3309 	cp a,#CMD_END 
      0012BC 2B 38            [ 1] 3310 	jrmi expr_exit 
      0012BE 1F 03            [ 2] 3311 0$:	ldw (N2,sp),x 
      0012C0 CD 07 F4         [ 4] 3312 	call next_token
      0012C3 A1 02            [ 1] 3313 	cp a,#2
      0012C5 2B 2B            [ 1] 3314 	jrmi 9$ 
      0012C7 6B 05            [ 1] 3315 1$:	ld (OP,sp),a  
      0012C9 A4 30            [ 1] 3316 	and a,#TK_GRP_MASK
      0012CB A1 10            [ 1] 3317 	cp a,#TK_GRP_ADD 
      0012CD 27 07            [ 1] 3318 	jreq 2$ 
      0012CF 7B 05            [ 1] 3319 	ld a,(OP,sp)
      0012D1 CD 0F 80         [ 4] 3320 	call unget_token
      0012D4 20 1C            [ 2] 3321 	jra 9$
      0012D6                       3322 2$: 
      0012D6 CD 12 68         [ 4] 3323 	call term
      0012D9 A1 04            [ 1] 3324 	cp a,#TK_INTGR 
      0012DB 27 03            [ 1] 3325 	jreq 3$
      0012DD CC 07 14         [ 2] 3326 	jp syntax_error
      0012E0 1F 01            [ 2] 3327 3$:	ldw (N1,sp),x 
      0012E2 7B 05            [ 1] 3328 	ld a,(OP,sp)
      0012E4 A1 10            [ 1] 3329 	cp a,#TK_PLUS 
      0012E6 26 05            [ 1] 3330 	jrne 4$
      0012E8 CD 10 74         [ 4] 3331 	call add 
      0012EB 20 D1            [ 2] 3332 	jra 0$ 
      0012ED CD 10 7C         [ 4] 3333 4$:	call substract
      0012F0 20 CC            [ 2] 3334 	jra 0$
      0012F2 1E 03            [ 2] 3335 9$: ldw x,(N2,sp)
      0012F4 A6 04            [ 1] 3336 	ld a,#TK_INTGR	
      0012F6                       3337 expr_exit:
      0012F6                       3338 	_drop VSIZE 
      0012F6 5B 05            [ 2]    1     addw sp,#VSIZE 
      0012F8 81               [ 4] 3339 	ret 
                                   3340 
                                   3341 ;---------------------------------------------
                                   3342 ; rel ::= expr rel_op expr
                                   3343 ; rel_op ::=  '=','<','>','>=','<=','<>','><'
                                   3344 ;  relation return 1 | 0  for true | false 
                                   3345 ;  output:
                                   3346 ;    A 		token attribute  
                                   3347 ;	 X		1|0
                                   3348 ;---------------------------------------------
                           000001  3349 	N1=1
                           000003  3350 	N2=3
                           000005  3351 	RELOP=5
                           000005  3352 	VSIZE=5 
      0012F9                       3353 relation: 
      0012F9                       3354 	_vars VSIZE
      0012F9 52 05            [ 2]    1     sub sp,#VSIZE 
      0012FB CD 12 B5         [ 4] 3355 	call expression
      0012FE A1 02            [ 1] 3356 	cp a,#CMD_END  
      001300 2B 4B            [ 1] 3357 	jrmi rel_exit 
                                   3358 	; expect rel_op or leave 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 66.
Hexadecimal [24-Bits]



      001302 1F 03            [ 2] 3359 	ldw (N2,sp),x 
      001304 CD 07 F4         [ 4] 3360 	call next_token 
      001307 A1 02            [ 1] 3361 	cp a,#2
      001309 2B 3E            [ 1] 3362 	jrmi 9$
      00130B                       3363 1$:	
      00130B 6B 05            [ 1] 3364 	ld (RELOP,sp),a 
      00130D A4 30            [ 1] 3365 	and a,#TK_GRP_MASK
      00130F A1 30            [ 1] 3366 	cp a,#TK_GRP_RELOP 
      001311 27 07            [ 1] 3367 	jreq 2$
      001313 7B 05            [ 1] 3368 	ld a,(RELOP,sp)
      001315 CD 0F 80         [ 4] 3369 	call unget_token  
      001318 20 2F            [ 2] 3370 	jra 9$
      00131A                       3371 2$:	; expect another expression or error 
      00131A CD 12 B5         [ 4] 3372 	call expression
      00131D A1 04            [ 1] 3373 	cp a,#TK_INTGR 
      00131F 27 03            [ 1] 3374 	jreq 3$
      001321 CC 07 14         [ 2] 3375 	jp syntax_error 
      001324 1F 01            [ 2] 3376 3$:	ldw (N1,sp),x 
      001326 CD 10 7C         [ 4] 3377 	call substract
      001329 26 06            [ 1] 3378 	jrne 4$
      00132B 35 02 00 09      [ 1] 3379 	mov acc8,#2 ; n1==n2
      00132F 20 0C            [ 2] 3380 	jra 6$ 
      001331                       3381 4$: 
      001331 2C 06            [ 1] 3382 	jrsgt 5$  
      001333 35 04 00 09      [ 1] 3383 	mov acc8,#4 ; n1<2 
      001337 20 04            [ 2] 3384 	jra 6$
      001339                       3385 5$:
      001339 35 01 00 09      [ 1] 3386 	mov acc8,#1 ; n1>n2 
      00133D                       3387 6$:
      00133D 5F               [ 1] 3388 	clrw x 
      00133E C6 00 09         [ 1] 3389 	ld a, acc8  
      001341 14 05            [ 1] 3390 	and a,(RELOP,sp)
      001343 4D               [ 1] 3391 	tnz a 
      001344 27 05            [ 1] 3392 	jreq 10$
      001346 5C               [ 1] 3393 	incw x 
      001347                       3394 7$:	 
      001347 20 02            [ 2] 3395 	jra 10$  	
      001349 1E 03            [ 2] 3396 9$: ldw x,(N2,sp)
      00134B                       3397 10$:
      00134B A6 04            [ 1] 3398 	ld a,#TK_INTGR
      00134D                       3399 rel_exit: 	 
      00134D                       3400 	_drop VSIZE
      00134D 5B 05            [ 2]    1     addw sp,#VSIZE 
      00134F 81               [ 4] 3401 	ret 
                                   3402 
                                   3403 ;--------------------------------
                                   3404 ; BASIC: SHOW 
                                   3405 ;  show content of dstack,cstack
                                   3406 ;--------------------------------
      001350                       3407 show:
      001350 C6 00 06         [ 1] 3408 	ld a,base 
      001353 88               [ 1] 3409 	push a 
      001354 CD 10 14         [ 4] 3410 	call dots
      001357 CD 10 47         [ 4] 3411 	call dotr 
      00135A 84               [ 1] 3412 	pop a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 67.
Hexadecimal [24-Bits]



      00135B C7 00 06         [ 1] 3413 	ld base,a 
      00135E 4F               [ 1] 3414 	clr a 
      00135F 81               [ 4] 3415 	ret
                                   3416 
                                   3417 ;--------------------------------------------
                                   3418 ; BASIC: HEX 
                                   3419 ; select hexadecimal base for integer print
                                   3420 ;---------------------------------------------
      001360                       3421 hex_base:
      001360 35 10 00 06      [ 1] 3422 	mov base,#16 
      001364 81               [ 4] 3423 	ret 
                                   3424 
                                   3425 ;--------------------------------------------
                                   3426 ; BASIC: DEC 
                                   3427 ; select decimal base for integer print
                                   3428 ;---------------------------------------------
      001365                       3429 dec_base:
      001365 35 0A 00 06      [ 1] 3430 	mov base,#10
      001369 81               [ 4] 3431 	ret 
                                   3432 
                                   3433 ;------------------------
                                   3434 ; BASIC: SIZE 
                                   3435 ; return free size in text area
                                   3436 ; output:
                                   3437 ;   A 		TK_INTGR
                                   3438 ;   X 	    size integer
                                   3439 ;--------------------------
      00136A                       3440 size:
      00136A AE 16 C8         [ 2] 3441 	ldw x,#tib 
      00136D 72 B0 00 1A      [ 2] 3442 	subw x,txtend 
      001371 A6 04            [ 1] 3443 	ld a,#TK_INTGR
      001373 81               [ 4] 3444 	ret 
                                   3445 
                                   3446 
                                   3447 ;------------------------
                                   3448 ; BASIC: UBOUND  
                                   3449 ; return array variable size 
                                   3450 ; output:
                                   3451 ;   A 		TK_INTGR
                                   3452 ;   X 	    array size 
                                   3453 ;--------------------------
      001374                       3454 ubound:
      001374 AE 16 C8         [ 2] 3455 	ldw x,#tib
      001377 72 B0 00 1A      [ 2] 3456 	subw x,txtend 
      00137B 90 CE 00 04      [ 2] 3457 	ldw y,basicptr 
      00137F 90 C3 00 1A      [ 2] 3458 	cpw y,txtend 
      001383 25 0A            [ 1] 3459 	jrult 1$
      001385 3B 00 03         [ 1] 3460 	push count 
      001388 4B 00            [ 1] 3461 	push #0 
      00138A 72 F0 01         [ 2] 3462 	subw x,(1,sp)
      00138D                       3463 	_drop 2 
      00138D 5B 02            [ 2]    1     addw sp,#2 
      00138F 54               [ 2] 3464 1$:	srlw x 
      001390 CF 00 1D         [ 2] 3465 	ldw array_size,x
      001393 A6 04            [ 1] 3466 	ld a,#TK_INTGR
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 68.
Hexadecimal [24-Bits]



      001395 81               [ 4] 3467 	ret 
                                   3468 
                                   3469 ;-----------------------------
                                   3470 ; BASIC: LET var=expr 
                                   3471 ; variable assignement 
                                   3472 ; output:
                                   3473 ;   A 		TK_NONE 
                                   3474 ;-----------------------------
      001396                       3475 let:
      001396 CD 07 F4         [ 4] 3476 	call next_token 
      001399 A1 05            [ 1] 3477 	cp a,#TK_VAR 
      00139B 27 03            [ 1] 3478 	jreq let02
      00139D CC 07 14         [ 2] 3479 	jp syntax_error
      0013A0                       3480 let02:
      0013A0 CD 0F 86         [ 4] 3481 	call dpush 
      0013A3 CD 07 F4         [ 4] 3482 	call next_token 
      0013A6 A1 32            [ 1] 3483 	cp a,#TK_EQUAL
      0013A8 27 03            [ 1] 3484 	jreq 1$
      0013AA CC 07 14         [ 2] 3485 	jp syntax_error
      0013AD                       3486 1$:	
      0013AD CD 12 F9         [ 4] 3487 	call relation   
      0013B0 A1 04            [ 1] 3488 	cp a,#TK_INTGR 
      0013B2 27 03            [ 1] 3489 	jreq 2$
      0013B4 CC 07 14         [ 2] 3490 	jp syntax_error
      0013B7                       3491 2$:	
      0013B7 90 93            [ 1] 3492 	ldw y,x 
      0013B9 CD 0F 93         [ 4] 3493 	call dpop  
      0013BC FF               [ 2] 3494 	ldw (x),y   
      0013BD 81               [ 4] 3495 	ret 
                                   3496 
                                   3497 ;----------------------------
                                   3498 ; BASIC: LIST [[start][,end]]
                                   3499 ; list program lines 
                                   3500 ; form start to end 
                                   3501 ; if empty argument list then 
                                   3502 ; list all.
                                   3503 ;----------------------------
                           000001  3504 	FIRST=1
                           000003  3505 	LAST=3 
                           000005  3506 	LN_PTR=5
                           000006  3507 	VSIZE=6 
      0013BE                       3508 list:
      0013BE                       3509 	_vars VSIZE
      0013BE 52 06            [ 2]    1     sub sp,#VSIZE 
      0013C0 CE 00 18         [ 2] 3510 	ldw x,txtbgn 
      0013C3 C3 00 1A         [ 2] 3511 	cpw x,txtend 
      0013C6 2B 03            [ 1] 3512 	jrmi 1$
      0013C8 CC 14 3E         [ 2] 3513 	jp list_exit ; nothing to list 
      0013CB 1F 05            [ 2] 3514 1$:	ldw (LN_PTR,sp),x 
      0013CD FE               [ 2] 3515 	ldw x,(x) 
      0013CE 1F 01            [ 2] 3516 	ldw (FIRST,sp),x ; list from first line 
      0013D0 AE 7F FF         [ 2] 3517 	ldw x,#0x7fff ; biggest line number 
      0013D3 1F 03            [ 2] 3518 	ldw (LAST,sp),x 
      0013D5 CD 11 B3         [ 4] 3519 	call arg_list
      0013D8 4D               [ 1] 3520 	tnz a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 69.
Hexadecimal [24-Bits]



      0013D9 27 3F            [ 1] 3521 	jreq list_start 
      0013DB A1 02            [ 1] 3522 	cp a,#2 
      0013DD 27 07            [ 1] 3523 	jreq 4$
      0013DF A1 01            [ 1] 3524 	cp a,#1 
      0013E1 27 06            [ 1] 3525 	jreq first_line 
      0013E3 CC 07 14         [ 2] 3526 	jp syntax_error 
      0013E6 CD 0F A0         [ 4] 3527 4$:	call dswap
      0013E9                       3528 first_line:
      0013E9 CD 0F 93         [ 4] 3529 	call dpop 
      0013EC 1F 01            [ 2] 3530 	ldw (FIRST,sp),x 
      0013EE A1 01            [ 1] 3531 	cp a,#1 
      0013F0 27 05            [ 1] 3532 	jreq lines_skip 	
      0013F2                       3533 last_line:
      0013F2 CD 0F 93         [ 4] 3534 	call dpop 
      0013F5 1F 03            [ 2] 3535 	ldw (LAST,sp),x 
      0013F7                       3536 lines_skip:
      0013F7 CE 00 18         [ 2] 3537 	ldw x,txtbgn
      0013FA 1F 05            [ 2] 3538 2$:	ldw (LN_PTR,sp),x 
      0013FC C3 00 1A         [ 2] 3539 	cpw x,txtend 
      0013FF 2A 3D            [ 1] 3540 	jrpl list_exit 
      001401 FE               [ 2] 3541 	ldw x,(x) ;line# 
      001402 13 01            [ 2] 3542 	cpw x,(FIRST,sp)
      001404 2A 14            [ 1] 3543 	jrpl list_start 
      001406 1E 05            [ 2] 3544 	ldw x,(LN_PTR,sp) 
      001408 1C 00 02         [ 2] 3545 	addw x,#2 
      00140B F6               [ 1] 3546 	ld a,(x)
      00140C 5C               [ 1] 3547 	incw x 
      00140D C7 00 09         [ 1] 3548 	ld acc8,a 
      001410 72 5F 00 08      [ 1] 3549 	clr acc16 
      001414 72 BB 00 08      [ 2] 3550 	addw x,acc16
      001418 20 E0            [ 2] 3551 	jra 2$ 
                                   3552 ; print loop
      00141A                       3553 list_start:
      00141A 1E 05            [ 2] 3554 	ldw x,(LN_PTR,sp)
      00141C                       3555 3$:	
      00141C CD 14 91         [ 4] 3556 	call prt_basic_line
      00141F 1E 05            [ 2] 3557 	ldw x,(LN_PTR,sp)
      001421 E6 02            [ 1] 3558 	ld a,(2,x)
      001423 C7 00 09         [ 1] 3559 	ld acc8,a 
      001426 72 5F 00 08      [ 1] 3560 	clr acc16 
      00142A 72 BB 00 08      [ 2] 3561 	addw x,acc16
      00142E C3 00 1A         [ 2] 3562 	cpw x,txtend 
      001431 2A 0B            [ 1] 3563 	jrpl list_exit
      001433 1F 05            [ 2] 3564 	ldw (LN_PTR,sp),x
      001435 FE               [ 2] 3565 	ldw x,(x)
      001436 13 03            [ 2] 3566 	cpw x,(LAST,sp)  
      001438 2C 04            [ 1] 3567 	jrsgt list_exit 
      00143A 1E 05            [ 2] 3568 	ldw x,(LN_PTR,sp)
      00143C 20 DE            [ 2] 3569 	jra 3$
      00143E                       3570 list_exit:
      00143E                       3571 	_drop VSIZE 
      00143E 5B 06            [ 2]    1     addw sp,#VSIZE 
      001440 81               [ 4] 3572 	ret
                                   3573 
                                   3574 ;-------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 70.
Hexadecimal [24-Bits]



                                   3575 ; print counted string 
                                   3576 ; input:
                                   3577 ;   X 		address of string
                                   3578 ;--------------------------
      001441                       3579 prt_cmd_name:
      001441 F6               [ 1] 3580 	ld a,(x)
      001442 5C               [ 1] 3581 	incw x
      001443 A4 0F            [ 1] 3582 	and a,#15  
      001445 88               [ 1] 3583 	push a 
      001446 0D 01            [ 1] 3584 1$: tnz (1,sp) 
      001448 27 09            [ 1] 3585 	jreq 9$
      00144A F6               [ 1] 3586 	ld a,(x)
      00144B CD 01 A6         [ 4] 3587 	call putc 
      00144E 5C               [ 1] 3588 	incw x
      00144F 0A 01            [ 1] 3589 	dec (1,sp)	 
      001451 20 F3            [ 2] 3590 	jra 1$
      001453 84               [ 1] 3591 9$: pop a 
      001454 81               [ 4] 3592 	ret	
                                   3593 
                                   3594 ;--------------------------
                                   3595 ; print TK_QSTR
                                   3596 ; converting control character
                                   3597 ; to backslash sequence
                                   3598 ; input:
                                   3599 ;   X        char *
                                   3600 ;-----------------------------
      001455                       3601 prt_quote:
      001455 A6 22            [ 1] 3602 	ld a,#'"
      001457 CD 01 A6         [ 4] 3603 	call putc 
      00145A F6               [ 1] 3604 1$:	ld a,(x)
      00145B 27 2D            [ 1] 3605 	jreq 9$
      00145D 5C               [ 1] 3606 	incw x 
      00145E A1 20            [ 1] 3607 	cp a,#SPACE 
      001460 25 0C            [ 1] 3608 	jrult 3$
      001462 CD 01 A6         [ 4] 3609 	call putc
      001465 A1 5C            [ 1] 3610 	cp a,#'\ 
      001467 26 F1            [ 1] 3611 	jrne 1$ 
      001469                       3612 2$:
      001469 CD 01 A6         [ 4] 3613 	call putc 
      00146C 20 EC            [ 2] 3614 	jra 1$
      00146E 88               [ 1] 3615 3$: push a 
      00146F A6 5C            [ 1] 3616 	ld a,#'\
      001471 CD 01 A6         [ 4] 3617 	call putc 
      001474 84               [ 1] 3618 	pop a 
      001475 A0 07            [ 1] 3619 	sub a,#7
      001477 C7 00 09         [ 1] 3620 	ld acc8,a 
      00147A 72 5F 00 08      [ 1] 3621 	clr acc16
      00147E 90 AE 0C 4F      [ 2] 3622 	ldw y,#escaped 
      001482 72 B9 00 08      [ 2] 3623 	addw y,acc16 
      001486 90 F6            [ 1] 3624 	ld a,(y)
      001488 20 DF            [ 2] 3625 	jra 2$
      00148A A6 22            [ 1] 3626 9$: ld a,#'"
      00148C CD 01 A6         [ 4] 3627 	call putc 
      00148F 5C               [ 1] 3628 	incw x 
      001490 81               [ 4] 3629 	ret
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 71.
Hexadecimal [24-Bits]



                                   3630 
                                   3631 
                                   3632 ;--------------------------
                                   3633 ; decompile line from token list 
                                   3634 ; input:
                                   3635 ;   X 		pointer at line
                                   3636 ; output:
                                   3637 ;   none 
                                   3638 ;--------------------------	
                           000001  3639 	BASE_SAV=1
                           000002  3640 	WIDTH_SAV=2
                           000003  3641 	XSAVE=3
                           000005  3642 	LLEN=5
                           000005  3643 	VSIZE=5 
      001491                       3644 prt_basic_line:
      001491                       3645 	_vars VSIZE 
      001491 52 05            [ 2]    1     sub sp,#VSIZE 
      001493 C6 00 06         [ 1] 3646 	ld a,base
      001496 6B 01            [ 1] 3647 	ld (BASE_SAV,sp),a  
      001498 C6 00 20         [ 1] 3648 	ld a,tab_width 
      00149B 6B 02            [ 1] 3649 	ld (WIDTH_SAV,sp),a 
      00149D CF 00 11         [ 2] 3650 	ldw ptr16,x
      0014A0 FE               [ 2] 3651 	ldw x,(x)
      0014A1 35 0A 00 06      [ 1] 3652 	mov base,#10
      0014A5 35 05 00 20      [ 1] 3653 	mov tab_width,#5
      0014A9 CD 09 8D         [ 4] 3654 	call print_int ; print line number 
      0014AC A6 20            [ 1] 3655 	ld a,#SPACE 
      0014AE CD 01 A6         [ 4] 3656 	call putc 
      0014B1 72 5F 00 20      [ 1] 3657 	clr tab_width
      0014B5 AE 00 02         [ 2] 3658 	ldw x,#2
      0014B8 72 D6 00 11      [ 4] 3659 	ld a,([ptr16],x)
      0014BC 6B 05            [ 1] 3660 	ld (LLEN,sp),a 
      0014BE 5C               [ 1] 3661 	incw x
      0014BF 9F               [ 1] 3662 1$:	ld a,xl 
      0014C0 11 05            [ 1] 3663 	cp a,(LLEN,sp)
      0014C2 2B 03            [ 1] 3664 	jrmi 20$
      0014C4 CC 15 CE         [ 2] 3665 	jp 90$
      0014C7                       3666 20$:	 
      0014C7 72 D6 00 11      [ 4] 3667 	ld a,([ptr16],x)
      0014CB 5C               [ 1] 3668 	incw x 
      0014CC 1F 03            [ 2] 3669 	ldw (XSAVE,sp),x 
      0014CE A1 06            [ 1] 3670 	cp a,#TK_CMD 
      0014D0 25 44            [ 1] 3671 	jrult 5$
      0014D2 A1 09            [ 1] 3672 	cp a,#TK_CONST 
      0014D4 22 2F            [ 1] 3673 	jrugt 4$
      0014D6                       3674 2$:	
      0014D6 72 DE 00 11      [ 5] 3675 	ldw x,([ptr16],x)
      0014DA A3 17 07         [ 2] 3676 	cpw x,#rem 
      0014DD 26 14            [ 1] 3677 	jrne 3$
      0014DF A6 27            [ 1] 3678 	ld a,#''
      0014E1 CD 01 A6         [ 4] 3679 	call putc 
      0014E4 1E 03            [ 2] 3680 	ldw x,(XSAVE,sp)
      0014E6 1C 00 02         [ 2] 3681 	addw x,#2
      0014E9 72 BB 00 11      [ 2] 3682 	addw x,ptr16  
      0014ED CD 01 B8         [ 4] 3683 	call puts 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 72.
Hexadecimal [24-Bits]



      0014F0 CC 15 CE         [ 2] 3684 	jp 90$ 
      0014F3 CD 11 1F         [ 4] 3685 3$:	call cmd_name
      0014F6 CD 14 41         [ 4] 3686 	call prt_cmd_name
      0014F9 A6 20            [ 1] 3687 	ld a,#SPACE 
      0014FB CD 01 A6         [ 4] 3688 	call putc 
      0014FE 1E 03            [ 2] 3689 	ldw x,(XSAVE,sp)
      001500 1C 00 02         [ 2] 3690 	addw x,#2
      001503 20 BA            [ 2] 3691 	jra 1$
      001505 A1 0A            [ 1] 3692 4$: cp a,#TK_QSTR 
      001507 26 0D            [ 1] 3693 	jrne 5$
      001509 72 BB 00 11      [ 2] 3694 	addw x,ptr16
      00150D CD 14 55         [ 4] 3695 	call prt_quote 
      001510 72 B0 00 11      [ 2] 3696 	subw x,ptr16  
      001514 20 A9            [ 2] 3697 	jra 1$
      001516 A1 05            [ 1] 3698 5$:	cp a,#TK_VAR
      001518 26 1A            [ 1] 3699 	jrne 6$ 
      00151A 72 DE 00 11      [ 5] 3700 	ldw x,([ptr16],x)
      00151E 1D 00 21         [ 2] 3701 	subw x,#vars 
      001521 9F               [ 1] 3702 	ld a,xl
      001522 44               [ 1] 3703 	srl a 
      001523 AB 41            [ 1] 3704 	add a,#'A 
      001525 CD 01 A6         [ 4] 3705 	call putc 
      001528 A6 20            [ 1] 3706 	ld a,#SPACE 
      00152A CD 01 A6         [ 4] 3707 	call putc 
      00152D 1E 03            [ 2] 3708 	ldw x,(XSAVE,sp)
      00152F 1C 00 02         [ 2] 3709 	addw x,#2 
      001532 20 8B            [ 2] 3710 	jra 1$ 
      001534 A1 02            [ 1] 3711 6$: cp a,#TK_ARRAY 
      001536 26 0A            [ 1] 3712 	jrne 7$
      001538 A6 40            [ 1] 3713 	ld a,#'@ 
      00153A CD 01 A6         [ 4] 3714 	call putc 
      00153D 1E 03            [ 2] 3715 	ldw x,(XSAVE,sp)
      00153F CC 14 BF         [ 2] 3716 	jp 1$ 
      001542 A1 04            [ 1] 3717 7$: cp a,#TK_INTGR 
      001544 26 14            [ 1] 3718 	jrne 8$
      001546 72 DE 00 11      [ 5] 3719 	ldw x,([ptr16],x)
      00154A CD 09 8D         [ 4] 3720 	call print_int
      00154D A6 20            [ 1] 3721 	ld a,#SPACE 
      00154F CD 01 A6         [ 4] 3722 	call putc 
      001552 1E 03            [ 2] 3723 	ldw x,(XSAVE,sp)
      001554 1C 00 02         [ 2] 3724 	addw x,#2 
      001557 CC 14 BF         [ 2] 3725 	jp 1$
      00155A A1 31            [ 1] 3726 8$: cp a,#TK_GT 
      00155C 2B 1A            [ 1] 3727 	jrmi 9$
      00155E A1 35            [ 1] 3728 	cp a,#TK_NE 
      001560 22 16            [ 1] 3729 	jrugt 9$
      001562 A0 31            [ 1] 3730 	sub a,#TK_GT  
      001564 48               [ 1] 3731 	sll a 
      001565 90 5F            [ 1] 3732 	clrw y 
      001567 90 97            [ 1] 3733 	ld yl,a 
      001569 72 A9 15 E7      [ 2] 3734 	addw y,#relop_str 
      00156D 90 FE            [ 2] 3735 	ldw y,(y)
      00156F 93               [ 1] 3736 	ldw x,y 
      001570 CD 01 B8         [ 4] 3737 	call puts 
      001573 1E 03            [ 2] 3738 	ldw x,(XSAVE,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 73.
Hexadecimal [24-Bits]



      001575 CC 14 BF         [ 2] 3739 	jp 1$
      001578 A1 10            [ 1] 3740 9$: cp a,#TK_PLUS 
      00157A 26 04            [ 1] 3741 	jrne 10$
      00157C A6 2B            [ 1] 3742 	ld a,#'+
      00157E 20 46            [ 2] 3743 	jra 80$ 
      001580 A1 11            [ 1] 3744 10$: cp a,#TK_MINUS
      001582 26 04            [ 1] 3745 	jrne 11$
      001584 A6 2D            [ 1] 3746 	ld a,#'-
      001586 20 3E            [ 2] 3747 	jra 80$
      001588 A1 20            [ 1] 3748 11$: cp a,#TK_MULT 
      00158A 2B 0E            [ 1] 3749 	jrmi 12$
      00158C A1 22            [ 1] 3750 	cp a,#TK_MOD 
      00158E 22 0A            [ 1] 3751 	jrugt 12$
      001590 A0 20            [ 1] 3752 	sub a,#0x20
      001592 5F               [ 1] 3753 	clrw x 
      001593 97               [ 1] 3754 	ld xl,a 
      001594 1C 15 E4         [ 2] 3755 	addw x,#mul_char 
      001597 F6               [ 1] 3756 	ld a,(x)
      001598 20 2C            [ 2] 3757 	jra 80$ 
      00159A A1 0B            [ 1] 3758 12$: cp a,#TK_LPAREN 
      00159C 2B 0E            [ 1] 3759 	jrmi 13$
      00159E A1 0E            [ 1] 3760 	cp a,#TK_SHARP 
      0015A0 22 0A            [ 1] 3761 	jrugt 13$
      0015A2 A0 0B            [ 1] 3762 	sub a,#TK_LPAREN
      0015A4 5F               [ 1] 3763 	clrw x 
      0015A5 97               [ 1] 3764 	ld xl,a 
      0015A6 1C 15 E0         [ 2] 3765 	addw x,#single_char 
      0015A9 F6               [ 1] 3766 	ld a,(x)
      0015AA 20 1A            [ 2] 3767 	jra 80$
      0015AC A1 03            [ 1] 3768 13$: cp a,#TK_CHAR 
      0015AE 26 14            [ 1] 3769 	jrne 14$
      0015B0 A6 5C            [ 1] 3770 	ld a,#'\
      0015B2 CD 01 A6         [ 4] 3771 	call putc 
      0015B5 1E 03            [ 2] 3772 	ldw x,(XSAVE,sp)
      0015B7 72 D6 00 11      [ 4] 3773 	ld a,([ptr16],x)
      0015BB 5C               [ 1] 3774 	incw x 
      0015BC 1F 03            [ 2] 3775 	ldw (XSAVE,sp),x 
      0015BE CD 01 A6         [ 4] 3776 	call putc 
      0015C1 CC 14 BF         [ 2] 3777 	jp 1$ 
      0015C4 A6 3A            [ 1] 3778 14$: ld a,#':
      0015C6 CD 01 A6         [ 4] 3779 80$: call putc 
      0015C9 1E 03            [ 2] 3780 	ldw x,(XSAVE,sp)
      0015CB CC 14 BF         [ 2] 3781 	jp 1$ 
      0015CE                       3782 90$: 
      0015CE A6 0D            [ 1] 3783 	ld a,#CR 
      0015D0 CD 01 A6         [ 4] 3784 	call putc
      0015D3 7B 02            [ 1] 3785 	ld a,(WIDTH_SAV,sp) 
      0015D5 C7 00 20         [ 1] 3786 	ld tab_width,a 
      0015D8 7B 01            [ 1] 3787 	ld a,(BASE_SAV,sp) 
      0015DA C7 00 06         [ 1] 3788 	ld base,a
      0015DD                       3789 	_drop VSIZE 
      0015DD 5B 05            [ 2]    1     addw sp,#VSIZE 
      0015DF 81               [ 4] 3790 	ret 	
      0015E0 28 29 2C 23           3791 single_char: .byte '(',')',',','#'
      0015E4 2A 2F 25              3792 mul_char: .byte '*','/','%'
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 74.
Hexadecimal [24-Bits]



      0015E7 15 F3 15 F5 15 F7 15  3793 relop_str: .word gt,equal,ge,lt,le,ne 
             FA 15 FC 15 FF
      0015F3 3E 00                 3794 gt: .asciz ">"
      0015F5 3D 00                 3795 equal: .asciz "="
      0015F7 3E 3D 00              3796 ge: .asciz ">="
      0015FA 3C 00                 3797 lt: .asciz "<"
      0015FC 3C 3D 00              3798 le: .asciz "<="
      0015FF 3C 3E 00              3799 ne:  .asciz "<>"
                                   3800 
                                   3801 
                                   3802 ;---------------------------------
                                   3803 ; BASIC: PRINT|? arg_list 
                                   3804 ; print values from argument list
                                   3805 ;----------------------------------
                           000001  3806 	COMMA=1
                           000001  3807 	VSIZE=1
      001602                       3808 print:
      001602 4B 00            [ 1] 3809 push #0 ; local variable COMMA 
      001604                       3810 reset_comma:
      001604 0F 01            [ 1] 3811 	clr (COMMA,sp)
      001606                       3812 prt_loop:
      001606 CD 12 F9         [ 4] 3813 	call relation 
      001609 A1 01            [ 1] 3814 	cp a,#TK_COLON 
      00160B 27 5A            [ 1] 3815 	jreq print_exit   
      00160D A1 04            [ 1] 3816 	cp a,#TK_INTGR 
      00160F 26 05            [ 1] 3817 	jrne 0$ 
      001611 CD 09 8D         [ 4] 3818 	call print_int 
      001614 20 EE            [ 2] 3819 	jra reset_comma
      001616                       3820 0$: 	
      001616 CD 07 F4         [ 4] 3821 	call next_token
      001619 A1 00            [ 1] 3822 	cp a,#TK_NONE 
      00161B 27 4A            [ 1] 3823 	jreq print_exit 
      00161D A1 0A            [ 1] 3824 1$:	cp a,#TK_QSTR
      00161F 26 0E            [ 1] 3825 	jrne 2$   
      001621 CD 01 B8         [ 4] 3826 	call puts
      001624 5C               [ 1] 3827 	incw x 
      001625 72 B0 00 04      [ 2] 3828 	subw x,basicptr 
      001629 9F               [ 1] 3829 	ld a,xl 
      00162A C7 00 01         [ 1] 3830 	ld in,a  
      00162D 20 D5            [ 2] 3831 	jra reset_comma
      00162F A1 03            [ 1] 3832 2$: cp a,#TK_CHAR 
      001631 26 06            [ 1] 3833 	jrne 3$
      001633 9F               [ 1] 3834 	ld a,xl 
      001634 CD 01 A6         [ 4] 3835 	call putc 
      001637 20 CB            [ 2] 3836 	jra reset_comma 
      001639                       3837 3$: 	
      001639 A1 08            [ 1] 3838 	cp a,#TK_CFUNC 
      00163B 26 07            [ 1] 3839 	jrne 4$ 
      00163D FD               [ 4] 3840 	call (x)
      00163E 9F               [ 1] 3841 	ld a,xl 
      00163F CD 01 A6         [ 4] 3842 	call putc
      001642 20 C0            [ 2] 3843 	jra reset_comma 
      001644                       3844 4$: 
      001644 A1 0D            [ 1] 3845 	cp a,#TK_COMMA 
      001646 26 05            [ 1] 3846 	jrne 5$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 75.
Hexadecimal [24-Bits]



      001648 03 01            [ 1] 3847 	cpl (COMMA,sp) 
      00164A CC 16 06         [ 2] 3848 	jp prt_loop   
      00164D                       3849 5$: 
      00164D A1 0E            [ 1] 3850 	cp a,#TK_SHARP
      00164F 26 13            [ 1] 3851 	jrne 7$
      001651 CD 07 F4         [ 4] 3852 	call next_token
      001654 A1 04            [ 1] 3853 	cp a,#TK_INTGR 
      001656 27 03            [ 1] 3854 	jreq 6$
      001658 CC 07 14         [ 2] 3855 	jp syntax_error 
      00165B                       3856 6$:
      00165B 9F               [ 1] 3857 	ld a,xl 
      00165C A4 0F            [ 1] 3858 	and a,#15 
      00165E C7 00 20         [ 1] 3859 	ld tab_width,a 
      001661 CC 16 04         [ 2] 3860 	jp reset_comma 
      001664                       3861 7$:	
      001664 CD 0F 80         [ 4] 3862 	call unget_token
      001667                       3863 print_exit:
      001667 0D 01            [ 1] 3864 	tnz (COMMA,sp)
      001669 26 05            [ 1] 3865 	jrne 9$
      00166B A6 0D            [ 1] 3866 	ld a,#CR 
      00166D CD 01 A6         [ 4] 3867     call putc 
      001670                       3868 9$:	_drop VSIZE 
      001670 5B 01            [ 2]    1     addw sp,#VSIZE 
      001672 81               [ 4] 3869 	ret 
                                   3870 
                                   3871 ;----------------------
                                   3872 ; 'save_context' and
                                   3873 ; 'rest_context' must be 
                                   3874 ; called at the same 
                                   3875 ; call stack depth 
                                   3876 ; i.e. SP must have the 
                                   3877 ; save value at  
                                   3878 ; entry point of both 
                                   3879 ; routine. 
                                   3880 ;---------------------
                           000006  3881 	CTXT_SIZE=6 ; size of saved data 
                                   3882 ;--------------------
                                   3883 ; save current BASIC
                                   3884 ; interpreter context 
                                   3885 ; on cstack 
                                   3886 ;--------------------
      001673                       3887 	_argofs 0 
                           000002     1     ARG_OFS=2+0 
      001673                       3888 	_arg BPTR 1
                           000003     1     BPTR=ARG_OFS+1 
      001673                       3889 	_arg LNO 3 
                           000005     1     LNO=ARG_OFS+3 
      001673                       3890 	_arg IN 5
                           000007     1     IN=ARG_OFS+5 
      001673                       3891 	_arg CNT 6
                           000008     1     CNT=ARG_OFS+6 
      001673                       3892 save_context:
      001673 CE 00 04         [ 2] 3893 	ldw x,basicptr 
      001676 1F 03            [ 2] 3894 	ldw (BPTR,sp),x
      001678 C6 00 01         [ 1] 3895 	ld a,in 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 76.
Hexadecimal [24-Bits]



      00167B 6B 07            [ 1] 3896 	ld (IN,sp),a
      00167D C6 00 03         [ 1] 3897 	ld a,count 
      001680 6B 08            [ 1] 3898 	ld (CNT,sp),a  
      001682 81               [ 4] 3899 	ret
                                   3900 
                                   3901 ;-----------------------
                                   3902 ; restore previously saved 
                                   3903 ; BASIC interpreter context 
                                   3904 ; from cstack 
                                   3905 ;-------------------------
      001683                       3906 rest_context:
      001683 1E 03            [ 2] 3907 	ldw x,(BPTR,sp)
      001685 CF 00 04         [ 2] 3908 	ldw basicptr,x 
      001688 7B 07            [ 1] 3909 	ld a,(IN,sp)
      00168A C7 00 01         [ 1] 3910 	ld in,a
      00168D 7B 08            [ 1] 3911 	ld a,(CNT,sp)
      00168F C7 00 03         [ 1] 3912 	ld count,a  
      001692 81               [ 4] 3913 	ret
                                   3914 
                                   3915 ;------------------------------------------
                                   3916 ; BASIC: INPUT [string],var[,[string],var]
                                   3917 ; input value in variables 
                                   3918 ; [string] optionally can be used as prompt 
                                   3919 ;-----------------------------------------
                           000001  3920 	CX_BPTR=1
                           000003  3921 	CX_LNO=3
                           000004  3922 	CX_IN=4
                           000005  3923 	CX_CNT=5
                           000006  3924 	SKIP=6
                           000007  3925 	VSIZE=7
      001693                       3926 input_var:
      001693 72 00 00 1F 05   [ 2] 3927 	btjt flags,#FRUN,1$ 
      001698 A6 06            [ 1] 3928 	ld a,#ERR_RUN_ONLY 
      00169A CC 07 16         [ 2] 3929 	jp tb_error 
      00169D                       3930 1$:	_vars VSIZE 
      00169D 52 07            [ 2]    1     sub sp,#VSIZE 
      00169F                       3931 input_loop:
      00169F 0F 06            [ 1] 3932 	clr (SKIP,sp)
      0016A1 CD 07 F4         [ 4] 3933 	call next_token 
      0016A4 A1 00            [ 1] 3934 	cp a,#TK_NONE 
      0016A6 27 5C            [ 1] 3935 	jreq input_exit 
      0016A8 A1 0A            [ 1] 3936 	cp a,#TK_QSTR 
      0016AA 26 08            [ 1] 3937 	jrne 1$ 
      0016AC CD 01 B8         [ 4] 3938 	call puts 
      0016AF 03 06            [ 1] 3939 	cpl (SKIP,sp)
      0016B1 CD 07 F4         [ 4] 3940 	call next_token 
      0016B4 A1 05            [ 1] 3941 1$: cp a,#TK_VAR  
      0016B6 27 03            [ 1] 3942 	jreq 2$ 
      0016B8 CC 07 14         [ 2] 3943 	jp syntax_error
      0016BB CD 0F 86         [ 4] 3944 2$:	call dpush 
      0016BE 0D 06            [ 1] 3945 	tnz (SKIP,sp)
      0016C0 26 0F            [ 1] 3946 	jrne 21$ 
      0016C2 A6 3A            [ 1] 3947 	ld a,#':
      0016C4 C7 17 19         [ 1] 3948 	ld pad+1,a 
      0016C7 72 5F 17 1A      [ 1] 3949 	clr pad+2
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 77.
Hexadecimal [24-Bits]



      0016CB AE 17 18         [ 2] 3950 	ldw x,#pad 
      0016CE CD 01 B8         [ 4] 3951 	call puts   
      0016D1                       3952 21$:
      0016D1 CD 16 73         [ 4] 3953 	call save_context 
      0016D4 AE 16 C8         [ 2] 3954 	ldw x,#tib 
      0016D7 CF 00 04         [ 2] 3955 	ldw basicptr,x  
      0016DA 72 5F 00 03      [ 1] 3956 	clr count  
      0016DE CD 0A 7B         [ 4] 3957 	call readln 
      0016E1 72 5F 00 01      [ 1] 3958 	clr in 
      0016E5 CD 12 F9         [ 4] 3959 	call relation 
      0016E8 A1 04            [ 1] 3960 	cp a,#TK_INTGR
      0016EA 27 03            [ 1] 3961 	jreq 3$ 
      0016EC CC 07 14         [ 2] 3962 	jp syntax_error
      0016EF CD 0F 86         [ 4] 3963 3$: call dpush 
      0016F2 CD 0F ED         [ 4] 3964 	call store 
      0016F5 CD 16 83         [ 4] 3965 	call rest_context
      0016F8 CD 07 F4         [ 4] 3966 	call next_token 
      0016FB A1 0D            [ 1] 3967 	cp a,#TK_COMMA 
      0016FD 26 02            [ 1] 3968 	jrne 4$
      0016FF 20 9E            [ 2] 3969 	jra input_loop 
      001701 CD 0F 80         [ 4] 3970 4$:	call unget_token 
      001704                       3971 input_exit:
      001704                       3972 	_drop VSIZE 
      001704 5B 07            [ 2]    1     addw sp,#VSIZE 
      001706 81               [ 4] 3973 	ret 
                                   3974 
                                   3975 
                                   3976 ;---------------------
                                   3977 ; BASIC: REMARK | ' 
                                   3978 ; skip comment to end of line 
                                   3979 ;---------------------- 
      001707                       3980 rem:
      001707 55 00 01 00 03   [ 1] 3981  	mov count,in 
      00170C 81               [ 4] 3982 	ret 
                                   3983 
                                   3984 ;---------------------
                                   3985 ; BASIC: WAIT addr,mask[,xor_mask] 
                                   3986 ; read in loop 'addr'  
                                   3987 ; apply & 'mask' to value 
                                   3988 ; loop while result==0.  
                                   3989 ; if 'xor_mask' given 
                                   3990 ; apply ^ in second  
                                   3991 ; loop while result==0 
                                   3992 ;---------------------
                           000001  3993 	XMASK=1 
                           000002  3994 	MASK=2
                           000003  3995 	ADDR=3
                           000004  3996 	VSIZE=4
      00170D                       3997 wait: 
      00170D                       3998 	_vars VSIZE
      00170D 52 04            [ 2]    1     sub sp,#VSIZE 
      00170F 0F 01            [ 1] 3999 	clr (XMASK,sp) 
      001711 CD 11 B3         [ 4] 4000 	call arg_list 
      001714 A1 02            [ 1] 4001 	cp a,#2
      001716 24 03            [ 1] 4002 	jruge 0$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 78.
Hexadecimal [24-Bits]



      001718 CC 07 14         [ 2] 4003 	jp syntax_error 
      00171B A1 03            [ 1] 4004 0$:	cp a,#3
      00171D 25 06            [ 1] 4005 	jrult 1$
      00171F CD 0F 93         [ 4] 4006 	call dpop 
      001722 9F               [ 1] 4007 	ld a,xl
      001723 6B 01            [ 1] 4008 	ld (XMASK,sp),a 
      001725 CD 0F 93         [ 4] 4009 1$: call dpop ; mask 
      001728 9F               [ 1] 4010 	ld a,xl 
      001729 6B 02            [ 1] 4011 	ld (MASK,sp),a 
      00172B CD 0F 93         [ 4] 4012 	call dpop ; address 
      00172E F6               [ 1] 4013 2$:	ld a,(x)
      00172F 14 02            [ 1] 4014 	and a,(MASK,sp)
      001731 18 01            [ 1] 4015 	xor a,(XMASK,sp)
      001733 27 F9            [ 1] 4016 	jreq 2$ 
      001735                       4017 	_drop VSIZE 
      001735 5B 04            [ 2]    1     addw sp,#VSIZE 
      001737 81               [ 4] 4018 	ret 
                                   4019 
                                   4020 ;---------------------
                                   4021 ; BASIC: BSET addr,mask
                                   4022 ; set bits at 'addr' corresponding 
                                   4023 ; to those of 'mask' that are at 1.
                                   4024 ; arguments:
                                   4025 ; 	addr 		memory address RAM|PERIPHERAL 
                                   4026 ;   mask        mask|addr
                                   4027 ; output:
                                   4028 ;	none 
                                   4029 ;--------------------------
      001738                       4030 bit_set:
      001738 CD 11 B3         [ 4] 4031 	call arg_list 
      00173B A1 02            [ 1] 4032 	cp a,#2	 
      00173D 27 03            [ 1] 4033 	jreq 1$ 
      00173F CC 07 14         [ 2] 4034 	jp syntax_error
      001742                       4035 1$: 
      001742 CD 0F 93         [ 4] 4036 	call dpop ; mask 
      001745 9F               [ 1] 4037 	ld a,xl 
      001746 CD 0F 93         [ 4] 4038 	call dpop ; addr  
      001749 FA               [ 1] 4039 	or a,(x)
      00174A F7               [ 1] 4040 	ld (x),a
      00174B 81               [ 4] 4041 	ret 
                                   4042 
                                   4043 ;---------------------
                                   4044 ; BASIC: BRES addr,mask
                                   4045 ; reset bits at 'addr' corresponding 
                                   4046 ; to those of 'mask' that are at 1.
                                   4047 ; arguments:
                                   4048 ; 	addr 		memory address RAM|PERIPHERAL 
                                   4049 ;   mask	    ~mask&*addr  
                                   4050 ; output:
                                   4051 ;	none 
                                   4052 ;--------------------------
      00174C                       4053 bit_reset:
      00174C CD 11 B3         [ 4] 4054 	call arg_list 
      00174F A1 02            [ 1] 4055 	cp a,#2  
      001751 27 03            [ 1] 4056 	jreq 1$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 79.
Hexadecimal [24-Bits]



      001753 CC 07 14         [ 2] 4057 	jp syntax_error
      001756                       4058 1$: 
      001756 CD 0F 93         [ 4] 4059 	call dpop ; mask 
      001759 9F               [ 1] 4060 	ld a,xl 
      00175A 43               [ 1] 4061 	cpl a 
      00175B CD 0F 93         [ 4] 4062 	call dpop ; addr  
      00175E F4               [ 1] 4063 	and a,(x)
      00175F F7               [ 1] 4064 	ld (x),a 
      001760 81               [ 4] 4065 	ret 
                                   4066 
                                   4067 ;---------------------
                                   4068 ; BASIC: BRES addr,mask
                                   4069 ; toggle bits at 'addr' corresponding 
                                   4070 ; to those of 'mask' that are at 1.
                                   4071 ; arguments:
                                   4072 ; 	addr 		memory address RAM|PERIPHERAL 
                                   4073 ;   mask	    mask^*addr  
                                   4074 ; output:
                                   4075 ;	none 
                                   4076 ;--------------------------
      001761                       4077 bit_toggle:
      001761 CD 11 B3         [ 4] 4078 	call arg_list 
      001764 A1 02            [ 1] 4079 	cp a,#2 
      001766 27 03            [ 1] 4080 	jreq 1$ 
      001768 CC 07 14         [ 2] 4081 	jp syntax_error
      00176B CD 0F 93         [ 4] 4082 1$: call dpop ; mask 
      00176E 9F               [ 1] 4083 	ld a,xl 
      00176F CD 0F 93         [ 4] 4084 	call dpop ; addr  
      001772 F8               [ 1] 4085 	xor a,(x)
      001773 F7               [ 1] 4086 	ld (x),a 
      001774 81               [ 4] 4087 	ret 
                                   4088 
                                   4089 
                                   4090 ;---------------------
                                   4091 ; BASIC: BTEST(addr,bit)
                                   4092 ; return bit value at 'addr' 
                                   4093 ; bit is in range {0..7}.
                                   4094 ; arguments:
                                   4095 ; 	addr 		memory address RAM|PERIPHERAL 
                                   4096 ;   bit 	    bit position {0..7}  
                                   4097 ; output:
                                   4098 ;	none 
                                   4099 ;--------------------------
      001775                       4100 bit_test:
      001775 CD 11 D7         [ 4] 4101 	call func_args 
      001778 A1 02            [ 1] 4102 	cp a,#2
      00177A 27 03            [ 1] 4103 	jreq 0$
      00177C CC 07 14         [ 2] 4104 	jp syntax_error
      00177F                       4105 0$:	
      00177F CD 0F 93         [ 4] 4106 	call dpop 
      001782 9F               [ 1] 4107 	ld a,xl 
      001783 A4 07            [ 1] 4108 	and a,#7
      001785 88               [ 1] 4109 	push a 
      001786 A6 01            [ 1] 4110 	ld a,#1 
      001788 0D 01            [ 1] 4111 1$: tnz (1,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 80.
Hexadecimal [24-Bits]



      00178A 27 05            [ 1] 4112 	jreq 2$
      00178C 48               [ 1] 4113 	sll a 
      00178D 0A 01            [ 1] 4114 	dec (1,sp)
      00178F 20 F7            [ 2] 4115 	jra 1$
      001791 CD 0F 93         [ 4] 4116 2$: call dpop 
      001794 F4               [ 1] 4117 	and a,(x)
      001795 27 02            [ 1] 4118 	jreq 3$
      001797 A6 01            [ 1] 4119 	ld a,#1 
      001799 5F               [ 1] 4120 3$:	clrw x 
      00179A 97               [ 1] 4121 	ld xl,a 
      00179B A6 04            [ 1] 4122 	ld a,#TK_INTGR
      00179D                       4123 	_drop 1 
      00179D 5B 01            [ 2]    1     addw sp,#1 
      00179F 81               [ 4] 4124 	ret
                                   4125 
                                   4126 
                                   4127 ;--------------------
                                   4128 ; BASIC: POKE addr,byte
                                   4129 ; put a byte at addr 
                                   4130 ;--------------------
      0017A0                       4131 poke:
      0017A0 CD 11 B3         [ 4] 4132 	call arg_list 
      0017A3 A1 02            [ 1] 4133 	cp a,#2
      0017A5 27 03            [ 1] 4134 	jreq 1$
      0017A7 CC 07 14         [ 2] 4135 	jp syntax_error
      0017AA                       4136 1$:	
      0017AA CD 0F 93         [ 4] 4137 	call dpop 
      0017AD 9F               [ 1] 4138     ld a,xl 
      0017AE CD 0F 93         [ 4] 4139 	call dpop 
      0017B1 F7               [ 1] 4140 	ld (x),a 
      0017B2 81               [ 4] 4141 	ret 
                                   4142 
                                   4143 ;-----------------------
                                   4144 ; BASIC: PEEK(addr)
                                   4145 ; get the byte at addr 
                                   4146 ; input:
                                   4147 ;	none 
                                   4148 ; output:
                                   4149 ;	X 		value 
                                   4150 ;-----------------------
      0017B3                       4151 peek:
      0017B3 CD 11 D7         [ 4] 4152 	call func_args
      0017B6 A1 01            [ 1] 4153 	cp a,#1
      0017B8 27 03            [ 1] 4154 	jreq 1$
      0017BA CC 07 14         [ 2] 4155 	jp syntax_error
      0017BD CD 0F 93         [ 4] 4156 1$:	call dpop 
      0017C0 F6               [ 1] 4157 	ld a,(x)
      0017C1 5F               [ 1] 4158 	clrw x 
      0017C2 97               [ 1] 4159 	ld xl,a 
      0017C3 A6 04            [ 1] 4160 	ld a,#TK_INTGR
      0017C5 81               [ 4] 4161 	ret 
                                   4162 
      0017C6                       4163 if: 
      0017C6 CD 12 F9         [ 4] 4164 	call relation 
      0017C9 A1 04            [ 1] 4165 	cp a,#TK_INTGR
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 81.
Hexadecimal [24-Bits]



      0017CB 27 03            [ 1] 4166 	jreq 1$ 
      0017CD CC 07 14         [ 2] 4167 	jp syntax_error
      0017D0 4F               [ 1] 4168 1$:	clr a 
      0017D1 5D               [ 2] 4169 	tnzw x 
      0017D2 26 05            [ 1] 4170 	jrne 9$  
                                   4171 ;skip to next line
      0017D4 55 00 03 00 01   [ 1] 4172 	mov in,count
      0017D9 81               [ 4] 4173 9$:	ret 
                                   4174 
                                   4175 ;------------------------
                                   4176 ; BASIC: FOR var=expr 
                                   4177 ; set variable to expression 
                                   4178 ; leave variable address 
                                   4179 ; on dstack and set
                                   4180 ; FFOR bit in 'flags'
                                   4181 ;-----------------
                           000001  4182 	RETL1=1
                           000003  4183 	INW=3
                           000005  4184 	BPTR=5
      0017DA                       4185 for: ; { -- var_addr }
      0017DA A6 05            [ 1] 4186 	ld a,#TK_VAR 
      0017DC CD 11 A6         [ 4] 4187 	call expect
      0017DF CD 0F 86         [ 4] 4188 	call dpush 
      0017E2 CD 13 A0         [ 4] 4189 	call let02 
      0017E5 72 14 00 1F      [ 1] 4190 	bset flags,#FFOR 
                                   4191 ; open space on cstack for BPTR and INW 
      0017E9 85               [ 2] 4192 	popw x ; call return address 
      0017EA                       4193 	_vars 4
      0017EA 52 04            [ 2]    1     sub sp,#4 
      0017EC 89               [ 2] 4194 	pushw x  ; RETL1 
      0017ED 5F               [ 1] 4195 	clrw x 
      0017EE 1F 05            [ 2] 4196 	ldw (BPTR,sp),x 
      0017F0 1F 03            [ 2] 4197 	ldw (INW,sp),x 
      0017F2 CD 07 F4         [ 4] 4198 	call next_token 
      0017F5 A1 06            [ 1] 4199 	cp a,#TK_CMD 
      0017F7 27 03            [ 1] 4200 	jreq 1$
      0017F9 CC 07 14         [ 2] 4201 	jp syntax_error
      0017FC                       4202 1$:  
      0017FC A3 18 04         [ 2] 4203 	cpw x,#to 
      0017FF 27 03            [ 1] 4204 	jreq to
      001801 CC 07 14         [ 2] 4205 	jp syntax_error 
                                   4206 
                                   4207 ;-----------------------------------
                                   4208 ; BASIC: TO expr 
                                   4209 ; second part of FOR loop initilization
                                   4210 ; leave limit on dstack and set 
                                   4211 ; FTO bit in 'flags'
                                   4212 ;-----------------------------------
      001804                       4213 to: ; { var_addr -- var_addr limit step }
      001804 72 04 00 1F 03   [ 2] 4214 	btjt flags,#FFOR,1$
      001809 CC 07 14         [ 2] 4215 	jp syntax_error
      00180C CD 12 F9         [ 4] 4216 1$: call relation  
      00180F A1 04            [ 1] 4217 	cp a,#TK_INTGR 
      001811 27 03            [ 1] 4218 	jreq 2$ 
      001813 CC 07 14         [ 2] 4219 	jp syntax_error
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 82.
Hexadecimal [24-Bits]



      001816                       4220 2$: 
      001816 CD 0F 86         [ 4] 4221     call dpush ; limit
      001819 CE 00 00         [ 2] 4222 	ldw x,in.w 
      00181C CD 07 F4         [ 4] 4223 	call next_token
      00181F A1 00            [ 1] 4224 	cp a,#TK_NONE  
      001821 27 0C            [ 1] 4225 	jreq 4$ 
      001823 A1 06            [ 1] 4226 	cp a,#TK_CMD
      001825 26 05            [ 1] 4227 	jrne 3$
      001827 A3 18 34         [ 2] 4228 	cpw x,#step 
      00182A 27 08            [ 1] 4229 	jreq step
      00182C                       4230 3$:	
      00182C CD 0F 80         [ 4] 4231 	call unget_token   	 
      00182F                       4232 4$:	
      00182F AE 00 01         [ 2] 4233 	ldw x,#1   ; default step  
      001832 20 12            [ 2] 4234 	jra store_loop_addr 
                                   4235 
                                   4236 
                                   4237 ;----------------------------------
                                   4238 ; BASIC: STEP expr 
                                   4239 ; optional third par of FOR loop
                                   4240 ; initialization. 	
                                   4241 ;------------------------------------
      001834                       4242 step: ; {var limit -- var limit step}
      001834 72 04 00 1F 03   [ 2] 4243 	btjt flags,#FFOR,1$
      001839 CC 07 14         [ 2] 4244 	jp syntax_error
      00183C CD 12 F9         [ 4] 4245 1$: call relation
      00183F A1 04            [ 1] 4246 	cp a,#TK_INTGR
      001841 27 03            [ 1] 4247 	jreq store_loop_addr  
      001843 CC 07 14         [ 2] 4248 	jp syntax_error
                                   4249 ; leave loop back entry point on cstack 
                                   4250 ; cstack is 2 call deep from interp_loop
      001846                       4251 store_loop_addr:
      001846 CD 0F 86         [ 4] 4252 	call dpush 
      001849 CE 00 04         [ 2] 4253 	ldw x,basicptr  
      00184C 1F 05            [ 2] 4254 	ldw (BPTR,sp),x 
      00184E CE 00 00         [ 2] 4255 	ldw x,in.w 
      001851 1F 03            [ 2] 4256 	ldw (INW,sp),x   
      001853 72 15 00 1F      [ 1] 4257 	bres flags,#FFOR 
      001857 72 5C 00 1C      [ 1] 4258 	inc loop_depth  
      00185B 81               [ 4] 4259 	ret 
                                   4260 
                                   4261 ;--------------------------------
                                   4262 ; BASIC: NEXT var 
                                   4263 ; FOR loop control 
                                   4264 ; increment variable with step 
                                   4265 ; and compare with limit 
                                   4266 ; loop if threshold not crossed.
                                   4267 ; else clean both stacks. 
                                   4268 ; and decrement 'loop_depth' 
                                   4269 ;--------------------------------
      00185C                       4270 next: ; {var limit step -- [var limit step ] }
      00185C 72 5D 00 1C      [ 1] 4271 	tnz loop_depth 
      001860 26 03            [ 1] 4272 	jrne 1$ 
      001862 CC 07 14         [ 2] 4273 	jp syntax_error 
      001865                       4274 1$: 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 83.
Hexadecimal [24-Bits]



      001865 A6 05            [ 1] 4275 	ld a,#TK_VAR 
      001867 CD 11 A6         [ 4] 4276 	call expect
                                   4277 ; check for good variable after NEXT 	 
      00186A 90 93            [ 1] 4278 	ldw y,x 
      00186C AE 00 04         [ 2] 4279 	ldw x,#4  
      00186F 72 D3 00 16      [ 4] 4280 	cpw y,([dstkptr],x) ; compare variables address 
      001873 27 03            [ 1] 4281 	jreq 2$  
      001875 CC 07 14         [ 2] 4282 	jp syntax_error ; not the good one 
      001878                       4283 2$: ; increment variable 
      001878 93               [ 1] 4284 	ldw x,y
      001879 FE               [ 2] 4285 	ldw x,(x)  ; get var value 
      00187A CF 00 08         [ 2] 4286 	ldw acc16,x 
      00187D 72 CE 00 16      [ 5] 4287 	ldw x,[dstkptr] ; step
      001881 72 BB 00 08      [ 2] 4288 	addw x,acc16 ; var+step 
      001885 90 FF            [ 2] 4289 	ldw (y),x ; save var new value 
                                   4290 ; compare with limit 
      001887 90 93            [ 1] 4291 	ldw y,x 
      001889 72 CE 00 16      [ 5] 4292 	ldw x,[dstkptr] ; step in x 
      00188D 5D               [ 2] 4293 	tnzw x  
      00188E 2A 0B            [ 1] 4294 	jrpl 4$ ; positive step 
                                   4295 ;negative step 
      001890 AE 00 02         [ 2] 4296 	ldw x,#2
      001893 72 D3 00 16      [ 4] 4297 	cpw y,([dstkptr],x)
      001897 2F 20            [ 1] 4298 	jrslt loop_done
      001899 20 09            [ 2] 4299 	jra loop_back 
      00189B                       4300 4$: ; positive step
      00189B AE 00 02         [ 2] 4301 	ldw x,#2 
      00189E 72 D3 00 16      [ 4] 4302 	cpw y,([dstkptr],x)
      0018A2 2C 15            [ 1] 4303 	jrsgt loop_done
      0018A4                       4304 loop_back:
      0018A4 1E 05            [ 2] 4305 	ldw x,(BPTR,sp)
      0018A6 CF 00 04         [ 2] 4306 	ldw basicptr,x 
      0018A9 72 01 00 1F 05   [ 2] 4307 	btjf flags,#FRUN,1$ 
      0018AE E6 02            [ 1] 4308 	ld a,(2,x)
      0018B0 C7 00 03         [ 1] 4309 	ld count,a
      0018B3 1E 03            [ 2] 4310 1$:	ldw x,(INW,sp)
      0018B5 CF 00 00         [ 2] 4311 	ldw in.w,x 
      0018B8 81               [ 4] 4312 	ret 
      0018B9                       4313 loop_done:
                                   4314 	; remove var limit step on dstack 
      0018B9 CE 00 16         [ 2] 4315 	ldw x,dstkptr 
      0018BC 1C 00 06         [ 2] 4316 	addw x,#3*CELL_SIZE
      0018BF CF 00 16         [ 2] 4317 	ldw dstkptr,x 
                                   4318 	; remove 2 return address on cstack 
      0018C2 85               [ 2] 4319 	popw x
      0018C3                       4320 	_drop 4
      0018C3 5B 04            [ 2]    1     addw sp,#4 
      0018C5 89               [ 2] 4321 	pushw x 
      0018C6 72 5A 00 1C      [ 1] 4322 	dec loop_depth 
      0018CA 81               [ 4] 4323 	ret 
                                   4324 
                                   4325 
                                   4326 ;------------------------
                                   4327 ; BASIC: GOTO line# 
                                   4328 ; jump to line# 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 84.
Hexadecimal [24-Bits]



                                   4329 ; here cstack is 2 call deep from interp_loop 
                                   4330 ;------------------------
      0018CB                       4331 goto:
      0018CB 72 00 00 1F 06   [ 2] 4332 	btjt flags,#FRUN,0$ 
      0018D0 A6 06            [ 1] 4333 	ld a,#ERR_RUN_ONLY
      0018D2 CC 07 16         [ 2] 4334 	jp tb_error 
      0018D5 81               [ 4] 4335 	ret 
      0018D6 20 23            [ 2] 4336 0$:	jra go_common
                                   4337 
                                   4338 ;--------------------
                                   4339 ; BASIC: GOSUB line#
                                   4340 ; basic subroutine call
                                   4341 ; actual line# and basicptr 
                                   4342 ; are saved on cstack
                                   4343 ; here cstack is 2 call deep from interp_loop 
                                   4344 ;--------------------
                           000003  4345 	GOS_RET=3
      0018D8                       4346 gosub:
      0018D8 72 00 00 1F 06   [ 2] 4347 	btjt flags,#FRUN,0$ 
      0018DD A6 06            [ 1] 4348 	ld a,#ERR_RUN_ONLY
      0018DF CC 07 16         [ 2] 4349 	jp tb_error 
      0018E2 81               [ 4] 4350 	ret 
      0018E3 85               [ 2] 4351 0$:	popw x 
      0018E4 52 02            [ 2] 4352 	sub sp,#2 
      0018E6 89               [ 2] 4353 	pushw x 
      0018E7 CE 00 04         [ 2] 4354 	ldw x,basicptr
      0018EA E6 02            [ 1] 4355 	ld a,(2,x)
      0018EC AB 03            [ 1] 4356 	add a,#3 
      0018EE C7 00 09         [ 1] 4357 	ld acc8,a 
      0018F1 72 5F 00 08      [ 1] 4358 	clr acc16 
      0018F5 72 BB 00 08      [ 2] 4359 	addw x,acc16
      0018F9 1F 03            [ 2] 4360 	ldw (GOS_RET,sp),x 
      0018FB                       4361 go_common: 
      0018FB CD 12 F9         [ 4] 4362 	call relation 
      0018FE A1 04            [ 1] 4363 	cp a,#TK_INTGR
      001900 27 03            [ 1] 4364 	jreq 1$ 
      001902 CC 07 14         [ 2] 4365 	jp syntax_error
      001905                       4366 1$: 
      001905 CD 02 E8         [ 4] 4367 	call search_lineno  
      001908 5D               [ 2] 4368 	tnzw x 
      001909 26 05            [ 1] 4369 	jrne 2$ 
      00190B A6 05            [ 1] 4370 	ld a,#ERR_NO_LINE 
      00190D CC 07 16         [ 2] 4371 	jp tb_error 
      001910                       4372 2$: 
      001910 CF 00 04         [ 2] 4373 	ldw basicptr,x 
      001913 E6 02            [ 1] 4374 	ld a,(2,x)
      001915 C7 00 03         [ 1] 4375 	ld count,a 
      001918 35 03 00 01      [ 1] 4376 	mov in,#3 
      00191C 81               [ 4] 4377 	ret 
                                   4378 
                                   4379 ;------------------------
                                   4380 ; BASIC: RETURN 
                                   4381 ; exit from a subroutine 
                                   4382 ; cstack is 2 level deep from interp_loop 
                                   4383 ;------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 85.
Hexadecimal [24-Bits]



      00191D                       4384 return:
      00191D 72 00 00 1F 05   [ 2] 4385 	btjt flags,#FRUN,0$ 
      001922 A6 06            [ 1] 4386 	ld a,#ERR_RUN_ONLY
      001924 CC 07 16         [ 2] 4387 	jp tb_error 
      001927                       4388 0$:	
      001927 1E 03            [ 2] 4389 	ldw x,(GOS_RET,sp) 
      001929 CF 00 04         [ 2] 4390 	ldw basicptr,x 
      00192C E6 02            [ 1] 4391 	ld a,(2,x)
      00192E AB 03            [ 1] 4392 	add a,#3 
      001930 C7 00 03         [ 1] 4393 	ld count,a 
      001933 35 03 00 01      [ 1] 4394 	mov in,#3
      001937 4F               [ 1] 4395 	clr a 
      001938 85               [ 2] 4396 	popw x 
      001939                       4397 	_drop 2
      001939 5B 02            [ 2]    1     addw sp,#2 
      00193B 89               [ 2] 4398 	pushw x
      00193C 81               [ 4] 4399 	ret  
                                   4400 
                                   4401 
                                   4402 ;----------------------------------
                                   4403 ; BASIC: RUN
                                   4404 ; run BASIC program in RAM
                                   4405 ;----------------------------------- 
      00193D                       4406 run: 
      00193D 72 01 00 1F 02   [ 2] 4407 	btjf flags,#FRUN,0$  
      001942 4F               [ 1] 4408 	clr a 
      001943 81               [ 4] 4409 	ret
      001944                       4410 0$: 
      001944 72 09 00 1F 12   [ 2] 4411 	btjf flags,#FBREAK,1$
      001949                       4412 	_drop 2 
      001949 5B 02            [ 2]    1     addw sp,#2 
      00194B CD 16 83         [ 4] 4413 	call rest_context
      00194E                       4414 	_drop CTXT_SIZE 
      00194E 5B 06            [ 2]    1     addw sp,#CTXT_SIZE 
      001950 72 19 00 1F      [ 1] 4415 	bres flags,#FBREAK 
      001954 72 10 00 1F      [ 1] 4416 	bset flags,#FRUN 
      001958 CC 07 C4         [ 2] 4417 	jp interp_loop 
      00195B CE 00 18         [ 2] 4418 1$:	ldw x,txtbgn
      00195E C3 00 1A         [ 2] 4419 	cpw x,txtend 
      001961 2B 02            [ 1] 4420 	jrmi 2$ 
      001963 4F               [ 1] 4421 	clr a 
      001964 81               [ 4] 4422 	ret 
      001965 CD 13 74         [ 4] 4423 2$: call ubound 
      001968                       4424 	_drop 2 
      001968 5B 02            [ 2]    1     addw sp,#2 
      00196A CE 00 18         [ 2] 4425 	ldw x,txtbgn 
      00196D CF 00 04         [ 2] 4426 	ldw basicptr,x 
      001970 E6 02            [ 1] 4427 	ld a,(2,x)
      001972 C7 00 03         [ 1] 4428 	ld count,a
      001975 35 03 00 01      [ 1] 4429 	mov in,#3	
      001979 72 10 00 1F      [ 1] 4430 	bset flags,#FRUN 
      00197D CC 07 C4         [ 2] 4431 	jp interp_loop 
                                   4432 
                                   4433 
                                   4434 ;----------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 86.
Hexadecimal [24-Bits]



                                   4435 ; BASIC: STOP 
                                   4436 ; stop running program
                                   4437 ;---------------------- 
      001980                       4438 stop: 
                                   4439 ; clean dstack and cstack 
      001980 AE 17 FF         [ 2] 4440 	ldw x,#STACK_EMPTY 
      001983 94               [ 1] 4441 	ldw sp,x 
      001984 72 11 00 1F      [ 1] 4442 	bres flags,#FRUN 
      001988 72 19 00 1F      [ 1] 4443 	bres flags,#FBREAK
      00198C CC 07 68         [ 2] 4444 	jp warm_start
                                   4445 
                                   4446 ;-----------------------
                                   4447 ; BASIC BEEP expr1,expr2
                                   4448 ; used MCU internal beeper 
                                   4449 ; to produce a sound
                                   4450 ; arguments:
                                   4451 ;    expr1   frequency  (expr1%32)
                                   4452 ;    expr2   duration msec.
                                   4453 ;---------------------------
      00198F                       4454 beep:
      00198F CD 11 B3         [ 4] 4455 	call arg_list 
      001992 A1 02            [ 1] 4456 	cp a,#2 
      001994 27 03            [ 1] 4457 	jreq 1$
      001996 CC 07 14         [ 2] 4458 	jp syntax_error 
      001999                       4459 1$: 
      001999 CE 00 16         [ 2] 4460 	ldw x,dstkptr 
      00199C EE 02            [ 2] 4461 	ldw x,(2,x);frequency 
      00199E A6 1F            [ 1] 4462 	ld a,#31
      0019A0 62               [ 2] 4463 	div x,a 
      0019A1 C7 50 F3         [ 1] 4464 	ld BEEP_CSR,a	
      0019A4 72 1A 50 F3      [ 1] 4465 	bset BEEP_CSR,#5 
      0019A8 CD 0F 93         [ 4] 4466 	call dpop 
      0019AB CD 1E 3E         [ 4] 4467 	call pause02 
      0019AE CD 0F BA         [ 4] 4468 	call ddrop 
      0019B1 A6 1F            [ 1] 4469 	ld a,#0x1f
      0019B3 C7 50 F3         [ 1] 4470 	ld BEEP_CSR,a 
      0019B6 81               [ 4] 4471 	ret 
                                   4472 
                                   4473 ;-------------------------------
                                   4474 ; BASIC: PWRADC 0|1 [,divisor]  
                                   4475 ; disable/enanble ADC 
                                   4476 ;-------------------------------
      0019B7                       4477 power_adc:
      0019B7 CD 11 B3         [ 4] 4478 	call arg_list 
      0019BA A1 02            [ 1] 4479 	cp a,#2	
      0019BC 27 0D            [ 1] 4480 	jreq 1$
      0019BE A1 01            [ 1] 4481 	cp a,#1 
      0019C0 27 03            [ 1] 4482 	jreq 0$ 
      0019C2 CC 07 14         [ 2] 4483 	jp syntax_error 
      0019C5 AE 00 00         [ 2] 4484 0$: ldw x,#0
      0019C8 CD 0F 86         [ 4] 4485 	call dpush 
      0019CB AE 00 02         [ 2] 4486 1$: ldw x,#2
      0019CE 72 DE 00 16      [ 5] 4487 	ldw x,([dstkptr],x) ; on|off
      0019D2 5D               [ 2] 4488 	tnzw x 
      0019D3 27 1C            [ 1] 4489 	jreq 2$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 87.
Hexadecimal [24-Bits]



      0019D5 72 CE 00 16      [ 5] 4490 	ldw x,[dstkptr] ; divisor 
      0019D9 9F               [ 1] 4491 	ld a,xl
      0019DA A4 07            [ 1] 4492 	and a,#7
      0019DC 4E               [ 1] 4493 	swap a 
      0019DD C7 54 01         [ 1] 4494 	ld ADC_CR1,a
      0019E0 72 16 50 CA      [ 1] 4495 	bset CLK_PCKENR2,#CLK_PCKENR2_ADC
      0019E4 72 10 54 01      [ 1] 4496 	bset ADC_CR1,#ADC_CR1_ADON 
      0019E8                       4497 	_usec_dly 7 
      0019E8 AE 00 1B         [ 2]    1     ldw x,#(16*7-2)/4
      0019EB 5A               [ 2]    2     decw x
      0019EC 9D               [ 1]    3     nop 
      0019ED 26 FA            [ 1]    4     jrne .-4
      0019EF 20 08            [ 2] 4498 	jra 3$
      0019F1 72 11 54 01      [ 1] 4499 2$: bres ADC_CR1,#ADC_CR1_ADON
      0019F5 72 17 50 CA      [ 1] 4500 	bres CLK_PCKENR2,#CLK_PCKENR2_ADC
      0019F9 AE 00 02         [ 2] 4501 3$:	ldw x,#2
      0019FC CD 0F F7         [ 4] 4502 	call ddrop_n 
      0019FF 81               [ 4] 4503 	ret
                                   4504 
                                   4505 ;-----------------------------
                                   4506 ; BASIC: RDADC(channel)
                                   4507 ; read adc channel {0..5}
                                   4508 ; output:
                                   4509 ;   A 		TK_INTGR 
                                   4510 ;   X 		value 
                                   4511 ;-----------------------------
      001A00                       4512 analog_read:
      001A00 CD 11 D7         [ 4] 4513 	call func_args 
      001A03 A1 01            [ 1] 4514 	cp a,#1 
      001A05 27 03            [ 1] 4515 	jreq 1$
      001A07 CC 07 14         [ 2] 4516 	jp syntax_error
      001A0A CD 0F 93         [ 4] 4517 1$: call dpop 
      001A0D A3 00 05         [ 2] 4518 	cpw x,#5 
      001A10 23 05            [ 2] 4519 	jrule 2$
      001A12 A6 0A            [ 1] 4520 	ld a,#ERR_BAD_VALUE
      001A14 CC 07 16         [ 2] 4521 	jp tb_error 
      001A17 9F               [ 1] 4522 2$: ld a,xl
      001A18 C7 00 09         [ 1] 4523 	ld acc8,a 
      001A1B A6 05            [ 1] 4524 	ld a,#5
      001A1D C0 00 09         [ 1] 4525 	sub a,acc8 
      001A20 C7 54 00         [ 1] 4526 	ld ADC_CSR,a
      001A23 72 16 54 02      [ 1] 4527 	bset ADC_CR2,#ADC_CR2_ALIGN
      001A27 72 10 54 01      [ 1] 4528 	bset ADC_CR1,#ADC_CR1_ADON
      001A2B 72 0F 54 00 FB   [ 2] 4529 	btjf ADC_CSR,#ADC_CSR_EOC,.
      001A30 CE 54 04         [ 2] 4530 	ldw x,ADC_DRH
      001A33 A6 04            [ 1] 4531 	ld a,#TK_INTGR
      001A35 81               [ 4] 4532 	ret 
                                   4533 
                                   4534 
                                   4535 ;-----------------------
                                   4536 ; BASIC: BREAK 
                                   4537 ; insert a breakpoint 
                                   4538 ; in pogram. 
                                   4539 ; the program is resumed
                                   4540 ; with RUN 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 88.
Hexadecimal [24-Bits]



                                   4541 ;-------------------------
      001A36                       4542 break:
      001A36 72 00 00 1F 02   [ 2] 4543 	btjt flags,#FRUN,2$
      001A3B 4F               [ 1] 4544 	clr a
      001A3C 81               [ 4] 4545 	ret 
      001A3D                       4546 2$:	 
                                   4547 ; create space on cstack to save context 
      001A3D AE 1A 64         [ 2] 4548 	ldw x,#break_point 
      001A40 CD 01 B8         [ 4] 4549 	call puts 
      001A43                       4550 	_drop 2 ;drop return address 
      001A43 5B 02            [ 2]    1     addw sp,#2 
      001A45                       4551 	_vars CTXT_SIZE ; context size 
      001A45 52 06            [ 2]    1     sub sp,#CTXT_SIZE 
      001A47 CD 16 73         [ 4] 4552 	call save_context 
      001A4A AE 16 C8         [ 2] 4553 	ldw x,#tib 
      001A4D CF 00 04         [ 2] 4554 	ldw basicptr,x
      001A50 7F               [ 1] 4555 	clr (x)
      001A51 72 5F 00 03      [ 1] 4556 	clr count  
      001A55 5F               [ 1] 4557 	clrw x 
      001A56 CF 00 00         [ 2] 4558 	ldw in.w,x
      001A59 72 11 00 1F      [ 1] 4559 	bres flags,#FRUN 
      001A5D 72 18 00 1F      [ 1] 4560 	bset flags,#FBREAK
      001A61 CC 07 C4         [ 2] 4561 	jp interp_loop 
      001A64 0A 62 72 65 61 6B 20  4562 break_point: .asciz "\nbreak point, RUN to resume.\n"
             70 6F 69 6E 74 2C 20
             52 55 4E 20 74 6F 20
             72 65 73 75 6D 65 2E
             0A 00
                                   4563 
                                   4564 ;-----------------------
                                   4565 ; BASIC: NEW
                                   4566 ; from command line only 
                                   4567 ; free program memory
                                   4568 ; and clear variables 
                                   4569 ;------------------------
      001A82                       4570 new: 
      001A82 72 01 00 1F 02   [ 2] 4571 	btjf flags,#FRUN,0$ 
      001A87 4F               [ 1] 4572 	clr a 
      001A88 81               [ 4] 4573 	ret 
      001A89                       4574 0$:	
      001A89 CD 05 E6         [ 4] 4575 	call clear_basic 
      001A8C 81               [ 4] 4576 	ret 
                                   4577 	 
                                   4578 ;;;;;;;;;;;;;;;;;;;;;;;;;
                                   4579 ;   file system routines
                                   4580 ;;;;;;;;;;;;;;;;;;;;;;;;;
                                   4581 
                                   4582 ;--------------------
                                   4583 ; input:
                                   4584 ;   X     increment 
                                   4585 ; output:
                                   4586 ;   farptr  incremented 
                                   4587 ;---------------------
      001A8D                       4588 incr_farptr:
      001A8D 72 BB 00 11      [ 2] 4589 	addw x,farptr+1 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 89.
Hexadecimal [24-Bits]



      001A91 24 04            [ 1] 4590 	jrnc 1$
      001A93 72 5C 00 10      [ 1] 4591 	inc farptr 
      001A97 CF 00 11         [ 2] 4592 1$:	ldw farptr+1,x  
      001A9A 81               [ 4] 4593 	ret 
                                   4594 
                                   4595 ;------------------------------
                                   4596 ; extended flash memory used as FLASH_DRIVE 
                                   4597 ; seek end of used flash drive   
                                   4598 ; starting at 0x10000 address.
                                   4599 ; 4 consecutives 0 bytes signal free space. 
                                   4600 ; input:
                                   4601 ;	none
                                   4602 ; output:
                                   4603 ;   ffree     free_addr| 0 if memory full.
                                   4604 ;------------------------------
      001A9B                       4605 seek_fdrive:
                                   4606 ; start scan at 0x10000 address 
      001A9B A6 01            [ 1] 4607 	ld a,#1
      001A9D C7 00 10         [ 1] 4608 	ld farptr,a 
      001AA0 5F               [ 1] 4609 	clrw x 
      001AA1 CF 00 11         [ 2] 4610 	ldw farptr+1,x 
      001AA4                       4611 1$:
      001AA4 AE 00 03         [ 2] 4612 	ldw x,#3  
      001AA7 92 AF 00 10      [ 5] 4613 2$:	ldf a,([farptr],x) 
      001AAB 26 05            [ 1] 4614 	jrne 3$
      001AAD 5A               [ 2] 4615 	decw x
      001AAE 2A F7            [ 1] 4616 	jrpl 2$
      001AB0 20 19            [ 2] 4617 	jra 4$ 
      001AB2 5C               [ 1] 4618 3$:	incw x 
      001AB3 CD 1A 8D         [ 4] 4619 	call incr_farptr
      001AB6 AE 02 7F         [ 2] 4620 	ldw x,#0x27f 
      001AB9 C3 00 10         [ 2] 4621 	cpw x,farptr
      001ABC 2A E6            [ 1] 4622 	jrpl 1$
                                   4623 ; drive full 
      001ABE 72 5F 00 13      [ 1] 4624 	clr ffree 
      001AC2 72 5F 00 14      [ 1] 4625 	clr ffree+1 
      001AC6 72 5F 00 15      [ 1] 4626 	clr ffree+2 
      001ACA 81               [ 4] 4627 	ret
      001ACB                       4628 4$: ; copy farptr to ffree	 
      001ACB CE 00 10         [ 2] 4629 	ldw x,farptr 
      001ACE C6 00 12         [ 1] 4630 	ld a,farptr+2 
      001AD1 CF 00 13         [ 2] 4631 	ldw ffree,x 
      001AD4 C7 00 15         [ 1] 4632 	ld ffree+2,a  
      001AD7 81               [ 4] 4633 	ret 
                                   4634 
                                   4635 ;-----------------------
                                   4636 ; compare file name 
                                   4637 ; with name pointed by Y  
                                   4638 ; input:
                                   4639 ;   farptr   file name 
                                   4640 ;   Y        target name 
                                   4641 ; output:
                                   4642 ;   farptr 	 at file_name
                                   4643 ;   X 		 farptr[x] point at size field  
                                   4644 ;   Carry    0|1 no match|match  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 90.
Hexadecimal [24-Bits]



                                   4645 ;----------------------
      001AD8                       4646 cmp_name:
      001AD8 5F               [ 1] 4647 	clrw x
      001AD9 92 AF 00 10      [ 5] 4648 1$:	ldf a,([farptr],x)
      001ADD 90 F1            [ 1] 4649 	cp a,(y)
      001ADF 26 08            [ 1] 4650 	jrne 4$
      001AE1 4D               [ 1] 4651 	tnz a 
      001AE2 27 12            [ 1] 4652 	jreq 9$ 
      001AE4 5C               [ 1] 4653     incw x 
      001AE5 90 5C            [ 1] 4654 	incw y 
      001AE7 20 F0            [ 2] 4655 	jra 1$
      001AE9                       4656 4$: ;no match 
      001AE9 4D               [ 1] 4657 	tnz a 
      001AEA 27 07            [ 1] 4658 	jreq 5$
      001AEC 5C               [ 1] 4659 	incw x 
      001AED 92 AF 00 10      [ 5] 4660 	ldf a,([farptr],x)
      001AF1 20 F6            [ 2] 4661 	jra 4$  
      001AF3 5C               [ 1] 4662 5$:	incw x ; farptr[x] point at 'size' field 
      001AF4 98               [ 1] 4663 	rcf 
      001AF5 81               [ 4] 4664 	ret
      001AF6                       4665 9$: ; match  
      001AF6 5C               [ 1] 4666 	incw x  ; farptr[x] at 'size' field 
      001AF7 99               [ 1] 4667 	scf 
      001AF8 81               [ 4] 4668 	ret 
                                   4669 
                                   4670 ;-----------------------
                                   4671 ; search file in 
                                   4672 ; flash memory 
                                   4673 ; input:
                                   4674 ;   Y       file name  
                                   4675 ; output:
                                   4676 ;   farptr  addr at name|0
                                   4677 ;-----------------------
                           000001  4678 	FSIZE=1
                           000003  4679 	YSAVE=3
                           000004  4680 	VSIZE=4 
      001AF9                       4681 search_file: 
      001AF9                       4682 	_vars VSIZE
      001AF9 52 04            [ 2]    1     sub sp,#VSIZE 
      001AFB 17 03            [ 2] 4683 	ldw (YSAVE,sp),y  
      001AFD 5F               [ 1] 4684 	clrw x 
      001AFE CF 00 11         [ 2] 4685 	ldw farptr+1,x 
      001B01 35 01 00 10      [ 1] 4686 	mov farptr,#1
      001B05                       4687 1$:	
                                   4688 ; check if farptr is after any file 
                                   4689 ; if  0 then so.
      001B05 92 BC 00 10      [ 5] 4690 	ldf a,[farptr]
      001B09 27 25            [ 1] 4691 	jreq 6$
      001B0B 5F               [ 1] 4692 2$: clrw x 	
      001B0C 16 03            [ 2] 4693 	ldw y,(YSAVE,sp) 
      001B0E CD 1A D8         [ 4] 4694 	call cmp_name
      001B11 25 2D            [ 1] 4695 	jrc 9$
      001B13 92 AF 00 10      [ 5] 4696 	ldf a,([farptr],x)
      001B17 6B 01            [ 1] 4697 	ld (FSIZE,sp),a 
      001B19 5C               [ 1] 4698 	incw x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 91.
Hexadecimal [24-Bits]



      001B1A 92 AF 00 10      [ 5] 4699 	ldf a,([farptr],x)
      001B1E 6B 02            [ 1] 4700 	ld (FSIZE+1,sp),a 
      001B20 5C               [ 1] 4701 	incw x 
      001B21 72 FB 01         [ 2] 4702 	addw x,(FSIZE,sp) ; count to skip 
      001B24 5C               [ 1] 4703 	incw x ; skip over EOF marker 
      001B25 CD 1A 8D         [ 4] 4704 	call incr_farptr ; now at next file 'name_field'
      001B28 AE 02 80         [ 2] 4705 	ldw x,#0x280
      001B2B C3 00 10         [ 2] 4706 	cpw x,farptr 
      001B2E 2A D5            [ 1] 4707 	jrpl 1$
      001B30                       4708 6$: ; file not found 
      001B30 72 5F 00 10      [ 1] 4709 	clr farptr
      001B34 72 5F 00 11      [ 1] 4710 	clr farptr+1 
      001B38 72 5F 00 12      [ 1] 4711 	clr farptr+2 
      001B3C                       4712 	_drop VSIZE 
      001B3C 5B 04            [ 2]    1     addw sp,#VSIZE 
      001B3E 98               [ 1] 4713 	rcf
      001B3F 81               [ 4] 4714 	ret
      001B40                       4715 9$: ; file found  farptr[0] at 'name_field',farptr[x] at 'file_size' 
      001B40                       4716 	_drop VSIZE 
      001B40 5B 04            [ 2]    1     addw sp,#VSIZE 
      001B42 99               [ 1] 4717 	scf 	
      001B43 81               [ 4] 4718 	ret
                                   4719 
                                   4720 ;--------------------------------
                                   4721 ; BASIC: SAVE "name" 
                                   4722 ; save text program in 
                                   4723 ; flash memory used as 
                                   4724 ;--------------------------------
                           000001  4725 	BSIZE=1
                           000003  4726 	NAMEPTR=3
                           000004  4727 	VSIZE=4
      001B44                       4728 save:
      001B44 72 01 00 1F 05   [ 2] 4729 	btjf flags,#FRUN,0$ 
      001B49 A6 07            [ 1] 4730 	ld a,#ERR_CMD_ONLY 
      001B4B CC 07 16         [ 2] 4731 	jp tb_error
      001B4E                       4732 0$:	 
      001B4E CE 00 1A         [ 2] 4733 	ldw x,txtend 
      001B51 72 B0 00 18      [ 2] 4734 	subw x,txtbgn
      001B55 26 01            [ 1] 4735 	jrne 1$
                                   4736 ; nothing to save 
      001B57 81               [ 4] 4737 	ret 
      001B58                       4738 1$:	
      001B58                       4739 	_vars VSIZE 
      001B58 52 04            [ 2]    1     sub sp,#VSIZE 
      001B5A 1F 01            [ 2] 4740 	ldw (BSIZE,sp),x 
      001B5C CD 07 F4         [ 4] 4741 	call next_token	
      001B5F A1 0A            [ 1] 4742 	cp a,#TK_QSTR
      001B61 27 03            [ 1] 4743 	jreq 2$
      001B63 CC 07 14         [ 2] 4744 	jp syntax_error
      001B66                       4745 2$: 
      001B66 90 CE 00 04      [ 2] 4746 	ldw y,basicptr 
      001B6A 72 B9 00 00      [ 2] 4747 	addw y,in.w
      001B6E 17 03            [ 2] 4748 	ldw (NAMEPTR,sp),y  
      001B70 55 00 03 00 01   [ 1] 4749 	mov in,count 
                                   4750 ; check if enough free space 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 92.
Hexadecimal [24-Bits]



      001B75 93               [ 1] 4751 	ldw x,y 
      001B76 CD 02 7A         [ 4] 4752 	call strlen 
      001B79 1C 00 03         [ 2] 4753 	addw x,#3 
      001B7C 72 FB 01         [ 2] 4754 	addw x,(BSIZE,sp)
      001B7F 72 5D 00 13      [ 1] 4755 	tnz ffree 
      001B83 26 0B            [ 1] 4756 	jrne 21$
      001B85 72 B0 00 14      [ 2] 4757 	subw x,ffree+1 
      001B89 23 05            [ 2] 4758 	jrule 21$
      001B8B A6 01            [ 1] 4759 	ld a,#ERR_MEM_FULL 
      001B8D CC 07 16         [ 2] 4760 	jp tb_error
      001B90                       4761 21$: 
                                   4762 ; check for existing file of that name 
      001B90 16 03            [ 2] 4763 	ldw y,(NAMEPTR,sp)	
      001B92 CD 1A F9         [ 4] 4764 	call search_file 
      001B95 24 05            [ 1] 4765 	jrnc 3$ 
      001B97 A6 08            [ 1] 4766 	ld a,#ERR_DUPLICATE 
      001B99 CC 07 16         [ 2] 4767 	jp tb_error 
      001B9C                       4768 3$:	;** write file name to flash **
      001B9C CE 00 13         [ 2] 4769 	ldw x,ffree 
      001B9F C6 00 15         [ 1] 4770 	ld a,ffree+2 
      001BA2 CF 00 10         [ 2] 4771 	ldw farptr,x 
      001BA5 C7 00 12         [ 1] 4772 	ld farptr+2,a 
      001BA8 1E 03            [ 2] 4773 	ldw x,(NAMEPTR,sp)  
      001BAA CD 02 7A         [ 4] 4774 	call strlen 
      001BAD 5C               [ 1] 4775 	incw  x
      001BAE 1F 01            [ 2] 4776 	ldw (BSIZE,sp),x  
      001BB0 5F               [ 1] 4777 	clrw x   
      001BB1 16 03            [ 2] 4778 	ldw y,(NAMEPTR,sp)
      001BB3 CD 01 55         [ 4] 4779 	call write_block  
                                   4780 ;** write file length after name **
      001BB6 CE 00 1A         [ 2] 4781 	ldw x,txtend 
      001BB9 72 B0 00 18      [ 2] 4782 	subw x,txtbgn
      001BBD 1F 01            [ 2] 4783 	ldw (BSIZE,sp),x 
      001BBF 5F               [ 1] 4784 	clrw x 
      001BC0 7B 01            [ 1] 4785 	ld a,(1,sp)
      001BC2 CD 00 E0         [ 4] 4786 	call write_byte 
      001BC5 5C               [ 1] 4787 	incw x 
      001BC6 7B 02            [ 1] 4788 	ld a,(2,sp)
      001BC8 CD 00 E0         [ 4] 4789 	call write_byte
      001BCB 5C               [ 1] 4790 	incw x  
      001BCC CD 1A 8D         [ 4] 4791 	call incr_farptr ; move farptr after SIZE field 
                                   4792 ;** write BASIC text **
                                   4793 ; copy BSIZE, cstack:{... bsize -- ... bsize bsize }	
      001BCF 1E 01            [ 2] 4794 	ldw x,(BSIZE,sp)
      001BD1 89               [ 2] 4795 	pushw x ; write_block argument 
      001BD2 5F               [ 1] 4796 	clrw x 
      001BD3 90 CE 00 18      [ 2] 4797 	ldw y,txtbgn  ; BASIC text to save 
      001BD7 CD 01 55         [ 4] 4798 	call write_block 
      001BDA                       4799 	_drop 2 ;  drop write_block argument  
      001BDA 5B 02            [ 2]    1     addw sp,#2 
                                   4800 ; write en end of file marker 
      001BDC AE 00 01         [ 2] 4801 	ldw x,#1
      001BDF A6 FF            [ 1] 4802 	ld a,#EOF  
      001BE1 CD 00 E0         [ 4] 4803 	call write_byte 
      001BE4 CD 1A 8D         [ 4] 4804 	call incr_farptr
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 93.
Hexadecimal [24-Bits]



                                   4805 ; save farptr in ffree
      001BE7 CE 00 10         [ 2] 4806 	ldw x,farptr 
      001BEA C6 00 12         [ 1] 4807 	ld a,farptr+2 
      001BED CF 00 13         [ 2] 4808 	ldw ffree,x 
      001BF0 C7 00 15         [ 1] 4809 	ld ffree+2,a
                                   4810 ;write 4 zero bytes as an end of all files marker 
      001BF3 5F               [ 1] 4811     clrw x 
      001BF4 4B 04            [ 1] 4812 	push #4 
      001BF6                       4813 4$:
      001BF6 4F               [ 1] 4814 	clr a 
      001BF7 CD 00 E0         [ 4] 4815 	call write_byte 
      001BFA 5C               [ 1] 4816 	incw x 
      001BFB 0A 01            [ 1] 4817 	dec (1,sp)
      001BFD 26 F7            [ 1] 4818 	jrne 4$
      001BFF 84               [ 1] 4819 5$: pop a 
                                   4820 ; display saved size  
      001C00 1E 01            [ 2] 4821 	ldw x,(BSIZE,sp) 
      001C02 CD 09 8D         [ 4] 4822 	call print_int 
      001C05                       4823 	_drop VSIZE 
      001C05 5B 04            [ 2]    1     addw sp,#VSIZE 
      001C07 81               [ 4] 4824 	ret 
                                   4825 
                                   4826 
                                   4827 ;------------------------
                                   4828 ; BASIC: LOAD "file" 
                                   4829 ; load file to RAM 
                                   4830 ; for execution 
                                   4831 ;------------------------
      001C08                       4832 load:
      001C08 72 01 00 1F 07   [ 2] 4833 	btjf flags,#FRUN,0$ 
      001C0D 27 05            [ 1] 4834 	jreq 0$ 
      001C0F A6 07            [ 1] 4835 	ld a,#ERR_CMD_ONLY 
      001C11 CC 07 16         [ 2] 4836 	jp tb_error 
      001C14                       4837 0$:	
      001C14 CD 07 F4         [ 4] 4838 	call next_token 
      001C17 A1 0A            [ 1] 4839 	cp a,#TK_QSTR
      001C19 27 03            [ 1] 4840 	jreq 1$
      001C1B CC 07 14         [ 2] 4841 	jp syntax_error 
      001C1E                       4842 1$:	
      001C1E 90 CE 00 04      [ 2] 4843 	ldw y,basicptr
      001C22 72 B9 00 00      [ 2] 4844 	addw y,in.w 
      001C26 55 00 03 00 01   [ 1] 4845 	mov in,count 
      001C2B CD 1A F9         [ 4] 4846 	call search_file 
      001C2E 25 05            [ 1] 4847 	jrc 2$ 
      001C30 A6 09            [ 1] 4848 	ld a,#ERR_NOT_FILE
      001C32 CC 07 16         [ 2] 4849 	jp tb_error  
      001C35                       4850 2$:	
      001C35 CD 1A 8D         [ 4] 4851 	call incr_farptr  
      001C38 CD 05 E6         [ 4] 4852 	call clear_basic  
      001C3B 5F               [ 1] 4853 	clrw x
      001C3C 92 AF 00 10      [ 5] 4854 	ldf a,([farptr],x)
      001C40 90 95            [ 1] 4855 	ld yh,a 
      001C42 5C               [ 1] 4856 	incw x  
      001C43 92 AF 00 10      [ 5] 4857 	ldf a,([farptr],x)
      001C47 5C               [ 1] 4858 	incw x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 94.
Hexadecimal [24-Bits]



      001C48 90 97            [ 1] 4859 	ld yl,a 
      001C4A 72 B9 00 18      [ 2] 4860 	addw y,txtbgn
      001C4E 90 CF 00 1A      [ 2] 4861 	ldw txtend,y
      001C52 90 CE 00 18      [ 2] 4862 	ldw y,txtbgn
      001C56                       4863 3$:	; load BASIC text 	
      001C56 92 AF 00 10      [ 5] 4864 	ldf a,([farptr],x)
      001C5A 90 F7            [ 1] 4865 	ld (y),a 
      001C5C 5C               [ 1] 4866 	incw x 
      001C5D 90 5C            [ 1] 4867 	incw y 
      001C5F 90 C3 00 1A      [ 2] 4868 	cpw y,txtend 
      001C63 2B F1            [ 1] 4869 	jrmi 3$
                                   4870 ; print loaded size 	 
      001C65 CE 00 1A         [ 2] 4871 	ldw x,txtend 
      001C68 72 B0 00 18      [ 2] 4872 	subw x,txtbgn
      001C6C CD 09 8D         [ 4] 4873 	call print_int 
      001C6F 81               [ 4] 4874 	ret 
                                   4875 
                                   4876 ;-----------------------------------
                                   4877 ; BASIC: FORGET ["file_name"] 
                                   4878 ; erase file_name and all others 
                                   4879 ; after it. 
                                   4880 ; without argument erase all files 
                                   4881 ;-----------------------------------
      001C70                       4882 forget:
      001C70 CD 07 F4         [ 4] 4883 	call next_token 
      001C73 A1 00            [ 1] 4884 	cp a,#TK_NONE 
      001C75 27 26            [ 1] 4885 	jreq 3$ 
      001C77 A1 0A            [ 1] 4886 	cp a,#TK_QSTR
      001C79 27 03            [ 1] 4887 	jreq 1$
      001C7B CC 07 14         [ 2] 4888 	jp syntax_error
      001C7E 90 CE 00 04      [ 2] 4889 1$: ldw y,basicptr
      001C82 72 B9 00 00      [ 2] 4890 	addw y,in.w
      001C86 55 00 03 00 01   [ 1] 4891 	mov in,count 
      001C8B CD 1A F9         [ 4] 4892 	call search_file
      001C8E 25 05            [ 1] 4893 	jrc 2$
      001C90 A6 09            [ 1] 4894 	ld a,#ERR_NOT_FILE 
      001C92 CC 07 16         [ 2] 4895 	jp tb_error 
      001C95                       4896 2$: 
      001C95 CE 00 10         [ 2] 4897 	ldw x,farptr
      001C98 C6 00 12         [ 1] 4898 	ld a,farptr+2
      001C9B 20 0A            [ 2] 4899 	jra 4$ 
      001C9D                       4900 3$: ; forget all files 
      001C9D AE 01 00         [ 2] 4901 	ldw x,#0x100
      001CA0 4F               [ 1] 4902 	clr a 
      001CA1 CF 00 10         [ 2] 4903 	ldw farptr,x 
      001CA4 C7 00 12         [ 1] 4904 	ld farptr+2,a 
      001CA7                       4905 4$:
      001CA7 CF 00 13         [ 2] 4906 	ldw ffree,x 
      001CAA C7 00 15         [ 1] 4907 	ld ffree+2,a 
      001CAD 4B 04            [ 1] 4908 	push #4
      001CAF 5F               [ 1] 4909 	clrw x 
      001CB0                       4910 5$: 
      001CB0 4F               [ 1] 4911 	clr a  
      001CB1 CD 00 E0         [ 4] 4912 	call write_byte 
      001CB4 5C               [ 1] 4913 	incw x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 95.
Hexadecimal [24-Bits]



      001CB5 0A 01            [ 1] 4914 	dec (1,sp)
      001CB7 26 F7            [ 1] 4915 	jrne 5$	
      001CB9 84               [ 1] 4916 6$: pop a 
      001CBA 81               [ 4] 4917 	ret 
                                   4918 
                                   4919 ;----------------------
                                   4920 ; BASIC: DIR 
                                   4921 ; list saved files 
                                   4922 ;----------------------
                           000001  4923 	COUNT=1 ; files counter 
                           000002  4924 	VSIZE=2 
      001CBB                       4925 directory:
      001CBB                       4926 	_vars VSIZE 
      001CBB 52 02            [ 2]    1     sub sp,#VSIZE 
      001CBD 5F               [ 1] 4927 	clrw x 
      001CBE 1F 01            [ 2] 4928 	ldw (COUNT,sp),x 
      001CC0 CF 00 11         [ 2] 4929 	ldw farptr+1,x 
      001CC3 35 01 00 10      [ 1] 4930 	mov farptr,#1 
      001CC7                       4931 dir_loop:
      001CC7 5F               [ 1] 4932 	clrw x 
      001CC8 92 AF 00 10      [ 5] 4933 	ldf a,([farptr],x)
      001CCC 27 39            [ 1] 4934 	jreq 8$ 
      001CCE                       4935 1$: ;name loop 	
      001CCE 92 AF 00 10      [ 5] 4936 	ldf a,([farptr],x)
      001CD2 27 06            [ 1] 4937 	jreq 2$ 
      001CD4 CD 01 A6         [ 4] 4938 	call putc 
      001CD7 5C               [ 1] 4939 	incw x 
      001CD8 20 F4            [ 2] 4940 	jra 1$
      001CDA 5C               [ 1] 4941 2$: incw x ; skip ending 0. 
      001CDB A6 20            [ 1] 4942 	ld a,#SPACE 
      001CDD CD 01 A6         [ 4] 4943 	call putc 
                                   4944 ; get file size 	
      001CE0 92 AF 00 10      [ 5] 4945 	ldf a,([farptr],x)
      001CE4 90 95            [ 1] 4946 	ld yh,a 
      001CE6 5C               [ 1] 4947 	incw x 
      001CE7 92 AF 00 10      [ 5] 4948 	ldf a,([farptr],x)
      001CEB 5C               [ 1] 4949 	incw x 
      001CEC 90 97            [ 1] 4950 	ld yl,a 
      001CEE 90 89            [ 2] 4951 	pushw y 
      001CF0 72 FB 01         [ 2] 4952 	addw x,(1,sp)
      001CF3 5C               [ 1] 4953 	incw x ; skip EOF marker 
                                   4954 ; skip to next file 
      001CF4 CD 1A 8D         [ 4] 4955 	call incr_farptr 
                                   4956 ; print file size 
      001CF7 85               [ 2] 4957 	popw x ; file size 
      001CF8 CD 09 8D         [ 4] 4958 	call print_int 
      001CFB A6 0D            [ 1] 4959 	ld a,#CR 
      001CFD CD 01 A6         [ 4] 4960 	call putc
      001D00 1E 01            [ 2] 4961 	ldw x,(COUNT,sp)
      001D02 5C               [ 1] 4962 	incw x
      001D03 1F 01            [ 2] 4963 	ldw (COUNT,sp),x  
      001D05 20 C0            [ 2] 4964 	jra dir_loop 
      001D07                       4965 8$: ; print number of files 
      001D07 1E 01            [ 2] 4966 	ldw x,(COUNT,sp)
      001D09 CD 09 8D         [ 4] 4967 	call print_int 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 96.
Hexadecimal [24-Bits]



      001D0C AE 1D 3C         [ 2] 4968 	ldw x,#file_count 
      001D0F CD 01 B8         [ 4] 4969 	call puts  
                                   4970 ; print drive free space 	
      001D12 A6 FF            [ 1] 4971 	ld a,#0xff 
      001D14 C0 00 15         [ 1] 4972 	sub a,ffree+2 
      001D17 C7 00 09         [ 1] 4973 	ld acc8,a 
      001D1A A6 7F            [ 1] 4974 	ld a,#0x7f 
      001D1C C2 00 14         [ 1] 4975 	sbc a,ffree+1 
      001D1F C7 00 08         [ 1] 4976 	ld acc16,a 
      001D22 A6 02            [ 1] 4977 	ld a,#2 
      001D24 C2 00 13         [ 1] 4978 	sbc a,ffree 
      001D27 C7 00 07         [ 1] 4979 	ld acc24,a 
      001D2A 5F               [ 1] 4980 	clrw x  
      001D2B A6 06            [ 1] 4981 	ld a,#6 
      001D2D 97               [ 1] 4982 	ld xl,a 
      001D2E A6 0A            [ 1] 4983 	ld a,#10 
      001D30 CD 09 45         [ 4] 4984 	call prti24 
      001D33 AE 1D 44         [ 2] 4985 	ldw x,#drive_free
      001D36 CD 01 B8         [ 4] 4986 	call puts 
      001D39                       4987 	_drop VSIZE 
      001D39 5B 02            [ 2]    1     addw sp,#VSIZE 
      001D3B 81               [ 4] 4988 	ret
      001D3C 20 66 69 6C 65 73 0A  4989 file_count: .asciz " files\n"
             00
      001D44 20 62 79 74 65 73 20  4990 drive_free: .asciz " bytes free\n" 
             66 72 65 65 0A 00
                                   4991 
                                   4992 ;---------------------
                                   4993 ; BASIC: WRITE expr1,expr2[,expr]* 
                                   4994 ; write 1 or more byte to FLASH or EEPROM
                                   4995 ; starting at address  
                                   4996 ; input:
                                   4997 ;   expr1  	is address 
                                   4998 ;   expr2   is byte to write
                                   4999 ; output:
                                   5000 ;   none 
                                   5001 ;---------------------
                           000001  5002 	ADDR=1
                           000002  5003 	VSIZ=2 
      001D51                       5004 write:
      001D51                       5005 	_vars VSIZE 
      001D51 52 02            [ 2]    1     sub sp,#VSIZE 
      001D53 72 5F 00 10      [ 1] 5006 	clr farptr ; expect 16 bits address 
      001D57 CD 12 B5         [ 4] 5007 	call expression
      001D5A A1 04            [ 1] 5008 	cp a,#TK_INTGR 
      001D5C 27 03            [ 1] 5009 	jreq 0$
      001D5E CC 07 14         [ 2] 5010 	jp syntax_error
      001D61 1F 01            [ 2] 5011 0$: ldw (ADDR,sp),x 
      001D63 CD 07 F4         [ 4] 5012 	call next_token 
      001D66 A1 0D            [ 1] 5013 	cp a,#TK_COMMA 
      001D68 27 02            [ 1] 5014 	jreq 1$ 
      001D6A 20 19            [ 2] 5015 	jra 9$ 
      001D6C CD 12 B5         [ 4] 5016 1$:	call expression
      001D6F A1 04            [ 1] 5017 	cp a,#TK_INTGR
      001D71 27 03            [ 1] 5018 	jreq 2$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 97.
Hexadecimal [24-Bits]



      001D73 CC 07 14         [ 2] 5019 	jp syntax_error
      001D76 9F               [ 1] 5020 2$:	ld a,xl 
      001D77 1E 01            [ 2] 5021 	ldw x,(ADDR,sp) 
      001D79 CF 00 11         [ 2] 5022 	ldw farptr+1,x 
      001D7C 5F               [ 1] 5023 	clrw x 
      001D7D CD 00 E0         [ 4] 5024 	call write_byte
      001D80 1E 01            [ 2] 5025 	ldw x,(ADDR,sp)
      001D82 5C               [ 1] 5026 	incw x 
      001D83 20 DC            [ 2] 5027 	jra 0$ 
      001D85                       5028 9$:
      001D85                       5029 	_drop VSIZE
      001D85 5B 02            [ 2]    1     addw sp,#VSIZE 
      001D87 81               [ 4] 5030 	ret 
                                   5031 
                                   5032 
                                   5033 ;---------------------
                                   5034 ;BASIC: CHAR(expr)
                                   5035 ; évaluate expression 
                                   5036 ; and take the 7 least 
                                   5037 ; bits as ASCII character
                                   5038 ;---------------------
      001D88                       5039 char:
      001D88 CD 11 D7         [ 4] 5040 	call func_args 
      001D8B A1 01            [ 1] 5041 	cp a,#1
      001D8D 27 03            [ 1] 5042 	jreq 1$
      001D8F CC 07 14         [ 2] 5043 	jp syntax_error
      001D92 CD 0F 93         [ 4] 5044 1$:	call dpop 
      001D95 9F               [ 1] 5045 	ld a,xl 
      001D96 A4 7F            [ 1] 5046 	and a,#0x7f 
      001D98 97               [ 1] 5047 	ld xl,a
      001D99 A6 03            [ 1] 5048 	ld a,#TK_CHAR
      001D9B 81               [ 4] 5049 	ret
                                   5050 
                                   5051 ;---------------------
                                   5052 ; BASIC: ASC(string|char)
                                   5053 ; extract first character 
                                   5054 ; of string argument 
                                   5055 ; return it as TK_INTGR 
                                   5056 ;---------------------
      001D9C                       5057 ascii:
      001D9C CD 11 D7         [ 4] 5058 	call func_args 
      001D9F CD 07 F4         [ 4] 5059 	call next_token 
      001DA2 A1 0A            [ 1] 5060 	cp a,#TK_QSTR 
      001DA4 27 07            [ 1] 5061 	jreq 1$
      001DA6 A1 03            [ 1] 5062 	cp a,#TK_CHAR 
      001DA8 27 06            [ 1] 5063 	jreq 2$ 
      001DAA CC 07 14         [ 2] 5064 	jp syntax_error
      001DAD                       5065 1$: 
      001DAD F6               [ 1] 5066 	ld a,(x)
      001DAE 20 01            [ 2] 5067 	jra 3$
      001DB0                       5068 2$: 
      001DB0 9F               [ 1] 5069 	ld a,xl 
      001DB1 97               [ 1] 5070 3$:	ld xl,a 
      001DB2 4F               [ 1] 5071 	clr a  
      001DB3 95               [ 1] 5072 	ld xh,a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 98.
Hexadecimal [24-Bits]



      001DB4 A6 04            [ 1] 5073 	ld a,#TK_INTGR 
      001DB6 81               [ 4] 5074 	ret 
                                   5075 
                                   5076 ;---------------------
                                   5077 ;BASIC: KEY
                                   5078 ; wait for a character 
                                   5079 ; received from STDIN 
                                   5080 ; input:
                                   5081 ;	none 
                                   5082 ; output:
                                   5083 ;	X 		ASCII character 
                                   5084 ;---------------------
      001DB7                       5085 key:
      001DB7 CD 01 AF         [ 4] 5086 	call getc 
      001DBA 5F               [ 1] 5087 	clrw x 
      001DBB 97               [ 1] 5088 	ld xl,a 
      001DBC A6 04            [ 1] 5089 	ld a,#TK_INTGR
      001DBE 81               [ 4] 5090 	ret
                                   5091 
                                   5092 ;----------------------
                                   5093 ; BASIC: QKEY
                                   5094 ; Return true if there 
                                   5095 ; is a character in 
                                   5096 ; waiting in STDIN 
                                   5097 ; input:
                                   5098 ;  none 
                                   5099 ; output:
                                   5100 ;   X 		0|1 
                                   5101 ;-----------------------
      001DBF                       5102 qkey: 
      001DBF 5F               [ 1] 5103 	clrw x 
      001DC0 72 0B 52 40 01   [ 2] 5104 	btjf UART3_SR,#UART_SR_RXNE,9$ 
      001DC5 5C               [ 1] 5105 	incw x 
      001DC6 A6 04            [ 1] 5106 9$: ld a,#TK_INTGR
      001DC8 81               [ 4] 5107 	ret 
                                   5108 
                                   5109 ;---------------------
                                   5110 ; BASIC: GPIO(expr,reg)
                                   5111 ; return gpio address 
                                   5112 ; expr {0..8}
                                   5113 ; input:
                                   5114 ;   none 
                                   5115 ; output:
                                   5116 ;   X 		gpio register address
                                   5117 ;----------------------------
      001DC9                       5118 gpio:
      001DC9 CD 11 D7         [ 4] 5119 	call func_args 
      001DCC A1 02            [ 1] 5120 	cp a,#2
      001DCE 27 03            [ 1] 5121 	jreq 1$
      001DD0 CC 07 14         [ 2] 5122 	jp syntax_error  
      001DD3                       5123 1$:	
      001DD3 AE 00 02         [ 2] 5124 	ldw x,#2
      001DD6 72 DE 00 16      [ 5] 5125 	ldw x,([dstkptr],x) ; port 
      001DDA 2B 1B            [ 1] 5126 	jrmi bad_port
      001DDC A3 00 09         [ 2] 5127 	cpw x,#9
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 99.
Hexadecimal [24-Bits]



      001DDF 2A 16            [ 1] 5128 	jrpl bad_port
      001DE1 A6 05            [ 1] 5129 	ld a,#5
      001DE3 42               [ 4] 5130 	mul x,a
      001DE4 1C 50 00         [ 2] 5131 	addw x,#GPIO_BASE 
      001DE7 89               [ 2] 5132 	pushw x 
      001DE8 CD 0F 93         [ 4] 5133 	call dpop 
      001DEB 72 FB 01         [ 2] 5134 	addw x,(1,sp)
      001DEE 1F 01            [ 2] 5135 	ldw (1,sp),x  
      001DF0 CD 0F BA         [ 4] 5136 	call ddrop  
      001DF3 85               [ 2] 5137 	popw x 
      001DF4 A6 04            [ 1] 5138 	ld a,#TK_INTGR
      001DF6 81               [ 4] 5139 	ret
      001DF7                       5140 bad_port:
      001DF7 A6 0A            [ 1] 5141 	ld a,#ERR_BAD_VALUE
      001DF9 CC 07 16         [ 2] 5142 	jp tb_error
                                   5143 
                                   5144 
                                   5145 ;-------------------------
                                   5146 ; BASIC: UFLASH 
                                   5147 ; return user flash address
                                   5148 ; input:
                                   5149 ;  none 
                                   5150 ; output:
                                   5151 ;	A		TK_INTGR
                                   5152 ;   X 		user address 
                                   5153 ;---------------------------
      001DFC                       5154 uflash:
      001DFC AE 22 80         [ 2] 5155 	ldw x,#user_space 
      001DFF A6 04            [ 1] 5156 	ld a,#TK_INTGR 
      001E01 81               [ 4] 5157 	ret 
                                   5158 
                                   5159 
                                   5160 ;---------------------
                                   5161 ; BASIC: USR(addr[,arg])
                                   5162 ; execute a function written 
                                   5163 ; in binary code.
                                   5164 ; binary fonction should 
                                   5165 ; return token attribute in A 
                                   5166 ; and value in X. 
                                   5167 ; input:
                                   5168 ;   addr	routine address 
                                   5169 ;   arg 	is an optional argument 
                                   5170 ; output:
                                   5171 ;   A 		token attribute 
                                   5172 ;   X       returned value 
                                   5173 ;---------------------
      001E02                       5174 usr:
      001E02 90 89            [ 2] 5175 	pushw y 	
      001E04 CD 11 D7         [ 4] 5176 	call func_args 
      001E07 A1 01            [ 1] 5177 	cp a,#1 
      001E09 2A 03            [ 1] 5178 	jrpl 2$ 
      001E0B CC 07 14         [ 2] 5179 	jp syntax_error 
      001E0E                       5180 2$: 
      001E0E CD 0F 93         [ 4] 5181 	call dpop 
      001E11 A1 02            [ 1] 5182 	cp a,#2 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 100.
Hexadecimal [24-Bits]



      001E13 2B 05            [ 1] 5183 	jrmi 4$
      001E15 90 93            [ 1] 5184 	ldw y,x ; y=arg 
      001E17 CD 0F 93         [ 4] 5185 	call dpop ;x=addr 
      001E1A 51               [ 1] 5186 4$:	exgw y,x ; y=addr,x=arg 
      001E1B 90 FD            [ 4] 5187 	call (y)
      001E1D 90 85            [ 2] 5188 	popw y 
      001E1F 81               [ 4] 5189 	ret 
                                   5190 
                                   5191 ;------------------------------
                                   5192 ; BASIC: BYE 
                                   5193 ; halt mcu in its lowest power mode 
                                   5194 ; wait for reset or external interrupt
                                   5195 ; do a cold start on wakeup.
                                   5196 ;------------------------------
      001E20                       5197 bye:
      001E20 72 0D 52 40 FB   [ 2] 5198 	btjf UART3_SR,#UART_SR_TC,.
      001E25 8E               [10] 5199 	halt
      001E26 CC 05 54         [ 2] 5200 	jp cold_start  
                                   5201 
                                   5202 ;----------------------------------
                                   5203 ; BASIC: SLEEP 
                                   5204 ; halt mcu until reset or external
                                   5205 ; interrupt.
                                   5206 ; Resume progam after SLEEP command
                                   5207 ;----------------------------------
      001E29                       5208 sleep:
      001E29 72 0D 52 40 FB   [ 2] 5209 	btjf UART3_SR,#UART_SR_TC,.
      001E2E 72 16 00 1F      [ 1] 5210 	bset flags,#FSLEEP
      001E32 8E               [10] 5211 	halt 
      001E33 81               [ 4] 5212 	ret 
                                   5213 
                                   5214 ;-------------------------------
                                   5215 ; BASIC: PAUSE expr 
                                   5216 ; suspend execution for n msec.
                                   5217 ; input:
                                   5218 ;	none
                                   5219 ; output:
                                   5220 ;	none 
                                   5221 ;------------------------------
      001E34                       5222 pause:
      001E34 CD 12 B5         [ 4] 5223 	call expression
      001E37 A1 04            [ 1] 5224 	cp a,#TK_INTGR
      001E39 27 03            [ 1] 5225 	jreq pause02 
      001E3B CC 07 14         [ 2] 5226 	jp syntax_error
      001E3E                       5227 pause02: 
      001E3E 5D               [ 2] 5228 1$: tnzw x 
      001E3F 27 04            [ 1] 5229 	jreq 2$
      001E41 8F               [10] 5230 	wfi 
      001E42 5A               [ 2] 5231 	decw x 
      001E43 26 F9            [ 1] 5232 	jrne 1$
      001E45 4F               [ 1] 5233 2$:	clr a 
      001E46 81               [ 4] 5234 	ret 
                                   5235 
                                   5236 ;------------------------------
                                   5237 ; BASIC: TICKS
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 101.
Hexadecimal [24-Bits]



                                   5238 ; return msec ticks counter value 
                                   5239 ; input:
                                   5240 ; 	none 
                                   5241 ; output:
                                   5242 ;	X 		TK_INTGR
                                   5243 ;-------------------------------
      001E47                       5244 get_ticks:
      001E47 CE 00 0A         [ 2] 5245 	ldw x,ticks 
      001E4A A6 04            [ 1] 5246 	ld a,#TK_INTGR
      001E4C 81               [ 4] 5247 	ret 
                                   5248 
                                   5249 
                                   5250 
                                   5251 ;------------------------------
                                   5252 ; BASIC: ABS(expr)
                                   5253 ; return absolute value of expr.
                                   5254 ; input:
                                   5255 ;   none
                                   5256 ; output:
                                   5257 ;   X     	positive integer
                                   5258 ;-------------------------------
      001E4D                       5259 abs:
      001E4D CD 11 D7         [ 4] 5260 	call func_args 
      001E50 A1 01            [ 1] 5261 	cp a,#1 
      001E52 27 03            [ 1] 5262 	jreq 0$ 
      001E54 CC 07 14         [ 2] 5263 	jp syntax_error
      001E57                       5264 0$:  
      001E57 CD 0F 93         [ 4] 5265     call dpop   
      001E5A 9E               [ 1] 5266 	ld a,xh 
      001E5B A5 80            [ 1] 5267 	bcp a,#0x80 
      001E5D 27 01            [ 1] 5268 	jreq 2$ 
      001E5F 50               [ 2] 5269 	negw x 
      001E60 A6 04            [ 1] 5270 2$: ld a,#TK_INTGR 
      001E62 81               [ 4] 5271 	ret 
                                   5272 
                                   5273 ;------------------------------
                                   5274 ; BASIC: AND(expr1,expr2)
                                   5275 ; Apply bit AND relation between
                                   5276 ; the 2 arguments, i.e expr1 & expr2 
                                   5277 ; output:
                                   5278 ; 	A 		TK_INTGR
                                   5279 ;   X 		result 
                                   5280 ;------------------------------
      001E63                       5281 bit_and:
      001E63 CD 11 D7         [ 4] 5282 	call func_args 
      001E66 A1 02            [ 1] 5283 	cp a,#2
      001E68 27 03            [ 1] 5284 	jreq 1$
      001E6A CC 07 14         [ 2] 5285 	jp syntax_error 
      001E6D CD 0F 93         [ 4] 5286 1$:	call dpop 
      001E70 89               [ 2] 5287 	pushw x 
      001E71 CD 0F 93         [ 4] 5288 	call dpop 
      001E74 9E               [ 1] 5289 	ld a,xh 
      001E75 14 01            [ 1] 5290 	and a,(1,sp)
      001E77 95               [ 1] 5291 	ld xh,a 
      001E78 9F               [ 1] 5292 	ld a,xl
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 102.
Hexadecimal [24-Bits]



      001E79 14 02            [ 1] 5293 	and a,(2,sp)
      001E7B 97               [ 1] 5294 	ld xl,a 
      001E7C                       5295 	_drop 2 
      001E7C 5B 02            [ 2]    1     addw sp,#2 
      001E7E A6 04            [ 1] 5296 	ld a,#TK_INTGR
      001E80 81               [ 4] 5297 	ret
                                   5298 
                                   5299 ;------------------------------
                                   5300 ; BASIC: OR(expr1,expr2)
                                   5301 ; Apply bit OR relation between
                                   5302 ; the 2 arguments, i.e expr1 | expr2 
                                   5303 ; output:
                                   5304 ; 	A 		TK_INTGR
                                   5305 ;   X 		result 
                                   5306 ;------------------------------
      001E81                       5307 bit_or:
      001E81 CD 11 D7         [ 4] 5308 	call func_args 
      001E84 A1 02            [ 1] 5309 	cp a,#2
      001E86 27 03            [ 1] 5310 	jreq 1$
      001E88 CC 07 14         [ 2] 5311 	jp syntax_error 
      001E8B                       5312 1$: 
      001E8B CD 0F 93         [ 4] 5313 	call dpop 
      001E8E 89               [ 2] 5314 	pushw x 
      001E8F CD 0F 93         [ 4] 5315 	call dpop 
      001E92 9E               [ 1] 5316 	ld a,xh 
      001E93 1A 01            [ 1] 5317 	or a,(1,sp)
      001E95 95               [ 1] 5318 	ld xh,a 
      001E96 9F               [ 1] 5319 	ld a,xl 
      001E97 1A 02            [ 1] 5320 	or a,(2,sp)
      001E99 97               [ 1] 5321 	ld xl,a 
      001E9A                       5322 	_drop 2 
      001E9A 5B 02            [ 2]    1     addw sp,#2 
      001E9C A6 04            [ 1] 5323 	ld a,#TK_INTGR 
      001E9E 81               [ 4] 5324 	ret
                                   5325 
                                   5326 ;------------------------------
                                   5327 ; BASIC: XOR(expr1,expr2)
                                   5328 ; Apply bit XOR relation between
                                   5329 ; the 2 arguments, i.e expr1 ^ expr2 
                                   5330 ; output:
                                   5331 ; 	A 		TK_INTGR
                                   5332 ;   X 		result 
                                   5333 ;------------------------------
      001E9F                       5334 bit_xor:
      001E9F CD 11 D7         [ 4] 5335 	call func_args 
      001EA2 A1 02            [ 1] 5336 	cp a,#2
      001EA4 27 03            [ 1] 5337 	jreq 1$
      001EA6 CC 07 14         [ 2] 5338 	jp syntax_error 
      001EA9                       5339 1$: 
      001EA9 CD 0F 93         [ 4] 5340 	call dpop 
      001EAC 89               [ 2] 5341 	pushw x 
      001EAD CD 0F 93         [ 4] 5342 	call dpop 
      001EB0 9E               [ 1] 5343 	ld a,xh 
      001EB1 18 01            [ 1] 5344 	xor a,(1,sp)
      001EB3 95               [ 1] 5345 	ld xh,a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 103.
Hexadecimal [24-Bits]



      001EB4 9F               [ 1] 5346 	ld a,xl 
      001EB5 18 02            [ 1] 5347 	xor a,(2,sp)
      001EB7 97               [ 1] 5348 	ld xl,a 
      001EB8                       5349 	_drop 2 
      001EB8 5B 02            [ 2]    1     addw sp,#2 
      001EBA A6 04            [ 1] 5350 	ld a,#TK_INTGR 
      001EBC 81               [ 4] 5351 	ret 
                                   5352 
                                   5353 ;------------------------------
                                   5354 ; BASIC: LSHIFT(expr1,expr2)
                                   5355 ; logical shift left expr1 by 
                                   5356 ; expr2 bits 
                                   5357 ; output:
                                   5358 ; 	A 		TK_INTGR
                                   5359 ;   X 		result 
                                   5360 ;------------------------------
      001EBD                       5361 lshift:
      001EBD CD 11 D7         [ 4] 5362 	call func_args
      001EC0 A1 02            [ 1] 5363 	cp a,#2 
      001EC2 27 03            [ 1] 5364 	jreq 1$
      001EC4 CC 07 14         [ 2] 5365 	jp syntax_error
      001EC7 CD 0F 93         [ 4] 5366 1$: call dpop  
      001ECA 51               [ 1] 5367 	exgw x,y 
      001ECB CD 0F 93         [ 4] 5368 	call dpop
      001ECE 90 5D            [ 2] 5369 	tnzw y 
      001ED0 27 05            [ 1] 5370 	jreq 4$
      001ED2 58               [ 2] 5371 2$:	sllw x 
      001ED3 90 5A            [ 2] 5372 	decw y 
      001ED5 26 FB            [ 1] 5373 	jrne 2$
      001ED7                       5374 4$:  
      001ED7 A6 04            [ 1] 5375 	ld a,#TK_INTGR
      001ED9 81               [ 4] 5376 	ret
                                   5377 
                                   5378 ;------------------------------
                                   5379 ; BASIC: RSHIFT(expr1,expr2)
                                   5380 ; logical shift right expr1 by 
                                   5381 ; expr2 bits.
                                   5382 ; output:
                                   5383 ; 	A 		TK_INTGR
                                   5384 ;   X 		result 
                                   5385 ;------------------------------
      001EDA                       5386 rshift:
      001EDA CD 11 D7         [ 4] 5387 	call func_args
      001EDD A1 02            [ 1] 5388 	cp a,#2 
      001EDF 27 03            [ 1] 5389 	jreq 1$
      001EE1 CC 07 14         [ 2] 5390 	jp syntax_error
      001EE4 CD 0F 93         [ 4] 5391 1$: call dpop  
      001EE7 51               [ 1] 5392 	exgw x,y 
      001EE8 CD 0F 93         [ 4] 5393 	call dpop
      001EEB 90 5D            [ 2] 5394 	tnzw y 
      001EED 27 05            [ 1] 5395 	jreq 4$
      001EEF 54               [ 2] 5396 2$:	srlw x 
      001EF0 90 5A            [ 2] 5397 	decw y 
      001EF2 26 FB            [ 1] 5398 	jrne 2$
      001EF4                       5399 4$:  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 104.
Hexadecimal [24-Bits]



      001EF4 A6 04            [ 1] 5400 	ld a,#TK_INTGR
      001EF6 81               [ 4] 5401 	ret
                                   5402 
                                   5403 ;--------------------------
                                   5404 ; BASIC: FCPU integer
                                   5405 ; set CPU frequency 
                                   5406 ;-------------------------- 
                                   5407 
      001EF7                       5408 fcpu:
      001EF7 A6 04            [ 1] 5409 	ld a,#TK_INTGR
      001EF9 CD 11 A6         [ 4] 5410 	call expect 
      001EFC 9F               [ 1] 5411 	ld a,xl 
      001EFD A4 07            [ 1] 5412 	and a,#7 
      001EFF C7 50 C6         [ 1] 5413 	ld CLK_CKDIVR,a 
      001F02 81               [ 4] 5414 	ret 
                                   5415 
                                   5416 ;------------------------------
                                   5417 ; BASIC: PMODE pin#, mode 
                                   5418 ; define pin as input or output
                                   5419 ; pin#: {0..15}
                                   5420 ; mode: INPUT|OUTPUT  
                                   5421 ;------------------------------
                           000001  5422 	PINNO=1
                           000001  5423 	VSIZE=1
      001F03                       5424 pin_mode:
      001F03                       5425 	_vars VSIZE 
      001F03 52 01            [ 2]    1     sub sp,#VSIZE 
      001F05 CD 11 B3         [ 4] 5426 	call arg_list 
      001F08 A1 02            [ 1] 5427 	cp a,#2 
      001F0A 27 03            [ 1] 5428 	jreq 1$
      001F0C CC 07 14         [ 2] 5429 	jp syntax_error 
      001F0F CD 0F 93         [ 4] 5430 1$: call dpop ; mode 
      001F12 51               [ 1] 5431 	exgw x,y 
      001F13 CD 0F 93         [ 4] 5432 	call dpop 
      001F16 58               [ 2] 5433 	sllw x 
      001F17 1C 1F 52         [ 2] 5434 	addw x,#arduino_to_8s208 
      001F1A FE               [ 2] 5435 	ldw x,(x) ; xh=port,xl=pin 
      001F1B 9F               [ 1] 5436 	ld a,xl 
      001F1C 6B 01            [ 1] 5437 	ld (PINNO,sp),a 
      001F1E 5E               [ 1] 5438 	swapw x 
      001F1F A6 05            [ 1] 5439 	ld a,#5 
      001F21 42               [ 4] 5440 	mul x,a 
      001F22 1C 50 00         [ 2] 5441 	addw x,#GPIO_BASE ; port base address 
      001F25 A6 01            [ 1] 5442 	ld a,#1 
      001F27 0D 01            [ 1] 5443 	tnz (PINNO,sp)
      001F29 27 0B            [ 1] 5444 	jreq 4$
      001F2B 48               [ 1] 5445 2$:	sll a 
      001F2C 0A 01            [ 1] 5446 	dec (PINNO,sp)
      001F2E 26 FB            [ 1] 5447 	jrne 2$ 
      001F30 6B 01            [ 1] 5448 	ld (PINNO,sp),a
      001F32 EA 03            [ 1] 5449 	or a,(GPIO_CR1,x) ;if input->pull-up else push-pull 
      001F34 E7 03            [ 1] 5450 	ld (GPIO_CR1,x),a 
      001F36 90 A3 00 01      [ 2] 5451 4$:	cpw y,#OUTP 
      001F3A 27 07            [ 1] 5452 	jreq 6$
                                   5453 ; input mode
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 105.
Hexadecimal [24-Bits]



      001F3C 7B 01            [ 1] 5454 	ld a,(PINNO,sp)
      001F3E 43               [ 1] 5455 	cpl a 
      001F3F E4 02            [ 1] 5456 	and a,(GPIO_DDR,x)	; bit==0 for input. 
      001F41 20 0A            [ 2] 5457 	jra 9$
      001F43                       5458 6$: ;output mode  
      001F43 7B 01            [ 1] 5459 	ld a,(PINNO,sp)
      001F45 EA 04            [ 1] 5460 	or a,(GPIO_CR2,x) ;port speed 10 Mhz 
      001F47 E7 04            [ 1] 5461 	ld (GPIO_CR2,x),a 
      001F49 7B 01            [ 1] 5462 	ld a,(PINNO,sp)
      001F4B EA 02            [ 1] 5463 	or a,(GPIO_DDR,x) ; bit==1 for output 
      001F4D E7 02            [ 1] 5464 9$:	ld (GPIO_DDR,x),a 
      001F4F                       5465 	_drop VSIZE 
      001F4F 5B 01            [ 2]    1     addw sp,#VSIZE 
      001F51 81               [ 4] 5466 	ret
                                   5467 ; translation from Arduino D0..D15 to stm8s208rb 
      001F52                       5468 arduino_to_8s208:
      001F52 03 06                 5469 .byte 3,6 ; D0 
      001F54 03 05                 5470 .byte 3,5 ; D1 
      001F56 04 00                 5471 .byte 4,0 ; D2 
      001F58 02 01                 5472 .byte 2,1 ; D3
      001F5A 06 00                 5473 .byte 6,0 ; D4
      001F5C 02 02                 5474 .byte 2,2 ; D5
      001F5E 02 03                 5475 .byte 2,3 ; D6
      001F60 03 01                 5476 .byte 3,1 ; D7
      001F62 03 03                 5477 .byte 3,3 ; D8
      001F64 02 04                 5478 .byte 2,4 ; D9
      001F66 04 05                 5479 .byte 4,5 ; D10
      001F68 02 06                 5480 .byte 2,6 ; D11
      001F6A 02 07                 5481 .byte 2,7 ; D12
      001F6C 02 05                 5482 .byte 2,5 ; D13
      001F6E 04 02                 5483 .byte 4,2 ; D14
      001F70 04 01                 5484 .byte 4,1 ; D15
                                   5485 
                                   5486 
                                   5487 ;------------------------------
                                   5488 ; BASIC: RND(expr)
                                   5489 ; return random number 
                                   5490 ; between 1 and expr inclusive
                                   5491 ; xorshift16 ref: http://b2d-f9r.blogspot.com/2010/08/16-bit-xorshift-rng-now-with-more.html
                                   5492 ; input:
                                   5493 ; 	none 
                                   5494 ; output:
                                   5495 ;	X 		random positive integer 
                                   5496 ;------------------------------
      001F72                       5497 random:
      001F72 CD 11 D7         [ 4] 5498 	call func_args 
      001F75 A1 01            [ 1] 5499 	cp a,#1
      001F77 27 03            [ 1] 5500 	jreq 1$
      001F79 CC 07 14         [ 2] 5501 	jp syntax_error
      001F7C                       5502 1$: 
      001F7C CD 0F 93         [ 4] 5503 	call dpop 
      001F7F 89               [ 2] 5504 	pushw x 
      001F80 9E               [ 1] 5505 	ld a,xh 
      001F81 A5 80            [ 1] 5506 	bcp a,#0x80 
      001F83 27 05            [ 1] 5507 	jreq 2$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 106.
Hexadecimal [24-Bits]



      001F85 A6 0A            [ 1] 5508 	ld a,#ERR_BAD_VALUE
      001F87 CC 07 16         [ 2] 5509 	jp tb_error
      001F8A                       5510 2$: 
                                   5511 ; acc16=(x<<5)^x 
      001F8A CE 00 0C         [ 2] 5512 	ldw x,seedx 
      001F8D 58               [ 2] 5513 	sllw x 
      001F8E 58               [ 2] 5514 	sllw x 
      001F8F 58               [ 2] 5515 	sllw x 
      001F90 58               [ 2] 5516 	sllw x 
      001F91 58               [ 2] 5517 	sllw x 
      001F92 9E               [ 1] 5518 	ld a,xh 
      001F93 C8 00 0C         [ 1] 5519 	xor a,seedx 
      001F96 C7 00 08         [ 1] 5520 	ld acc16,a 
      001F99 9F               [ 1] 5521 	ld a,xl 
      001F9A C8 00 0D         [ 1] 5522 	xor a,seedx+1 
      001F9D C7 00 09         [ 1] 5523 	ld acc8,a 
                                   5524 ; seedx=seedy 
      001FA0 CE 00 0E         [ 2] 5525 	ldw x,seedy 
      001FA3 CF 00 0C         [ 2] 5526 	ldw seedx,x  
                                   5527 ; seedy=seedy^(seedy>>1)
      001FA6 90 54            [ 2] 5528 	srlw y 
      001FA8 90 9E            [ 1] 5529 	ld a,yh 
      001FAA C8 00 0E         [ 1] 5530 	xor a,seedy 
      001FAD C7 00 0E         [ 1] 5531 	ld seedy,a  
      001FB0 90 9F            [ 1] 5532 	ld a,yl 
      001FB2 C8 00 0F         [ 1] 5533 	xor a,seedy+1 
      001FB5 C7 00 0F         [ 1] 5534 	ld seedy+1,a 
                                   5535 ; acc16>>3 
      001FB8 CE 00 08         [ 2] 5536 	ldw x,acc16 
      001FBB 54               [ 2] 5537 	srlw x 
      001FBC 54               [ 2] 5538 	srlw x 
      001FBD 54               [ 2] 5539 	srlw x 
                                   5540 ; x=acc16^x 
      001FBE 9E               [ 1] 5541 	ld a,xh 
      001FBF C8 00 08         [ 1] 5542 	xor a,acc16 
      001FC2 95               [ 1] 5543 	ld xh,a 
      001FC3 9F               [ 1] 5544 	ld a,xl 
      001FC4 C8 00 09         [ 1] 5545 	xor a,acc8 
      001FC7 97               [ 1] 5546 	ld xl,a 
                                   5547 ; seedy=x^seedy 
      001FC8 C8 00 0F         [ 1] 5548 	xor a,seedy+1
      001FCB 97               [ 1] 5549 	ld xl,a 
      001FCC 9E               [ 1] 5550 	ld a,xh 
      001FCD C8 00 0E         [ 1] 5551 	xor a,seedy
      001FD0 95               [ 1] 5552 	ld xh,a 
      001FD1 CF 00 0E         [ 2] 5553 	ldw seedy,x 
                                   5554 ; return seedy modulo expr + 1 
      001FD4 90 85            [ 2] 5555 	popw y 
      001FD6 65               [ 2] 5556 	divw x,y 
      001FD7 93               [ 1] 5557 	ldw x,y 
      001FD8 5C               [ 1] 5558 	incw x 
      001FD9 A6 04            [ 1] 5559 	ld a,#TK_INTGR
      001FDB 81               [ 4] 5560 	ret 
                                   5561 
                                   5562 ;---------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 107.
Hexadecimal [24-Bits]



                                   5563 ; BASIC: WORDS 
                                   5564 ; affiche la listes des mots du
                                   5565 ; dictionnaire.
                                   5566 ;---------------------------------
                           000001  5567 	WLEN=1
                           000002  5568 	LLEN=2  
                           000002  5569 	VSIZE=2 
      001FDC                       5570 words:
      001FDC                       5571 	_vars VSIZE
      001FDC 52 02            [ 2]    1     sub sp,#VSIZE 
      001FDE 0F 02            [ 1] 5572 	clr (LLEN,sp)
      001FE0 90 AE 22 73      [ 2] 5573 	ldw y,#kword_dict+2
      001FE4 93               [ 1] 5574 0$:	ldw x,y
      001FE5 F6               [ 1] 5575 	ld a,(x)
      001FE6 A4 0F            [ 1] 5576 	and a,#15 
      001FE8 6B 01            [ 1] 5577 	ld (WLEN,sp),a 
      001FEA 5C               [ 1] 5578 1$:	incw x 
      001FEB F6               [ 1] 5579 	ld a,(x)
      001FEC CD 01 A6         [ 4] 5580 	call putc 
      001FEF 0C 02            [ 1] 5581 	inc (LLEN,sp)
      001FF1 0A 01            [ 1] 5582 	dec (WLEN,sp)
      001FF3 26 F5            [ 1] 5583 	jrne 1$
      001FF5 A6 46            [ 1] 5584 	ld a,#70
      001FF7 11 02            [ 1] 5585 	cp a,(LLEN,sp)
      001FF9 2B 09            [ 1] 5586 	jrmi 2$   
      001FFB A6 20            [ 1] 5587 	ld a,#SPACE 
      001FFD CD 01 A6         [ 4] 5588 	call putc 
      002000 0C 02            [ 1] 5589 	inc (LLEN,sp) 
      002002 20 07            [ 2] 5590 	jra 3$
      002004 A6 0D            [ 1] 5591 2$: ld a,#CR 
      002006 CD 01 A6         [ 4] 5592 	call putc 
      002009 0F 02            [ 1] 5593 	clr (LLEN,sp)
      00200B 72 A2 00 02      [ 2] 5594 3$:	subw y,#2 
      00200F 90 FE            [ 2] 5595 	ldw y,(y)
      002011 26 D1            [ 1] 5596 	jrne 0$  
      002013                       5597 	_drop VSIZE 
      002013 5B 02            [ 2]    1     addw sp,#VSIZE 
      002015 81               [ 4] 5598 	ret 
                                   5599 
                                   5600 
                                   5601 ;*********************************
                                   5602 
                                   5603 ;------------------------------
                                   5604 ;      dictionary 
                                   5605 ; format:
                                   5606 ;   link:   2 bytes 
                                   5607 ;   name_length+flags:  1 byte, bits 0:4 lenght,5:8 flags  
                                   5608 ;   cmd_name: 16 byte max 
                                   5609 ;   code_address: 2 bytes 
                                   5610 ;------------------------------
                                   5611 	.macro _dict_entry len,name,cmd 
                                   5612 	.word LINK 
                                   5613 	LINK=.
                                   5614 name:
                                   5615 	.byte len 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 108.
Hexadecimal [24-Bits]



                                   5616 	.ascii "name"
                                   5617 	.word cmd 
                                   5618 	.endm 
                                   5619 
                           000000  5620 	LINK=0
      002016                       5621 kword_end:
      002016                       5622 	_dict_entry,3+F_IFUNC,XOR,bit_xor
      002016 00 00                    1 	.word LINK 
                           002018     2 	LINK=.
      002018                          3 XOR:
      002018 43                       4 	.byte 3+F_IFUNC 	
      002019 58 4F 52                 5 	.ascii "XOR"
      00201C 1E 9F                    6 	.word bit_xor 
      00201E                       5623 	_dict_entry,5,WRITE,write  
      00201E 20 18                    1 	.word LINK 
                           002020     2 	LINK=.
      002020                          3 WRITE:
      002020 05                       4 	.byte 5 	
      002021 57 52 49 54 45           5 	.ascii "WRITE"
      002026 1D 51                    6 	.word write 
      002028                       5624 	_dict_entry,5,WORDS,words 
      002028 20 20                    1 	.word LINK 
                           00202A     2 	LINK=.
      00202A                          3 WORDS:
      00202A 05                       4 	.byte 5 	
      00202B 57 4F 52 44 53           5 	.ascii "WORDS"
      002030 1F DC                    6 	.word words 
      002032                       5625 	_dict_entry 4,WAIT,wait 
      002032 20 2A                    1 	.word LINK 
                           002034     2 	LINK=.
      002034                          3 WAIT:
      002034 04                       4 	.byte 4 	
      002035 57 41 49 54              5 	.ascii "WAIT"
      002039 17 0D                    6 	.word wait 
      00203B                       5626 	_dict_entry,3+F_IFUNC,USR,usr
      00203B 20 34                    1 	.word LINK 
                           00203D     2 	LINK=.
      00203D                          3 USR:
      00203D 43                       4 	.byte 3+F_IFUNC 	
      00203E 55 53 52                 5 	.ascii "USR"
      002041 1E 02                    6 	.word usr 
      002043                       5627 	_dict_entry,6+F_IFUNC,UFLASH,uflash 
      002043 20 3D                    1 	.word LINK 
                           002045     2 	LINK=.
      002045                          3 UFLASH:
      002045 46                       4 	.byte 6+F_IFUNC 	
      002046 55 46 4C 41 53 48        5 	.ascii "UFLASH"
      00204C 1D FC                    6 	.word uflash 
      00204E                       5628 	_dict_entry,6+F_IFUNC,UBOUND,ubound 
      00204E 20 45                    1 	.word LINK 
                           002050     2 	LINK=.
      002050                          3 UBOUND:
      002050 46                       4 	.byte 6+F_IFUNC 	
      002051 55 42 4F 55 4E 44        5 	.ascii "UBOUND"
      002057 13 74                    6 	.word ubound 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 109.
Hexadecimal [24-Bits]



      002059                       5629 	_dict_entry,2,TO,to
      002059 20 50                    1 	.word LINK 
                           00205B     2 	LINK=.
      00205B                          3 TO:
      00205B 02                       4 	.byte 2 	
      00205C 54 4F                    5 	.ascii "TO"
      00205E 18 04                    6 	.word to 
      002060                       5630 	_dict_entry,5+F_IFUNC,TICKS,get_ticks
      002060 20 5B                    1 	.word LINK 
                           002062     2 	LINK=.
      002062                          3 TICKS:
      002062 45                       4 	.byte 5+F_IFUNC 	
      002063 54 49 43 4B 53           5 	.ascii "TICKS"
      002068 1E 47                    6 	.word get_ticks 
      00206A                       5631 	_dict_entry,4,STOP,stop 
      00206A 20 62                    1 	.word LINK 
                           00206C     2 	LINK=.
      00206C                          3 STOP:
      00206C 04                       4 	.byte 4 	
      00206D 53 54 4F 50              5 	.ascii "STOP"
      002071 19 80                    6 	.word stop 
      002073                       5632 	_dict_entry,4,STEP,step 
      002073 20 6C                    1 	.word LINK 
                           002075     2 	LINK=.
      002075                          3 STEP:
      002075 04                       4 	.byte 4 	
      002076 53 54 45 50              5 	.ascii "STEP"
      00207A 18 34                    6 	.word step 
      00207C                       5633 	_dict_entry,5,SLEEP,sleep 
      00207C 20 75                    1 	.word LINK 
                           00207E     2 	LINK=.
      00207E                          3 SLEEP:
      00207E 05                       4 	.byte 5 	
      00207F 53 4C 45 45 50           5 	.ascii "SLEEP"
      002084 1E 29                    6 	.word sleep 
      002086                       5634 	_dict_entry,4+F_IFUNC,SIZE,size
      002086 20 7E                    1 	.word LINK 
                           002088     2 	LINK=.
      002088                          3 SIZE:
      002088 44                       4 	.byte 4+F_IFUNC 	
      002089 53 49 5A 45              5 	.ascii "SIZE"
      00208D 13 6A                    6 	.word size 
      00208F                       5635     _dict_entry,4,SHOW,show 
      00208F 20 88                    1 	.word LINK 
                           002091     2 	LINK=.
      002091                          3 SHOW:
      002091 04                       4 	.byte 4 	
      002092 53 48 4F 57              5 	.ascii "SHOW"
      002096 13 50                    6 	.word show 
      002098                       5636 	_dict_entry,4,SAVE,save
      002098 20 91                    1 	.word LINK 
                           00209A     2 	LINK=.
      00209A                          3 SAVE:
      00209A 04                       4 	.byte 4 	
      00209B 53 41 56 45              5 	.ascii "SAVE"
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 110.
Hexadecimal [24-Bits]



      00209F 1B 44                    6 	.word save 
      0020A1                       5637 	_dict_entry 3,RUN,run
      0020A1 20 9A                    1 	.word LINK 
                           0020A3     2 	LINK=.
      0020A3                          3 RUN:
      0020A3 03                       4 	.byte 3 	
      0020A4 52 55 4E                 5 	.ascii "RUN"
      0020A7 19 3D                    6 	.word run 
      0020A9                       5638 	_dict_entry,6+F_IFUNC,RSHIFT,rshift
      0020A9 20 A3                    1 	.word LINK 
                           0020AB     2 	LINK=.
      0020AB                          3 RSHIFT:
      0020AB 46                       4 	.byte 6+F_IFUNC 	
      0020AC 52 53 48 49 46 54        5 	.ascii "RSHIFT"
      0020B2 1E DA                    6 	.word rshift 
      0020B4                       5639 	_dict_entry,3+F_IFUNC,RND,random 
      0020B4 20 AB                    1 	.word LINK 
                           0020B6     2 	LINK=.
      0020B6                          3 RND:
      0020B6 43                       4 	.byte 3+F_IFUNC 	
      0020B7 52 4E 44                 5 	.ascii "RND"
      0020BA 1F 72                    6 	.word random 
      0020BC                       5640 	_dict_entry,6,RETURN,return 
      0020BC 20 B6                    1 	.word LINK 
                           0020BE     2 	LINK=.
      0020BE                          3 RETURN:
      0020BE 06                       4 	.byte 6 	
      0020BF 52 45 54 55 52 4E        5 	.ascii "RETURN"
      0020C5 19 1D                    6 	.word return 
      0020C7                       5641 	_dict_entry 6,REMARK,rem 
      0020C7 20 BE                    1 	.word LINK 
                           0020C9     2 	LINK=.
      0020C9                          3 REMARK:
      0020C9 06                       4 	.byte 6 	
      0020CA 52 45 4D 41 52 4B        5 	.ascii "REMARK"
      0020D0 17 07                    6 	.word rem 
      0020D2                       5642 	_dict_entry,6,REBOOT,cold_start 
      0020D2 20 C9                    1 	.word LINK 
                           0020D4     2 	LINK=.
      0020D4                          3 REBOOT:
      0020D4 06                       4 	.byte 6 	
      0020D5 52 45 42 4F 4F 54        5 	.ascii "REBOOT"
      0020DB 05 54                    6 	.word cold_start 
      0020DD                       5643 	_dict_entry,4+F_IFUNC,QKEY,qkey  
      0020DD 20 D4                    1 	.word LINK 
                           0020DF     2 	LINK=.
      0020DF                          3 QKEY:
      0020DF 44                       4 	.byte 4+F_IFUNC 	
      0020E0 51 4B 45 59              5 	.ascii "QKEY"
      0020E4 1D BF                    6 	.word qkey 
      0020E6                       5644 	_dict_entry,6,PWRADC,power_adc 
      0020E6 20 DF                    1 	.word LINK 
                           0020E8     2 	LINK=.
      0020E8                          3 PWRADC:
      0020E8 06                       4 	.byte 6 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 111.
Hexadecimal [24-Bits]



      0020E9 50 57 52 41 44 43        5 	.ascii "PWRADC"
      0020EF 19 B7                    6 	.word power_adc 
      0020F1                       5645 	_dict_entry 5,PRINT,print 
      0020F1 20 E8                    1 	.word LINK 
                           0020F3     2 	LINK=.
      0020F3                          3 PRINT:
      0020F3 05                       4 	.byte 5 	
      0020F4 50 52 49 4E 54           5 	.ascii "PRINT"
      0020F9 16 02                    6 	.word print 
      0020FB                       5646 	_dict_entry,4+F_CONST,POUT,OUTP 
      0020FB 20 F3                    1 	.word LINK 
                           0020FD     2 	LINK=.
      0020FD                          3 POUT:
      0020FD C4                       4 	.byte 4+F_CONST 	
      0020FE 50 4F 55 54              5 	.ascii "POUT"
      002102 00 01                    6 	.word OUTP 
      002104                       5647 	_dict_entry,4,POKE,poke 
      002104 20 FD                    1 	.word LINK 
                           002106     2 	LINK=.
      002106                          3 POKE:
      002106 04                       4 	.byte 4 	
      002107 50 4F 4B 45              5 	.ascii "POKE"
      00210B 17 A0                    6 	.word poke 
      00210D                       5648 	_dict_entry,4+F_CONST,PINP,INP 
      00210D 21 06                    1 	.word LINK 
                           00210F     2 	LINK=.
      00210F                          3 PINP:
      00210F C4                       4 	.byte 4+F_CONST 	
      002110 50 49 4E 50              5 	.ascii "PINP"
      002114 00 00                    6 	.word INP 
      002116                       5649 	_dict_entry,4+F_IFUNC,PEEK,peek 
      002116 21 0F                    1 	.word LINK 
                           002118     2 	LINK=.
      002118                          3 PEEK:
      002118 44                       4 	.byte 4+F_IFUNC 	
      002119 50 45 45 4B              5 	.ascii "PEEK"
      00211D 17 B3                    6 	.word peek 
      00211F                       5650 	_dict_entry,5,PMODE,pin_mode 
      00211F 21 18                    1 	.word LINK 
                           002121     2 	LINK=.
      002121                          3 PMODE:
      002121 05                       4 	.byte 5 	
      002122 50 4D 4F 44 45           5 	.ascii "PMODE"
      002127 1F 03                    6 	.word pin_mode 
      002129                       5651 	_dict_entry,5,PAUSE,pause 
      002129 21 21                    1 	.word LINK 
                           00212B     2 	LINK=.
      00212B                          3 PAUSE:
      00212B 05                       4 	.byte 5 	
      00212C 50 41 55 53 45           5 	.ascii "PAUSE"
      002131 1E 34                    6 	.word pause 
      002133                       5652 	_dict_entry,2+F_IFUNC,OR,bit_or
      002133 21 2B                    1 	.word LINK 
                           002135     2 	LINK=.
      002135                          3 OR:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 112.
Hexadecimal [24-Bits]



      002135 42                       4 	.byte 2+F_IFUNC 	
      002136 4F 52                    5 	.ascii "OR"
      002138 1E 81                    6 	.word bit_or 
      00213A                       5653 	_dict_entry,3+F_CONST,ODR,GPIO_ODR
      00213A 21 35                    1 	.word LINK 
                           00213C     2 	LINK=.
      00213C                          3 ODR:
      00213C C3                       4 	.byte 3+F_CONST 	
      00213D 4F 44 52                 5 	.ascii "ODR"
      002140 00 00                    6 	.word GPIO_ODR 
      002142                       5654 	_dict_entry,3,NEW,new
      002142 21 3C                    1 	.word LINK 
                           002144     2 	LINK=.
      002144                          3 NEW:
      002144 03                       4 	.byte 3 	
      002145 4E 45 57                 5 	.ascii "NEW"
      002148 1A 82                    6 	.word new 
      00214A                       5655 	_dict_entry,4,NEXT,next 
      00214A 21 44                    1 	.word LINK 
                           00214C     2 	LINK=.
      00214C                          3 NEXT:
      00214C 04                       4 	.byte 4 	
      00214D 4E 45 58 54              5 	.ascii "NEXT"
      002151 18 5C                    6 	.word next 
      002153                       5656 	_dict_entry,6+F_IFUNC,LSHIFT,lshift
      002153 21 4C                    1 	.word LINK 
                           002155     2 	LINK=.
      002155                          3 LSHIFT:
      002155 46                       4 	.byte 6+F_IFUNC 	
      002156 4C 53 48 49 46 54        5 	.ascii "LSHIFT"
      00215C 1E BD                    6 	.word lshift 
      00215E                       5657 	_dict_entry,4,LOAD,load 
      00215E 21 55                    1 	.word LINK 
                           002160     2 	LINK=.
      002160                          3 LOAD:
      002160 04                       4 	.byte 4 	
      002161 4C 4F 41 44              5 	.ascii "LOAD"
      002165 1C 08                    6 	.word load 
      002167                       5658 	_dict_entry 4,LIST,list
      002167 21 60                    1 	.word LINK 
                           002169     2 	LINK=.
      002169                          3 LIST:
      002169 04                       4 	.byte 4 	
      00216A 4C 49 53 54              5 	.ascii "LIST"
      00216E 13 BE                    6 	.word list 
      002170                       5659 	_dict_entry 3,LET,let 
      002170 21 69                    1 	.word LINK 
                           002172     2 	LINK=.
      002172                          3 LET:
      002172 03                       4 	.byte 3 	
      002173 4C 45 54                 5 	.ascii "LET"
      002176 13 96                    6 	.word let 
      002178                       5660 	_dict_entry,3+F_IFUNC,KEY,key 
      002178 21 72                    1 	.word LINK 
                           00217A     2 	LINK=.
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 113.
Hexadecimal [24-Bits]



      00217A                          3 KEY:
      00217A 43                       4 	.byte 3+F_IFUNC 	
      00217B 4B 45 59                 5 	.ascii "KEY"
      00217E 1D B7                    6 	.word key 
      002180                       5661 	_dict_entry,5,INPUT,input_var  
      002180 21 7A                    1 	.word LINK 
                           002182     2 	LINK=.
      002182                          3 INPUT:
      002182 05                       4 	.byte 5 	
      002183 49 4E 50 55 54           5 	.ascii "INPUT"
      002188 16 93                    6 	.word input_var 
      00218A                       5662 	_dict_entry,2,IF,if 
      00218A 21 82                    1 	.word LINK 
                           00218C     2 	LINK=.
      00218C                          3 IF:
      00218C 02                       4 	.byte 2 	
      00218D 49 46                    5 	.ascii "IF"
      00218F 17 C6                    6 	.word if 
      002191                       5663 	_dict_entry,3+F_CONST,IDR,GPIO_IDR
      002191 21 8C                    1 	.word LINK 
                           002193     2 	LINK=.
      002193                          3 IDR:
      002193 C3                       4 	.byte 3+F_CONST 	
      002194 49 44 52                 5 	.ascii "IDR"
      002197 00 01                    6 	.word GPIO_IDR 
      002199                       5664 	_dict_entry,3,HEX,hex_base
      002199 21 93                    1 	.word LINK 
                           00219B     2 	LINK=.
      00219B                          3 HEX:
      00219B 03                       4 	.byte 3 	
      00219C 48 45 58                 5 	.ascii "HEX"
      00219F 13 60                    6 	.word hex_base 
      0021A1                       5665 	_dict_entry,4+F_IFUNC,GPIO,gpio 
      0021A1 21 9B                    1 	.word LINK 
                           0021A3     2 	LINK=.
      0021A3                          3 GPIO:
      0021A3 44                       4 	.byte 4+F_IFUNC 	
      0021A4 47 50 49 4F              5 	.ascii "GPIO"
      0021A8 1D C9                    6 	.word gpio 
      0021AA                       5666 	_dict_entry,4,GOTO,goto 
      0021AA 21 A3                    1 	.word LINK 
                           0021AC     2 	LINK=.
      0021AC                          3 GOTO:
      0021AC 04                       4 	.byte 4 	
      0021AD 47 4F 54 4F              5 	.ascii "GOTO"
      0021B1 18 CB                    6 	.word goto 
      0021B3                       5667 	_dict_entry,5,GOSUB,gosub 
      0021B3 21 AC                    1 	.word LINK 
                           0021B5     2 	LINK=.
      0021B5                          3 GOSUB:
      0021B5 05                       4 	.byte 5 	
      0021B6 47 4F 53 55 42           5 	.ascii "GOSUB"
      0021BB 18 D8                    6 	.word gosub 
      0021BD                       5668 	_dict_entry,6,FORGET,forget 
      0021BD 21 B5                    1 	.word LINK 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 114.
Hexadecimal [24-Bits]



                           0021BF     2 	LINK=.
      0021BF                          3 FORGET:
      0021BF 06                       4 	.byte 6 	
      0021C0 46 4F 52 47 45 54        5 	.ascii "FORGET"
      0021C6 1C 70                    6 	.word forget 
      0021C8                       5669 	_dict_entry,3,FOR,for 
      0021C8 21 BF                    1 	.word LINK 
                           0021CA     2 	LINK=.
      0021CA                          3 FOR:
      0021CA 03                       4 	.byte 3 	
      0021CB 46 4F 52                 5 	.ascii "FOR"
      0021CE 17 DA                    6 	.word for 
      0021D0                       5670 	_dict_entry,4,FCPU,fcpu 
      0021D0 21 CA                    1 	.word LINK 
                           0021D2     2 	LINK=.
      0021D2                          3 FCPU:
      0021D2 04                       4 	.byte 4 	
      0021D3 46 43 50 55              5 	.ascii "FCPU"
      0021D7 1E F7                    6 	.word fcpu 
      0021D9                       5671 	_dict_entry,6+F_CONST,EEPROM,EEPROM_BASE  
      0021D9 21 D2                    1 	.word LINK 
                           0021DB     2 	LINK=.
      0021DB                          3 EEPROM:
      0021DB C6                       4 	.byte 6+F_CONST 	
      0021DC 45 45 50 52 4F 4D        5 	.ascii "EEPROM"
      0021E2 40 00                    6 	.word EEPROM_BASE 
      0021E4                       5672 	_dict_entry,3,DIR,directory 
      0021E4 21 DB                    1 	.word LINK 
                           0021E6     2 	LINK=.
      0021E6                          3 DIR:
      0021E6 03                       4 	.byte 3 	
      0021E7 44 49 52                 5 	.ascii "DIR"
      0021EA 1C BB                    6 	.word directory 
      0021EC                       5673 	_dict_entry,3,DEC,dec_base
      0021EC 21 E6                    1 	.word LINK 
                           0021EE     2 	LINK=.
      0021EE                          3 DEC:
      0021EE 03                       4 	.byte 3 	
      0021EF 44 45 43                 5 	.ascii "DEC"
      0021F2 13 65                    6 	.word dec_base 
      0021F4                       5674 	_dict_entry,3+F_CONST,DDR,GPIO_DDR
      0021F4 21 EE                    1 	.word LINK 
                           0021F6     2 	LINK=.
      0021F6                          3 DDR:
      0021F6 C3                       4 	.byte 3+F_CONST 	
      0021F7 44 44 52                 5 	.ascii "DDR"
      0021FA 00 02                    6 	.word GPIO_DDR 
      0021FC                       5675 	_dict_entry,3+F_CONST,CRL,GPIO_CR1
      0021FC 21 F6                    1 	.word LINK 
                           0021FE     2 	LINK=.
      0021FE                          3 CRL:
      0021FE C3                       4 	.byte 3+F_CONST 	
      0021FF 43 52 4C                 5 	.ascii "CRL"
      002202 00 03                    6 	.word GPIO_CR1 
      002204                       5676 	_dict_entry,3+F_CONST,CRH,GPIO_CR2
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 115.
Hexadecimal [24-Bits]



      002204 21 FE                    1 	.word LINK 
                           002206     2 	LINK=.
      002206                          3 CRH:
      002206 C3                       4 	.byte 3+F_CONST 	
      002207 43 52 48                 5 	.ascii "CRH"
      00220A 00 04                    6 	.word GPIO_CR2 
      00220C                       5677 	_dict_entry,4+F_CFUNC,CHAR,char
      00220C 22 06                    1 	.word LINK 
                           00220E     2 	LINK=.
      00220E                          3 CHAR:
      00220E 84                       4 	.byte 4+F_CFUNC 	
      00220F 43 48 41 52              5 	.ascii "CHAR"
      002213 1D 88                    6 	.word char 
      002215                       5678 	_dict_entry,3,BYE,bye 
      002215 22 0E                    1 	.word LINK 
                           002217     2 	LINK=.
      002217                          3 BYE:
      002217 03                       4 	.byte 3 	
      002218 42 59 45                 5 	.ascii "BYE"
      00221B 1E 20                    6 	.word bye 
      00221D                       5679 	_dict_entry,5,BTOGL,bit_toggle
      00221D 22 17                    1 	.word LINK 
                           00221F     2 	LINK=.
      00221F                          3 BTOGL:
      00221F 05                       4 	.byte 5 	
      002220 42 54 4F 47 4C           5 	.ascii "BTOGL"
      002225 17 61                    6 	.word bit_toggle 
      002227                       5680 	_dict_entry,5+F_IFUNC,BTEST,bit_test 
      002227 22 1F                    1 	.word LINK 
                           002229     2 	LINK=.
      002229                          3 BTEST:
      002229 45                       4 	.byte 5+F_IFUNC 	
      00222A 42 54 45 53 54           5 	.ascii "BTEST"
      00222F 17 75                    6 	.word bit_test 
      002231                       5681 	_dict_entry,4,BSET,bit_set 
      002231 22 29                    1 	.word LINK 
                           002233     2 	LINK=.
      002233                          3 BSET:
      002233 04                       4 	.byte 4 	
      002234 42 53 45 54              5 	.ascii "BSET"
      002238 17 38                    6 	.word bit_set 
      00223A                       5682 	_dict_entry,4,BRES,bit_reset
      00223A 22 33                    1 	.word LINK 
                           00223C     2 	LINK=.
      00223C                          3 BRES:
      00223C 04                       4 	.byte 4 	
      00223D 42 52 45 53              5 	.ascii "BRES"
      002241 17 4C                    6 	.word bit_reset 
      002243                       5683 	_dict_entry,5,BREAK,break 
      002243 22 3C                    1 	.word LINK 
                           002245     2 	LINK=.
      002245                          3 BREAK:
      002245 05                       4 	.byte 5 	
      002246 42 52 45 41 4B           5 	.ascii "BREAK"
      00224B 1A 36                    6 	.word break 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 116.
Hexadecimal [24-Bits]



      00224D                       5684 	_dict_entry,4,BEEP,beep 
      00224D 22 45                    1 	.word LINK 
                           00224F     2 	LINK=.
      00224F                          3 BEEP:
      00224F 04                       4 	.byte 4 	
      002250 42 45 45 50              5 	.ascii "BEEP"
      002254 19 8F                    6 	.word beep 
      002256                       5685 	_dict_entry,3+F_IFUNC,ASC,ascii
      002256 22 4F                    1 	.word LINK 
                           002258     2 	LINK=.
      002258                          3 ASC:
      002258 43                       4 	.byte 3+F_IFUNC 	
      002259 41 53 43                 5 	.ascii "ASC"
      00225C 1D 9C                    6 	.word ascii 
      00225E                       5686 	_dict_entry,6+F_IFUNC,ANREAD,analog_read
      00225E 22 58                    1 	.word LINK 
                           002260     2 	LINK=.
      002260                          3 ANREAD:
      002260 46                       4 	.byte 6+F_IFUNC 	
      002261 41 4E 52 45 41 44        5 	.ascii "ANREAD"
      002267 1A 00                    6 	.word analog_read 
      002269                       5687 	_dict_entry,3+F_IFUNC,AND,bit_and
      002269 22 60                    1 	.word LINK 
                           00226B     2 	LINK=.
      00226B                          3 AND:
      00226B 43                       4 	.byte 3+F_IFUNC 	
      00226C 41 4E 44                 5 	.ascii "AND"
      00226F 1E 63                    6 	.word bit_and 
      002271                       5688 kword_dict:
      002271                       5689 	_dict_entry,3+F_IFUNC,ABS,abs
      002271 22 6B                    1 	.word LINK 
                           002273     2 	LINK=.
      002273                          3 ABS:
      002273 43                       4 	.byte 3+F_IFUNC 	
      002274 41 42 53                 5 	.ascii "ABS"
      002277 1E 4D                    6 	.word abs 
                                   5690 	
                                   5691 
      002280                       5692 	.bndry 128 ; align on FLASH block.
                                   5693 ; free space for user application  
      002280                       5694 user_space:
                                   5695 ; USR() function test
      002280 89               [ 2] 5696 	pushw x 
      002281 72 1A 50 0A      [ 1] 5697 	bset PC_ODR,#5 
      002285 85               [ 2] 5698 	popw x 
      002286 CD 1E 3E         [ 4] 5699 	call pause02 
      002289 72 1B 50 0A      [ 1] 5700 	bres PC_ODR,#5 
      00228D 81               [ 4] 5701 	ret
                                   5702 
                                   5703 	.area FLASH_DRIVE (ABS)
      010000                       5704 	.org 0x10000
      010000                       5705 fdrive:
                                   5706 ;.byte 0,0,0,0
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 117.
Hexadecimal [24-Bits]

Symbol Table

    .__.$$$.=  002710 L   |     .__.ABS.=  000000 G   |     .__.CPU.=  000000 L
    .__.H$L.=  000001 L   |   5 ABS        002273 R   |     ADC_CR1 =  005401 
    ADC_CR1_=  000000     |     ADC_CR1_=  000001     |     ADC_CR1_=  000004 
    ADC_CR1_=  000005     |     ADC_CR1_=  000006     |     ADC_CR2 =  005402 
    ADC_CR2_=  000003     |     ADC_CR2_=  000004     |     ADC_CR2_=  000005 
    ADC_CR2_=  000006     |     ADC_CR2_=  000001     |     ADC_CR3 =  005403 
    ADC_CR3_=  000007     |     ADC_CR3_=  000006     |     ADC_CSR =  005400 
    ADC_CSR_=  000006     |     ADC_CSR_=  000004     |     ADC_CSR_=  000000 
    ADC_CSR_=  000001     |     ADC_CSR_=  000002     |     ADC_CSR_=  000003 
    ADC_CSR_=  000007     |     ADC_CSR_=  000005     |     ADC_DRH =  005404 
    ADC_DRL =  005405     |     ADC_TDRH=  005406     |     ADC_TDRL=  005407 
    ADDR    =  000001     |     ADD_SPAC=  000003     |     AFR     =  004803 
    AFR0_ADC=  000000     |     AFR1_TIM=  000001     |     AFR2_CCO=  000002 
    AFR3_TIM=  000003     |     AFR4_TIM=  000004     |     AFR5_TIM=  000005 
    AFR6_I2C=  000006     |     AFR7_BEE=  000007     |   5 AND        00226B R
  5 ANREAD     002260 R   |     ARG_CNT =  000001     |     ARG_OFS =  000002 
  5 ASC        002258 R   |     ATTRIB  =  000002     |     AWU_APR =  0050F1 
    AWU_CSR =  0050F0     |     AWU_TBR =  0050F2     |     B0_MASK =  000001 
    B115200 =  000006     |     B19200  =  000003     |     B1_MASK =  000002 
    B230400 =  000007     |     B2400   =  000000     |     B2_MASK =  000004 
    B38400  =  000004     |     B3_MASK =  000008     |     B460800 =  000008 
    B4800   =  000001     |     B4_MASK =  000010     |     B57600  =  000005 
    B5_MASK =  000020     |     B6_MASK =  000040     |     B7_MASK =  000080 
    B921600 =  000009     |     B9600   =  000002     |     BASE    =  000002 
    BASE_SAV=  000001     |   5 BEEP       00224F R   |     BEEP_BIT=  000004 
    BEEP_CSR=  0050F3     |     BEEP_MAS=  000010     |     BEEP_POR=  00000F 
    BELL    =  000007     |     BINARY  =  000001     |     BIT0    =  000000 
    BIT1    =  000001     |     BIT2    =  000002     |     BIT3    =  000003 
    BIT4    =  000004     |     BIT5    =  000005     |     BIT6    =  000006 
    BIT7    =  000007     |     BLOCK_ER=  000000     |     BLOCK_SI=  000080 
    BOOT_ROM=  006000     |     BOOT_ROM=  007FFF     |     BPTR    =  000005 
  5 BREAK      002245 R   |   5 BRES       00223C R   |   5 BSET       002233 R
    BSIZE   =  000001     |     BSP     =  000008     |   5 BTEST      002229 R
  5 BTOGL      00221F R   |     BTW     =  000001     |     BUFIDX  =  000003 
  5 BYE        002217 R   |     C       =  000001     |     CAN_DGR =  005426 
    CAN_FPSR=  005427     |     CAN_IER =  005425     |     CAN_MCR =  005420 
    CAN_MSR =  005421     |     CAN_P0  =  005428     |     CAN_P1  =  005429 
    CAN_P2  =  00542A     |     CAN_P3  =  00542B     |     CAN_P4  =  00542C 
    CAN_P5  =  00542D     |     CAN_P6  =  00542E     |     CAN_P7  =  00542F 
    CAN_P8  =  005430     |     CAN_P9  =  005431     |     CAN_PA  =  005432 
    CAN_PB  =  005433     |     CAN_PC  =  005434     |     CAN_PD  =  005435 
    CAN_PE  =  005436     |     CAN_PF  =  005437     |     CAN_RFR =  005424 
    CAN_TPR =  005423     |     CAN_TSR =  005422     |     CC_C    =  000000 
    CC_H    =  000004     |     CC_I0   =  000003     |     CC_I1   =  000005 
    CC_N    =  000002     |     CC_V    =  000007     |     CC_Z    =  000001 
    CELL_SIZ=  000002     |     CFG_GCR =  007F60     |     CFG_GCR_=  000001 
    CFG_GCR_=  000000     |   5 CHAR       00220E R   |     CLKOPT  =  004807 
    CLKOPT_C=  000002     |     CLKOPT_E=  000003     |     CLKOPT_P=  000000 
    CLKOPT_P=  000001     |     CLK_CCOR=  0050C9     |     CLK_CKDI=  0050C6 
    CLK_CKDI=  000000     |     CLK_CKDI=  000001     |     CLK_CKDI=  000002 
    CLK_CKDI=  000003     |     CLK_CKDI=  000004     |     CLK_CMSR=  0050C3 
    CLK_CSSR=  0050C8     |     CLK_ECKR=  0050C1     |     CLK_ECKR=  000000 
    CLK_ECKR=  000001     |     CLK_HSIT=  0050CC     |     CLK_ICKR=  0050C0 
    CLK_ICKR=  000002     |     CLK_ICKR=  000000     |     CLK_ICKR=  000001 
    CLK_ICKR=  000003     |     CLK_ICKR=  000004     |     CLK_ICKR=  000005 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 118.
Hexadecimal [24-Bits]

Symbol Table

    CLK_PCKE=  0050C7     |     CLK_PCKE=  000000     |     CLK_PCKE=  000001 
    CLK_PCKE=  000007     |     CLK_PCKE=  000005     |     CLK_PCKE=  000006 
    CLK_PCKE=  000004     |     CLK_PCKE=  000002     |     CLK_PCKE=  000003 
    CLK_PCKE=  0050CA     |     CLK_PCKE=  000003     |     CLK_PCKE=  000002 
    CLK_PCKE=  000007     |     CLK_SWCR=  0050C5     |     CLK_SWCR=  000000 
    CLK_SWCR=  000001     |     CLK_SWCR=  000002     |     CLK_SWCR=  000003 
    CLK_SWIM=  0050CD     |     CLK_SWR =  0050C4     |     CLK_SWR_=  0000B4 
    CLK_SWR_=  0000E1     |     CLK_SWR_=  0000D2     |     CMD_END =  000002 
    CNT     =  000008     |     COMMA   =  000001     |     COUNT   =  000001 
    CPU_A   =  007F00     |     CPU_CCR =  007F0A     |     CPU_PCE =  007F01 
    CPU_PCH =  007F02     |     CPU_PCL =  007F03     |     CPU_SPH =  007F08 
    CPU_SPL =  007F09     |     CPU_XH  =  007F04     |     CPU_XL  =  007F05 
    CPU_YH  =  007F06     |     CPU_YL  =  007F07     |     CR      =  00000D 
  5 CRH        002206 R   |   5 CRL        0021FE R   |     CTRL_A  =  000001 
    CTRL_B  =  000002     |     CTRL_C  =  000003     |     CTRL_D  =  000004 
    CTRL_E  =  000005     |     CTRL_F  =  000006     |     CTRL_G  =  000007 
    CTRL_H  =  000008     |     CTRL_I  =  000009     |     CTRL_J  =  00000A 
    CTRL_K  =  00000B     |     CTRL_L  =  00000C     |     CTRL_M  =  00000D 
    CTRL_N  =  00000E     |     CTRL_O  =  00000F     |     CTRL_P  =  000010 
    CTRL_Q  =  000011     |     CTRL_R  =  000012     |     CTRL_S  =  000013 
    CTRL_T  =  000014     |     CTRL_U  =  000015     |     CTRL_V  =  000016 
    CTRL_W  =  000017     |     CTRL_X  =  000018     |     CTRL_Y  =  000019 
    CTRL_Z  =  00001A     |     CTXT_SIZ=  000006     |     CURR    =  000002 
    CX_BPTR =  000001     |     CX_CNT  =  000005     |     CX_IN   =  000004 
    CX_LNO  =  000003     |     DBG_A   =  000005     |     DBG_CC  =  000006 
    DBG_X   =  000003     |     DBG_Y   =  000001     |   5 DDR        0021F6 R
    DEBUG   =  000001     |     DEBUG_BA=  007F00     |     DEBUG_EN=  007FFF 
  5 DEC        0021EE R   |     DEST    =  000001     |     DEVID_BA=  0048CD 
    DEVID_EN=  0048D8     |     DEVID_LO=  0048D2     |     DEVID_LO=  0048D3 
    DEVID_LO=  0048D4     |     DEVID_LO=  0048D5     |     DEVID_LO=  0048D6 
    DEVID_LO=  0048D7     |     DEVID_LO=  0048D8     |     DEVID_WA=  0048D1 
    DEVID_XH=  0048CE     |     DEVID_XL=  0048CD     |     DEVID_YH=  0048D0 
    DEVID_YL=  0048CF     |   5 DIR        0021E6 R   |     DIVIDND =  000007 
    DIVISR  =  000005     |     DM_BK1RE=  007F90     |     DM_BK1RH=  007F91 
    DM_BK1RL=  007F92     |     DM_BK2RE=  007F93     |     DM_BK2RH=  007F94 
    DM_BK2RL=  007F95     |     DM_CR1  =  007F96     |     DM_CR2  =  007F97 
    DM_CSR1 =  007F98     |     DM_CSR2 =  007F99     |     DM_ENFCT=  007F9A 
    DSTACK_S=  000040     |   5 EEPROM     0021DB R   |     EEPROM_B=  004000 
    EEPROM_E=  0047FF     |     EEPROM_S=  000800     |     EOF     =  0000FF 
    ERR_BAD_=  00000A     |     ERR_CMD_=  000007     |     ERR_DIV0=  000004 
    ERR_DUPL=  000008     |     ERR_MATH=  000003     |     ERR_MEM_=  000001 
    ERR_NONE=  000000     |     ERR_NOT_=  000009     |     ERR_NO_A=  00000B 
    ERR_NO_L=  000005     |     ERR_RUN_=  000006     |     ERR_SYNT=  000002 
    ESC     =  00001B     |     EXTI_CR1=  0050A0     |     EXTI_CR2=  0050A1 
    FBREAK  =  000004     |     FCOMP   =  000005     |   5 FCPU       0021D2 R
    FF      =  00000C     |     FFOR    =  000002     |     FHSE    =  7A1200 
    FHSI    =  F42400     |     FIRST   =  000001     |     FLASH_BA=  008000 
    FLASH_CR=  00505A     |     FLASH_CR=  000002     |     FLASH_CR=  000000 
    FLASH_CR=  000003     |     FLASH_CR=  000001     |     FLASH_CR=  00505B 
    FLASH_CR=  000005     |     FLASH_CR=  000004     |     FLASH_CR=  000007 
    FLASH_CR=  000000     |     FLASH_CR=  000006     |     FLASH_DU=  005064 
    FLASH_DU=  0000AE     |     FLASH_DU=  000056     |     FLASH_EN=  027FFF 
    FLASH_FP=  00505D     |     FLASH_FP=  000000     |     FLASH_FP=  000001 
    FLASH_FP=  000002     |     FLASH_FP=  000003     |     FLASH_FP=  000004 
    FLASH_FP=  000005     |     FLASH_IA=  00505F     |     FLASH_IA=  000003 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 119.
Hexadecimal [24-Bits]

Symbol Table

    FLASH_IA=  000002     |     FLASH_IA=  000006     |     FLASH_IA=  000001 
    FLASH_IA=  000000     |     FLASH_NC=  00505C     |     FLASH_NF=  00505E 
    FLASH_NF=  000000     |     FLASH_NF=  000001     |     FLASH_NF=  000002 
    FLASH_NF=  000003     |     FLASH_NF=  000004     |     FLASH_NF=  000005 
    FLASH_PU=  005062     |     FLASH_PU=  000056     |     FLASH_PU=  0000AE 
    FLASH_SI=  020000     |     FLASH_WS=  00480D     |     FLSI    =  01F400 
  5 FOR        0021CA R   |   5 FORGET     0021BF R   |     FRUN    =  000000 
    FSIZE   =  000001     |     FSLEEP  =  000003     |     FTRAP   =  000001 
    F_CFUNC =  000080     |     F_CMD   =  000000     |     F_CONST =  0000C0 
    F_IFUNC =  000040     |   5 GOSUB      0021B5 R   |     GOS_RET =  000003 
  5 GOTO       0021AC R   |   5 GPIO       0021A3 R   |     GPIO_BAS=  005000 
    GPIO_CR1=  000003     |     GPIO_CR2=  000004     |     GPIO_DDR=  000002 
    GPIO_IDR=  000001     |     GPIO_ODR=  000000     |     GPIO_SIZ=  000005 
  5 HEX        00219B R   |     HSECNT  =  004809     |     I2C_CCRH=  00521C 
    I2C_CCRH=  000080     |     I2C_CCRH=  0000C0     |     I2C_CCRH=  000080 
    I2C_CCRH=  000000     |     I2C_CCRH=  000001     |     I2C_CCRH=  000000 
    I2C_CCRL=  00521B     |     I2C_CCRL=  00001A     |     I2C_CCRL=  000002 
    I2C_CCRL=  00000D     |     I2C_CCRL=  000050     |     I2C_CCRL=  000090 
    I2C_CCRL=  0000A0     |     I2C_CR1 =  005210     |     I2C_CR1_=  000006 
    I2C_CR1_=  000007     |     I2C_CR1_=  000000     |     I2C_CR2 =  005211 
    I2C_CR2_=  000002     |     I2C_CR2_=  000003     |     I2C_CR2_=  000000 
    I2C_CR2_=  000001     |     I2C_CR2_=  000007     |     I2C_DR  =  005216 
    I2C_FREQ=  005212     |     I2C_ITR =  00521A     |     I2C_ITR_=  000002 
    I2C_ITR_=  000000     |     I2C_ITR_=  000001     |     I2C_OARH=  005214 
    I2C_OARH=  000001     |     I2C_OARH=  000002     |     I2C_OARH=  000006 
    I2C_OARH=  000007     |     I2C_OARL=  005213     |     I2C_OARL=  000000 
    I2C_OAR_=  000813     |     I2C_OAR_=  000009     |     I2C_PECR=  00521E 
    I2C_READ=  000001     |     I2C_SR1 =  005217     |     I2C_SR1_=  000003 
    I2C_SR1_=  000001     |     I2C_SR1_=  000002     |     I2C_SR1_=  000006 
    I2C_SR1_=  000000     |     I2C_SR1_=  000004     |     I2C_SR1_=  000007 
    I2C_SR2 =  005218     |     I2C_SR2_=  000002     |     I2C_SR2_=  000001 
    I2C_SR2_=  000000     |     I2C_SR2_=  000003     |     I2C_SR2_=  000005 
    I2C_SR3 =  005219     |     I2C_SR3_=  000001     |     I2C_SR3_=  000007 
    I2C_SR3_=  000004     |     I2C_SR3_=  000000     |     I2C_SR3_=  000002 
    I2C_TRIS=  00521D     |     I2C_TRIS=  000005     |     I2C_TRIS=  000005 
    I2C_TRIS=  000005     |     I2C_TRIS=  000011     |     I2C_TRIS=  000011 
    I2C_TRIS=  000011     |     I2C_WRIT=  000000     |   5 IDR        002193 R
  5 IF         00218C R   |     IN      =  000007     |     INCR    =  000001 
    INP     =  000000     |   5 INPUT      002182 R   |     INPUT_DI=  000000 
    INPUT_EI=  000001     |     INPUT_FL=  000000     |     INPUT_PU=  000001 
    INT_ADC2=  000016     |     INT_AUAR=  000012     |     INT_AWU =  000001 
    INT_CAN_=  000008     |     INT_CAN_=  000009     |     INT_CLK =  000002 
    INT_EXTI=  000003     |     INT_EXTI=  000004     |     INT_EXTI=  000005 
    INT_EXTI=  000006     |     INT_EXTI=  000007     |     INT_FLAS=  000018 
    INT_I2C =  000013     |     INT_SPI =  00000A     |     INT_TIM1=  00000C 
    INT_TIM1=  00000B     |     INT_TIM2=  00000E     |     INT_TIM2=  00000D 
    INT_TIM3=  000010     |     INT_TIM3=  00000F     |     INT_TIM4=  000017 
    INT_TLI =  000000     |     INT_UART=  000011     |     INT_UART=  000015 
    INT_UART=  000014     |     INT_VECT=  008060     |     INT_VECT=  00800C 
    INT_VECT=  008028     |     INT_VECT=  00802C     |     INT_VECT=  008010 
    INT_VECT=  008014     |     INT_VECT=  008018     |     INT_VECT=  00801C 
    INT_VECT=  008020     |     INT_VECT=  008024     |     INT_VECT=  008068 
    INT_VECT=  008054     |     INT_VECT=  008000     |     INT_VECT=  008030 
    INT_VECT=  008038     |     INT_VECT=  008034     |     INT_VECT=  008040 
    INT_VECT=  00803C     |     INT_VECT=  008048     |     INT_VECT=  008044 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 120.
Hexadecimal [24-Bits]

Symbol Table

    INT_VECT=  008064     |     INT_VECT=  008008     |     INT_VECT=  008004 
    INT_VECT=  008050     |     INT_VECT=  00804C     |     INT_VECT=  00805C 
    INT_VECT=  008058     |     INW     =  000003     |     ITC_SPR1=  007F70 
    ITC_SPR2=  007F71     |     ITC_SPR3=  007F72     |     ITC_SPR4=  007F73 
    ITC_SPR5=  007F74     |     ITC_SPR6=  007F75     |     ITC_SPR7=  007F76 
    ITC_SPR8=  007F77     |     IWDG_KR =  0050E0     |     IWDG_PR =  0050E1 
    IWDG_RLR=  0050E2     |   5 KEY        00217A R   |     LAST    =  000003 
    LB      =  000002     |     LED2_BIT=  000005     |     LED2_MAS=  000020 
    LED2_POR=  00500A     |     LEN     =  000005     |   5 LET        002172 R
    LINENO  =  000005     |   5 LINK    =  002273 R   |   5 LIST       002169 R
    LL      =  000002     |     LLEN    =  000002     |     LL_HB   =  000001 
    LNO     =  000005     |     LN_PTR  =  000005     |   5 LOAD       002160 R
  5 LSHIFT     002155 R   |     MAJOR   =  000001     |     MASK    =  000002 
    MATH_OVF=  000000     |     MINOR   =  000000     |     MULOP   =  000005 
    N1      =  000001     |     N1_HB   =  000006     |     N1_LB   =  000007 
    N2      =  000003     |     N2_HB   =  000008     |     N2_LB   =  000009 
    NAFR    =  004804     |     NAMEPTR =  000003     |     NCLKOPT =  004808 
    NEG     =  000001     |   5 NEW        002144 R   |   5 NEXT       00214C R
    NFLASH_W=  00480E     |     NHSECNT =  00480A     |     NL      =  00000A 
    NLEN    =  000001     |     NOPT1   =  004802     |     NOPT2   =  004804 
    NOPT3   =  004806     |     NOPT4   =  004808     |     NOPT5   =  00480A 
    NOPT6   =  00480C     |     NOPT7   =  00480E     |     NOPTBL  =  00487F 
    NUBC    =  004802     |     NWDGOPT =  004806     |     NWDGOPT_=  FFFFFFFD 
    NWDGOPT_=  FFFFFFFC     |     NWDGOPT_=  FFFFFFFF     |     NWDGOPT_=  FFFFFFFE 
  5 NonHandl   000009 R   |   5 ODR        00213C R   |     OP      =  000005 
    OPT     =  000002     |     OPT0    =  004800     |     OPT1    =  004801 
    OPT2    =  004803     |     OPT3    =  004805     |     OPT4    =  004807 
    OPT5    =  004809     |     OPT6    =  00480B     |     OPT7    =  00480D 
    OPTBL   =  00487E     |     OPTION_B=  004800     |     OPTION_E=  00487F 
    OPTION_S=  000080     |   5 OR         002135 R   |     OUTP    =  000001 
    OUTPUT_F=  000001     |     OUTPUT_O=  000000     |     OUTPUT_P=  000001 
    OUTPUT_S=  000000     |     OVFH    =  000001     |     OVFL    =  000002 
    PA      =  000000     |     PAD_SIZE=  000028     |   5 PAUSE      00212B R
    PA_BASE =  005000     |     PA_CR1  =  005003     |     PA_CR2  =  005004 
    PA_DDR  =  005002     |     PA_IDR  =  005001     |     PA_ODR  =  005000 
    PB      =  000005     |     PB_BASE =  005005     |     PB_CR1  =  005008 
    PB_CR2  =  005009     |     PB_DDR  =  005007     |     PB_IDR  =  005006 
    PB_ODR  =  005005     |     PC      =  00000A     |     PC_BASE =  00500A 
    PC_CR1  =  00500D     |     PC_CR2  =  00500E     |     PC_DDR  =  00500C 
    PC_IDR  =  00500B     |     PC_ODR  =  00500A     |     PD      =  00000F 
    PD_BASE =  00500F     |     PD_CR1  =  005012     |     PD_CR2  =  005013 
    PD_DDR  =  005011     |     PD_IDR  =  005010     |     PD_ODR  =  00500F 
    PE      =  000014     |   5 PEEK       002118 R   |     PE_BASE =  005014 
    PE_CR1  =  005017     |     PE_CR2  =  005018     |     PE_DDR  =  005016 
    PE_IDR  =  005015     |     PE_ODR  =  005014     |     PF      =  000019 
    PF_BASE =  005019     |     PF_CR1  =  00501C     |     PF_CR2  =  00501D 
    PF_DDR  =  00501B     |     PF_IDR  =  00501A     |     PF_ODR  =  005019 
    PG      =  00001E     |     PG_BASE =  00501E     |     PG_CR1  =  005021 
    PG_CR2  =  005022     |     PG_DDR  =  005020     |     PG_IDR  =  00501F 
    PG_ODR  =  00501E     |     PH      =  000023     |     PH_BASE =  005023 
    PH_CR1  =  005026     |     PH_CR2  =  005027     |     PH_DDR  =  005025 
    PH_IDR  =  005024     |     PH_ODR  =  005023     |     PI      =  000028 
    PINNO   =  000001     |   5 PINP       00210F R   |     PI_BASE =  005028 
    PI_CR1  =  00502B     |     PI_CR2  =  00502C     |     PI_DDR  =  00502A 
    PI_IDR  =  005029     |     PI_ODR  =  005028     |   5 PMODE      002121 R
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 121.
Hexadecimal [24-Bits]

Symbol Table

  5 POKE       002106 R   |   5 POUT       0020FD R   |     PREV    =  000001 
  5 PRINT      0020F3 R   |     PROD    =  000002     |     PSIZE   =  000001 
  5 PWRADC     0020E8 R   |   5 QKEY       0020DF R   |     RAM_BASE=  000000 
    RAM_END =  0017FF     |     RAM_SIZE=  001800     |   5 REBOOT     0020D4 R
  5 REG_A      000937 R   |   5 REG_CC     00093B R   |   5 REG_EPC    00092A R
  5 REG_SP     000940 R   |   5 REG_X      000933 R   |   5 REG_Y      00092F R
    RELOP   =  000005     |   5 REMARK     0020C9 R   |     RETL1   =  000001 
  5 RETURN     0020BE R   |   5 RND        0020B6 R   |     ROP     =  004800 
  5 RSHIFT     0020AB R   |     RST_SR  =  0050B3     |   5 RUN        0020A3 R
    RXCHAR  =  000001     |     R_A     =  000007     |     R_CC    =  000008 
    R_X     =  000005     |     R_Y     =  000003     |   5 SAVE       00209A R
    SDIVD   =  000002     |     SFR_BASE=  005000     |     SFR_END =  0057FF 
    SHARP   =  000023     |   5 SHOW       002091 R   |     SIGN    =  000001 
  5 SIZE       002088 R   |     SKIP    =  000006     |   5 SLEEP      00207E R
    SPACE   =  000020     |     SPI_CR1 =  005200     |     SPI_CR2 =  005201 
    SPI_CRCP=  005205     |     SPI_DR  =  005204     |     SPI_ICR =  005202 
    SPI_RXCR=  005206     |     SPI_SR  =  005203     |     SPI_TXCR=  005207 
    SQUOT   =  000001     |     SRC     =  000003     |     STACK_EM=  0017FF 
    STACK_SI=  000080     |   5 STATES     0008ED R   |   5 STEP       002075 R
  5 STOP       00206C R   |     SWIM_CSR=  007F80     |     TAB     =  000009 
    TAB_WIDT=  000004     |     TCHAR   =  000001     |     TEMP    =  000003 
    TIB_SIZE=  000050     |     TICK    =  000027     |   5 TICKS      002062 R
    TIM1_ARR=  005262     |     TIM1_ARR=  005263     |     TIM1_BKR=  00526D 
    TIM1_CCE=  00525C     |     TIM1_CCE=  00525D     |     TIM1_CCM=  005258 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  005259 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  00525A 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  00525B 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCR=  005265 
    TIM1_CCR=  005266     |     TIM1_CCR=  005267     |     TIM1_CCR=  005268 
    TIM1_CCR=  005269     |     TIM1_CCR=  00526A     |     TIM1_CCR=  00526B 
    TIM1_CCR=  00526C     |     TIM1_CNT=  00525E     |     TIM1_CNT=  00525F 
    TIM1_CR1=  005250     |     TIM1_CR2=  005251     |     TIM1_CR2=  000000 
    TIM1_CR2=  000002     |     TIM1_CR2=  000004     |     TIM1_CR2=  000005 
    TIM1_CR2=  000006     |     TIM1_DTR=  00526E     |     TIM1_EGR=  005257 
    TIM1_EGR=  000007     |     TIM1_EGR=  000001     |     TIM1_EGR=  000002 
    TIM1_EGR=  000003     |     TIM1_EGR=  000004     |     TIM1_EGR=  000005 
    TIM1_EGR=  000006     |     TIM1_EGR=  000000     |     TIM1_ETR=  005253 
    TIM1_ETR=  000006     |     TIM1_ETR=  000000     |     TIM1_ETR=  000001 
    TIM1_ETR=  000002     |     TIM1_ETR=  000003     |     TIM1_ETR=  000007 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 122.
Hexadecimal [24-Bits]

Symbol Table

    TIM1_ETR=  000004     |     TIM1_ETR=  000005     |     TIM1_IER=  005254 
    TIM1_IER=  000007     |     TIM1_IER=  000001     |     TIM1_IER=  000002 
    TIM1_IER=  000003     |     TIM1_IER=  000004     |     TIM1_IER=  000005 
    TIM1_IER=  000006     |     TIM1_IER=  000000     |     TIM1_OIS=  00526F 
    TIM1_PSC=  005260     |     TIM1_PSC=  005261     |     TIM1_RCR=  005264 
    TIM1_SMC=  005252     |     TIM1_SMC=  000007     |     TIM1_SMC=  000000 
    TIM1_SMC=  000001     |     TIM1_SMC=  000002     |     TIM1_SMC=  000004 
    TIM1_SMC=  000005     |     TIM1_SMC=  000006     |     TIM1_SR1=  005255 
    TIM1_SR1=  000007     |     TIM1_SR1=  000001     |     TIM1_SR1=  000002 
    TIM1_SR1=  000003     |     TIM1_SR1=  000004     |     TIM1_SR1=  000005 
    TIM1_SR1=  000006     |     TIM1_SR1=  000000     |     TIM1_SR2=  005256 
    TIM1_SR2=  000001     |     TIM1_SR2=  000002     |     TIM1_SR2=  000003 
    TIM1_SR2=  000004     |     TIM2_ARR=  00530D     |     TIM2_ARR=  00530E 
    TIM2_CCE=  005308     |     TIM2_CCE=  005309     |     TIM2_CCM=  005305 
    TIM2_CCM=  005306     |     TIM2_CCM=  005307     |     TIM2_CCR=  00530F 
    TIM2_CCR=  005310     |     TIM2_CCR=  005311     |     TIM2_CCR=  005312 
    TIM2_CCR=  005313     |     TIM2_CCR=  005314     |     TIM2_CNT=  00530A 
    TIM2_CNT=  00530B     |     TIM2_CR1=  005300     |     TIM2_EGR=  005304 
    TIM2_IER=  005301     |     TIM2_PSC=  00530C     |     TIM2_SR1=  005302 
    TIM2_SR2=  005303     |     TIM3_ARR=  00532B     |     TIM3_ARR=  00532C 
    TIM3_CCE=  005327     |     TIM3_CCE=  000000     |     TIM3_CCE=  000001 
    TIM3_CCE=  000004     |     TIM3_CCE=  000005     |     TIM3_CCE=  000000 
    TIM3_CCE=  000001     |     TIM3_CCM=  005325     |     TIM3_CCM=  005326 
    TIM3_CCM=  000000     |     TIM3_CCM=  000004     |     TIM3_CCM=  000003 
    TIM3_CCR=  00532D     |     TIM3_CCR=  00532E     |     TIM3_CCR=  00532F 
    TIM3_CCR=  005330     |     TIM3_CNT=  005328     |     TIM3_CNT=  005329 
    TIM3_CR1=  005320     |     TIM3_CR1=  000007     |     TIM3_CR1=  000000 
    TIM3_CR1=  000003     |     TIM3_CR1=  000001     |     TIM3_CR1=  000002 
    TIM3_EGR=  005324     |     TIM3_IER=  005321     |     TIM3_PSC=  00532A 
    TIM3_SR1=  005322     |     TIM3_SR2=  005323     |     TIM4_ARR=  005346 
    TIM4_CNT=  005344     |     TIM4_CR1=  005340     |     TIM4_CR1=  000007 
    TIM4_CR1=  000000     |     TIM4_CR1=  000003     |     TIM4_CR1=  000001 
    TIM4_CR1=  000002     |     TIM4_EGR=  005343     |     TIM4_EGR=  000000 
    TIM4_IER=  005341     |     TIM4_IER=  000000     |     TIM4_PSC=  005345 
    TIM4_PSC=  000000     |     TIM4_PSC=  000007     |     TIM4_PSC=  000004 
    TIM4_PSC=  000001     |     TIM4_PSC=  000005     |     TIM4_PSC=  000002 
    TIM4_PSC=  000006     |     TIM4_PSC=  000003     |     TIM4_PSC=  000000 
    TIM4_PSC=  000001     |     TIM4_PSC=  000002     |     TIM4_SR =  005342 
    TIM4_SR_=  000000     |     TIM_CR1_=  000007     |     TIM_CR1_=  000000 
    TIM_CR1_=  000006     |     TIM_CR1_=  000005     |     TIM_CR1_=  000004 
    TIM_CR1_=  000003     |     TIM_CR1_=  000001     |     TIM_CR1_=  000002 
    TK_ARRAY=  000002     |     TK_CFUNC=  000008     |     TK_CHAR =  000003 
    TK_CMD  =  000006     |     TK_COLON=  000001     |     TK_COMMA=  00000D 
    TK_CONST=  000009     |     TK_DIV  =  000021     |     TK_EQUAL=  000032 
    TK_GE   =  000033     |     TK_GRP_A=  000010     |     TK_GRP_M=  000030 
    TK_GRP_M=  000000     |     TK_GRP_M=  000020     |     TK_GRP_R=  000030 
    TK_GT   =  000031     |     TK_IFUNC=  000007     |     TK_INTGR=  000004 
    TK_LE   =  000036     |     TK_LPARE=  00000B     |     TK_LT   =  000034 
    TK_MINUS=  000011     |     TK_MOD  =  000022     |     TK_MULT =  000020 
    TK_NE   =  000035     |     TK_NONE =  000000     |     TK_PLUS =  000010 
    TK_QSTR =  00000A     |     TK_RPARE=  00000C     |     TK_SHARP=  00000E 
    TK_VAR  =  000005     |   5 TO         00205B R   |   5 Timer4Up   000019 R
  5 TrapHand   00000A R   |     U8      =  000003     |     UART1   =  000000 
    UART1_BA=  005230     |     UART1_BR=  005232     |     UART1_BR=  005233 
    UART1_CR=  005234     |     UART1_CR=  005235     |     UART1_CR=  005236 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 123.
Hexadecimal [24-Bits]

Symbol Table

    UART1_CR=  005237     |     UART1_CR=  005238     |     UART1_DR=  005231 
    UART1_GT=  005239     |     UART1_PO=  000000     |     UART1_PS=  00523A 
    UART1_RX=  000004     |     UART1_SR=  005230     |     UART1_TX=  000005 
    UART3   =  000001     |     UART3_BA=  005240     |     UART3_BR=  005242 
    UART3_BR=  005243     |     UART3_CR=  005244     |     UART3_CR=  005245 
    UART3_CR=  005246     |     UART3_CR=  005247     |     UART3_CR=  004249 
    UART3_DR=  005241     |     UART3_PO=  00000F     |     UART3_RX=  000006 
    UART3_SR=  005240     |     UART3_TX=  000005     |     UART_BRR=  000002 
    UART_BRR=  000003     |     UART_CR1=  000004     |     UART_CR1=  000004 
    UART_CR1=  000002     |     UART_CR1=  000000     |     UART_CR1=  000001 
    UART_CR1=  000007     |     UART_CR1=  000006     |     UART_CR1=  000005 
    UART_CR1=  000003     |     UART_CR2=  000005     |     UART_CR2=  000004 
    UART_CR2=  000002     |     UART_CR2=  000005     |     UART_CR2=  000001 
    UART_CR2=  000000     |     UART_CR2=  000006     |     UART_CR2=  000003 
    UART_CR2=  000007     |     UART_CR3=  000006     |     UART_CR3=  000003 
    UART_CR3=  000001     |     UART_CR3=  000002     |     UART_CR3=  000000 
    UART_CR3=  000006     |     UART_CR3=  000004     |     UART_CR3=  000005 
    UART_CR4=  000007     |     UART_CR4=  000000     |     UART_CR4=  000001 
    UART_CR4=  000002     |     UART_CR4=  000003     |     UART_CR4=  000004 
    UART_CR4=  000006     |     UART_CR4=  000005     |     UART_CR5=  000008 
    UART_CR5=  000003     |     UART_CR5=  000001     |     UART_CR5=  000002 
    UART_CR5=  000004     |     UART_CR5=  000005     |     UART_CR6=  000009 
    UART_CR6=  000004     |     UART_CR6=  000007     |     UART_CR6=  000001 
    UART_CR6=  000002     |     UART_CR6=  000000     |     UART_CR6=  000005 
    UART_DR =  000001     |     UART_GTR=  000009     |     UART_PSC=  00000A 
    UART_SR =  000000     |     UART_SR_=  000001     |     UART_SR_=  000004 
    UART_SR_=  000002     |     UART_SR_=  000003     |     UART_SR_=  000000 
    UART_SR_=  000005     |     UART_SR_=  000006     |     UART_SR_=  000007 
    UBC     =  004801     |   5 UBOUND     002050 R   |   5 UFLASH     002045 R
  5 USER_ABO   00007E R   |   5 USR        00203D R   |     USR_BTN_=  000004 
    USR_BTN_=  000010     |     USR_BTN_=  005015     |   5 UserButt   000025 R
    VSIZ    =  000002     |     VSIZE   =  000002     |     VT      =  00000B 
  5 WAIT       002034 R   |     WDGOPT  =  004805     |     WDGOPT_I=  000002 
    WDGOPT_L=  000003     |     WDGOPT_W=  000000     |     WDGOPT_W=  000001 
    WIDTH   =  000001     |     WIDTH_SA=  000002     |     WLEN    =  000001 
  5 WORDS      00202A R   |   5 WRITE      002020 R   |     WWDG_CR =  0050D1 
    WWDG_WR =  0050D2     |     XADR    =  000001     |     XMASK   =  000001 
  5 XOR        002018 R   |     XSAVE   =  000003     |     YSAVE   =  000003 
  5 abs        001E4D R   |   1 acc16      000008 R   |   1 acc24      000007 R
  1 acc8       000009 R   |   5 accept_c   000AE1 R   |   5 add        001074 R
  5 analog_r   001A00 R   |   5 ansi_seq   000AA3 R   |   5 arduino_   001F52 R
  5 arg_list   0011B3 R   |   1 array_si   00001D R   |   5 ascii      001D9C R
  5 at_tst     000DAE R   |   5 atoi24     000EC1 R   |   5 atoi_exi   000F2F R
  5 bad_port   001DF7 R   |   1 base       000006 R   |   1 basicptr   000004 R
  5 beep       00198F R   |   5 bin_exit   000CB2 R   |   5 bit_and    001E63 R
  5 bit_or     001E81 R   |   5 bit_rese   00174C R   |   5 bit_set    001738 R
  5 bit_test   001775 R   |   5 bit_togg   001761 R   |   5 bit_xor    001E9F R
  5 bkslsh_t   000D59 R   |   5 bksp       0001C2 R   |   5 break      001A36 R
  5 break_po   001A64 R   |   5 bye        001E20 R   |   5 char       001D88 R
  5 check_fu   0003E5 R   |   5 clear_ba   0005E6 R   |   5 clear_va   0004EF R
  5 clock_in   000099 R   |   5 cmd_itf    000B05 R   |   5 cmd_name   00111F R
  5 cmp_name   001AD8 R   |   5 cold_sta   000554 R   |   5 colon_ts   000D82 R
  5 comma_ts   000D8D R   |   5 compile    0003F4 R   |   5 convert_   000C3A R
  1 count      000003 R   |   5 cp_loop    001162 R   |   5 create_g   000344 R
  5 cstk_pro   00103E R   |   5 dash_tst   000DA3 R   |   5 ddrop      000FBA R
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 124.
Hexadecimal [24-Bits]

Symbol Table

  5 ddrop_n    000FF7 R   |   5 ddup       000FC3 R   |   5 dec_base   001365 R
  5 del_back   000AD2 R   |   5 del_line   00030C R   |   5 del_ln     000AC3 R
  5 delete     0001D2 R   |   5 dir_loop   001CC7 R   |   5 director   001CBB R
  5 divide     0010CA R   |   5 divu24_8   000A30 R   |   5 dotr       001047 R
  5 dotr_loo   00105C R   |   5 dots       001014 R   |   5 dpick      000FD4 R
  5 dpop       000F93 R   |   5 dpush      000F86 R   |   5 drive_fr   001D44 R
  3 dstack     001740 R   |   3 dstack_u   001780 R   |   5 dstk_pro   00100A R
  1 dstkptr    000016 R   |   5 dswap      000FA0 R   |   5 eql_tst    000E0E R
  5 equal      0015F5 R   |   5 err_bad_   0006C3 R   |   5 err_cmd_   000684 R
  5 err_div0   000646 R   |   5 err_dupl   00069F R   |   5 err_math   00062C R
  5 err_mem_   00060F R   |   5 err_msg    0005F7 R   |   5 err_no_a   0006D0 R
  5 err_no_l   000656 R   |   5 err_not_   0006B1 R   |   5 err_run_   00066D R
  5 err_synt   00061D R   |   5 escaped    000C4F R   |   5 expect     0011A6 R
  5 expr_exi   0012F6 R   |   5 expressi   0012B5 R   |   5 factor     00120E R
  1 farptr     000010 R   |   5 fcpu       001EF7 R   |   7 fdrive     010000 R
  5 fetch      000FE3 R   |   5 fetchc     000BF2 R   |   1 ffree      000013 R
  5 file_cou   001D3C R   |   5 final_te   000A9D R   |   5 first_li   0013E9 R
  1 flags      00001F R   |   5 for        0017DA R   |   5 forget     001C70 R
  1 free_ram   000055 R   |   5 func_arg   0011D7 R   |   5 ge         0015F7 R
  5 get_arra   0011E7 R   |   5 get_tick   001E47 R   |   5 get_toke   000CF4 R
  5 getc       0001AF R   |   5 go_commo   0018FB R   |   5 gosub      0018D8 R
  5 goto       0018CB R   |   5 gpio       001DC9 R   |   5 gt         0015F3 R
  5 gt_tst     000E19 R   |   5 hex_base   001360 R   |   5 hse_cloc   00018F R
  5 hsi_cloc   000199 R   |   5 if         0017C6 R   |   1 in         000001 R
  1 in.saved   000002 R   |   1 in.w       000000 R   |   5 incr_far   001A8D R
  5 input_ex   001704 R   |   5 input_lo   00169F R   |   5 input_va   001693 R
  5 insert_l   00037D R   |   5 insert_l   0003E2 R   |   5 interp     000784 R
  5 interp_l   0007C4 R   |   5 invalid    000B4A R   |   5 invalid_   000BC8 R
  5 is_alpha   0004FD R   |   5 is_digit   000EAC R   |   5 itoa       0009E9 R
  5 itoa_loo   000A01 R   |   5 key        001DB7 R   |   5 kword_di   002271 R
  5 kword_en   002016 R   |   5 last_lin   0013F2 R   |   5 le         0015FC R
  5 ledoff     00083D R   |   5 ledon      000838 R   |   5 ledtoggl   000842 R
  5 left_arr   000AA3 R   |   5 left_par   00084B R   |   5 let        001396 R
  5 let02      0013A0 R   |   5 lines_sk   0013F7 R   |   5 list       0013BE R
  5 list_exi   00143E R   |   5 list_sta   00141A R   |   5 load       001C08 R
  5 loop_bac   0018A4 R   |   1 loop_dep   00001C R   |   5 loop_don   0018B9 R
  5 lshift     001EBD R   |   5 lt         0015FA R   |   5 lt_tst     000E52 R
  5 mem_peek   000B67 R   |   5 modulo     00110E R   |   5 move       0002A6 R
  5 move_dow   0002C4 R   |   5 move_exi   0002E5 R   |   5 move_loo   0002C9 R
  5 move_up    0002B6 R   |   5 mul_char   0015E4 R   |   5 multiply   001082 R
  5 mulu24_8   000F33 R   |   5 nbr_tst    000D2F R   |   5 ne         0015FF R
  5 neg_acc2   000A58 R   |   5 new        001A82 R   |   5 next       00185C R
  5 next_tok   0007F4 R   |   5 no_match   001174 R   |   5 none       000CF4 R
  5 number     000BF8 GR  |   5 other      000E8A R   |   3 pad        001718 R
  5 parse_bi   000C92 R   |   5 parse_in   000C57 R   |   5 parse_ke   000CBA R
  5 parse_qu   000BFF R   |   5 pause      001E34 R   |   5 pause02    001E3E R
  5 peek       0017B3 R   |   5 peek_byt   000B92 R   |   5 pin_mode   001F03 R
  5 plus_tst   000DE2 R   |   5 poke       0017A0 R   |   5 power_ad   0019B7 R
  5 prcnt_ts   000E03 R   |   5 print      001602 R   |   5 print_ex   001667 R
  5 print_fa   000BD7 R   |   5 print_in   00098D R   |   5 print_re   00089A R
  5 print_st   000B5A R   |   5 prt_basi   001491 R   |   5 prt_cmd_   001441 R
  5 prt_loop   001606 R   |   5 prt_peek   000256 R   |   5 prt_quot   001455 R
  5 prt_reg1   00087B R   |   5 prt_reg8   000856 R   |   5 prt_regs   0001EC R
  5 prti24     000945 R   |   1 ptr16      000011 R   |   1 ptr8       000012 R
  5 putc       0001A6 R   |   5 puts       0001B8 R   |   5 qkey       001DBF R
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 125.
Hexadecimal [24-Bits]

Symbol Table

  5 qmark_ts   000DB9 R   |   5 random     001F72 R   |   5 readln     000A7B R
  5 readln_l   000A81 R   |   5 readln_q   000AF6 R   |   5 regs_sta   00022F R
  5 rel_exit   00134D R   |   5 relation   0012F9 R   |   5 relop_st   0015E7 R
  5 rem        001707 R   |   5 repl       000B13 R   |   5 repl_exi   000B3B R
  5 reprint    000AA3 R   |   5 reset_co   001604 R   |   5 rest_con   001683 R
  5 return     00191D R   |   5 right_ar   000AA3 R   |   5 rparnt_t   000D77 R
  5 rshift     001EDA R   |   5 rt_msg     000704 R   |   5 run        00193D R
  5 save       001B44 R   |   5 save_con   001673 R   |   5 search_d   001151 R
  5 search_e   0011A2 R   |   5 search_f   001AF9 R   |   5 search_l   0002E8 R
  5 search_l   0002F0 R   |   5 search_n   001155 R   |   1 seedx      00000C R
  1 seedy      00000E R   |   5 seek_fdr   001A9B R   |   5 sharp_ts   000D98 R
  5 show       001350 R   |   5 single_c   0015E0 R   |   5 size       00136A R
  5 skip       000F6D R   |   5 slash_ts   000DF8 R   |   5 sleep      001E29 R
  5 software   00050E R   |   5 spaces     0001E0 R   |   3 stack_fu   001780 R
  3 stack_un   001800 R   |   5 star_tst   000DED R   |   5 step       001834 R
  5 stop       001980 R   |   5 store      000FED R   |   5 store_lo   001846 R
  5 str_matc   001183 R   |   5 str_tst    000D1E R   |   5 strcmp     000287 R
  5 strcpy     000298 R   |   5 strlen     00027A R   |   5 substrac   00107C R
  5 syntax_e   000714 R   |   1 tab_widt   000020 R   |   5 tb_error   000716 R
  5 term       001268 R   |   5 term01     001271 R   |   5 term_exi   0012B2 R
  5 test_p     000B52 R   |   3 tib        0016C8 R   |   5 tick_tst   000DD0 R
  1 ticks      00000A R   |   5 timer4_i   0000AF R   |   5 to         001804 R
  5 to_upper   000EB5 GR  |   5 token_ch   000E99 R   |   5 token_ex   000EA9 R
  1 txtbgn     000018 R   |   1 txtend     00001A R   |   5 uart3_in   000178 R
  5 uart3_se   000188 R   |   5 uart_ena   0001A1 R   |   5 ubound     001374 R
  5 uflash     001DFC R   |   5 unget_to   000F80 R   |   5 unlock_e   0000C4 R
  5 unlock_f   0000D2 R   |   5 user_spa   002280 R   |   5 usr        001E02 R
  1 vars       000021 R   |   5 wait       00170D R   |   5 warm_sta   000768 R
  5 words      001FDC R   |   5 write      001D51 R   |   5 write_bl   000155 R
  5 write_by   0000E0 R   |   5 write_ee   00011C R   |   5 write_ex   000150 R
  5 write_fl   000106 R

ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 126.
Hexadecimal [24-Bits]

Area Table

   0 _CODE      size      0   flags    0
   1 DATA       size     55   flags    0
   2 SSEG       size      0   flags    8
   3 SSEG0      size    138   flags    8
   4 HOME       size     80   flags    0
   5 CODE       size   228E   flags    0
   6 FLASH_DR   size      0   flags    8
   7 FLASH_DR   size      0   flags    8

