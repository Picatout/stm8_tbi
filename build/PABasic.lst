ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 1.
Hexadecimal [24-Bits]



                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019 
                                      3 ; This file is part of PABasic 
                                      4 ;
                                      5 ;     PABasic is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     PABasic is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with PABasic.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 ;--------------------------------------
                                     19 ;   Implementation of Tiny BASIC
                                     20 ;   REF: https://en.wikipedia.org/wiki/Li-Chen_Wang#Palo_Alto_Tiny_BASIC
                                     21 ;   Palo Alto BASIC is 4th version of TinyBasic
                                     22 ;   DATE: 2019-12-17
                                     23 ;
                                     24 ;--------------------------------------------------
                                     25 
                                     26     .module TBI_STM8
                                     27 
                                        	.include "inc/nucleo_8s208.inc"
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of MONA 
                                        ;
                                        ;     MONA is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     MONA is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                        ; NUCLEO-8S208RB board specific definitions
                                        ; Date: 2019/10/29
                                        ; author: Jacques Deschênes, copyright 2018,2019
                                        ; licence: GPLv3
                                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                        
                                        ; mcu on board is stm8s208rbt6
                                        
                                        ; crystal on board is 8Mhz
                                 
                                        
                                        ; LED2 is user LED
                                        ; connected to PC5 via Q2 -> 2N7002 MOSFET
                                 
                                 
                                 
                                        
                                        ; B1 on schematic is user button
                                        ; connected to PE4
                                        ; external pullup resistor R6 4k7 and debounce capacitor C5 100nF
                                 
                                 
                                 
                                        
                                        
                                        	.include "inc/stm8s208.inc"
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of MONA 
                                        ;
                                        ;     MONA is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     MONA is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                        ; 2019/10/18
                                        ; STM8S208RB µC registers map
                                        ; sdas source file
                                        ; author: Jacques Deschênes, copyright 2018,2019
                                        ; licence: GPLv3
                                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                        	.module stm8s208rb
                                        
                                        ;;;;;;;;;;;;
                                        ; bits
                                        ;;;;;;;;;;;;
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                         	
                                        ;;;;;;;;;;;;
                                        ; bits masks
                                        ;;;;;;;;;;;;
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; HSI oscillator frequency 16Mhz
                                 
                                        ; LSI oscillator frequency 128Khz
                                 
                                        
                                        ; controller memory regions
                                 
                                 
                                        ; STM8S208RB have 128K flash
                                 
                                        ; erase block size 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; options bytes
                                        ; this one can be programmed only from SWIM  (ICP)
                                 
                                        ; these can be programmed at runtime (IAP)
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; option registers usage
                                        ; read out protection, value 0xAA enable ROP
                                 
                                        ; user boot code, {0..0x3e} 512 bytes row
                                 
                                 
                                        ; alternate function register
                                 
                                 
                                        ; miscelinous options
                                 
                                 
                                        ; clock options
                                 
                                 
                                        ; HSE clock startup delay
                                 
                                 
                                        ; flash wait state
                                 
                                 
                                        
                                        ; watchdog options bits
                                 
                                 
                                 
                                 
                                        ; NWDGOPT bits
                                 
                                 
                                 
                                 
                                        
                                        ; CLKOPT bits
                                 
                                 
                                 
                                 
                                        
                                        ; AFR option, remapable functions
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; device ID = (read only)
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        
                                 
                                 
                                        ; PORTS SFR OFFSET
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; GPIO
                                        ; gpio register offset to base
                                 
                                 
                                 
                                 
                                 
                                 
                                         
                                        ; port A
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port B
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port C
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port D
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port E
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port F
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port G
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port H not present on LQFP48/LQFP64 package
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; port I ; only bit 0 on LQFP64 package, not present on LQFP48
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; input modes CR1
                                 
                                 
                                        ; output mode CR1
                                 
                                 
                                        ; input modes CR2
                                 
                                 
                                        ; output speed CR2
                                 
                                 
                                        
                                        
                                        ; Flash memory
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; data memory unlock keys
                                 
                                 
                                        ; flash memory unlock keys
                                 
                                 
                                        ; FLASH_CR1 bits
                                 
                                 
                                 
                                 
                                        ; FLASH_CR2 bits
                                 
                                 
                                 
                                 
                                 
                                        ; FLASH_FPR bits
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; FLASH_NFPR bits
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; FLASH_IAPSR bits
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Interrupt control
                                 
                                 
                                        
                                        ; Reset Status
                                 
                                        
                                        ; Clock Registers
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Peripherals clock gating
                                        ; CLK_PCKENR1 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        ; CLK_PCKENR2
                                 
                                 
                                 
                                        
                                        ; Clock bits
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                        ; clock source
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Watchdog
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Beeper
                                        ; beeper output is alternate function AFR7 on PD4
                                        ; connected to CN9-6
                                 
                                 
                                 
                                 
                                        
                                        ; SPI
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; I2C
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                        
                                        ; Precalculated values, all in KHz
                                 
                                 
                                        ;
                                        ; Fast I2C mode max rise time = 300ns
                                        ; I2C_FREQR = 16 = (MHz) => tMASTER = 1/16 = 62.5 ns
                                        ; TRISER = = (300/62.5) + 1 = floor(4.8) + 1 = 5.
                                        
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                        ;
                                        ; Standard I2C mode max rise time = 1000ns
                                        ; I2C_FREQR = 16 = (MHz) => tMASTER = 1/16 = 62.5 ns
                                        ; TRISER = = (1000/62.5) + 1 = floor(16) + 1 = 17.
                                        
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                        
                                        ; baudrate constant for brr_value table access
                                        ; to be used by uart_init 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; UART registers offset from
                                        ; base address 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; uart identifier
                                        ; to be used by uart_init
                                 
                                 
                                        
                                        ; pins used by uart 
                                 
                                 
                                 
                                 
                                        ; uart port base address 
                                 
                                 
                                        
                                        ; UART1 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; UART3
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; UART Status Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Uart Control Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        ; LIN mode config register
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; TIMERS
                                        ; Timer 1 - 16-bit timer with complementary PWM outputs
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Control Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Slave Mode Control bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer External Trigger Enable bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Interrupt Enable bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Status Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                        
                                        ; Timer Event Generation Register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 1 - channel configured in output
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 1 - channel configured in input
                                 
                                 
                                 
                                 
                                 
                                 
                                        ;  TIM1_CCMR1_CC1S1 = (1)
                                 
                                        
                                        ; Capture/Compare Mode Register 2 - channel configured in output
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 2 - channel configured in input
                                 
                                 
                                 
                                 
                                 
                                 
                                        ;  TIM1_CCMR2_CC2S1 = (1)
                                 
                                        
                                        ; Capture/Compare Mode Register 3 - channel configured in output
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 3 - channel configured in input
                                 
                                 
                                 
                                 
                                 
                                 
                                        ;  TIM1_CCMR3_CC3S1 = (1)
                                 
                                        
                                        ; Capture/Compare Mode Register 4 - channel configured in output
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Capture/Compare Mode Register 4 - channel configured in input
                                 
                                 
                                 
                                 
                                 
                                 
                                        ;  TIM1_CCMR4_CC4S1 = (1)
                                 
                                        
                                        ; Timer 2 - 16-bit timer
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer 3
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; TIM3_CR1  fields
                                 
                                 
                                 
                                 
                                 
                                        ; TIM3_CCR2  fields
                                 
                                 
                                 
                                        ; TIM3_CCER1 fields
                                 
                                 
                                 
                                 
                                        ; TIM3_CCER2 fields
                                 
                                 
                                        
                                        ; Timer 4
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Timer 4 bitmasks
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                        
                                 
                                        
                                 
                                        
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; ADC2
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                         
                                        ; ADC bitmasks
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                        
                                        ; beCAN
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        
                                        ; CPU
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; global configuration register
                                 
                                 
                                 
                                        
                                        ; interrupt control registers
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; SWIM, control and status register
                                 
                                        ; debug registers
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Interrupt Numbers
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Interrupt Vectors
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ; Condition code register bits
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        	.include "inc/ascii.inc"
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of MONA 
                                        ;
                                        ;     MONA is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     MONA is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        
                                        ;-------------------------------------------------------
                                        ;     ASCII control  values
                                        ;     CTRL_x   are VT100 keyboard values  
                                        ;-------------------------------------------------------
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                        
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        	.include "inc/gen_macros.inc" 
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of STM8_NUCLEO 
                                        ;
                                        ;     STM8_NUCLEO is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     STM8_NUCLEO is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with STM8_NUCLEO.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        ;--------------------------------------
                                        ;   console Input/Output module
                                        ;   DATE: 2019-12-11
                                        ;    
                                        ;   General usage macros.   
                                        ;
                                        ;--------------------------------------
                                        
                                            ; reserve space on stack
                                            ; for local variabls
                                            .macro _vars n 
                                            
                                            ; free space on stack
                                            .macro _drop n 
                                        
                                            ; declare ARG_OFS for arguments 
                                            ; displacement on stack. This 
                                            ; value depend on local variables 
                                            ; size.
                                            .macro _argofs n 
                                        
                                            ; declare a function argument 
                                            ; position relative to stack pointer 
                                            ; _argofs must be called before it.
                                            .macro _arg name ofs 
                                        	.include "pab_macros.inc" 
                                        ;;
                                        ; Copyright Jacques Deschênes 2019 
                                        ; This file is part of STM8_NUCLEO 
                                        ;
                                        ;     STM8_NUCLEO is free software: you can redistribute it and/or modify
                                        ;     it under the terms of the GNU General Public License as published by
                                        ;     the Free Software Foundation, either version 3 of the License, or
                                        ;     (at your option) any later version.
                                        ;
                                        ;     STM8_NUCLEO is distributed in the hope that it will be useful,
                                        ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                        ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                        ;     GNU General Public License for more details.
                                        ;
                                        ;     You should have received a copy of the GNU General Public License
                                        ;     along with STM8_NUCLEO.  If not, see <http://www.gnu.org/licenses/>.
                                        ;;
                                        ;--------------------------------------
                                 
                                        ;--------------------------------------
                                        ;       token attribute
                                        ;--------------------------------------
                                                ; bits 4:5 identify token group 
                                                ; 0x0n -> miscelinous 
                                                ; 0x1n -> +|- operators 
                                                ; 0x2n -> *|/|% operators
                                                ; 0x3n -> relational operators 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                                ; don't change these token values 
                                                ; values chosen to be used as a mask.
                                                ; bits 7:6  always 0 
                                                ; bits 5:4 identify group 
                                                ; bits 3:0 token identifier inside group  
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                        
                                        ;--------------------------------------
                                        ;   error codes 
                                        ;--------------------------------------
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                 
                                            
                                        ;--------------------------------------
                                        ;   assembler flags 
                                        ;-------------------------------------
                                 
                                        
                                        
                                            .macro _usec_dly n 
                                            
                                        ;---------------------------------------
                                        ;  data stack macros 
                                        ;---------------------------------------
                                 
                                        
                                            ; move dp up 1 element 
                                            .macro _dp_up 
                                        
                                            ;move dp down 1 element
                                            .macro _dp_down 
                                        
                                            ; load X register with 
                                            ; entry point of dictionary
                                            ; before calling 'search_dict'
                                            .macro _ldx_dict dict_name
                                        
                                        ;-------------------------------
                                        ;  macros used to help debugging
                                        ;-------------------------------
                                 
                                            .macro _dbg 
                                        
                                            .macro _nodbg
                                        
                                 
                                 
                                 
                                 
                                            .macro _dbg_save_regs 
                                        
                                            .macro _dbg_restore_regs 
                                        
                                            .macro _dbg_getc 
                                        
                                            .macro _dbg_putc 
                                        
                                            .macro _dbg_puts 
                                        
                                            .macro _dbg_prti24 
                                        
                                            .macro _dbg_prt_regs
                                        
                                            .macro _dbg_peek addr 
                                        
                                            .macro _dbg_parser_init 
                                        
                                            .macro _dbg_readln
                                        
                                            .macro _dbg_number
                                        
                                            .macro _dbg_nextword
                                        
                                            .macro _dbg_dots 
                                        
                                            .macro _dbg_trap
                                        
                                            .macro _dbg_mark n  
                                            
                                            .macro _dbg_prt_var var 
                                        
                                            .macro _dbg_show 
                                     34     .list 
                                     35 
      000000                         36 _dbg 
                           000001     1     DEBUG=1
                                     37 
                                     38 ;--------------------------------------
                                     39     .area DATA 
                                     40 ;--------------------------------------	
                                     41 
                           000050    42 	TIB_SIZE=80
                           000028    43     PAD_SIZE=40
                           000040    44 	DSTACK_SIZE=64 
                           000080    45 	STACK_SIZE=128
                           0017FF    46 	STACK_EMPTY=RAM_SIZE-1  
                           000000    47 	FRUN=0 ; flags run code in variable flags
                           000001    48 	FTRAP=1 ; inside trap handler 
                           000002    49 	FFOR=2 ; FOR loop in preparation 
                           000003    50 	FSLEEP=3 ; halt produit par la commande SLEEP 
                           000004    51 	FBREAK=4 ; break point flag 
                           000005    52 	FCOMP=5  ; compiling flags 
                                     53 
      000000                         54 in.w:  .blkb 1 ; parser position in text line
      000001                         55 in:    .blkb 1 ; low byte of in.w
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 2.
Hexadecimal [24-Bits]



      000002                         56 count: .blkb 1 ; length of string in text line  
      000003                         57 basicptr:  .blkb 2  ; point to text buffer 
      000005                         58 lineno: .blkb 2  ; BASIC line number 
      000007                         59 base:  .blkb 1 ; nemeric base used to print integer 
      000008                         60 acc24: .blkb 1 ; 24 accumulator
      000009                         61 acc16: .blkb 1
      00000A                         62 acc8:  .blkb 1
      00000B                         63 ticks: .blkw 1 ; milliseconds ticks counter (see Timer4UpdateHandler)
      00000D                         64 seedx: .blkw 1  ; xorshift 16 seed x 
      00000F                         65 seedy: .blkw 1  ; xorshift 16 seed y 
      000011                         66 in.w.saved: .blkw 1 ; set by get_token before parsing next token, used by unget_token
      000013                         67 farptr: .blkb 1 ; far pointer used by file system
      000014                         68 ptr16:  .blkb 1 ; middle byte of farptr
      000015                         69 ptr8:   .blkb 1 ; least byte of farptr 
      000016                         70 ffree: .blkb 3 ; flash free address ; file system free space pointer
      000019                         71 dstkptr: .blkw 1  ; data stack pointer 
      00001B                         72 txtbgn: .ds 2 ; BASIC text beginning address 
      00001D                         73 txtend: .ds 2 ; BASIC text end address 
      00001F                         74 loop_depth: .ds 1 ; FOR loop depth, level of nested loop.  
      000020                         75 array_addr: .ds 2 ; address of @ array 
      000022                         76 array_size: .ds 2 ; array size 
      000024                         77 flags: .ds 1 ; boolean flags
      000025                         78 tab_width: .ds 1 ; print colon width (4)
      000026                         79 vars: .ds 2*26 ; BASIC variables A-Z, keep it as but last .
                                     80 ; keep as last variable 
      00005A                         81 free_ram: ; from here RAM free for BASIC text 
                                     82 
                                     83 ;-----------------------------------
                                     84     .area SSEG (ABS)
                                     85 ;-----------------------------------	
      0016C8                         86     .org RAM_SIZE-STACK_SIZE-TIB_SIZE-PAD_SIZE-DSTACK_SIZE 
      0016C8                         87 tib: .ds TIB_SIZE             ; transaction input buffer
      001718                         88 pad: .ds PAD_SIZE             ; working buffer
      001740                         89 dstack: .ds DSTACK_SIZE 	  ; data stack used by FOR...NEXT 
      001780                         90 dstack_unf: ; dstack underflow ; data stack bottom 
      001780                         91 stack_full: .ds STACK_SIZE   ; control stack 
      001800                         92 stack_unf: ; stack underflow ; control_stack bottom 
                                     93 
                                     94 
                                     95 ;--------------------------------------
                                     96     .area HOME 
                                     97 ;--------------------------------------
      000000 82 00 05 1A             98     int cold_start
                           000001    99 .if DEBUG
      000004 82 00 00 0A            100 	int TrapHandler 		;TRAP  software interrupt
                           000000   101 .else
                                    102 	int NonHandledInterrupt ;TRAP  software interrupt
                                    103 .endif
      000008 82 00 00 09            104 	int NonHandledInterrupt ;int0 TLI   external top level interrupt
      00000C 82 00 00 09            105 	int NonHandledInterrupt ;int1 AWU   auto wake up from halt
      000010 82 00 00 09            106 	int NonHandledInterrupt ;int2 CLK   clock controller
      000014 82 00 00 09            107 	int NonHandledInterrupt ;int3 EXTI0 gpio A external interrupts
      000018 82 00 00 09            108 	int NonHandledInterrupt ;int4 EXTI1 gpio B external interrupts
      00001C 82 00 00 09            109 	int NonHandledInterrupt ;int5 EXTI2 gpio C external interrupts
      000020 82 00 00 09            110 	int NonHandledInterrupt ;int6 EXTI3 gpio D external interrupts
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 3.
Hexadecimal [24-Bits]



      000024 82 00 00 25            111 	int UserButtonHandler   ;int7 EXTI4 gpio E external interrupts
      000028 82 00 00 09            112 	int NonHandledInterrupt ;int8 beCAN RX interrupt
      00002C 82 00 00 09            113 	int NonHandledInterrupt ;int9 beCAN TX/ER/SC interrupt
      000030 82 00 00 09            114 	int NonHandledInterrupt ;int10 SPI End of transfer
      000034 82 00 00 09            115 	int NonHandledInterrupt ;int11 TIM1 update/overflow/underflow/trigger/break
      000038 82 00 00 09            116 	int NonHandledInterrupt ;int12 TIM1 capture/compare
      00003C 82 00 00 09            117 	int NonHandledInterrupt ;int13 TIM2 update /overflow
      000040 82 00 00 09            118 	int NonHandledInterrupt ;int14 TIM2 capture/compare
      000044 82 00 00 09            119 	int NonHandledInterrupt ;int15 TIM3 Update/overflow
      000048 82 00 00 09            120 	int NonHandledInterrupt ;int16 TIM3 Capture/compare
      00004C 82 00 00 09            121 	int NonHandledInterrupt ;int17 UART1 TX completed
      000050 82 00 00 09            122 	int NonHandledInterrupt ;int18 UART1 RX full
      000054 82 00 00 09            123 	int NonHandledInterrupt ;int19 I2C 
      000058 82 00 00 09            124 	int NonHandledInterrupt ;int20 UART3 TX completed
      00005C 82 00 00 09            125 	int NonHandledInterrupt ;int21 UART3 RX full
      000060 82 00 00 09            126 	int NonHandledInterrupt ;int22 ADC2 end of conversion
      000064 82 00 00 19            127 	int Timer4UpdateHandler	;int23 TIM4 update/overflow used as msec ticks counter
      000068 82 00 00 09            128 	int NonHandledInterrupt ;int24 flash writing EOP/WR_PG_DIS
      00006C 82 00 00 09            129 	int NonHandledInterrupt ;int25  not used
      000070 82 00 00 09            130 	int NonHandledInterrupt ;int26  not used
      000074 82 00 00 09            131 	int NonHandledInterrupt ;int27  not used
      000078 82 00 00 09            132 	int NonHandledInterrupt ;int28  not used
      00007C 82 00 00 09            133 	int NonHandledInterrupt ;int29  not used
                                    134 
                                    135 ;---------------------------------------
                                    136     .area CODE
                                    137 ;---------------------------------------
                           000001   138 .if DEBUG
      000000 53 54 4D 38 5F 54 42   139 .asciz "STM8_TBI" ; I like to put module name here.
             49 00
                                    140 .endif 
                                    141 
      000009                        142 NonHandledInterrupt:
      000009 71                     143     .byte 0x71  ; reinitialize MCU
                                    144 
                                    145 
                                    146 ;------------------------------------
                                    147 ; software interrupt handler  
                                    148 ;------------------------------------
                           000001   149 .if DEBUG 
      00000A                        150 TrapHandler:
      00000A 72 12 00 24      [ 1]  151 	bset flags,#FTRAP 
      00000E CD 08 5C         [ 4]  152 	call print_registers
      000011 CD 0A CB         [ 4]  153 	call cmd_itf
      000014 72 13 00 24      [ 1]  154 	bres flags,#FTRAP 	
      000018 80               [11]  155 	iret
                                    156 .endif 
                                    157 
      000019                        158 Timer4UpdateHandler:
      000019 72 5F 53 42      [ 1]  159 	clr TIM4_SR 
      00001D CE 00 0B         [ 2]  160 	ldw x,ticks
      000020 5C               [ 1]  161 	incw x
      000021 CF 00 0B         [ 2]  162 	ldw ticks,x 
      000024 80               [11]  163 	iret 
                                    164 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 4.
Hexadecimal [24-Bits]



                                    165 
                                    166 ;------------------------------------
                                    167 ; Triggered by pressing USER UserButton 
                                    168 ; on NUCLEO card.
                                    169 ;------------------------------------
      000025                        170 UserButtonHandler:
                                    171 ; wait button release
      000025 5F               [ 1]  172 	clrw x
      000026 5A               [ 2]  173 1$: decw x 
      000027 26 FD            [ 1]  174 	jrne 1$
      000029 72 09 50 15 F8   [ 2]  175 	btjf USR_BTN_PORT,#USR_BTN_BIT, 1$
                                    176 ; if MCU suspended by SLEEP resume program
      00002E 72 07 00 24 05   [ 2]  177     btjf flags,#FSLEEP,2$
      000033 72 17 00 24      [ 1]  178 	bres flags,#FSLEEP 
      000037 80               [11]  179 	iret
      000038 72 00 00 24 03   [ 2]  180 2$:	btjt flags,#FRUN,4$
      00003D CC 00 76         [ 2]  181 	jp 9$ 
      000040                        182 4$:	; program interrupted by user 
      000040 72 11 00 24      [ 1]  183 	bres flags,#FRUN 
      000044 AE 00 7E         [ 2]  184 	ldw x,#USER_ABORT
      000047 CD 01 B0         [ 4]  185 	call puts 
      00004A CE 00 03         [ 2]  186 	ldw x,basicptr
      00004D FE               [ 2]  187 	ldw x,(x)
                                    188 ; print line number 
      00004E 35 0A 00 07      [ 1]  189 	mov base,#10 
      000052 35 06 00 25      [ 1]  190 	mov tab_width,#6
      000056 CD 09 4F         [ 4]  191 	call print_int  	
      000059 CE 00 03         [ 2]  192 	ldw x,basicptr 
      00005C 1C 00 03         [ 2]  193 	addw x,#3  
      00005F CD 01 B0         [ 4]  194 	call puts 
      000062 A6 0D            [ 1]  195 	ld a,#CR 
      000064 CD 01 9E         [ 4]  196 	call putc
      000067 5F               [ 1]  197 	clrw x  
      000068 C6 00 01         [ 1]  198 	ld a,in 
      00006B AB 03            [ 1]  199 	add a,#3 ; adjustment for line number display 
      00006D 97               [ 1]  200 	ld xl,a 
      00006E CD 01 D8         [ 4]  201 	call spaces 
      000071 A6 5E            [ 1]  202 	ld a,#'^
      000073 CD 01 9E         [ 4]  203 	call putc 
      000076                        204 9$:
      000076 AE 17 FF         [ 2]  205     ldw x,#STACK_EMPTY 
      000079 94               [ 1]  206     ldw sp,x
      00007A 9A               [ 1]  207 	rim 
      00007B CC 07 29         [ 2]  208 	jp warm_start
                                    209 
      00007E 0A 50 72 6F 67 72 61   210 USER_ABORT: .asciz "\nProgram aborted by user.\n"
             6D 20 61 62 6F 72 74
             65 64 20 62 79 20 75
             73 65 72 2E 0A 00
                                    211 
                                    212 
                                    213 ;----------------------------------------
                                    214 ; inialize MCU clock 
                                    215 ; input:
                                    216 ;   A 		source  HSI | 1 HSE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 5.
Hexadecimal [24-Bits]



                                    217 ;   XL      CLK_CKDIVR , clock divisor 
                                    218 ; output:
                                    219 ;   none 
                                    220 ;----------------------------------------
      000099                        221 clock_init:	
      000099 C1 50 C3         [ 1]  222 	cp a,CLK_CMSR 
      00009C 27 0C            [ 1]  223 	jreq 2$ ; no switching required 
                                    224 ; select clock source 
      00009E 72 12 50 C5      [ 1]  225 	bset CLK_SWCR,#CLK_SWCR_SWEN
      0000A2 C7 50 C4         [ 1]  226 	ld CLK_SWR,a
      0000A5 C1 50 C3         [ 1]  227 1$:	cp a,CLK_CMSR
      0000A8 26 FB            [ 1]  228 	jrne 1$
      0000AA                        229 2$: 	
                                    230 ; HSI and cpu clock divisor 
      0000AA 9F               [ 1]  231 	ld a,xl 
      0000AB C7 50 C6         [ 1]  232 	ld CLK_CKDIVR,a  
      0000AE 81               [ 4]  233 	ret
                                    234 
                                    235 ;---------------------------------
                                    236 ; TIM4 is configured to generate an 
                                    237 ; interrupt every millisecond 
                                    238 ;----------------------------------
      0000AF                        239 timer4_init:
      0000AF 35 07 53 45      [ 1]  240 	mov TIM4_PSCR,#7 ; prescale 128  
      0000B3 35 7D 53 46      [ 1]  241 	mov TIM4_ARR,#125 ; set for 1msec.
      0000B7 35 05 53 40      [ 1]  242 	mov TIM4_CR1,#((1<<TIM4_CR1_CEN)|(1<<TIM4_CR1_URS))
      0000BB 72 10 53 41      [ 1]  243 	bset TIM4_IER,#TIM4_IER_UIE 
      0000BF 81               [ 4]  244 	ret
                                    245 
                                    246 ;----------------------------------
                                    247 ; unlock EEPROM for writing/erasing
                                    248 ; wait endlessly for FLASH_IAPSR_DUL bit.
                                    249 ; input:
                                    250 ;  none
                                    251 ; output:
                                    252 ;  none 
                                    253 ;----------------------------------
      0000C0                        254 unlock_eeprom:
      0000C0 35 AE 50 64      [ 1]  255 	mov FLASH_DUKR,#FLASH_DUKR_KEY1
      0000C4 35 56 50 64      [ 1]  256     mov FLASH_DUKR,#FLASH_DUKR_KEY2
      0000C8 72 07 50 5F FB   [ 2]  257 	btjf FLASH_IAPSR,#FLASH_IAPSR_DUL,.
      0000CD 81               [ 4]  258 	ret
                                    259 
                                    260 ;----------------------------------
                                    261 ; unlock FLASH for writing/erasing
                                    262 ; wait endlessly for FLASH_IAPSR_PUL bit.
                                    263 ; input:
                                    264 ;  none
                                    265 ; output:
                                    266 ;  none
                                    267 ;----------------------------------
      0000CE                        268 unlock_flash:
      0000CE 35 56 50 62      [ 1]  269 	mov FLASH_PUKR,#FLASH_PUKR_KEY1
      0000D2 35 AE 50 62      [ 1]  270 	mov FLASH_PUKR,#FLASH_PUKR_KEY2
      0000D6 72 03 50 5F FB   [ 2]  271 	btjf FLASH_IAPSR,#FLASH_IAPSR_PUL,.
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 6.
Hexadecimal [24-Bits]



      0000DB 81               [ 4]  272 	ret
                                    273 
                           000000   274 	BLOCK_ERASE=0
                                    275 ;----------------------------
                                    276 ; erase block code must be 
                                    277 ;executed from RAM
                                    278 ;-----------------------------
                           000000   279 .if BLOCK_ERASE 
                                    280 ; this code is copied to RAM 
                                    281 erase_start:
                                    282 	clr a 
                                    283     bset FLASH_CR2,#FLASH_CR2_ERASE
                                    284     bres FLASH_NCR2,#FLASH_CR2_ERASE
                                    285 	ldf [farptr],a
                                    286     inc farptr+2 
                                    287     ldf [farptr],a
                                    288     inc farptr+2 
                                    289     ldf [farptr],a
                                    290     inc farptr+2 
                                    291     ldf [farptr],a
                                    292 	btjf FLASH_IAPSR,#FLASH_IAPSR_EOP,.
                                    293 	ret
                                    294 erase_end:
                                    295 
                                    296 ; copy erase_start in RAM 
                                    297 move_code_in_ram:
                                    298 	ldw x,#erase_end 
                                    299 	subw x,#erase_start
                                    300 	ldw acc16,x 
                                    301 	ldw x,#pad 
                                    302 	ldw y,#erase_start 
                                    303 	call move 
                                    304 	ret 
                                    305 
                                    306 ;-----------------------------------
                                    307 ; erase flash or EEPROM block 
                                    308 ; a block is 128 bytes 
                                    309 ; input:
                                    310 ;   farptr  address block begin
                                    311 ; output:
                                    312 ;   none
                                    313 ;--------------------------------------
                                    314 erase_block:
                                    315 	ldw x,farptr+1 
                                    316 	pushw x 
                                    317 	call move_code_in_ram 
                                    318 	popw x 
                                    319 	ldw farptr+1,x 
                                    320 	tnz farptr
                                    321 	jrne erase_flash 
                                    322 	ldw x,#FLASH_BASE 
                                    323 	cpw x,farptr+1 
                                    324 	jrpl erase_flash 
                                    325 ; erase eeprom block
                                    326 	call unlock_eeprom 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 7.
Hexadecimal [24-Bits]



                                    327 	sim 
                                    328 	call pad   
                                    329 	bres FLASH_IAPSR,#FLASH_IAPSR_DUL
                                    330 	rim 
                                    331 	ret 
                                    332 ; erase flash block:
                                    333 erase_flash:
                                    334 	call unlock_flash 
                                    335 	bset FLASH_CR2,#FLASH_CR2_ERASE
                                    336 	bres FLASH_NCR2,#FLASH_CR2_ERASE
                                    337 	clr a 
                                    338 	sim 
                                    339 	call pad 
                                    340     bres FLASH_IAPSR,#FLASH_IAPSR_PUL
                                    341 	rim 
                                    342 	ret 
                                    343 .endif ; BLOCK_ERASE 
                                    344 
                                    345 
                                    346 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
                                    347 ; write a byte to FLASH or EEPROM 
                                    348 ; input:
                                    349 ;    a  		byte to write
                                    350 ;    farptr  	address
                                    351 ;    x          farptr[x]
                                    352 ; output:
                                    353 ;    none
                                    354 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    355 	; variables locales
                           000001   356 	BTW = 1   ; byte to write offset on stack
                           000002   357 	OPT = 2   ; OPTION flag offset on stack
                           000002   358 	VSIZE = 2
      0000DC                        359 write_byte:
      0000DC 90 89            [ 2]  360 	pushw y
      0000DE                        361 	_vars VSIZE
      0000DE 52 02            [ 2]    1     sub sp,#VSIZE 
      0000E0 6B 01            [ 1]  362 	ld (BTW,sp),a ; byte to write 
      0000E2 0F 02            [ 1]  363 	clr (OPT,sp)  ; OPTION flag
                                    364 ; put addr[15:0] in Y, for bounds check.
      0000E4 90 CE 00 14      [ 2]  365 	ldw y,farptr+1   ; Y=addr15:0
                                    366 ; check addr[23:16], if <> 0 then it is extened flash memory
      0000E8 72 5D 00 13      [ 1]  367 	tnz farptr 
      0000EC 26 14            [ 1]  368 	jrne write_flash
      0000EE 90 A3 21 00      [ 2]  369     cpw y,#user_space
      0000F2 24 0E            [ 1]  370     jruge write_flash
      0000F4 90 A3 40 00      [ 2]  371 	cpw y,#EEPROM_BASE  
      0000F8 25 52            [ 1]  372     jrult write_exit
      0000FA 90 A3 48 00      [ 2]  373 	cpw y,#OPTION_BASE
      0000FE 25 18            [ 1]  374 	jrult write_eeprom
      000100 20 4A            [ 2]  375     jra write_exit
                                    376 ; write program memory
      000102                        377 write_flash:
      000102 CD 00 CE         [ 4]  378 	call unlock_flash 
      000105 9B               [ 1]  379 1$:	sim 
      000106 7B 01            [ 1]  380 	ld a,(BTW,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 8.
Hexadecimal [24-Bits]



      000108 92 A7 00 13      [ 4]  381 	ldf ([farptr],x),a ; farptr[x]=A
      00010C 72 05 50 5F FB   [ 2]  382 	btjf FLASH_IAPSR,#FLASH_IAPSR_EOP,.
      000111 9A               [ 1]  383     rim 
      000112 72 13 50 5F      [ 1]  384     bres FLASH_IAPSR,#FLASH_IAPSR_PUL
      000116 20 34            [ 2]  385     jra write_exit
                                    386 ; write eeprom and option
      000118                        387 write_eeprom:
      000118 CD 00 C0         [ 4]  388 	call unlock_eeprom
                                    389 	; check for data eeprom or option eeprom
      00011B 90 A3 48 00      [ 2]  390 	cpw y,#OPTION_BASE
      00011F 2B 08            [ 1]  391 	jrmi 1$
      000121 90 A3 48 80      [ 2]  392 	cpw y,#OPTION_END+1
      000125 2A 02            [ 1]  393 	jrpl 1$
      000127 03 02            [ 1]  394 	cpl (OPT,sp)
      000129                        395 1$: 
      000129 0D 02            [ 1]  396     tnz (OPT,sp)
      00012B 27 08            [ 1]  397     jreq 2$
                                    398 	; pour modifier une option il faut modifier ces 2 bits
      00012D 72 1E 50 5B      [ 1]  399     bset FLASH_CR2,#FLASH_CR2_OPT
      000131 72 1F 50 5C      [ 1]  400     bres FLASH_NCR2,#FLASH_CR2_OPT 
      000135                        401 2$: 
      000135 7B 01            [ 1]  402     ld a,(BTW,sp)
      000137 92 A7 00 13      [ 4]  403     ldf ([farptr],x),a
      00013B 0D 02            [ 1]  404     tnz (OPT,sp)
      00013D 27 08            [ 1]  405     jreq 3$
      00013F 5C               [ 1]  406     incw x
      000140 7B 01            [ 1]  407     ld a,(BTW,sp)
      000142 43               [ 1]  408     cpl a
      000143 92 A7 00 13      [ 4]  409     ldf ([farptr],x),a
      000147 72 05 50 5F FB   [ 2]  410 3$: btjf FLASH_IAPSR,#FLASH_IAPSR_EOP,.
      00014C                        411 write_exit:
      00014C                        412 	_drop VSIZE 
      00014C 5B 02            [ 2]    1     addw sp,#VSIZE 
      00014E 90 85            [ 2]  413 	popw y
      000150 81               [ 4]  414     ret
                                    415 
                                    416 ;--------------------------------------------
                                    417 ; write a data block to eeprom or flash 
                                    418 ; input:
                                    419 ;   Y        source address   
                                    420 ;   X        array index  destination  farptr[x]
                                    421 ;   BSIZE    block size bytes 
                                    422 ;   farptr   write address , byte* 
                                    423 ; output:
                                    424 ;	X 		after last byte written 
                                    425 ;   Y 		after last byte read 
                                    426 ;  farptr   point after block
                                    427 ;---------------------------------------------
      000151                        428 	_argofs 2 
                           000004     1     ARG_OFS=2+2 
      000151                        429 	_arg BSIZE 1  ; block size
                           000005     1     BSIZE=ARG_OFS+1 
                                    430 	; local var 
                           000001   431 	XSAVE=1 
                           000002   432 	VSIZE=2 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 9.
Hexadecimal [24-Bits]



      000151                        433 write_block:
      000151                        434 	_vars VSIZE
      000151 52 02            [ 2]    1     sub sp,#VSIZE 
      000153 1F 01            [ 2]  435 	ldw (XSAVE,sp),x 
      000155 1E 05            [ 2]  436 	ldw x,(BSIZE,sp) 
      000157 27 13            [ 1]  437 	jreq 9$
      000159 1E 01            [ 2]  438 1$:	ldw x,(XSAVE,sp)
      00015B 90 F6            [ 1]  439 	ld a,(y)
      00015D CD 00 DC         [ 4]  440 	call write_byte 
      000160 5C               [ 1]  441 	incw x 
      000161 90 5C            [ 1]  442 	incw y 
      000163 1F 01            [ 2]  443 	ldw (XSAVE,sp),x
      000165 1E 05            [ 2]  444 	ldw x,(BSIZE,sp)
      000167 5A               [ 2]  445 	decw x
      000168 1F 05            [ 2]  446 	ldw (BSIZE,sp),x 
      00016A 26 ED            [ 1]  447 	jrne 1$
      00016C                        448 9$:
      00016C 1E 01            [ 2]  449 	ldw x,(XSAVE,sp)
      00016E CD 19 E7         [ 4]  450 	call incr_farptr
      000171                        451 	_drop VSIZE
      000171 5B 02            [ 2]    1     addw sp,#VSIZE 
      000173 81               [ 4]  452 	ret 
                                    453 
                                    454 
                                    455 ;---------------------------------------------
                                    456 ;   UART3 subroutines
                                    457 ;---------------------------------------------
                                    458 
                                    459 ;---------------------------------------------
                                    460 ; initialize UART3, 115200 8N1
                                    461 ; input:
                                    462 ;	none
                                    463 ; output:
                                    464 ;   none
                                    465 ;---------------------------------------------
      000174                        466 uart3_init:
                                    467 	; configure tx pin
      000174 72 1A 50 11      [ 1]  468 	bset PD_DDR,#BIT5 ; tx pin
      000178 72 1A 50 12      [ 1]  469 	bset PD_CR1,#BIT5 ; push-pull output
      00017C 72 1A 50 13      [ 1]  470 	bset PD_CR2,#BIT5 ; fast output
      000180                        471 uart3_set_baud: 
                                    472 ; baud rate 115200 Fmaster=8Mhz  8000000/115200=69=0x45
                                    473 ; 1) check clock source, HSI at 16Mhz or HSE at 8Mhz  
      000180 A6 E1            [ 1]  474 	ld a,#CLK_SWR_HSI
      000182 C1 50 C3         [ 1]  475 	cp a,CLK_CMSR 
      000185 27 0A            [ 1]  476 	jreq hsi_clock 
      000187                        477 hse_clock: ; 8 Mhz 	
      000187 35 05 52 43      [ 1]  478 	mov UART3_BRR2,#0x05 ; must be loaded first
      00018B 35 04 52 42      [ 1]  479 	mov UART3_BRR1,#0x4
      00018F 20 08            [ 2]  480 	jra uart_enable
      000191                        481 hsi_clock: ; 16 Mhz 	
      000191 35 0B 52 43      [ 1]  482 	mov UART3_BRR2,#0x0b ; must be loaded first
      000195 35 08 52 42      [ 1]  483 	mov UART3_BRR1,#0x08
      000199                        484 uart_enable:	
      000199 35 0C 52 45      [ 1]  485 	mov UART3_CR2,#((1<<UART_CR2_TEN)|(1<<UART_CR2_REN));
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 10.
Hexadecimal [24-Bits]



      00019D 81               [ 4]  486 	ret
                                    487 	
                                    488 ;---------------------------------
                                    489 ; send character to UART3 
                                    490 ; input:
                                    491 ;   A 
                                    492 ; output:
                                    493 ;   none 
                                    494 ;--------------------------------	
      00019E                        495 putc:
      00019E 72 0F 52 40 FB   [ 2]  496 	btjf UART3_SR,#UART_SR_TXE,.
      0001A3 C7 52 41         [ 1]  497 	ld UART3_DR,a 
      0001A6 81               [ 4]  498 	ret 
                                    499 
                                    500 ;---------------------------------
                                    501 ; wait character from UART3 
                                    502 ; input:
                                    503 ;   none
                                    504 ; output:
                                    505 ;   A 			char  
                                    506 ;--------------------------------	
      0001A7                        507 getc:
      0001A7 72 0B 52 40 FB   [ 2]  508 	btjf UART3_SR,#UART_SR_RXNE,.
      0001AC C6 52 41         [ 1]  509 	ld a,UART3_DR 
      0001AF 81               [ 4]  510 	ret 
                                    511 
                                    512 ;-----------------------------
                                    513 ; send an ASCIZ string to UART3 
                                    514 ; input: 
                                    515 ;   x 		char * 
                                    516 ; output:
                                    517 ;   none 
                                    518 ;-------------------------------
      0001B0                        519 puts:
      0001B0 F6               [ 1]  520     ld a,(x)
      0001B1 27 06            [ 1]  521 	jreq 1$
      0001B3 CD 01 9E         [ 4]  522 	call putc 
      0001B6 5C               [ 1]  523 	incw x 
      0001B7 20 F7            [ 2]  524 	jra puts 
      0001B9 81               [ 4]  525 1$:	ret 
                                    526 
                                    527 
                                    528 ;---------------------------
                                    529 ; delete character at left 
                                    530 ; of cursor on terminal 
                                    531 ; input:
                                    532 ;   none 
                                    533 ; output:
                                    534 ;	none 
                                    535 ;---------------------------
      0001BA                        536 bksp:
      0001BA A6 08            [ 1]  537 	ld a,#BSP 
      0001BC CD 01 9E         [ 4]  538 	call putc 
      0001BF A6 20            [ 1]  539 	ld a,#SPACE 
      0001C1 CD 01 9E         [ 4]  540 	call putc 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 11.
Hexadecimal [24-Bits]



      0001C4 A6 08            [ 1]  541 	ld a,#BSP 
      0001C6 CD 01 9E         [ 4]  542 	call putc 
      0001C9 81               [ 4]  543 	ret 
                                    544 ;---------------------------
                                    545 ; delete n character left of cursor 
                                    546 ; at terminal.
                                    547 ; input: 
                                    548 ;   A   	number of characters to delete.
                                    549 ; output:
                                    550 ;    none 
                                    551 ;--------------------------	
      0001CA                        552 delete:
      0001CA 88               [ 1]  553 	push a 
      0001CB 0D 01            [ 1]  554 0$:	tnz (1,sp)
      0001CD 27 07            [ 1]  555 	jreq 1$
      0001CF CD 01 BA         [ 4]  556 	call bksp 
      0001D2 0A 01            [ 1]  557 	dec (1,sp)
      0001D4 20 F5            [ 2]  558 	jra 0$
      0001D6 84               [ 1]  559 1$:	pop a 
      0001D7 81               [ 4]  560 	ret
                                    561 
                                    562 ;--------------------------
                                    563 ; print n spaces on terminal
                                    564 ; input:
                                    565 ;  X 		number of spaces 
                                    566 ; output:
                                    567 ;	none 
                                    568 ;---------------------------
      0001D8                        569 spaces:
      0001D8 A6 20            [ 1]  570 	ld a,#SPACE 
      0001DA 5D               [ 2]  571 1$:	tnzw x
      0001DB 27 06            [ 1]  572 	jreq 9$
      0001DD CD 01 9E         [ 4]  573 	call putc 
      0001E0 5A               [ 2]  574 	decw x
      0001E1 20 F7            [ 2]  575 	jra 1$
      0001E3                        576 9$: 
      0001E3 81               [ 4]  577 	ret 
                                    578 
                           000001   579 .if DEBUG 
                                    580 ;---------------------------------
                                    581 ;; print actual registers states 
                                    582 ;; as pushed on stack 
                                    583 ;; {Y,X,CC,A}
                                    584 ;---------------------------------
      0001E4                        585 	_argofs 0  
                           000002     1     ARG_OFS=2+0 
      0001E4                        586 	_arg R_Y 1 
                           000003     1     R_Y=ARG_OFS+1 
      0001E4                        587 	_arg R_X 3
                           000005     1     R_X=ARG_OFS+3 
      0001E4                        588 	_arg R_A 5
                           000007     1     R_A=ARG_OFS+5 
      0001E4                        589 	_arg R_CC 6
                           000008     1     R_CC=ARG_OFS+6 
      0001E4                        590 prt_regs:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 12.
Hexadecimal [24-Bits]



      0001E4 AE 02 27         [ 2]  591 	ldw x,#regs_state 
      0001E7 CD 01 B0         [ 4]  592 	call puts
                                    593 ; register PC
      0001EA 16 01            [ 2]  594 	ldw y,(1,sp)
      0001EC AE 08 EC         [ 2]  595 	ldw x,#REG_EPC 
      0001EF CD 08 3D         [ 4]  596 	call prt_reg16 
                                    597 ; register CC 
      0001F2 7B 08            [ 1]  598 	ld a,(R_CC,sp)
      0001F4 AE 08 FD         [ 2]  599 	ldw x,#REG_CC 
      0001F7 CD 08 18         [ 4]  600 	call prt_reg8 
                                    601 ; register A 
      0001FA 7B 07            [ 1]  602 	ld a,(R_A,sp)
      0001FC AE 08 F9         [ 2]  603 	ldw x,#REG_A 
      0001FF CD 08 18         [ 4]  604 	call prt_reg8 
                                    605 ; register X 
      000202 16 05            [ 2]  606 	ldw y,(R_X,sp)
      000204 AE 08 F5         [ 2]  607 	ldw x,#REG_X 
      000207 CD 08 3D         [ 4]  608 	call prt_reg16 
                                    609 ; register Y 
      00020A 16 03            [ 2]  610 	ldw y,(R_Y,sp)
      00020C AE 08 F1         [ 2]  611 	ldw x,#REG_Y 
      00020F CD 08 3D         [ 4]  612 	call prt_reg16 
                                    613 ; register SP 
      000212 90 96            [ 1]  614 	ldw y,sp
      000214 72 A9 00 08      [ 2]  615 	addw y,#6+ARG_OFS  
      000218 AE 09 02         [ 2]  616 	ldw x,#REG_SP
      00021B CD 08 3D         [ 4]  617 	call prt_reg16
      00021E A6 0D            [ 1]  618 	ld a,#CR 
      000220 CD 01 9E         [ 4]  619 	call putc
      000223 CD 01 9E         [ 4]  620 	call putc   
      000226 81               [ 4]  621 	ret 
                                    622 
      000227 0A 72 65 67 69 73 74   623 regs_state: .asciz "\nregisters state\n--------------------\n"
             65 72 73 20 73 74 61
             74 65 0A 2D 2D 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 0A 00
                                    624 
                                    625 
                                    626 ;--------------------
                                    627 ; print content at address in hex.
                                    628 ; input:
                                    629 ;   X 	address to peek 
                                    630 ; output:
                                    631 ;	none 
                                    632 ;--------------------	
      00024E                        633 prt_peek:
      00024E 89               [ 2]  634 	pushw x 
      00024F CF 00 09         [ 2]  635 	ldw acc16,x 
      000252 72 5F 00 08      [ 1]  636 	clr acc24 
      000256 5F               [ 1]  637 	clrw x 
      000257 A6 10            [ 1]  638 	ld a,#16 
      000259 CD 09 07         [ 4]  639 	call prti24 
      00025C A6 3A            [ 1]  640 	ld a,#': 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 13.
Hexadecimal [24-Bits]



      00025E CD 01 9E         [ 4]  641 	call putc 
      000261 A6 20            [ 1]  642 	ld a,#SPACE 
      000263 CD 01 9E         [ 4]  643 	call putc 
      000266 85               [ 2]  644 	popw x 
      000267 F6               [ 1]  645 	ld a,(x)
      000268 C7 00 0A         [ 1]  646 	ld acc8,a 
      00026B 5F               [ 1]  647 	clrw x 
      00026C A6 10            [ 1]  648 	ld a,#16 
      00026E CD 09 07         [ 4]  649 	call prti24
      000271 81               [ 4]  650 	ret 
                                    651 .endif ; DEBUG  
                                    652 
                                    653 ;-------------------------------------
                                    654 ; retrun string length
                                    655 ; input:
                                    656 ;   X         .asciz  
                                    657 ; output:
                                    658 ;   X         length 
                                    659 ;-------------------------------------
      000272                        660 strlen:
      000272 90 93            [ 1]  661 	ldw y,x 
      000274 5F               [ 1]  662 	clrw x 
      000275 90 7D            [ 1]  663 1$:	tnz (y) 
      000277 27 05            [ 1]  664 	jreq 9$ 
      000279 5C               [ 1]  665 	incw x
      00027A 90 5C            [ 1]  666 	incw y 
      00027C 20 F7            [ 2]  667 	jra 1$ 
      00027E 81               [ 4]  668 9$: ret 
                                    669 
                                    670 ;------------------------------------
                                    671 ; compare 2 strings
                                    672 ; input:
                                    673 ;   X 		char* first string 
                                    674 ;   Y       char* second string 
                                    675 ; output:
                                    676 ;   A 		0|1 
                                    677 ;-------------------------------------
      00027F                        678 strcmp:
      00027F F6               [ 1]  679 	ld a,(x)
      000280 27 0B            [ 1]  680 	jreq 5$ 
      000282 90 F1            [ 1]  681 	cp a,(y) 
      000284 26 05            [ 1]  682 	jrne 4$ 
      000286 5C               [ 1]  683 	incw x 
      000287 90 5C            [ 1]  684 	incw y 
      000289 20 F4            [ 2]  685 	jra strcmp 
      00028B                        686 4$: ; not same  
      00028B 4F               [ 1]  687 	clr a 
      00028C 81               [ 4]  688 	ret 
      00028D                        689 5$: ; same 
      00028D A6 01            [ 1]  690 	ld a,#1 
      00028F 81               [ 4]  691 	ret 
                                    692 
                                    693 
                                    694 ;---------------------------------------
                                    695 ;  copy src to dest 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 14.
Hexadecimal [24-Bits]



                                    696 ; input:
                                    697 ;   X 		dest 
                                    698 ;   Y 		src 
                                    699 ; output: 
                                    700 ;   X 		dest 
                                    701 ;----------------------------------
      000290                        702 strcpy:
      000290 89               [ 2]  703 	pushw x 
      000291 90 F6            [ 1]  704 1$: ld a,(y)
      000293 27 06            [ 1]  705 	jreq 9$ 
      000295 F7               [ 1]  706 	ld (x),a 
      000296 5C               [ 1]  707 	incw x 
      000297 90 5C            [ 1]  708 	incw y 
      000299 20 F6            [ 2]  709 	jra 1$ 
      00029B 7F               [ 1]  710 9$:	clr (x)
      00029C 85               [ 2]  711 	popw x 
      00029D 81               [ 4]  712 	ret 
                                    713 
                                    714 ;---------------------------------------
                                    715 ; move memory block 
                                    716 ; input:
                                    717 ;   X 		destination 
                                    718 ;   Y 	    source 
                                    719 ;   acc16	size 
                                    720 ; output:
                                    721 ;   none 
                                    722 ;--------------------------------------
                           000001   723 	INCR=1 ; increament high byte 
                           000002   724 	LB=2 ; increament low byte 
                           000002   725 	VSIZE=2
      00029E                        726 move:
      00029E                        727 	_vars VSIZE 
      00029E 52 02            [ 2]    1     sub sp,#VSIZE 
      0002A0 0F 01            [ 1]  728 	clr (INCR,sp)
      0002A2 0F 02            [ 1]  729 	clr (LB,sp)
      0002A4 90 89            [ 2]  730 	pushw y 
      0002A6 13 01            [ 2]  731 	cpw x,(1,sp) ; compare DEST to SRC 
      0002A8 90 85            [ 2]  732 	popw y 
      0002AA 27 31            [ 1]  733 	jreq move_exit ; x==y 
      0002AC 2B 0E            [ 1]  734 	jrmi move_down
      0002AE                        735 move_up: ; start from top address with incr=-1
      0002AE 72 BB 00 09      [ 2]  736 	addw x,acc16
      0002B2 72 B9 00 09      [ 2]  737 	addw y,acc16
      0002B6 03 01            [ 1]  738 	cpl (INCR,sp)
      0002B8 03 02            [ 1]  739 	cpl (LB,sp)   ; increment = -1 
      0002BA 20 05            [ 2]  740 	jra move_loop  
      0002BC                        741 move_down: ; start from bottom address with incr=1 
      0002BC 5A               [ 2]  742     decw x 
      0002BD 90 5A            [ 2]  743 	decw y
      0002BF 0C 02            [ 1]  744 	inc (LB,sp) ; incr=1 
      0002C1                        745 move_loop:	
      0002C1 C6 00 09         [ 1]  746     ld a, acc16 
      0002C4 CA 00 0A         [ 1]  747 	or a, acc8
      0002C7 27 14            [ 1]  748 	jreq move_exit 
      0002C9 72 FB 01         [ 2]  749 	addw x,(INCR,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 15.
Hexadecimal [24-Bits]



      0002CC 72 F9 01         [ 2]  750 	addw y,(INCR,sp) 
      0002CF 90 F6            [ 1]  751 	ld a,(y)
      0002D1 F7               [ 1]  752 	ld (x),a 
      0002D2 89               [ 2]  753 	pushw x 
      0002D3 CE 00 09         [ 2]  754 	ldw x,acc16 
      0002D6 5A               [ 2]  755 	decw x 
      0002D7 CF 00 09         [ 2]  756 	ldw acc16,x 
      0002DA 85               [ 2]  757 	popw x 
      0002DB 20 E4            [ 2]  758 	jra move_loop
      0002DD                        759 move_exit:
      0002DD                        760 	_drop VSIZE
      0002DD 5B 02            [ 2]    1     addw sp,#VSIZE 
      0002DF 81               [ 4]  761 	ret 	
                                    762 
                                    763 ;-------------------------------------
                                    764 ; search text area for a line with 
                                    765 ; same number as lineno  
                                    766 ; input:
                                    767 ;	X 			lineno 
                                    768 ; output:
                                    769 ;   X 			addr of line | 0 
                                    770 ;   Y           lineno|insert address if not found  
                                    771 ;-------------------------------------
                           000001   772 	LL=1 ; line length 
                           000002   773 	LB=2 ; line length low byte 
                           000002   774 	VSIZE=2 
      0002E0                        775 search_lineno:
      0002E0                        776 	_vars VSIZE
      0002E0 52 02            [ 2]    1     sub sp,#VSIZE 
      0002E2 CF 00 09         [ 2]  777 	ldw acc16,x 
      0002E5 0F 01            [ 1]  778 	clr (LL,sp)
      0002E7 90 CE 00 1B      [ 2]  779 	ldw y,txtbgn
      0002EB                        780 search_ln_loop:
      0002EB 90 C3 00 1D      [ 2]  781 	cpw y,txtend 
      0002EF 2A 13            [ 1]  782 	jrpl 8$
      0002F1 93               [ 1]  783 	ldw x,y 
      0002F2 FE               [ 2]  784 	ldw x,(x) ; x=line number 
      0002F3 C3 00 09         [ 2]  785 	cpw x,acc16 
      0002F6 27 0F            [ 1]  786 	jreq 9$ 
      0002F8 2A 0A            [ 1]  787 	jrpl 8$ ; from here all lines are > lineno 
      0002FA 90 E6 02         [ 1]  788 	ld a,(2,y)
      0002FD 6B 02            [ 1]  789 	ld (LB,sp),a 
      0002FF 72 F9 01         [ 2]  790 	addw y,(LL,sp)
      000302 20 E7            [ 2]  791 	jra search_ln_loop 
      000304 51               [ 1]  792 8$: exgw x,y 
      000305 90 5F            [ 1]  793 	clrw y 	
      000307                        794 9$: _drop VSIZE
      000307 5B 02            [ 2]    1     addw sp,#VSIZE 
      000309 51               [ 1]  795 	exgw x,y   
      00030A 81               [ 4]  796 	ret 
                                    797 
                                    798 ;-------------------------------------
                                    799 ; delete line at addr
                                    800 ; input:
                                    801 ;   X 		addr of line i.e DEST for move 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 16.
Hexadecimal [24-Bits]



                                    802 ;-------------------------------------
                           000001   803 	LLEN=1
                           000003   804 	SRC=3
                           000004   805 	VSIZE=4
      00030B                        806 del_line: 
      00030B                        807 	_vars VSIZE 
      00030B 52 04            [ 2]    1     sub sp,#VSIZE 
      00030D E6 02            [ 1]  808 	ld a,(2,x) ; line length
      00030F 6B 02            [ 1]  809 	ld (LLEN+1,sp),a 
      000311 0F 01            [ 1]  810 	clr (LLEN,sp)
      000313 90 93            [ 1]  811 	ldw y,x  
      000315 72 F9 01         [ 2]  812 	addw y,(LLEN,sp) ;SRC  
      000318 17 03            [ 2]  813 	ldw (SRC,sp),y  ;save source 
      00031A 90 CE 00 1D      [ 2]  814 	ldw y,txtend 
      00031E 72 F2 03         [ 2]  815 	subw y,(SRC,sp) ; y=count 
      000321 90 CF 00 09      [ 2]  816 	ldw acc16,y 
      000325 16 03            [ 2]  817 	ldw y,(SRC,sp)    ; source
      000327 CD 02 9E         [ 4]  818 	call move
      00032A 90 CE 00 1D      [ 2]  819 	ldw y,txtend 
      00032E 72 F2 01         [ 2]  820 	subw y,(LLEN,sp)
      000331 90 CF 00 1D      [ 2]  821 	ldw txtend,y  
      000335                        822 	_drop VSIZE     
      000335 5B 04            [ 2]    1     addw sp,#VSIZE 
      000337 81               [ 4]  823 	ret 
                                    824 
                                    825 
                                    826 ;---------------------------------------------
                                    827 ; create a gap in text area 
                                    828 ; input:
                                    829 ;    X 			addr gap start 
                                    830 ;    Y 			gap length 
                                    831 ; output:
                                    832 ;    X 			addr gap start 
                                    833 ;--------------------------------------------
                           000001   834 	DEST=1
                           000003   835 	SRC=3
                           000005   836 	LEN=5
                           000006   837 	VSIZE=6 
      000338                        838 create_gap:
      000338                        839 	_vars VSIZE
      000338 52 06            [ 2]    1     sub sp,#VSIZE 
      00033A C3 00 1D         [ 2]  840 	cpw x,txtend 
      00033D 2A 27            [ 1]  841 	jrpl 9$ ; no need for a gap since at end of text.
      00033F 1F 03            [ 2]  842 	ldw (SRC,sp),x 
      000341 17 05            [ 2]  843 	ldw (LEN,sp),y 
      000343 90 CF 00 09      [ 2]  844 	ldw acc16,y 
      000347 90 93            [ 1]  845 	ldw y,x ; SRC
      000349 72 BB 00 09      [ 2]  846 	addw x,acc16  
      00034D 1F 01            [ 2]  847 	ldw (DEST,sp),x 
                                    848 ;compute size to move 	
      00034F CE 00 1D         [ 2]  849 	ldw x,txtend 
      000352 72 F0 03         [ 2]  850 	subw x,(SRC,sp)
      000355 CF 00 09         [ 2]  851 	ldw acc16,x
      000358 1E 01            [ 2]  852 	ldw x,(DEST,sp) 
      00035A CD 02 9E         [ 4]  853 	call move
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 17.
Hexadecimal [24-Bits]



      00035D CE 00 1D         [ 2]  854 	ldw x,txtend
      000360 72 FB 05         [ 2]  855 	addw x,(LEN,sp)
      000363 CF 00 1D         [ 2]  856 	ldw txtend,x
      000366                        857 9$:	_drop VSIZE 
      000366 5B 06            [ 2]    1     addw sp,#VSIZE 
      000368 81               [ 4]  858 	ret 
                                    859 
                                    860 
                                    861 ;--------------------------------------------
                                    862 ; insert line in tib into text area 
                                    863 ; first search for already existing 
                                    864 ; replace existing 
                                    865 ; if strlen(tib)==0 delete existing 
                                    866 ; input:
                                    867 ;   ptr16 				pointer to tokenized line  
                                    868 ; output:
                                    869 ;   none
                                    870 ;---------------------------------------------
                           000001   871 	DEST=1  ; text area insertion address 
                           000003   872 	SRC=3   ; str to insert address 
                           000005   873 	LINENO=5 ; line number 
                           000007   874 	LLEN=7 ; line length 
                           000008   875 	VSIZE=8  
      000369                        876 insert_line:
      000369                        877 	_vars VSIZE 
      000369 52 08            [ 2]    1     sub sp,#VSIZE 
      00036B CE 00 14         [ 2]  878 	ldw x,ptr16  
      00036E C3 00 1B         [ 2]  879 	cpw x,txtbgn 
      000371 26 12            [ 1]  880 	jrne 0$
      000373 AE 00 02         [ 2]  881 	ldw x,#2 
      000376 72 D6 00 14      [ 4]  882 	ld a,([ptr16],x)
      00037A 5F               [ 1]  883 	clrw x 
      00037B 97               [ 1]  884 	ld xl,a 
      00037C 72 BB 00 1D      [ 2]  885 	addw x,txtend 
      000380 CF 00 1D         [ 2]  886 	ldw txtend,x 
      000383 20 64            [ 2]  887 	jra insert_ln_exit 
      000385 72 CE 00 14      [ 5]  888 0$:	ldw x,[ptr16]
      000389 1F 05            [ 2]  889 	ldw (LINENO,sp),x 
      00038B AE 00 02         [ 2]  890 	ldw x,#2 
      00038E 72 D6 00 14      [ 4]  891 	ld a,([ptr16],x); line length 
      000392 97               [ 1]  892 	ld xl,a
      000393 1F 07            [ 2]  893 	ldw (LLEN,sp),x
      000395 1E 05            [ 2]  894 	ldw x,(LINENO,sp)
      000397 CD 02 E0         [ 4]  895 	call search_lineno 
      00039A 5D               [ 2]  896 	tnzw x 
      00039B 26 04            [ 1]  897 	jrne 2$
                                    898 ; line doesn't exit 	
      00039D 17 01            [ 2]  899 	ldw (DEST,sp),y 
      00039F 20 05            [ 2]  900 	jra 3$
                                    901 ; line exit delete it.	
      0003A1 1F 01            [ 2]  902 2$: ldw (DEST,sp),x 
      0003A3 CD 03 0B         [ 4]  903 	call del_line
                                    904 ; leave or insert new line if LLEN>0
      0003A6                        905 3$: 
      0003A6 0D 08            [ 1]  906 	tnz (LLEN+1,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 18.
Hexadecimal [24-Bits]



      0003A8 27 3F            [ 1]  907 	jreq insert_ln_exit ; empty line forget it.
      0003AA 1E 01            [ 2]  908 	ldw x,(DEST,sp)
      0003AC C3 00 1D         [ 2]  909 	cpw x,txtend 
      0003AF 2A 12            [ 1]  910 	jrpl 4$ 
                                    911 ; must create a gap 
      0003B1 CE 00 1D         [ 2]  912 	ldw x,txtend 
      0003B4 72 FB 07         [ 2]  913 	addw x,(LLEN,sp)
      0003B7 CF 00 1D         [ 2]  914 	ldw txtend,x 
      0003BA 1E 01            [ 2]  915 	ldw x,(DEST,sp)
      0003BC 16 07            [ 2]  916 	ldw y,(LLEN,sp)
      0003BE CD 03 38         [ 4]  917 	call create_gap 
      0003C1 20 0B            [ 2]  918 	jra 5$ 
      0003C3                        919 4$: ; leave line at end. 
      0003C3 CE 00 1D         [ 2]  920 	ldw x,txtend 
      0003C6 72 FB 07         [ 2]  921 	addw x,(LLEN,sp)
      0003C9 CF 00 1D         [ 2]  922 	ldw txtend,x 
      0003CC 20 1B            [ 2]  923 	jra insert_ln_exit 
      0003CE                        924 5$:	
      0003CE 1E 07            [ 2]  925 	ldw x,(LLEN,sp)
      0003D0 CF 00 09         [ 2]  926 	ldw acc16,x 
      0003D3 90 CE 00 14      [ 2]  927 	ldw y,ptr16 
      0003D7 72 F9 07         [ 2]  928 	addw y,(LLEN,sp)
      0003DA 1E 01            [ 2]  929 	ldw x,(DEST,sp) ; dest address 
      0003DC CD 02 9E         [ 4]  930 	call move 
      0003DF CE 00 1D         [ 2]  931 	ldw x,txtend 
      0003E2 72 F0 07         [ 2]  932 	subw x,(LLEN,sp)
      0003E5 CF 00 1D         [ 2]  933 	ldw txtend,x
      0003E8 7F               [ 1]  934 	clr (x) 
      0003E9                        935 insert_ln_exit:	
      0003E9                        936 	_drop VSIZE
      0003E9 5B 08            [ 2]    1     addw sp,#VSIZE 
      0003EB 81               [ 4]  937 	ret
                                    938 
                                    939 
                                    940 ;-----------------------------
                                    941 ; check if text buffer full
                                    942 ; input:
                                    943 ;   ptr16     addr start tokenize line 
                                    944 ;   X         buffer index 
                                    945 ; output:
                                    946 ;   none 
                                    947 ;-----------------------------------
      0003EC                        948 check_full:
      0003EC 72 BB 00 14      [ 2]  949 	addw x,ptr16 
      0003F0 A3 16 C8         [ 2]  950 	cpw x,#tib 
      0003F3 25 05            [ 1]  951 	jrult 1$
      0003F5 A6 01            [ 1]  952 	ld a,#ERR_MEM_FULL
      0003F7 CC 06 D9         [ 2]  953 	jp tb_error 
      0003FA 81               [ 4]  954 1$: ret 
                                    955 
                                    956 
                                    957 ;-----------------------------------
                                    958 ; create token list form text line 
                                    959 ; save this list in text area
                                    960 ; input:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 19.
Hexadecimal [24-Bits]



                                    961 ;   none
                                    962 ; output:
                                    963 ;   basicptr     token list buffer
                                    964 ;   lineno 		 BASIC line number 
                                    965 ;   in.w  		 cleared 
                                    966 ;-----------------------------------
                                    967 	.macro _incr_ptr16 n 
                                    968 	ldw x,#n 
                                    969 	addw x,ptr16 
                                    970 	ldw ptr16,x 
                                    971 	.endm 
                                    972 
                           000001   973 	XSAVE=1
                           000003   974 	BUFIDX=3
                           000004   975 	VSIZE=4
      0003FB                        976 compile:
      0003FB                        977 	_vars VSIZE 
      0003FB 52 04            [ 2]    1     sub sp,#VSIZE 
      0003FD 72 1A 00 24      [ 1]  978 	bset flags,#FCOMP 
      000401 CE 00 1D         [ 2]  979 	ldw x,txtend
      000404 CF 00 14         [ 2]  980 	ldw ptr16,x 
      000407 5F               [ 1]  981 	clrw x 
      000408 AE 00 03         [ 2]  982 	ldw x,#3
      00040B 1F 03            [ 2]  983 	ldw (BUFIDX,sp),X  
      00040D CD 03 EC         [ 4]  984 	call check_full
      000410 5F               [ 1]  985 	clrw x 
      000411 72 CF 00 14      [ 5]  986 	ldw [ptr16],x 
      000415 CD 0C E7         [ 4]  987 	call get_token
      000418 1F 01            [ 2]  988 	ldw (XSAVE,sp),x 
      00041A A1 02            [ 1]  989 	cp a,#TK_INTGR 
      00041C 26 11            [ 1]  990 	jrne 3$
      00041E A3 00 00         [ 2]  991 	cpw x,#0  
      000421 22 03            [ 1]  992 	jrugt 1$
      000423 CC 06 D7         [ 2]  993 	jp syntax_error 
      000426 72 CF 00 14      [ 5]  994 1$:	ldw [ptr16],x; line number
      00042A CD 0C E7         [ 4]  995 2$:	call get_token
      00042D 1F 01            [ 2]  996 	ldw (XSAVE,sp),x 
      00042F A1 00            [ 1]  997 3$:	cp a,#TK_NONE 
      000431 27 4E            [ 1]  998 	jreq 9$ 
      000433 1E 03            [ 2]  999 	ldw x,(BUFIDX,sp)
      000435 CD 03 EC         [ 4] 1000 	call check_full 
      000438 16 03            [ 2] 1001 	ldw y,(BUFIDX,sp) 
      00043A 91 D7 14         [ 4] 1002 	ld ([ptr16],y),a 
      00043D 90 5C            [ 1] 1003 	incw y
      00043F 17 03            [ 2] 1004 	ldw (BUFIDX,sp),y
      000441 A1 08            [ 1] 1005 	cp a,#TK_QSTR 
      000443 26 25            [ 1] 1006 	jrne 4$
      000445 AE 17 18         [ 2] 1007 	ldw x,#pad 
      000448 CD 02 72         [ 4] 1008 	call strlen
      00044B 5C               [ 1] 1009 	incw x  
      00044C CD 03 EC         [ 4] 1010 	call check_full 
      00044F 90 AE 17 18      [ 2] 1011 	ldw y,#pad 
      000453 CE 00 14         [ 2] 1012 	ldw x,ptr16
      000456 72 FB 03         [ 2] 1013 	addw x,(BUFIDX,sp)	
      000459 CD 02 90         [ 4] 1014 	call strcpy 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 20.
Hexadecimal [24-Bits]



      00045C AE 17 18         [ 2] 1015 	ldw x,#pad 
      00045F CD 02 72         [ 4] 1016 	call strlen 
      000462 5C               [ 1] 1017 	incw x
      000463 72 FB 03         [ 2] 1018 	addw x,(BUFIDX,sp) 
      000466 1F 03            [ 2] 1019 	ldw (BUFIDX,sp),x
      000468 20 C0            [ 2] 1020 	jra 2$  
      00046A A1 02            [ 1] 1021 4$: cp a,#TK_INTGR
      00046C 25 BC            [ 1] 1022 	jrult 2$
      00046E A1 07            [ 1] 1023 	cp a,#TK_FUNC 
      000470 22 B8            [ 1] 1024 	Jrugt 2$
      000472 1E 01            [ 2] 1025 	ldw x,(XSAVE,sp) 
      000474 16 03            [ 2] 1026 	ldw y,(BUFIDX,sp)
      000476 91 DF 14         [ 5] 1027 	ldw ([ptr16],y),x
      000479 72 A9 00 02      [ 2] 1028 	addw y,#2 
      00047D 17 03            [ 2] 1029 	ldw (BUFIDX,sp),y 
      00047F 20 A9            [ 2] 1030 	jra 2$
      000481                       1031 9$: 
      000481 AE 00 02         [ 2] 1032 	ldw x,#2
      000484 16 03            [ 2] 1033 	ldw y,(BUFIDX,sp)
      000486 90 9F            [ 1] 1034 	ld a,yl 
      000488 72 D7 00 14      [ 4] 1035 	ld ([ptr16],x),a  	
      00048C 72 CE 00 14      [ 5] 1036 	ldw x,[ptr16]
      000490 27 09            [ 1] 1037 	jreq 10$
      000492 CD 03 69         [ 4] 1038 	call insert_line
      000495 72 5F 00 02      [ 1] 1039 	clr  count 
      000499 20 13            [ 2] 1040 	jra  11$ 
      00049B                       1041 10$: 
      00049B CE 00 14         [ 2] 1042 	ldw x,ptr16 
      00049E CF 00 03         [ 2] 1043 	ldw basicptr,x 
      0004A1 E6 02            [ 1] 1044 	ld a,(2,x)
      0004A3 C7 00 02         [ 1] 1045 	ld count,a 
      0004A6 FE               [ 2] 1046 	ldw x,(x)
      0004A7 CF 00 05         [ 2] 1047 	ldw lineno,x 
      0004AA 35 03 00 01      [ 1] 1048 	mov in,#3 
      0004AE                       1049 11$:
      0004AE                       1050 	_drop VSIZE 
      0004AE 5B 04            [ 2]    1     addw sp,#VSIZE 
      0004B0 72 1B 00 24      [ 1] 1051 	bres flags,#FCOMP 
      0004B4 81               [ 4] 1052 	ret 
                                   1053 
                                   1054 
                                   1055 ;------------------------------------
                                   1056 ;  set all variables to zero 
                                   1057 ; input:
                                   1058 ;   none 
                                   1059 ; output:
                                   1060 ;	none
                                   1061 ;------------------------------------
      0004B5                       1062 clear_vars:
      0004B5 AE 00 26         [ 2] 1063 	ldw x,#vars 
      0004B8 90 AE 00 34      [ 2] 1064 	ldw y,#2*26 
      0004BC 7F               [ 1] 1065 1$:	clr (x)
      0004BD 5C               [ 1] 1066 	incw x 
      0004BE 90 5A            [ 2] 1067 	decw y 
      0004C0 26 FA            [ 1] 1068 	jrne 1$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 21.
Hexadecimal [24-Bits]



      0004C2 81               [ 4] 1069 	ret 
                                   1070 
                                   1071 ;-------------------------------------
                                   1072 ; check if A is a letter
                                   1073 ; input:
                                   1074 ;   A 			character to test 
                                   1075 ; output:
                                   1076 ;   C flag      1 true, 0 false 
                                   1077 ;-------------------------------------
      0004C3                       1078 is_alpha:
      0004C3 A1 41            [ 1] 1079 	cp a,#'A 
      0004C5 8C               [ 1] 1080 	ccf
      0004C6 24 0B            [ 1] 1081 	jrnc 9$ 
      0004C8 A1 5B            [ 1] 1082 	cp a,#'Z+1 
      0004CA 25 07            [ 1] 1083 	jrc 9$ 
      0004CC A1 61            [ 1] 1084 	cp a,#'a 
      0004CE 8C               [ 1] 1085 	ccf 
      0004CF 24 02            [ 1] 1086 	jrnc 9$
      0004D1 A1 7B            [ 1] 1087 	cp a,#'z+1   
      0004D3 81               [ 4] 1088 9$: ret 	
                                   1089 
                                   1090 ;-------------------------------------
                                   1091 ;  program initialization entry point 
                                   1092 ;-------------------------------------
                           000001  1093 	MAJOR=1
                           000000  1094 	MINOR=0
      0004D4 0A 0A 54 69 6E 79 20  1095 software: .asciz "\n\nTiny BASIC for STM8\nCopyright, Jacques Deschenes 2019,2020\nversion "
             42 41 53 49 43 20 66
             6F 72 20 53 54 4D 38
             0A 43 6F 70 79 72 69
             67 68 74 2C 20 4A 61
             63 71 75 65 73 20 44
             65 73 63 68 65 6E 65
             73 20 32 30 31 39 2C
             32 30 32 30 0A 76 65
             72 73 69 6F 6E 20 00
      00051A                       1096 cold_start:
                                   1097 ;set stack 
      00051A AE 17 FF         [ 2] 1098 	ldw x,#STACK_EMPTY
      00051D 94               [ 1] 1099 	ldw sp,x   
                                   1100 ; clear all ram 
      00051E 7F               [ 1] 1101 0$: clr (x)
      00051F 5A               [ 2] 1102 	decw x 
      000520 26 FC            [ 1] 1103 	jrne 0$
                                   1104 ; activate pull up on all inputs 
      000522 A6 FF            [ 1] 1105 	ld a,#255 
      000524 C7 50 03         [ 1] 1106 	ld PA_CR1,a 
      000527 C7 50 08         [ 1] 1107 	ld PB_CR1,a 
      00052A C7 50 0D         [ 1] 1108 	ld PC_CR1,a 
      00052D C7 50 12         [ 1] 1109 	ld PD_CR1,a 
      000530 C7 50 17         [ 1] 1110 	ld PE_CR1,a 
      000533 C7 50 1C         [ 1] 1111 	ld PF_CR1,a 
      000536 C7 50 21         [ 1] 1112 	ld PG_CR1,a 
      000539 C7 50 2B         [ 1] 1113 	ld PI_CR1,a 
                                   1114 ; select internal clock no divisor: 16 Mhz 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 22.
Hexadecimal [24-Bits]



      00053C A6 E1            [ 1] 1115 	ld a,#CLK_SWR_HSI 
      00053E 5F               [ 1] 1116 	clrw x  
      00053F CD 00 99         [ 4] 1117     call clock_init 
      000542 CD 00 AF         [ 4] 1118 	call timer4_init
                                   1119 ; UART3 at 115200 BAUD
      000545 CD 01 74         [ 4] 1120 	call uart3_init
                                   1121 ; activate PE_4 (user button interrupt)
      000548 72 18 50 18      [ 1] 1122     bset PE_CR2,#USR_BTN_BIT 
                                   1123 ; display system information
      00054C AE 04 D4         [ 2] 1124 	ldw x,#software 
      00054F CD 01 B0         [ 4] 1125 	call puts 
      000552 A6 01            [ 1] 1126 	ld a,#MAJOR 
      000554 C7 00 0A         [ 1] 1127 	ld acc8,a 
      000557 5F               [ 1] 1128 	clrw x 
      000558 CF 00 08         [ 2] 1129 	ldw acc24,x 
      00055B A6 0A            [ 1] 1130 	ld a,#10 
      00055D CD 09 07         [ 4] 1131 	call prti24 
      000560 A6 2E            [ 1] 1132 	ld a,#'.
      000562 CD 01 9E         [ 4] 1133 	call putc 
      000565 A6 00            [ 1] 1134 	ld a,#MINOR 
      000567 C7 00 0A         [ 1] 1135 	ld acc8,a 
      00056A 5F               [ 1] 1136 	clrw x 
      00056B CF 00 08         [ 2] 1137 	ldw acc24,x 
      00056E A6 0A            [ 1] 1138 	ld a,#10 
      000570 CD 09 07         [ 4] 1139 	call prti24 
      000573 A6 0D            [ 1] 1140 	ld a,#CR 
      000575 CD 01 9E         [ 4] 1141 	call putc 
      000578 CD 19 F5         [ 4] 1142 	call seek_fdrive 
                                   1143 ; configure LED2 pin 
      00057B 72 1A 50 0D      [ 1] 1144     bset PC_CR1,#LED2_BIT
      00057F 72 1A 50 0E      [ 1] 1145     bset PC_CR2,#LED2_BIT
      000583 72 1A 50 0C      [ 1] 1146     bset PC_DDR,#LED2_BIT
      000587 9A               [ 1] 1147 	rim 
      000588 AE 16 C8         [ 2] 1148 	ldw x,#tib
      00058B CF 00 20         [ 2] 1149 	ldw array_addr,x 
      00058E 72 5C 00 10      [ 1] 1150 	inc seedy+1 
      000592 72 5C 00 0E      [ 1] 1151 	inc seedx+1 
      000596 CD 05 A5         [ 4] 1152 	call clear_basic
      000599 CD 13 63         [ 4] 1153 	call ubound 
      00059C CD 0F 87         [ 4] 1154 	call dpop 
      00059F CF 00 22         [ 2] 1155 	ldw array_size,x 
      0005A2 CC 07 29         [ 2] 1156     jp warm_start 
                                   1157 
                                   1158 ;---------------------------
                                   1159 ; reset BASIC text variables 
                                   1160 ; and clear variables 
                                   1161 ;---------------------------
      0005A5                       1162 clear_basic:
      0005A5 5F               [ 1] 1163 	clrw x 
      0005A6 CF 00 05         [ 2] 1164 	ldw lineno,x
      0005A9 72 5F 00 02      [ 1] 1165 	clr count 
      0005AD AE 00 5A         [ 2] 1166 	ldw x,#free_ram 
      0005B0 CF 00 1B         [ 2] 1167 	ldw txtbgn,x 
      0005B3 CF 00 1D         [ 2] 1168 	ldw txtend,x 
      0005B6 CD 04 B5         [ 4] 1169 	call clear_vars 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 23.
Hexadecimal [24-Bits]



      0005B9 81               [ 4] 1170 	ret 
                                   1171 
                                   1172 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                   1173 ;;   Tiny BASIC error messages     ;;
                                   1174 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      0005BA                       1175 err_msg:
      0005BA 00 00 05 D2 05 E0 05  1176 	.word 0,err_mem_full, err_syntax, err_math_ovf, err_div0,err_no_line    
             EF 06 09 06 19
      0005C6 06 30 06 47 06 62 06  1177 	.word err_run_only,err_cmd_only,err_duplicate,err_not_file,err_bad_value
             74 06 86
      0005D0 06 93                 1178 	.word err_no_access 
                                   1179 
      0005D2 0A 4D 65 6D 6F 72 79  1180 err_mem_full: .asciz "\nMemory full\n" 
             20 66 75 6C 6C 0A 00
      0005E0 0A 73 79 6E 74 61 78  1181 err_syntax: .asciz "\nsyntax error\n" 
             20 65 72 72 6F 72 0A
             00
      0005EF 0A 6D 61 74 68 20 6F  1182 err_math_ovf: .asciz "\nmath operation overflow\n"
             70 65 72 61 74 69 6F
             6E 20 6F 76 65 72 66
             6C 6F 77 0A 00
      000609 0A 64 69 76 69 73 69  1183 err_div0: .asciz "\ndivision by 0\n" 
             6F 6E 20 62 79 20 30
             0A 00
      000619 0A 69 6E 76 61 6C 69  1184 err_no_line: .asciz "\ninvalid line number.\n"
             64 20 6C 69 6E 65 20
             6E 75 6D 62 65 72 2E
             0A 00
      000630 0A 72 75 6E 20 74 69  1185 err_run_only: .asciz "\nrun time only usage.\n" 
             6D 65 20 6F 6E 6C 79
             20 75 73 61 67 65 2E
             0A 00
      000647 0A 63 6F 6D 6D 61 6E  1186 err_cmd_only: .asciz "\ncommand line only usage.\n"
             64 20 6C 69 6E 65 20
             6F 6E 6C 79 20 75 73
             61 67 65 2E 0A 00
      000662 0A 64 75 70 6C 69 63  1187 err_duplicate: .asciz "\nduplicate name.\n"
             61 74 65 20 6E 61 6D
             65 2E 0A 00
      000674 0A 46 69 6C 65 20 6E  1188 err_not_file: .asciz "\nFile not found.\n"
             6F 74 20 66 6F 75 6E
             64 2E 0A 00
      000686 0A 62 61 64 20 76 61  1189 err_bad_value: .asciz "\nbad value.\n"
             6C 75 65 2E 0A 00
      000693 0A 46 69 6C 65 20 69  1190 err_no_access: .asciz "\nFile in extended memory, can't be run from there.\n" 
             6E 20 65 78 74 65 6E
             64 65 64 20 6D 65 6D
             6F 72 79 2C 20 63 61
             6E 27 74 20 62 65 20
             72 75 6E 20 66 72 6F
             6D 20 74 68 65 72 65
             2E 0A 00
                                   1191 
      0006C7 6C 61 73 74 20 74 6F  1192 rt_msg: .asciz "last token id: "
             6B 65 6E 20 69 64 3A
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 24.
Hexadecimal [24-Bits]



             20 00
                                   1193 
      0006D7                       1194 syntax_error:
      0006D7 A6 02            [ 1] 1195 	ld a,#ERR_SYNTAX 
                                   1196 
      0006D9                       1197 tb_error:
      0006D9 AE 05 BA         [ 2] 1198 	ldw x, #err_msg 
      0006DC 72 5F 00 09      [ 1] 1199 	clr acc16 
      0006E0 48               [ 1] 1200 	sll a
      0006E1 72 59 00 09      [ 1] 1201 	rlc acc16  
      0006E5 C7 00 0A         [ 1] 1202 	ld acc8, a 
      0006E8 72 BB 00 09      [ 2] 1203 	addw x,acc16 
      0006EC FE               [ 2] 1204 	ldw x,(x)
      0006ED CD 01 B0         [ 4] 1205 	call puts
      0006F0 72 0B 00 24 18   [ 2] 1206 	btjf flags,#FCOMP, 1$
      0006F5 AE 16 C8         [ 2] 1207 	ldw x,#tib
      0006F8 CD 01 B0         [ 4] 1208 	call puts 
      0006FB A6 0D            [ 1] 1209 	ld a,#CR 
      0006FD CD 01 9E         [ 4] 1210 	call putc
      000700 AE 00 11         [ 2] 1211 	ldw x,#in.w.saved
      000703 CD 01 D8         [ 4] 1212 	call spaces
      000706 A6 5E            [ 1] 1213 	ld a,#'^
      000708 CD 01 9E         [ 4] 1214 	call putc 
      00070B 20 18            [ 2] 1215 	jra 6$
      00070D CE 00 03         [ 2] 1216 1$:	ldw x,basicptr
      000710 CD 14 30         [ 4] 1217 	call prt_basic_line
      000713 AE 06 C7         [ 2] 1218 	ldw x,#rt_msg 
      000716 CD 01 B0         [ 4] 1219 	call puts 
      000719 CE 00 11         [ 2] 1220 	ldw x,in.w.saved 
      00071C 72 D6 00 03      [ 4] 1221 	ld a,([basicptr],x)
      000720 5F               [ 1] 1222 	clrw x 
      000721 97               [ 1] 1223 	ld xl,a 
      000722 CD 09 4F         [ 4] 1224 	call print_int 
      000725 AE 17 FF         [ 2] 1225 6$: ldw x,#STACK_EMPTY 
      000728 94               [ 1] 1226     ldw sp,x
      000729                       1227 warm_start:
      000729 72 5F 00 24      [ 1] 1228 	clr flags 
      00072D 72 5F 00 1F      [ 1] 1229 	clr loop_depth 
      000731 AE 17 80         [ 2] 1230 	ldw x,#dstack_unf 
      000734 CF 00 19         [ 2] 1231 	ldw dstkptr,x 
      000737 35 04 00 25      [ 1] 1232 	mov tab_width,#TAB_WIDTH 
      00073B 35 0A 00 07      [ 1] 1233 	mov base,#10 
      00073F 5F               [ 1] 1234 	clrw x 
      000740 CF 00 05         [ 2] 1235 	ldw lineno,x 
      000743 AE 16 C8         [ 2] 1236 	ldw x,#tib 
      000746 CF 00 03         [ 2] 1237 	ldw basicptr,x 
                                   1238 ;----------------------------
                                   1239 ;   BASIC interpreter
                                   1240 ;----------------------------
      000749                       1241 interp:
      000749 72 5F 00 00      [ 1] 1242 	clr in.w
      00074D 72 01 00 24 27   [ 2] 1243 	btjf flags,#FRUN,4$ 
                                   1244 ; running program
                                   1245 ; goto next basic line 
      000752 CE 00 03         [ 2] 1246 	ldw x,basicptr
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 25.
Hexadecimal [24-Bits]



      000755 E6 02            [ 1] 1247 	ld a,(2,x) ; line length 
      000757 C7 00 0A         [ 1] 1248 	ld acc8,a 
      00075A 72 5F 00 09      [ 1] 1249 	clr acc16 
      00075E 72 BB 00 09      [ 2] 1250 	addw x,acc16
      000762 C3 00 1D         [ 2] 1251 	cpw x,txtend 
      000765 2A C2            [ 1] 1252 	jrpl warm_start
      000767 CF 00 03         [ 2] 1253 	ldw basicptr,x ; start of next line  
      00076A E6 02            [ 1] 1254 	ld a,(2,x)
      00076C C7 00 02         [ 1] 1255 	ld count,a 
      00076F FE               [ 2] 1256 	ldw x,(x) ; line no 
      000770 CF 00 05         [ 2] 1257 	ldw lineno,x 
      000773 35 03 00 01      [ 1] 1258 	mov in,#3 ; skip first 3 bytes of line 
      000777 20 14            [ 2] 1259 	jra interp_loop 
      000779                       1260 4$: ; commande line mode 	
      000779 72 5F 00 01      [ 1] 1261 	clr in
      00077D A6 0D            [ 1] 1262 	ld a,#CR 
      00077F CD 01 9E         [ 4] 1263 	call putc 
      000782 A6 3E            [ 1] 1264 	ld a,#'> 
      000784 CD 01 9E         [ 4] 1265 	call putc 
      000787 CD 0A 3D         [ 4] 1266 	call readln
      00078A CD 03 FB         [ 4] 1267 	call compile
      00078D                       1268 interp_loop:  
      00078D C6 00 01         [ 1] 1269 	ld a,in 
      000790 C1 00 02         [ 1] 1270 	cp a,count  
      000793 2A B4            [ 1] 1271 	jrpl interp
      000795 CD 07 BD         [ 4] 1272 	call next_token
      000798 A1 01            [ 1] 1273 	cp a,#TK_COLON 
      00079A 27 F1            [ 1] 1274 	jreq interp_loop 
      00079C A1 00            [ 1] 1275 	cp a,#TK_NONE 
                                   1276 ;	jreq interp 
      00079E                       1277 1$:
      00079E A1 03            [ 1] 1278 	cp a,#TK_VAR
      0007A0 26 05            [ 1] 1279 	jrne 2$
      0007A2 CD 13 7B         [ 4] 1280 	call let02  
      0007A5 20 E6            [ 2] 1281 	jra interp_loop 
      0007A7                       1282 2$:	
      0007A7 A1 04            [ 1] 1283 	cp a,#TK_ARRAY 
      0007A9 26 08            [ 1] 1284 	jrne 3$
      0007AB CD 11 CE         [ 4] 1285 	call get_array_element
      0007AE CD 13 7B         [ 4] 1286 	call let02 
      0007B1 20 DA            [ 2] 1287 	jra interp_loop 
      0007B3                       1288 3$:
      0007B3 A1 06            [ 1] 1289 	cp a,#TK_CMD
      0007B5 26 03            [ 1] 1290 	jrne 4$
      0007B7 FD               [ 4] 1291 	call (x) 
      0007B8 20 D3            [ 2] 1292 	jra interp_loop 
      0007BA                       1293 4$:	
      0007BA CC 06 D7         [ 2] 1294 	jp syntax_error 
                                   1295 
                                   1296 ;--------------------------
                                   1297 ; extract next token from
                                   1298 ; token list 
                                   1299 ; basicptr -> base address 
                                   1300 ; in  -> offset in list array 
                                   1301 ; output:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 26.
Hexadecimal [24-Bits]



                                   1302 ;   A 		token attribute
                                   1303 ;   X 		token value if there is one
                                   1304 ;----------------------------------------
      0007BD                       1305 next_token:
      0007BD 4B 00            [ 1] 1306 	push #0
      0007BF C6 00 01         [ 1] 1307 	ld a,in 
      0007C2 C1 00 02         [ 1] 1308 	cp a,count 
      0007C5 84               [ 1] 1309 	pop a 
      0007C6 2A 31            [ 1] 1310 	jrpl 9$ 
      0007C8 CE 00 00         [ 2] 1311 	ldw x,in.w 
      0007CB CF 00 11         [ 2] 1312 	ldw in.w.saved,x 
      0007CE CE 00 03         [ 2] 1313 	ldw x,basicptr 
      0007D1 72 D6 00 00      [ 4] 1314 	ld a,([in.w],x)
      0007D5 72 5C 00 01      [ 1] 1315 	inc in 
      0007D9 A1 02            [ 1] 1316 	cp a,#CMD_END 
      0007DB 25 1C            [ 1] 1317 	jrult 9$
      0007DD A1 08            [ 1] 1318 	cp a,#TK_QSTR 
      0007DF 22 18            [ 1] 1319 	jrugt 9$
      0007E1 25 06            [ 1] 1320 	jrult 2$
      0007E3 72 BB 00 00      [ 2] 1321 	addw x,in.w 
      0007E7 20 10            [ 2] 1322 	jra 9$
      0007E9 72 DE 00 00      [ 5] 1323 2$: ldw x,([in.w],x)
      0007ED 90 CE 00 00      [ 2] 1324 	ldw y,in.w 
      0007F1 72 A9 00 02      [ 2] 1325 	addw y,#2
      0007F5 90 CF 00 00      [ 2] 1326 	ldw in.w,y
      0007F9 81               [ 4] 1327 9$: ret	
                                   1328 
                                   1329 
                                   1330 ;----------------------------------------
                                   1331 ;   DEBUG support functions
                                   1332 ;----------------------------------------
                           000001  1333 .if DEBUG 
                                   1334 ; turn LED on 
      0007FA                       1335 ledon:
      0007FA 72 1A 50 0A      [ 1] 1336     bset PC_ODR,#LED2_BIT
      0007FE 81               [ 4] 1337     ret 
                                   1338 
                                   1339 ; turn LED off 
      0007FF                       1340 ledoff:
      0007FF 72 1B 50 0A      [ 1] 1341     bres PC_ODR,#LED2_BIT 
      000803 81               [ 4] 1342     ret 
                                   1343 
                                   1344 ; invert LED status 
      000804                       1345 ledtoggle:
      000804 A6 20            [ 1] 1346     ld a,#LED2_MASK
      000806 C8 50 0A         [ 1] 1347     xor a,PC_ODR
      000809 C7 50 0A         [ 1] 1348     ld PC_ODR,a
      00080C 81               [ 4] 1349     ret 
                                   1350 
      00080D                       1351 left_paren:
      00080D A6 20            [ 1] 1352 	ld a,#SPACE 
      00080F CD 01 9E         [ 4] 1353 	call putc
      000812 A6 28            [ 1] 1354 	ld a,#'( 
      000814 CD 01 9E         [ 4] 1355 	call putc 	
      000817 81               [ 4] 1356 	ret 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 27.
Hexadecimal [24-Bits]



                                   1357 
                                   1358 ;------------------------------
                                   1359 ; print 8 bit register 
                                   1360 ; input:
                                   1361 ;   X  point to register name 
                                   1362 ;   A  register value to print 
                                   1363 ; output:
                                   1364 ;   none
                                   1365 ;------------------------------- 
      000818                       1366 prt_reg8:
      000818 88               [ 1] 1367 	push a 
      000819 CD 01 B0         [ 4] 1368 	call puts 
      00081C 7B 01            [ 1] 1369 	ld a,(1,sp) 
      00081E C7 00 0A         [ 1] 1370 	ld acc8,a 
      000821 5F               [ 1] 1371 	clrw x 
      000822 97               [ 1] 1372 	ld xl,a 
      000823 35 10 00 07      [ 1] 1373 	mov base,#16
      000827 CD 09 4F         [ 4] 1374 	call print_int 
      00082A CD 08 0D         [ 4] 1375 	call left_paren 
      00082D 84               [ 1] 1376 	pop a 
      00082E 5F               [ 1] 1377 	clrw x 
      00082F 97               [ 1] 1378 	ld xl,a 
      000830 35 0A 00 07      [ 1] 1379 	mov base,#10 
      000834 CD 09 4F         [ 4] 1380 	call print_int  
      000837 A6 29            [ 1] 1381 	ld a,#') 
      000839 CD 01 9E         [ 4] 1382 	call putc
      00083C 81               [ 4] 1383 	ret
                                   1384 
                                   1385 ;--------------------------------
                                   1386 ; print 16 bits register 
                                   1387 ; input:
                                   1388 ;   X   point register name 
                                   1389 ;   Y   register value to print 
                                   1390 ; output:
                                   1391 ;  none
                                   1392 ;--------------------------------
      00083D                       1393 prt_reg16: 
      00083D 90 89            [ 2] 1394 	pushw y 
      00083F CD 01 B0         [ 4] 1395 	call puts 
      000842 1E 01            [ 2] 1396 	ldw x,(1,sp) 
      000844 35 10 00 07      [ 1] 1397 	mov base,#16 
      000848 CD 09 4F         [ 4] 1398 	call print_int  
      00084B CD 08 0D         [ 4] 1399 	call left_paren 
      00084E 85               [ 2] 1400 	popw x 
      00084F 35 0A 00 07      [ 1] 1401 	mov base,#10 
      000853 CD 09 4F         [ 4] 1402 	call print_int  
      000856 A6 29            [ 1] 1403 	ld a,#') 
      000858 CD 01 9E         [ 4] 1404 	call putc
      00085B 81               [ 4] 1405 	ret 
                                   1406 
                                   1407 ;------------------------------------
                                   1408 ; print registers contents saved on
                                   1409 ; stack by trap interrupt.
                                   1410 ;------------------------------------
      00085C                       1411 print_registers:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 28.
Hexadecimal [24-Bits]



      00085C AE 08 AF         [ 2] 1412 	ldw x,#STATES
      00085F CD 01 B0         [ 4] 1413 	call puts
                                   1414 ; print EPC 
      000862 AE 08 EC         [ 2] 1415 	ldw x, #REG_EPC
      000865 CD 01 B0         [ 4] 1416 	call puts 
      000868 7B 0B            [ 1] 1417 	ld a, (11,sp)
      00086A C7 00 0A         [ 1] 1418 	ld acc8,a 
      00086D 7B 0A            [ 1] 1419 	ld a, (10,sp) 
      00086F C7 00 09         [ 1] 1420 	ld acc16,a 
      000872 7B 09            [ 1] 1421 	ld a,(9,sp) 
      000874 C7 00 08         [ 1] 1422 	ld acc24,a
      000877 5F               [ 1] 1423 	clrw x  
      000878 A6 10            [ 1] 1424 	ld a,#16
      00087A CD 09 07         [ 4] 1425 	call prti24  
                                   1426 ; print X
      00087D AE 08 F5         [ 2] 1427 	ldw x,#REG_X
      000880 16 05            [ 2] 1428 	ldw y,(5,sp)
      000882 CD 08 3D         [ 4] 1429 	call prt_reg16  
                                   1430 ; print Y 
      000885 AE 08 F1         [ 2] 1431 	ldw x,#REG_Y
      000888 16 07            [ 2] 1432 	ldw y, (7,sp)
      00088A CD 08 3D         [ 4] 1433 	call prt_reg16  
                                   1434 ; print A 
      00088D AE 08 F9         [ 2] 1435 	ldw x,#REG_A
      000890 7B 04            [ 1] 1436 	ld a, (4,sp) 
      000892 CD 08 18         [ 4] 1437 	call prt_reg8
                                   1438 ; print CC 
      000895 AE 08 FD         [ 2] 1439 	ldw x,#REG_CC 
      000898 7B 03            [ 1] 1440 	ld a, (3,sp) 
      00089A CD 08 18         [ 4] 1441 	call prt_reg8 
                                   1442 ; print SP 
      00089D AE 09 02         [ 2] 1443 	ldw x,#REG_SP
      0008A0 90 96            [ 1] 1444 	ldw y,sp 
      0008A2 72 A9 00 0C      [ 2] 1445 	addw y,#12
      0008A6 CD 08 3D         [ 4] 1446 	call prt_reg16  
      0008A9 A6 0A            [ 1] 1447 	ld a,#'\n' 
      0008AB CD 01 9E         [ 4] 1448 	call putc
      0008AE 81               [ 4] 1449 	ret
                                   1450 
      0008AF 0A 52 65 67 69 73 74  1451 STATES:  .asciz "\nRegisters state at abort point.\n--------------------------\n"
             65 72 73 20 73 74 61
             74 65 20 61 74 20 61
             62 6F 72 74 20 70 6F
             69 6E 74 2E 0A 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 2D 2D 2D 2D 2D
             2D 2D 2D 0A 00
      0008EC 45 50 43 3A 00        1452 REG_EPC: .asciz "EPC:"
      0008F1 0A 59 3A 00           1453 REG_Y:   .asciz "\nY:" 
      0008F5 0A 58 3A 00           1454 REG_X:   .asciz "\nX:"
      0008F9 0A 41 3A 00           1455 REG_A:   .asciz "\nA:" 
      0008FD 0A 43 43 3A 00        1456 REG_CC:  .asciz "\nCC:"
      000902 0A 53 50 3A 00        1457 REG_SP:  .asciz "\nSP:"
                                   1458 .endif ; DEBUG 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 29.
Hexadecimal [24-Bits]



                                   1459 
                                   1460 ;------------------------------------
                                   1461 ; print integer in acc24 
                                   1462 ; input:
                                   1463 ;	acc24 		integer to print 
                                   1464 ;	A 			numerical base for conversion 
                                   1465 ;               if bit 7 is set add a space at print end.
                                   1466 ;   XL 			field width, 0 -> no fill.
                                   1467 ;  output:
                                   1468 ;    none 
                                   1469 ;------------------------------------
                           000001  1470 	WIDTH = 1
                           000002  1471 	BASE = 2
                           000003  1472 	ADD_SPACE=3 ; add a space after number 
                           000003  1473 	VSIZE = 3
      000907                       1474 prti24:
      000907                       1475 	_vars VSIZE 
      000907 52 03            [ 2]    1     sub sp,#VSIZE 
      000909 0F 03            [ 1] 1476 	clr (ADD_SPACE,sp)
      00090B A5 80            [ 1] 1477 	bcp a,#0x80 
      00090D 27 02            [ 1] 1478 	jreq 0$ 
      00090F 03 03            [ 1] 1479 	cpl (ADD_SPACE,sp)
      000911 A4 1F            [ 1] 1480 0$:	and a,#31 
      000913 6B 02            [ 1] 1481 	ld (BASE,sp),a
      000915 9F               [ 1] 1482 	ld a,xl
      000916 6B 01            [ 1] 1483 	ld (WIDTH,sp),a 
      000918 7B 02            [ 1] 1484 	ld a, (BASE,sp)  
      00091A CD 09 AB         [ 4] 1485     call itoa  ; conversion entier en  .asciz
      00091D 7B 01            [ 1] 1486 1$: ld a,(WIDTH,sp)
      00091F 27 1F            [ 1] 1487 	jreq 4$
      000921 C7 00 0A         [ 1] 1488 	ld acc8,a 
      000924 89               [ 2] 1489 	pushw x 
      000925 CD 02 72         [ 4] 1490 	call strlen 
      000928 9F               [ 1] 1491 	ld a,xl 
      000929 85               [ 2] 1492 	popw x 
      00092A 31 00 0A         [ 3] 1493 	exg a,acc8 
      00092D C0 00 0A         [ 1] 1494 	sub a,acc8 
      000930 2B 0E            [ 1] 1495 	jrmi 4$
      000932 6B 01            [ 1] 1496 	ld (WIDTH,sp),a 
      000934 A6 20            [ 1] 1497 	ld  a,#SPACE
      000936 0D 01            [ 1] 1498 3$: tnz (WIDTH,sp)
      000938 27 06            [ 1] 1499 	jreq 4$
      00093A 5A               [ 2] 1500 	decw x 
      00093B F7               [ 1] 1501 	ld (x),a 
      00093C 0A 01            [ 1] 1502 	dec (WIDTH,sp) 
      00093E 20 F6            [ 2] 1503 	jra 3$
      000940                       1504 4$: 
      000940 CD 01 B0         [ 4] 1505 	call puts 
      000943 0D 03            [ 1] 1506 	tnz (ADD_SPACE,sp)
      000945 27 05            [ 1] 1507 	jreq 5$
      000947 A6 20            [ 1] 1508     ld a,#SPACE 
      000949 CD 01 9E         [ 4] 1509 	call putc 
      00094C                       1510 5$: _drop VSIZE 
      00094C 5B 03            [ 2]    1     addw sp,#VSIZE 
      00094E 81               [ 4] 1511     ret	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 30.
Hexadecimal [24-Bits]



                                   1512 
                                   1513 ;-----------------------------------
                                   1514 ; print a 16 bit integer 
                                   1515 ; using variable 'base' as conversion
                                   1516 ; format.
                                   1517 ; input:
                                   1518 ;   X       integer to print 
                                   1519 ;   base    conversion base 
                                   1520 ; output:
                                   1521 ;   none 
                                   1522 ;-----------------------------------
                           000001  1523 	SIGN=1
                           000001  1524 	VSIZE=1
      00094F                       1525 print_int: 
      00094F                       1526 	_vars VSIZE 
      00094F 52 01            [ 2]    1     sub sp,#VSIZE 
      000951 0F 01            [ 1] 1527 	clr (SIGN,sp)
      000953 90 AE 17 3F      [ 2] 1528 	ldw y,#pad+PAD_SIZE-1 
      000957 90 7F            [ 1] 1529 	clr (y)
      000959 C6 00 07         [ 1] 1530 	ld a,base  
      00095C A1 0A            [ 1] 1531 	cp a,#10 
      00095E 26 06            [ 1] 1532 	jrne 1$ 
      000960 5D               [ 2] 1533 	tnzw x 
      000961 2A 03            [ 1] 1534 	jrpl 1$ 
      000963 03 01            [ 1] 1535 	cpl (SIGN,sp)
      000965 50               [ 2] 1536 	negw x 	 
      000966                       1537 1$:	
      000966 C6 00 07         [ 1] 1538 	ld a,base 
      000969 62               [ 2] 1539 	div x,a 
      00096A AB 30            [ 1] 1540 	add a,#'0 
      00096C A1 3A            [ 1] 1541 	cp a,#'9+1 
      00096E 2B 02            [ 1] 1542 	jrmi 2$ 
      000970 AB 07            [ 1] 1543 	add a,#7 
      000972 90 5A            [ 2] 1544 2$: decw y 
      000974 90 F7            [ 1] 1545 	ld (y),a 
      000976 5D               [ 2] 1546 	tnzw x 
      000977 26 ED            [ 1] 1547 	jrne 1$ 
      000979 A6 10            [ 1] 1548 	ld a,#16 
      00097B C1 00 07         [ 1] 1549 	cp a,base 
      00097E 26 08            [ 1] 1550 	jrne 3$
      000980 A6 24            [ 1] 1551 	ld a,#'$
      000982 90 5A            [ 2] 1552 	decw y  
      000984 90 F7            [ 1] 1553 	ld (y),a
      000986 20 0A            [ 2] 1554 	jra 9$ 
      000988 0D 01            [ 1] 1555 3$: tnz (SIGN,sp)
      00098A 27 06            [ 1] 1556 	jreq 9$ 
      00098C A6 2D            [ 1] 1557 	ld a,#'-
      00098E 90 5A            [ 2] 1558 	decw y  
      000990 90 F7            [ 1] 1559 	ld (y),a
      000992                       1560 9$:	
      000992 93               [ 1] 1561 	ldw x,y 
      000993 1D 17 3F         [ 2] 1562 	subw x,#pad+PAD_SIZE-1 
      000996 50               [ 2] 1563 	negw x  
      000997                       1564 10$:
      000997 90 5A            [ 2] 1565 	decw y 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 31.
Hexadecimal [24-Bits]



      000999 A6 20            [ 1] 1566 	ld a,#SPACE 
      00099B 90 F7            [ 1] 1567 	ld (y),a
      00099D 5C               [ 1] 1568 	incw x 
      00099E 9F               [ 1] 1569 	ld a,xl 
      00099F C1 00 25         [ 1] 1570 	cp a,tab_width
      0009A2 2B F3            [ 1] 1571 	jrmi 10$ 
      0009A4                       1572 12$:
      0009A4 93               [ 1] 1573     ldw x,y 
      0009A5 CD 01 B0         [ 4] 1574 	call puts  
      0009A8                       1575 	_drop VSIZE 
      0009A8 5B 01            [ 2]    1     addw sp,#VSIZE 
      0009AA 81               [ 4] 1576 	ret 
                                   1577 
                                   1578 ;------------------------------------
                                   1579 ; convert integer in acc24 to string
                                   1580 ; input:
                                   1581 ;   A	  	base
                                   1582 ;	acc24	integer to convert
                                   1583 ; output:
                                   1584 ;   X  		pointer to string
                                   1585 ;------------------------------------
                           000001  1586 	SIGN=1  ; integer sign 
                           000002  1587 	BASE=2  ; numeric base 
                           000002  1588 	VSIZE=2  ;locals size
      0009AB                       1589 itoa:
      0009AB 52 02            [ 2] 1590 	sub sp,#VSIZE
      0009AD 6B 02            [ 1] 1591 	ld (BASE,sp), a  ; base
      0009AF 0F 01            [ 1] 1592 	clr (SIGN,sp)    ; sign
      0009B1 A1 0A            [ 1] 1593 	cp a,#10
      0009B3 26 0A            [ 1] 1594 	jrne 1$
                                   1595 	; base 10 string display with negative sign if bit 23==1
      0009B5 72 0F 00 08 05   [ 2] 1596 	btjf acc24,#7,1$
      0009BA 03 01            [ 1] 1597 	cpl (SIGN,sp)
      0009BC CD 0A 1A         [ 4] 1598 	call neg_acc24
      0009BF                       1599 1$:
                                   1600 ; initialize string pointer 
      0009BF AE 17 3F         [ 2] 1601 	ldw x,#pad+PAD_SIZE-1
      0009C2 7F               [ 1] 1602 	clr (x)
      0009C3                       1603 itoa_loop:
      0009C3 7B 02            [ 1] 1604     ld a,(BASE,sp)
      0009C5 CD 09 F2         [ 4] 1605     call divu24_8 ; acc24/A 
      0009C8 AB 30            [ 1] 1606     add a,#'0  ; remainder of division
      0009CA A1 3A            [ 1] 1607     cp a,#'9+1
      0009CC 2B 02            [ 1] 1608     jrmi 2$
      0009CE AB 07            [ 1] 1609     add a,#7 
      0009D0 5A               [ 2] 1610 2$: decw x
      0009D1 F7               [ 1] 1611     ld (x),a
                                   1612 	; if acc24==0 conversion done
      0009D2 C6 00 08         [ 1] 1613 	ld a,acc24
      0009D5 CA 00 09         [ 1] 1614 	or a,acc16
      0009D8 CA 00 0A         [ 1] 1615 	or a,acc8
      0009DB 26 E6            [ 1] 1616     jrne itoa_loop
                                   1617 	;conversion done, next add '$' or '-' as required
      0009DD 7B 02            [ 1] 1618 	ld a,(BASE,sp)
      0009DF A1 10            [ 1] 1619 	cp a,#16
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 32.
Hexadecimal [24-Bits]



      0009E1 27 08            [ 1] 1620 	jreq 8$
      0009E3 7B 01            [ 1] 1621 	ld a,(SIGN,sp)
      0009E5 27 08            [ 1] 1622     jreq 10$
      0009E7 A6 2D            [ 1] 1623     ld a,#'-
      0009E9 20 02            [ 2] 1624 	jra 9$ 
      0009EB A6 24            [ 1] 1625 8$: ld a,#'$ 
      0009ED 5A               [ 2] 1626 9$: decw x
      0009EE F7               [ 1] 1627     ld (x),a
      0009EF                       1628 10$:
      0009EF 5B 02            [ 2] 1629 	addw sp,#VSIZE
      0009F1 81               [ 4] 1630 	ret
                                   1631 
                                   1632 ;-------------------------------------
                                   1633 ; divide uint24_t by uint8_t
                                   1634 ; used to convert uint24_t to string
                                   1635 ; input:
                                   1636 ;	acc24	dividend
                                   1637 ;   A 		divisor
                                   1638 ; output:
                                   1639 ;   acc24	quotient
                                   1640 ;   A		remainder
                                   1641 ;------------------------------------- 
                                   1642 ; offset  on sp of arguments and locals
                           000001  1643 	U8   = 1   ; divisor on stack
                           000001  1644 	VSIZE =1
      0009F2                       1645 divu24_8:
      0009F2 89               [ 2] 1646 	pushw x ; save x
      0009F3 88               [ 1] 1647 	push a 
                                   1648 	; ld dividend UU:MM bytes in X
      0009F4 C6 00 08         [ 1] 1649 	ld a, acc24
      0009F7 95               [ 1] 1650 	ld xh,a
      0009F8 C6 00 09         [ 1] 1651 	ld a,acc24+1
      0009FB 97               [ 1] 1652 	ld xl,a
      0009FC 7B 01            [ 1] 1653 	ld a,(U8,SP) ; divisor
      0009FE 62               [ 2] 1654 	div x,a ; UU:MM/U8
      0009FF 88               [ 1] 1655 	push a  ;save remainder
      000A00 9E               [ 1] 1656 	ld a,xh
      000A01 C7 00 08         [ 1] 1657 	ld acc24,a
      000A04 9F               [ 1] 1658 	ld a,xl
      000A05 C7 00 09         [ 1] 1659 	ld acc24+1,a
      000A08 84               [ 1] 1660 	pop a
      000A09 95               [ 1] 1661 	ld xh,a
      000A0A C6 00 0A         [ 1] 1662 	ld a,acc24+2
      000A0D 97               [ 1] 1663 	ld xl,a
      000A0E 7B 01            [ 1] 1664 	ld a,(U8,sp) ; divisor
      000A10 62               [ 2] 1665 	div x,a  ; R:LL/U8
      000A11 6B 01            [ 1] 1666 	ld (U8,sp),a ; save remainder
      000A13 9F               [ 1] 1667 	ld a,xl
      000A14 C7 00 0A         [ 1] 1668 	ld acc24+2,a
      000A17 84               [ 1] 1669 	pop a
      000A18 85               [ 2] 1670 	popw x
      000A19 81               [ 4] 1671 	ret
                                   1672 
                                   1673 ;------------------------------------
                                   1674 ;  two's complement acc24
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 33.
Hexadecimal [24-Bits]



                                   1675 ;  input:
                                   1676 ;		acc24 variable
                                   1677 ;  output:
                                   1678 ;		acc24 variable
                                   1679 ;-------------------------------------
      000A1A                       1680 neg_acc24:
      000A1A 72 53 00 0A      [ 1] 1681 	cpl acc24+2
      000A1E 72 53 00 09      [ 1] 1682 	cpl acc24+1
      000A22 72 53 00 08      [ 1] 1683 	cpl acc24
      000A26 A6 01            [ 1] 1684 	ld a,#1
      000A28 CB 00 0A         [ 1] 1685 	add a,acc24+2
      000A2B C7 00 0A         [ 1] 1686 	ld acc24+2,a
      000A2E 4F               [ 1] 1687 	clr a
      000A2F C9 00 09         [ 1] 1688 	adc a,acc24+1
      000A32 C7 00 09         [ 1] 1689 	ld acc24+1,a 
      000A35 4F               [ 1] 1690 	clr a 
      000A36 C9 00 08         [ 1] 1691 	adc a,acc24 
      000A39 C7 00 08         [ 1] 1692 	ld acc24,a 
      000A3C 81               [ 4] 1693 	ret
                                   1694 
                                   1695 
                                   1696 ;------------------------------------
                                   1697 ; read a line of text from terminal
                                   1698 ; input:
                                   1699 ;	none
                                   1700 ; local variable on stack:
                                   1701 ;	LL  line length
                                   1702 ;   RXCHAR last received chaaracte 
                                   1703 ; output:
                                   1704 ;   text in tib  buffer
                                   1705 ;------------------------------------
                                   1706 	; local variables
                           000001  1707 	LL_HB=1
                           000001  1708 	RXCHAR = 1 ; last char received
                           000002  1709 	LL = 2  ; accepted line length
                           000002  1710 	VSIZE=2 
      000A3D                       1711 readln:
      000A3D 5F               [ 1] 1712 	clrw x 
      000A3E 89               [ 2] 1713 	pushw x 
      000A3F 90 AE 16 C8      [ 2] 1714  	ldw y,#tib ; input buffer
      000A43                       1715 readln_loop:
      000A43 CD 01 A7         [ 4] 1716 	call getc
      000A46 6B 01            [ 1] 1717 	ld (RXCHAR,sp),a
      000A48 A1 0D            [ 1] 1718 	cp a,#CR
      000A4A 26 03            [ 1] 1719 	jrne 1$
      000A4C CC 0A BC         [ 2] 1720 	jp readln_quit
      000A4F A1 0A            [ 1] 1721 1$:	cp a,#NL
      000A51 27 69            [ 1] 1722 	jreq readln_quit
      000A53 A1 08            [ 1] 1723 	cp a,#BSP
      000A55 27 41            [ 1] 1724 	jreq del_back
      000A57 A1 04            [ 1] 1725 	cp a,#CTRL_D
      000A59 27 2E            [ 1] 1726 	jreq del_ln
      000A5B A1 12            [ 1] 1727 	cp a,#CTRL_R 
      000A5D 27 06            [ 1] 1728 	jreq reprint 
                                   1729 ;	cp a,#'[
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 34.
Hexadecimal [24-Bits]



                                   1730 ;	jreq ansi_seq
      000A5F                       1731 final_test:
      000A5F A1 20            [ 1] 1732 	cp a,#SPACE
      000A61 2A 44            [ 1] 1733 	jrpl accept_char
      000A63 20 DE            [ 2] 1734 	jra readln_loop
      000A65                       1735 ansi_seq:
                                   1736 ;	call getc
                                   1737 ;	cp a,#'C 
                                   1738 ;	jreq rigth_arrow
                                   1739 ;	cp a,#'D 
                                   1740 ;	jreq left_arrow 
                                   1741 ;	jra final_test
      000A65                       1742 right_arrow:
                                   1743 ;	ld a,#BSP 
                                   1744 ;	call putc 
                                   1745 ;	jra realn_loop 
      000A65                       1746 left_arrow:
                                   1747 
                                   1748 ;	jra readln_loop
      000A65                       1749 reprint: 
      000A65 72 5D 00 02      [ 1] 1750 	tnz count 
      000A69 27 D8            [ 1] 1751 	jreq readln_loop
      000A6B 0D 02            [ 1] 1752 	tnz (LL,sp)
      000A6D 26 D4            [ 1] 1753 	jrne readln_loop
      000A6F AE 16 C8         [ 2] 1754 	ldw x,#tib 
      000A72 CD 01 B0         [ 4] 1755 	call puts
      000A75 90 AE 16 C8      [ 2] 1756 	ldw y,#tib 
      000A79 C6 00 02         [ 1] 1757 	ld a,count 
      000A7C 6B 02            [ 1] 1758 	ld (LL,sp),a
      000A7E 72 5F 00 02      [ 1] 1759 	clr count 
      000A82 0F 01            [ 1] 1760 	clr (LL_HB,sp)
      000A84 72 F9 01         [ 2] 1761 	addw y,(LL_HB,sp)
      000A87 20 BA            [ 2] 1762 	jra readln_loop 
      000A89                       1763 del_ln:
      000A89 7B 02            [ 1] 1764 	ld a,(LL,sp)
      000A8B CD 01 CA         [ 4] 1765 	call delete
      000A8E 90 AE 16 C8      [ 2] 1766 	ldw y,#tib
      000A92 90 7F            [ 1] 1767 	clr (y)
      000A94 0F 02            [ 1] 1768 	clr (LL,sp)
      000A96 20 AB            [ 2] 1769 	jra readln_loop
      000A98                       1770 del_back:
      000A98 0D 02            [ 1] 1771     tnz (LL,sp)
      000A9A 27 A7            [ 1] 1772     jreq readln_loop
      000A9C 0A 02            [ 1] 1773     dec (LL,sp)
      000A9E 90 5A            [ 2] 1774     decw y
      000AA0 90 7F            [ 1] 1775     clr  (y)
      000AA2 CD 01 BA         [ 4] 1776     call bksp 
      000AA5 20 9C            [ 2] 1777     jra readln_loop	
      000AA7                       1778 accept_char:
      000AA7 A6 4F            [ 1] 1779 	ld a,#TIB_SIZE-1
      000AA9 11 02            [ 1] 1780 	cp a, (LL,sp)
      000AAB 27 96            [ 1] 1781 	jreq readln_loop
      000AAD 7B 01            [ 1] 1782 	ld a,(RXCHAR,sp)
      000AAF 90 F7            [ 1] 1783 	ld (y),a
      000AB1 0C 02            [ 1] 1784 	inc (LL,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 35.
Hexadecimal [24-Bits]



      000AB3 90 5C            [ 1] 1785 	incw y
      000AB5 90 7F            [ 1] 1786 	clr (y)
      000AB7 CD 01 9E         [ 4] 1787 	call putc 
      000ABA 20 87            [ 2] 1788 	jra readln_loop
      000ABC                       1789 readln_quit:
      000ABC 90 7F            [ 1] 1790 	clr (y)
      000ABE 7B 02            [ 1] 1791 	ld a,(LL,sp)
      000AC0 C7 00 02         [ 1] 1792 	ld count,a 
      000AC3                       1793 	_drop VSIZE 
      000AC3 5B 02            [ 2]    1     addw sp,#VSIZE 
      000AC5 A6 0D            [ 1] 1794 	ld a,#CR
      000AC7 CD 01 9E         [ 4] 1795 	call putc
      000ACA 81               [ 4] 1796 	ret
                                   1797 
                           000001  1798 .if DEBUG 	
                                   1799 ;----------------------------
                                   1800 ; command interface
                                   1801 ; only 3 commands:
                                   1802 ;  'q' to resume application
                                   1803 ;  'p [addr]' to print memory values 
                                   1804 ;  's addr' to print string 
                                   1805 ;----------------------------
                                   1806 ;local variable 
                           000001  1807 	PSIZE=1
                           000001  1808 	VSIZE=1 
      000ACB                       1809 cmd_itf:
      000ACB 52 01            [ 2] 1810 	sub sp,#VSIZE 
      000ACD 72 5F 00 13      [ 1] 1811 	clr farptr 
      000AD1 72 5F 00 14      [ 1] 1812 	clr farptr+1 
      000AD5 72 5F 00 15      [ 1] 1813 	clr farptr+2  
      000AD9                       1814 repl:
      000AD9 A6 0D            [ 1] 1815 	ld a,#CR 
      000ADB CD 01 9E         [ 4] 1816 	call putc 
      000ADE A6 3F            [ 1] 1817 	ld a,#'? 
      000AE0 CD 01 9E         [ 4] 1818 	call putc
      000AE3 72 5F 00 00      [ 1] 1819 	clr in.w 
      000AE7 72 5F 00 01      [ 1] 1820 	clr in 
      000AEB CD 0A 3D         [ 4] 1821 	call readln
      000AEE 90 AE 16 C8      [ 2] 1822 	ldw y,#tib  
      000AF2 90 F6            [ 1] 1823 	ld a,(y)
      000AF4 27 E3            [ 1] 1824 	jreq repl  
      000AF6 72 5C 00 01      [ 1] 1825 	inc in 
      000AFA CD 0E A8         [ 4] 1826 	call to_upper 
      000AFD A1 51            [ 1] 1827 	cp a,#'Q 
      000AFF 26 17            [ 1] 1828 	jrne test_p
      000B01                       1829 repl_exit:
      000B01 72 5F 16 C8      [ 1] 1830 	clr tib 
      000B05 72 5F 00 02      [ 1] 1831 	clr count 
      000B09 72 5F 00 01      [ 1] 1832 	clr in 
      000B0D                       1833 	_drop #VSIZE 	
      000B0D 5B 01            [ 2]    1     addw sp,##VSIZE 
      000B0F 81               [ 4] 1834 	ret  
      000B10                       1835 invalid:
      000B10 AE 0B 8E         [ 2] 1836 	ldw x,#invalid_cmd 
      000B13 CD 01 B0         [ 4] 1837 	call puts 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 36.
Hexadecimal [24-Bits]



      000B16 20 C1            [ 2] 1838 	jra repl 
      000B18                       1839 test_p:	
      000B18 A1 50            [ 1] 1840     cp a,#'P 
      000B1A 27 11            [ 1] 1841 	jreq mem_peek
      000B1C A1 53            [ 1] 1842     cp a,#'S 
      000B1E 26 F0            [ 1] 1843 	jrne invalid 
      000B20                       1844 print_string:	
      000B20 CD 0C E7         [ 4] 1845 	call get_token
      000B23 A1 02            [ 1] 1846 	cp a,#TK_INTGR 
      000B25 26 E9            [ 1] 1847 	jrne invalid 
      000B27 CD 01 B0         [ 4] 1848 	call puts
      000B2A CC 0A D9         [ 2] 1849 	jp repl 	
      000B2D                       1850 mem_peek:
      000B2D A6 20            [ 1] 1851 	ld a,#SPACE 
      000B2F CD 0F 60         [ 4] 1852 	call skip  	 
      000B32 72 B9 00 00      [ 2] 1853 	addw y,in.w 
      000B36 AE 17 18         [ 2] 1854 	ldw x,#pad 
      000B39 CD 02 90         [ 4] 1855 	call strcpy
      000B3C CD 0E B4         [ 4] 1856 	call atoi24 	
      000B3F C6 00 08         [ 1] 1857 	ld a, acc24 
      000B42 CA 00 09         [ 1] 1858 	or a,acc16 
      000B45 CA 00 0A         [ 1] 1859 	or a,acc8 
      000B48 26 02            [ 1] 1860 	jrne 1$ 
      000B4A 20 0C            [ 2] 1861 	jra peek_byte  
      000B4C CE 00 08         [ 2] 1862 1$:	ldw x,acc24 
      000B4F CF 00 13         [ 2] 1863 	ldw farptr,x 
      000B52 C6 00 0A         [ 1] 1864 	ld a,acc8 
      000B55 C7 00 15         [ 1] 1865 	ld farptr+2,a 
      000B58                       1866 peek_byte:
      000B58 CD 0B 9D         [ 4] 1867 	call print_farptr 
      000B5B A6 08            [ 1] 1868 	ld a,#8 
      000B5D 6B 01            [ 1] 1869 	ld (PSIZE,sp),a 
      000B5F 5F               [ 1] 1870 	clrw x 
      000B60 CD 0B B8         [ 4] 1871 1$:	call fetchc  
      000B63 89               [ 2] 1872 	pushw x 
      000B64 C7 00 0A         [ 1] 1873 	ld acc8,a 
      000B67 5F               [ 1] 1874 	clrw x 
      000B68 CF 00 08         [ 2] 1875 	ldw acc24,x 
      000B6B A6 90            [ 1] 1876 	ld a,#16+128
      000B6D CD 09 07         [ 4] 1877 	call prti24
      000B70 85               [ 2] 1878 	popw x 
      000B71 0A 01            [ 1] 1879 	dec (PSIZE,sp)
      000B73 26 EB            [ 1] 1880 	jrne 1$ 
      000B75 A6 08            [ 1] 1881 	ld a,#8 
      000B77 CB 00 15         [ 1] 1882 	add a,farptr+2 
      000B7A C7 00 15         [ 1] 1883 	ld farptr+2,a
      000B7D 4F               [ 1] 1884 	clr a 
      000B7E C9 00 14         [ 1] 1885 	adc a,farptr+1 
      000B81 C7 00 14         [ 1] 1886 	ld farptr+1,a 
      000B84 4F               [ 1] 1887 	clr a 
      000B85 C9 00 13         [ 1] 1888 	adc a,farptr 
      000B88 C7 00 13         [ 1] 1889 	ld farptr,a 
      000B8B CC 0A D9         [ 2] 1890 	jp repl  
                                   1891 
      000B8E 6E 6F 74 20 61 20 63  1892 invalid_cmd: .asciz "not a command\n" 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 37.
Hexadecimal [24-Bits]



             6F 6D 6D 61 6E 64 0A
             00
                                   1893 
                                   1894 ;----------------------------
                                   1895 ; display farptr address
                                   1896 ;----------------------------
      000B9D                       1897 print_farptr:
      000B9D C6 00 15         [ 1] 1898 	ld a ,farptr+2 
      000BA0 C7 00 0A         [ 1] 1899 	ld acc8,a 
      000BA3 CE 00 13         [ 2] 1900 	ldw x,farptr 
      000BA6 CF 00 08         [ 2] 1901 	ldw acc24,x 
      000BA9 5F               [ 1] 1902 	clrw x 
      000BAA A6 10            [ 1] 1903 	ld a,#16 
      000BAC CD 09 07         [ 4] 1904 	call prti24
      000BAF A6 20            [ 1] 1905 	ld a,#SPACE 
      000BB1 CD 01 9E         [ 4] 1906 	call putc 
      000BB4 CD 01 9E         [ 4] 1907 	call putc 
      000BB7 81               [ 4] 1908 	ret
                                   1909 
                                   1910 ;------------------------------------
                                   1911 ; get byte at address farptr[X]
                                   1912 ; input:
                                   1913 ;	 farptr   address to peek
                                   1914 ;    X		  farptr index 	
                                   1915 ; output:
                                   1916 ;	 A 		  byte from memory  
                                   1917 ;    x		  incremented by 1
                                   1918 ;------------------------------------
      000BB8                       1919 fetchc: ; @C
      000BB8 92 AF 00 13      [ 5] 1920 	ldf a,([farptr],x)
      000BBC 5C               [ 1] 1921 	incw x
      000BBD 81               [ 4] 1922 	ret
                                   1923 
                                   1924 
                                   1925 ;------------------------------------
                                   1926 ; expect a number from command line 
                                   1927 ; next argument
                                   1928 ;  input:
                                   1929 ;	  none
                                   1930 ;  output:
                                   1931 ;    acc24   int24_t 
                                   1932 ;------------------------------------
      000BBE                       1933 number::
      000BBE CD 0C E7         [ 4] 1934 	call get_token
      000BC1 CD 0E B4         [ 4] 1935 	call atoi24
      000BC4 81               [ 4] 1936 	ret
                                   1937 .endif ; DEBUG 
                                   1938 
                                   1939 ;------------------------------------
                                   1940 ; parse quoted string 
                                   1941 ; input:
                                   1942 ;   Y 	pointer to tib 
                                   1943 ;   X   pointer to pad
                                   1944 ; output:
                                   1945 ;	pad   parsed string
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 38.
Hexadecimal [24-Bits]



                                   1946 ;   TOS  char* to pad  
                                   1947 ;------------------------------------
                           000001  1948 	PREV = 1
                           000002  1949 	CURR =2 
                           000002  1950 	VSIZE=2 
      000BC5                       1951 parse_quote: ; { -- addr }
      000BC5                       1952 	_vars VSIZE 
      000BC5 52 02            [ 2]    1     sub sp,#VSIZE 
      000BC7 4F               [ 1] 1953 	clr a
      000BC8 6B 01            [ 1] 1954 1$:	ld (PREV,sp),a 
      000BCA 72 5C 00 01      [ 1] 1955 2$:	inc in
      000BCE 91 D6 00         [ 4] 1956 	ld a,([in.w],y)
      000BD1 27 24            [ 1] 1957 	jreq 6$
      000BD3 6B 02            [ 1] 1958 	ld (CURR,sp),a 
      000BD5 A6 5C            [ 1] 1959 	ld a,#'\
      000BD7 11 01            [ 1] 1960 	cp a, (PREV,sp)
      000BD9 26 0A            [ 1] 1961 	jrne 3$
      000BDB 0F 01            [ 1] 1962 	clr (PREV,sp)
      000BDD 7B 02            [ 1] 1963 	ld a,(CURR,sp)
      000BDF AD 1F            [ 4] 1964 	callr convert_escape
      000BE1 F7               [ 1] 1965 	ld (x),a 
      000BE2 5C               [ 1] 1966 	incw x 
      000BE3 20 E5            [ 2] 1967 	jra 2$
      000BE5                       1968 3$:
      000BE5 7B 02            [ 1] 1969 	ld a,(CURR,sp)
      000BE7 A1 5C            [ 1] 1970 	cp a,#'\'
      000BE9 27 DD            [ 1] 1971 	jreq 1$
      000BEB A1 22            [ 1] 1972 	cp a,#'"
      000BED 27 04            [ 1] 1973 	jreq 5$ 
      000BEF F7               [ 1] 1974 	ld (x),a 
      000BF0 5C               [ 1] 1975 	incw x 
      000BF1 20 D7            [ 2] 1976 	jra 2$
      000BF3 72 5C 00 01      [ 1] 1977 5$:	inc in 
      000BF7 7F               [ 1] 1978 6$: clr (x)
      000BF8 AE 17 18         [ 2] 1979 	ldw x,#pad 
      000BFB                       1980 	_drop VSIZE
      000BFB 5B 02            [ 2]    1     addw sp,#VSIZE 
      000BFD A6 08            [ 1] 1981 	ld a,#TK_QSTR  
      000BFF 81               [ 4] 1982 	ret 
                                   1983 
                                   1984 ;---------------------------------------
                                   1985 ; called by parse_quote
                                   1986 ; subtitute escaped character 
                                   1987 ; by their ASCII value .
                                   1988 ; input:
                                   1989 ;   A  character following '\'
                                   1990 ; output:
                                   1991 ;   A  substitued char or same if not valid.
                                   1992 ;---------------------------------------
      000C00                       1993 convert_escape:
      000C00 A1 61            [ 1] 1994 	cp a,#'a'
      000C02 26 03            [ 1] 1995 	jrne 1$
      000C04 A6 07            [ 1] 1996 	ld a,#7
      000C06 81               [ 4] 1997 	ret 
      000C07 A1 62            [ 1] 1998 1$: cp a,#'b'
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 39.
Hexadecimal [24-Bits]



      000C09 26 03            [ 1] 1999 	jrne 2$
      000C0B A6 08            [ 1] 2000 	ld a,#8
      000C0D 81               [ 4] 2001 	ret 
      000C0E A1 65            [ 1] 2002 2$: cp a,#'e' 
      000C10 26 03            [ 1] 2003     jrne 3$
      000C12 A6 5C            [ 1] 2004 	ld a,#'\'
      000C14 81               [ 4] 2005 	ret  
      000C15 A1 5C            [ 1] 2006 3$: cp a,#'\'
      000C17 26 03            [ 1] 2007 	jrne 4$
      000C19 A6 5C            [ 1] 2008 	ld a,#'\'
      000C1B 81               [ 4] 2009 	ret 
      000C1C A1 66            [ 1] 2010 4$: cp a,#'f' 
      000C1E 26 03            [ 1] 2011 	jrne 5$ 
      000C20 A6 0C            [ 1] 2012 	ld a,#FF 
      000C22 81               [ 4] 2013 	ret  
      000C23 A1 6E            [ 1] 2014 5$: cp a,#'n' 
      000C25 26 03            [ 1] 2015     jrne 6$ 
      000C27 A6 0A            [ 1] 2016 	ld a,#0xa 
      000C29 81               [ 4] 2017 	ret  
      000C2A A1 72            [ 1] 2018 6$: cp a,#'r' 
      000C2C 26 03            [ 1] 2019 	jrne 7$
      000C2E A6 0D            [ 1] 2020 	ld a,#0xd 
      000C30 81               [ 4] 2021 	ret  
      000C31 A1 74            [ 1] 2022 7$: cp a,#'t' 
      000C33 26 03            [ 1] 2023 	jrne 8$ 
      000C35 A6 09            [ 1] 2024 	ld a,#9 
      000C37 81               [ 4] 2025 	ret  
      000C38 A1 76            [ 1] 2026 8$: cp a,#'v' 
      000C3A 26 02            [ 1] 2027 	jrne 9$  
      000C3C A6 0B            [ 1] 2028 	ld a,#0xb 
      000C3E 81               [ 4] 2029 9$:	ret 
                                   2030 
                                   2031 ;-------------------------
                                   2032 ; integer parser 
                                   2033 ; input:
                                   2034 ;   X 		point to pad 
                                   2035 ;   Y 		point to tib 
                                   2036 ;   A 	    first digit|'$' 
                                   2037 ; output:  
                                   2038 ;   pad     number string 
                                   2039 ;   X 		integer 
                                   2040 ;   A 		TK_INTGR
                                   2041 ;-------------------------
                           000001  2042 	BASE=1
                           000002  2043 	TCHAR=2 
                           000002  2044 	VSIZE=2 
      000C3F                       2045 parse_integer: ; { -- n }
      000C3F 4B 00            [ 1] 2046 	push #0 ; TCHAR 
      000C41 A1 24            [ 1] 2047 	cp a,#'$
      000C43 27 04            [ 1] 2048 	jreq 1$ 
      000C45 4B 0A            [ 1] 2049 	push #10 ; BASE=10 
      000C47 20 02            [ 2] 2050 	jra 2$ 
      000C49 4B 10            [ 1] 2051 1$: push #16  ; BASE=16
      000C4B F7               [ 1] 2052 2$:	ld (x),a 
      000C4C 5C               [ 1] 2053 	incw x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 40.
Hexadecimal [24-Bits]



      000C4D 72 5C 00 01      [ 1] 2054 	inc in 
      000C51 91 D6 00         [ 4] 2055 	ld a,([in.w],y)
      000C54 CD 0E A8         [ 4] 2056 	call to_upper 
      000C57 6B 02            [ 1] 2057 	ld (TCHAR,sp),a 
      000C59 CD 0E 9F         [ 4] 2058 	call is_digit 
      000C5C 25 ED            [ 1] 2059 	jrc 2$
      000C5E A6 10            [ 1] 2060 	ld a,#16 
      000C60 11 01            [ 1] 2061 	cp a,(BASE,sp)
      000C62 26 0A            [ 1] 2062 	jrne 3$ 
      000C64 7B 02            [ 1] 2063 	ld a,(TCHAR,sp)
      000C66 A1 41            [ 1] 2064 	cp a,#'A 
      000C68 2B 04            [ 1] 2065 	jrmi 3$ 
      000C6A A1 47            [ 1] 2066 	cp a,#'G 
      000C6C 2B DD            [ 1] 2067 	jrmi 2$ 
      000C6E 7F               [ 1] 2068 3$:	clr (x)
      000C6F CD 0E B4         [ 4] 2069 	call atoi24
      000C72 CE 00 09         [ 2] 2070 	ldw x,acc16 
      000C75 A6 02            [ 1] 2071 	ld a,#TK_INTGR
      000C77                       2072 	_drop VSIZE  
      000C77 5B 02            [ 2]    1     addw sp,#VSIZE 
      000C79 81               [ 4] 2073 	ret 	
                                   2074 
                                   2075 ;-------------------------
                                   2076 ; binary integer parser 
                                   2077 ; input:
                                   2078 ;   X 		point to pad 
                                   2079 ;   Y 		point to tib 
                                   2080 ;   A 	    '%' 
                                   2081 ; output:  
                                   2082 ;   pad     number string 
                                   2083 ;   X 		integer 
                                   2084 ;   A 		TK_INTGR
                                   2085 ;   TOS     integer 
                                   2086 ;-------------------------
                           000001  2087 	BINARY=1
                           000002  2088 	VSIZE=2
      000C7A                       2089 parse_binary: ; { -- n }
      000C7A 4B 00            [ 1] 2090 	push #0
      000C7C 4B 00            [ 1] 2091 	push #0
      000C7E F7               [ 1] 2092 1$: ld (x),a 
      000C7F 5C               [ 1] 2093 	incw x 
      000C80 72 5C 00 01      [ 1] 2094 	inc in 
      000C84 91 D6 00         [ 4] 2095 	ld a,([in.w],y)
      000C87 A1 30            [ 1] 2096 	cp a,#'0 
      000C89 27 06            [ 1] 2097 	jreq 2$
      000C8B A1 31            [ 1] 2098 	cp a,#'1 
      000C8D 27 02            [ 1] 2099 	jreq 2$ 
      000C8F 20 09            [ 2] 2100 	jra bin_exit 
      000C91 A0 30            [ 1] 2101 2$: sub a,#'0	
      000C93 46               [ 1] 2102 	rrc a 
      000C94 09 02            [ 1] 2103 	rlc (BINARY+1,sp)
      000C96 09 01            [ 1] 2104 	rlc (BINARY,sp)
      000C98 20 E4            [ 2] 2105 	jra 1$  
      000C9A                       2106 bin_exit:
      000C9A 7F               [ 1] 2107 	clr (x)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 41.
Hexadecimal [24-Bits]



      000C9B 1E 01            [ 2] 2108 	ldw x,(BINARY,sp)
      000C9D A6 02            [ 1] 2109 	ld a,#TK_INTGR 	
      000C9F                       2110 	_drop VSIZE 
      000C9F 5B 02            [ 2]    1     addw sp,#VSIZE 
      000CA1 81               [ 4] 2111 	ret
                                   2112 
                                   2113 ;---------------------------
                                   2114 ;  token begin with a letter,
                                   2115 ;  is keyword or variable. 	
                                   2116 ; input:
                                   2117 ;   X 		point to pad 
                                   2118 ;   Y 		point to text
                                   2119 ;   A 	    first letter  
                                   2120 ; output:
                                   2121 ;   X		exec_addr|var_addr 
                                   2122 ;   A 		TK_CMD 
                                   2123 ;   pad 	keyword|var_name  
                                   2124 ;   TOS     exec_addr|var_addr 
                                   2125 ;--------------------------  
      000CA2                       2126 parse_keyword: ; { -- exec_addr|var_addr}
      000CA2 CD 0E A8         [ 4] 2127 	call to_upper 
      000CA5 F7               [ 1] 2128 	ld (x),a 
      000CA6 5C               [ 1] 2129 	incw x 
      000CA7 72 5C 00 01      [ 1] 2130 	inc in 
      000CAB 91 D6 00         [ 4] 2131 	ld a,([in.w],y)
      000CAE CD 04 C3         [ 4] 2132 	call is_alpha 
      000CB1 25 EF            [ 1] 2133 	jrc parse_keyword 
      000CB3 7F               [ 1] 2134 1$: clr (x)
      000CB4 72 5D 17 19      [ 1] 2135 	tnz pad+1 
      000CB8 26 15            [ 1] 2136 	jrne 2$
                                   2137 ; one letter variable name 
      000CBA C6 17 18         [ 1] 2138 	ld a,pad 
      000CBD A0 41            [ 1] 2139 	sub a,#'A 
      000CBF 48               [ 1] 2140 	sll a 
      000CC0 88               [ 1] 2141 	push a 
      000CC1 4B 00            [ 1] 2142 	push #0
      000CC3 AE 00 26         [ 2] 2143 	ldw x,#vars 
      000CC6 72 FB 01         [ 2] 2144 	addw x,(1,sp) ; X=var address 
      000CC9                       2145 	_drop 2 
      000CC9 5B 02            [ 2]    1     addw sp,#2 
      000CCB A6 03            [ 1] 2146 	ld a,#TK_VAR 
      000CCD 20 17            [ 2] 2147 	jra 4$ 
      000CCF                       2148 2$: ; check for keyword, otherwise syntax error.
      000CCF                       2149 	_ldx_dict kword_dict
      000CCF AE 20 AF         [ 2]    1     ldw x,#kword_dict+2
      000CD2 CD 11 45         [ 4] 2150 	call search_dict
      000CD5 4D               [ 1] 2151 	tnz a
      000CD6 26 03            [ 1] 2152 	jrne 3$ 
      000CD8 CC 06 D7         [ 2] 2153 	jp syntax_error
      000CDB A3 16 83         [ 2] 2154 3$: cpw x,#rem  
      000CDE 26 06            [ 1] 2155 	jrne 4$
      000CE0 55 00 02 00 01   [ 1] 2156 	mov in,count 
      000CE5 4F               [ 1] 2157 	clr a 
      000CE6 81               [ 4] 2158 4$:	ret  	
                                   2159 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 42.
Hexadecimal [24-Bits]



                                   2160 
                                   2161 ;------------------------------------
                                   2162 ; Command line tokenizer
                                   2163 ; scan text for next token
                                   2164 ; move token in 'pad'
                                   2165 ; input: 
      000CE7                       2166 	none: 
                                   2167 ; use:
                                   2168 ;	Y   pointer to text
                                   2169 ;   X	pointer to pad 
                                   2170 ;   in.w   index in text buffer
                                   2171 ; output:
                                   2172 ;   A       token attribute 
                                   2173 ;   pad 	token as .asciz
                                   2174 ;   X 		token value   
                                   2175 ;------------------------------------
                                   2176 	; use to check special character 
                                   2177 	.macro _case c t  
                                   2178 	ld a,#c 
                                   2179 	cp a,(TCHAR,sp) 
                                   2180 	jrne t
                                   2181 	.endm 
                                   2182 
                           000001  2183 	TCHAR=1
                           000002  2184 	ATTRIB=2 
                           000002  2185 	VSIZE=2
      000CE7                       2186 get_token: 
      000CE7 90 AE 16 C8      [ 2] 2187 	ldw y,#tib    	
      000CEB C6 00 01         [ 1] 2188 	ld a,in 
      000CEE C1 00 02         [ 1] 2189 	cp a,count 
      000CF1 2B 03            [ 1] 2190 	jrmi 1$
      000CF3 A6 00            [ 1] 2191 	ld a,#TK_NONE 
      000CF5 81               [ 4] 2192 	ret 
      000CF6                       2193 1$:	
      000CF6                       2194 	_vars VSIZE
      000CF6 52 02            [ 2]    1     sub sp,#VSIZE 
      000CF8 AE 17 18         [ 2] 2195 	ldw x, #pad
      000CFB A6 20            [ 1] 2196 	ld a,#SPACE
      000CFD CD 0F 60         [ 4] 2197 	call skip
      000D00 CF 00 11         [ 2] 2198 	ldw in.w.saved,x 
      000D03 91 D6 00         [ 4] 2199 	ld a,([in.w],y)
      000D06 26 07            [ 1] 2200 	jrne str_tst
      000D08 72 5F 17 18      [ 1] 2201 	clr pad 
      000D0C CC 0E 9C         [ 2] 2202 	jp token_exit ; end of line 
                                   2203 
      000D0F                       2204 str_tst: ; check for quoted string  	
      000D0F CD 0E A8         [ 4] 2205 	call to_upper 
      000D12 6B 01            [ 1] 2206 	ld (TCHAR,sp),a 
      000D14                       2207 	_case '"' nbr_tst
      000D14 A6 22            [ 1]    1 	ld a,#'"' 
      000D16 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D18 26 06            [ 1]    3 	jrne nbr_tst
      000D1A CD 0B C5         [ 4] 2208 	call parse_quote
      000D1D CC 0E 9C         [ 2] 2209 	jp token_exit
      000D20                       2210 nbr_tst: ; check for number 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 43.
Hexadecimal [24-Bits]



      000D20 A6 24            [ 1] 2211 	ld a,#'$'
      000D22 11 01            [ 1] 2212 	cp a,(TCHAR,sp) 
      000D24 27 13            [ 1] 2213 	jreq 1$
      000D26 A6 26            [ 1] 2214 	ld a,#'&
      000D28 11 01            [ 1] 2215 	cp a,(TCHAR,sp)
      000D2A 26 06            [ 1] 2216 	jrne 0$
      000D2C CD 0C 7A         [ 4] 2217 	call parse_binary ; expect binary integer 
      000D2F CC 0E 9C         [ 2] 2218 	jp token_exit 
      000D32 7B 01            [ 1] 2219 0$:	ld a,(TCHAR,sp)
      000D34 CD 0E 9F         [ 4] 2220 	call is_digit
      000D37 24 06            [ 1] 2221 	jrnc 3$
      000D39 CD 0C 3F         [ 4] 2222 1$:	call parse_integer 
      000D3C CC 0E 9C         [ 2] 2223 	jp token_exit 
      000D3F                       2224 3$: 
      000D3F                       2225 	_case '(' bkslsh_tst 
      000D3F A6 28            [ 1]    1 	ld a,#'(' 
      000D41 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D43 26 05            [ 1]    3 	jrne bkslsh_tst
      000D45 A6 09            [ 1] 2226 	ld a,#TK_LPAREN
      000D47 CC 0E 8C         [ 2] 2227 	jp token_char   	
      000D4A                       2228 bkslsh_tst:
      000D4A                       2229 	_case '\',rparnt_tst
      000D4A A6 5C            [ 1]    1 	ld a,#'\' 
      000D4C 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D4E 26 18            [ 1]    3 	jrne rparnt_tst
      000D50 7B 01            [ 1] 2230 	ld a,(TCHAR,sp)
      000D52 F7               [ 1] 2231 	ld (x),a 
      000D53 5C               [ 1] 2232 	incw x 
      000D54 72 5C 00 01      [ 1] 2233 	inc in 
      000D58 91 D6 00         [ 4] 2234 	ld a,([in.w],y)
      000D5B F7               [ 1] 2235 	ld (x),a 
      000D5C 5C               [ 1] 2236 	incw x 
      000D5D 72 5C 00 01      [ 1] 2237 	inc in  
      000D61 7F               [ 1] 2238 	clr (x) 
      000D62 97               [ 1] 2239 	ld xl,a 
      000D63 A6 05            [ 1] 2240 	ld a,#TK_CHAR 
      000D65 CC 0E 9C         [ 2] 2241 	jp token_exit 
      000D68                       2242 rparnt_tst:		
      000D68                       2243 	_case ')' colon_tst 
      000D68 A6 29            [ 1]    1 	ld a,#')' 
      000D6A 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D6C 26 05            [ 1]    3 	jrne colon_tst
      000D6E A6 0A            [ 1] 2244 	ld a,#TK_RPAREN 
      000D70 CC 0E 8C         [ 2] 2245 	jp token_char 
      000D73                       2246 colon_tst:
      000D73                       2247 	_case ':' comma_tst 
      000D73 A6 3A            [ 1]    1 	ld a,#':' 
      000D75 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D77 26 05            [ 1]    3 	jrne comma_tst
      000D79 A6 01            [ 1] 2248 	ld a,#TK_COLON 
      000D7B CC 0E 8C         [ 2] 2249 	jp token_char 
      000D7E                       2250 comma_tst:
      000D7E                       2251 	_case COMMA sharp_tst 
      000D7E A6 2C            [ 1]    1 	ld a,#COMMA 
      000D80 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 44.
Hexadecimal [24-Bits]



      000D82 26 05            [ 1]    3 	jrne sharp_tst
      000D84 A6 0B            [ 1] 2252 	ld a,#TK_COMMA
      000D86 CC 0E 8C         [ 2] 2253 	jp token_char
      000D89                       2254 sharp_tst:
      000D89                       2255 	_case SHARP dash_tst 
      000D89 A6 23            [ 1]    1 	ld a,#SHARP 
      000D8B 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D8D 26 05            [ 1]    3 	jrne dash_tst
      000D8F A6 0C            [ 1] 2256 	ld a,#TK_SHARP
      000D91 CC 0E 8C         [ 2] 2257 	jp token_char  	 	 
      000D94                       2258 dash_tst: 	
      000D94                       2259 	_case '-' at_tst 
      000D94 A6 2D            [ 1]    1 	ld a,#'-' 
      000D96 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000D98 26 05            [ 1]    3 	jrne at_tst
      000D9A A6 11            [ 1] 2260 	ld a,#TK_MINUS  
      000D9C CC 0E 8C         [ 2] 2261 	jp token_char 
      000D9F                       2262 at_tst:
      000D9F                       2263 	_case '@' qmark_tst 
      000D9F A6 40            [ 1]    1 	ld a,#'@' 
      000DA1 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DA3 26 05            [ 1]    3 	jrne qmark_tst
      000DA5 A6 04            [ 1] 2264 	ld a,#TK_ARRAY 
      000DA7 CC 0E 8C         [ 2] 2265 	jp token_char
      000DAA                       2266 qmark_tst:
      000DAA                       2267 	_case '?' tick_tst 
      000DAA A6 3F            [ 1]    1 	ld a,#'?' 
      000DAC 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DAE 26 11            [ 1]    3 	jrne tick_tst
      000DB0 7B 01            [ 1] 2268 	ld a,(TCHAR,sp)
      000DB2 F7               [ 1] 2269 	ld (x),a 
      000DB3 5C               [ 1] 2270 	incw x 
      000DB4 7F               [ 1] 2271 	clr (x)
      000DB5 72 5C 00 01      [ 1] 2272 	inc in 
      000DB9 A6 06            [ 1] 2273 	ld a,#TK_CMD 
      000DBB AE 15 75         [ 2] 2274 	ldw x,#print 
      000DBE CC 0E 9C         [ 2] 2275 	jp token_exit
      000DC1                       2276 tick_tst: ; ignore comment 
      000DC1                       2277 	_case TICK plus_tst 
      000DC1 A6 27            [ 1]    1 	ld a,#TICK 
      000DC3 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DC5 26 0E            [ 1]    3 	jrne plus_tst
      000DC7 7B 01            [ 1] 2278 	ld a,(TCHAR,sp)
      000DC9 F7               [ 1] 2279 	ld (x),a 
      000DCA 5C               [ 1] 2280 	incw x 
      000DCB 7F               [ 1] 2281 	clr (x)
      000DCC 55 00 02 00 01   [ 1] 2282 	mov in,count  
      000DD1 4F               [ 1] 2283 	clr a 
      000DD2 CC 0E 9C         [ 2] 2284 	jp token_exit 
      000DD5                       2285 plus_tst:
      000DD5                       2286 	_case '+' star_tst 
      000DD5 A6 2B            [ 1]    1 	ld a,#'+' 
      000DD7 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DD9 26 05            [ 1]    3 	jrne star_tst
      000DDB A6 10            [ 1] 2287 	ld a,#TK_PLUS  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 45.
Hexadecimal [24-Bits]



      000DDD CC 0E 8C         [ 2] 2288 	jp token_char 
      000DE0                       2289 star_tst:
      000DE0                       2290 	_case '*' slash_tst 
      000DE0 A6 2A            [ 1]    1 	ld a,#'*' 
      000DE2 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DE4 26 05            [ 1]    3 	jrne slash_tst
      000DE6 A6 20            [ 1] 2291 	ld a,#TK_MULT 
      000DE8 CC 0E 8C         [ 2] 2292 	jp token_char 
      000DEB                       2293 slash_tst: 
      000DEB                       2294 	_case '/' prcnt_tst 
      000DEB A6 2F            [ 1]    1 	ld a,#'/' 
      000DED 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DEF 26 05            [ 1]    3 	jrne prcnt_tst
      000DF1 A6 21            [ 1] 2295 	ld a,#TK_DIV 
      000DF3 CC 0E 8C         [ 2] 2296 	jp token_char 
      000DF6                       2297 prcnt_tst:
      000DF6                       2298 	_case '%' eql_tst 
      000DF6 A6 25            [ 1]    1 	ld a,#'%' 
      000DF8 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000DFA 26 05            [ 1]    3 	jrne eql_tst
      000DFC A6 22            [ 1] 2299 	ld a,#TK_MOD
      000DFE CC 0E 8C         [ 2] 2300 	jp token_char  
                                   2301 ; 1 or 2 character tokens 	
      000E01                       2302 eql_tst:
      000E01                       2303 	_case '=' gt_tst 		
      000E01 A6 3D            [ 1]    1 	ld a,#'=' 
      000E03 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000E05 26 05            [ 1]    3 	jrne gt_tst
      000E07 A6 32            [ 1] 2304 	ld a,#TK_EQUAL
      000E09 CC 0E 8C         [ 2] 2305 	jp token_char 
      000E0C                       2306 gt_tst:
      000E0C                       2307 	_case '>' lt_tst 
      000E0C A6 3E            [ 1]    1 	ld a,#'>' 
      000E0E 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000E10 26 33            [ 1]    3 	jrne lt_tst
      000E12 A6 31            [ 1] 2308 	ld a,#TK_GT 
      000E14 6B 02            [ 1] 2309 	ld (ATTRIB,sp),a 
      000E16 72 5C 00 01      [ 1] 2310 	inc in 
      000E1A 91 D6 00         [ 4] 2311 	ld a,([in.w],y)
      000E1D A1 3D            [ 1] 2312 	cp a,#'=
      000E1F 26 0C            [ 1] 2313 	jrne 1$
      000E21 7B 01            [ 1] 2314 	ld a,(TCHAR,sp)
      000E23 F7               [ 1] 2315 	ld (x),a
      000E24 5C               [ 1] 2316 	incw x 
      000E25 A6 3D            [ 1] 2317 	ld a,#'=
      000E27 6B 01            [ 1] 2318 	ld (TCHAR,sp),a 
      000E29 A6 33            [ 1] 2319 	ld a,#TK_GE 
      000E2B 20 5F            [ 2] 2320 	jra token_char  
      000E2D A1 3C            [ 1] 2321 1$: cp a,#'<
      000E2F 26 0C            [ 1] 2322 	jrne 2$
      000E31 7B 01            [ 1] 2323 	ld a,(TCHAR,sp)
      000E33 F7               [ 1] 2324 	ld (x),a
      000E34 5C               [ 1] 2325 	incw x 
      000E35 A6 3C            [ 1] 2326 	ld a,#'<	
      000E37 6B 01            [ 1] 2327 	ld (TCHAR,sp),a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 46.
Hexadecimal [24-Bits]



      000E39 A6 35            [ 1] 2328 	ld a,#TK_NE 
      000E3B 20 4F            [ 2] 2329 	jra token_char 
      000E3D 72 5A 00 01      [ 1] 2330 2$: dec in
      000E41 7B 02            [ 1] 2331 	ld a,(ATTRIB,sp)
      000E43 20 47            [ 2] 2332 	jra token_char 
      000E45                       2333 lt_tst:
      000E45                       2334 	_case '<' other
      000E45 A6 3C            [ 1]    1 	ld a,#'<' 
      000E47 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000E49 26 32            [ 1]    3 	jrne other
      000E4B A6 34            [ 1] 2335 	ld a,#TK_LT 
      000E4D 6B 02            [ 1] 2336 	ld (ATTRIB,sp),a 
      000E4F 72 5C 00 01      [ 1] 2337 	inc in 
      000E53 91 D6 00         [ 4] 2338 	ld a,([in.w],y)
      000E56 A1 3D            [ 1] 2339 	cp a,#'=
      000E58 26 0B            [ 1] 2340 	jrne 1$
      000E5A 7B 01            [ 1] 2341 	ld a,(TCHAR,sp)
      000E5C F7               [ 1] 2342 	ld (x),a 
      000E5D A6 3D            [ 1] 2343 	ld a,#'=
      000E5F 6B 01            [ 1] 2344 	ld (TCHAR,sp),a 
      000E61 A6 36            [ 1] 2345 	ld a,#TK_LE 
      000E63 20 27            [ 2] 2346 	jra token_char 
      000E65 A1 3E            [ 1] 2347 1$: cp a,#'>
      000E67 26 0C            [ 1] 2348 	jrne 2$
      000E69 7B 01            [ 1] 2349 	ld a,(TCHAR,sp)
      000E6B F7               [ 1] 2350 	ld (x),a 
      000E6C 5C               [ 1] 2351 	incw x 
      000E6D A6 3E            [ 1] 2352 	ld a,#'>
      000E6F 6B 01            [ 1] 2353 	ld (TCHAR,sp),a 
      000E71 A6 35            [ 1] 2354 	ld a,#TK_NE 
      000E73 20 17            [ 2] 2355 	jra token_char 
      000E75 72 5A 00 01      [ 1] 2356 2$: dec in 
      000E79 7B 02            [ 1] 2357 	ld a,(ATTRIB,sp)
      000E7B 20 0F            [ 2] 2358 	jra token_char 	
      000E7D                       2359 other: ; not a special character 	 
      000E7D 7B 01            [ 1] 2360 	ld a,(TCHAR,sp)
      000E7F CD 04 C3         [ 4] 2361 	call is_alpha 
      000E82 25 03            [ 1] 2362 	jrc 30$ 
      000E84 CC 06 D7         [ 2] 2363 	jp syntax_error 
      000E87                       2364 30$: 
      000E87 CD 0C A2         [ 4] 2365 	call parse_keyword
      000E8A 20 10            [ 2] 2366 	jra token_exit 
      000E8C                       2367 token_char:
      000E8C 6B 02            [ 1] 2368 	ld (ATTRIB,sp),a 
      000E8E 7B 01            [ 1] 2369 	ld a,(TCHAR,sp)
      000E90 F7               [ 1] 2370 	ld (x),a 
      000E91 5C               [ 1] 2371 	incw x 
      000E92 7F               [ 1] 2372 	clr(x)
      000E93 72 5C 00 01      [ 1] 2373 	inc in 
      000E97 7B 02            [ 1] 2374 	ld a,(ATTRIB,sp)
      000E99 AE 17 18         [ 2] 2375 	ldw x,#pad 
      000E9C                       2376 token_exit:
      000E9C                       2377 	_drop VSIZE 
      000E9C 5B 02            [ 2]    1     addw sp,#VSIZE 
      000E9E 81               [ 4] 2378 	ret
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 47.
Hexadecimal [24-Bits]



                                   2379 
                                   2380 
                                   2381 
                                   2382 ;------------------------------------
                                   2383 ; check if character in {'0'..'9'}
                                   2384 ; input:
                                   2385 ;    A  character to test
                                   2386 ; output:
                                   2387 ;    Carry  0 not digit | 1 digit
                                   2388 ;------------------------------------
      000E9F                       2389 is_digit:
      000E9F A1 30            [ 1] 2390 	cp a,#'0
      000EA1 25 03            [ 1] 2391 	jrc 1$
      000EA3 A1 3A            [ 1] 2392     cp a,#'9+1
      000EA5 8C               [ 1] 2393 	ccf 
      000EA6 8C               [ 1] 2394 1$:	ccf 
      000EA7 81               [ 4] 2395     ret
                                   2396 
                                   2397 ;------------------------------------
                                   2398 ; convert alpha to uppercase
                                   2399 ; input:
                                   2400 ;    a  character to convert
                                   2401 ; output:
                                   2402 ;    a  uppercase character
                                   2403 ;------------------------------------
      000EA8                       2404 to_upper::
      000EA8 A1 61            [ 1] 2405 	cp a,#'a
      000EAA 2A 01            [ 1] 2406 	jrpl 1$
      000EAC 81               [ 4] 2407 0$:	ret
      000EAD A1 7A            [ 1] 2408 1$: cp a,#'z	
      000EAF 22 FB            [ 1] 2409 	jrugt 0$
      000EB1 A0 20            [ 1] 2410 	sub a,#32
      000EB3 81               [ 4] 2411 	ret
                                   2412 	
                                   2413 ;------------------------------------
                                   2414 ; convert pad content in integer
                                   2415 ; input:
                                   2416 ;    pad		.asciz to convert
                                   2417 ; output:
                                   2418 ;    acc24      int24_t
                                   2419 ;------------------------------------
                                   2420 	; local variables
                           000001  2421 	SIGN=1 ; 1 byte, 
                           000002  2422 	BASE=2 ; 1 byte, numeric base used in conversion
                           000003  2423 	TEMP=3 ; 1 byte, temporary storage
                           000003  2424 	VSIZE=3 ; 3 bytes reserved for local storage
      000EB4                       2425 atoi24:
      000EB4 89               [ 2] 2426 	pushw x ;save x
      000EB5 52 03            [ 2] 2427 	sub sp,#VSIZE
                                   2428 	; acc24=0 
      000EB7 72 5F 00 08      [ 1] 2429 	clr acc24    
      000EBB 72 5F 00 09      [ 1] 2430 	clr acc16
      000EBF 72 5F 00 0A      [ 1] 2431 	clr acc8 
      000EC3 C6 17 18         [ 1] 2432 	ld a, pad 
      000EC6 27 5A            [ 1] 2433 	jreq atoi_exit
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 48.
Hexadecimal [24-Bits]



      000EC8 0F 01            [ 1] 2434 	clr (SIGN,sp)
      000ECA A6 0A            [ 1] 2435 	ld a,#10
      000ECC 6B 02            [ 1] 2436 	ld (BASE,sp),a ; default base decimal
      000ECE AE 17 18         [ 2] 2437 	ldw x,#pad ; pointer to string to convert
      000ED1 F6               [ 1] 2438 	ld a,(x)
      000ED2 27 47            [ 1] 2439 	jreq 9$  ; completed if 0
      000ED4 A1 2D            [ 1] 2440 	cp a,#'-
      000ED6 26 04            [ 1] 2441 	jrne 1$
      000ED8 03 01            [ 1] 2442 	cpl (SIGN,sp)
      000EDA 20 08            [ 2] 2443 	jra 2$
      000EDC A1 24            [ 1] 2444 1$: cp a,#'$
      000EDE 26 06            [ 1] 2445 	jrne 3$
      000EE0 A6 10            [ 1] 2446 	ld a,#16
      000EE2 6B 02            [ 1] 2447 	ld (BASE,sp),a
      000EE4 5C               [ 1] 2448 2$:	incw x
      000EE5 F6               [ 1] 2449 	ld a,(x)
      000EE6                       2450 3$:	
      000EE6 A1 61            [ 1] 2451 	cp a,#'a
      000EE8 2B 02            [ 1] 2452 	jrmi 4$
      000EEA A0 20            [ 1] 2453 	sub a,#32
      000EEC A1 30            [ 1] 2454 4$:	cp a,#'0
      000EEE 2B 2B            [ 1] 2455 	jrmi 9$
      000EF0 A0 30            [ 1] 2456 	sub a,#'0
      000EF2 A1 0A            [ 1] 2457 	cp a,#10
      000EF4 2B 06            [ 1] 2458 	jrmi 5$
      000EF6 A0 07            [ 1] 2459 	sub a,#7
      000EF8 11 02            [ 1] 2460 	cp a,(BASE,sp)
      000EFA 2A 1F            [ 1] 2461 	jrpl 9$
      000EFC 6B 03            [ 1] 2462 5$:	ld (TEMP,sp),a
      000EFE 7B 02            [ 1] 2463 	ld a,(BASE,sp)
      000F00 CD 0F 26         [ 4] 2464 	call mulu24_8
      000F03 7B 03            [ 1] 2465 	ld a,(TEMP,sp)
      000F05 CB 00 0A         [ 1] 2466 	add a,acc24+2
      000F08 C7 00 0A         [ 1] 2467 	ld acc24+2,a
      000F0B 4F               [ 1] 2468 	clr a
      000F0C C9 00 09         [ 1] 2469 	adc a,acc24+1
      000F0F C7 00 09         [ 1] 2470 	ld acc24+1,a
      000F12 4F               [ 1] 2471 	clr a
      000F13 C9 00 08         [ 1] 2472 	adc a,acc24
      000F16 C7 00 08         [ 1] 2473 	ld acc24,a
      000F19 20 C9            [ 2] 2474 	jra 2$
      000F1B 0D 01            [ 1] 2475 9$:	tnz (SIGN,sp)
      000F1D 27 03            [ 1] 2476     jreq atoi_exit
      000F1F CD 0A 1A         [ 4] 2477     call neg_acc24
      000F22                       2478 atoi_exit: 
      000F22 5B 03            [ 2] 2479 	addw sp,#VSIZE
      000F24 85               [ 2] 2480 	popw x ; restore x
      000F25 81               [ 4] 2481 	ret
                                   2482 
                                   2483 ;--------------------------------------
                                   2484 ; unsigned multiply uint24_t by uint8_t
                                   2485 ; use to convert numerical string to uint24_t
                                   2486 ; input:
                                   2487 ;	acc24	uint24_t 
                                   2488 ;   A		uint8_t
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 49.
Hexadecimal [24-Bits]



                                   2489 ; output:
                                   2490 ;   acc24   A*acc24
                                   2491 ;-------------------------------------
                                   2492 ; local variables offset  on sp
                           000003  2493 	U8   = 3   ; A pushed on stack
                           000002  2494 	OVFL = 2  ; multiplicaton overflow low byte
                           000001  2495 	OVFH = 1  ; multiplication overflow high byte
                           000003  2496 	VSIZE = 3
      000F26                       2497 mulu24_8:
      000F26 89               [ 2] 2498 	pushw x    ; save X
                                   2499 	; local variables
      000F27 88               [ 1] 2500 	push a     ; U8
      000F28 5F               [ 1] 2501 	clrw x     ; initialize overflow to 0
      000F29 89               [ 2] 2502 	pushw x    ; multiplication overflow
                                   2503 ; multiply low byte.
      000F2A C6 00 0A         [ 1] 2504 	ld a,acc24+2
      000F2D 97               [ 1] 2505 	ld xl,a
      000F2E 7B 03            [ 1] 2506 	ld a,(U8,sp)
      000F30 42               [ 4] 2507 	mul x,a
      000F31 9F               [ 1] 2508 	ld a,xl
      000F32 C7 00 0A         [ 1] 2509 	ld acc24+2,a
      000F35 9E               [ 1] 2510 	ld a, xh
      000F36 6B 02            [ 1] 2511 	ld (OVFL,sp),a
                                   2512 ; multipy middle byte
      000F38 C6 00 09         [ 1] 2513 	ld a,acc24+1
      000F3B 97               [ 1] 2514 	ld xl,a
      000F3C 7B 03            [ 1] 2515 	ld a, (U8,sp)
      000F3E 42               [ 4] 2516 	mul x,a
                                   2517 ; add overflow to this partial product
      000F3F 72 FB 01         [ 2] 2518 	addw x,(OVFH,sp)
      000F42 9F               [ 1] 2519 	ld a,xl
      000F43 C7 00 09         [ 1] 2520 	ld acc24+1,a
      000F46 4F               [ 1] 2521 	clr a
      000F47 A9 00            [ 1] 2522 	adc a,#0
      000F49 6B 01            [ 1] 2523 	ld (OVFH,sp),a
      000F4B 9E               [ 1] 2524 	ld a,xh
      000F4C 6B 02            [ 1] 2525 	ld (OVFL,sp),a
                                   2526 ; multiply most signficant byte	
      000F4E C6 00 08         [ 1] 2527 	ld a, acc24
      000F51 97               [ 1] 2528 	ld xl, a
      000F52 7B 03            [ 1] 2529 	ld a, (U8,sp)
      000F54 42               [ 4] 2530 	mul x,a
      000F55 72 FB 01         [ 2] 2531 	addw x, (OVFH,sp)
      000F58 9F               [ 1] 2532 	ld a, xl
      000F59 C7 00 08         [ 1] 2533 	ld acc24,a
      000F5C 5B 03            [ 2] 2534     addw sp,#VSIZE
      000F5E 85               [ 2] 2535 	popw x
      000F5F 81               [ 4] 2536 	ret
                                   2537 
                                   2538 ;------------------------------------
                                   2539 ; skip character c in text starting from 'in'
                                   2540 ; input:
                                   2541 ;	 y 		point to text buffer
                                   2542 ;    a 		character to skip
                                   2543 ; output:  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 50.
Hexadecimal [24-Bits]



                                   2544 ;	'in' ajusted to new position
                                   2545 ;------------------------------------
                           000001  2546 	C = 1 ; local var
      000F60                       2547 skip:
      000F60 88               [ 1] 2548 	push a
      000F61 91 D6 00         [ 4] 2549 1$:	ld a,([in.w],y)
      000F64 27 0A            [ 1] 2550 	jreq 2$
      000F66 11 01            [ 1] 2551 	cp a,(C,sp)
      000F68 26 06            [ 1] 2552 	jrne 2$
      000F6A 72 5C 00 01      [ 1] 2553 	inc in
      000F6E 20 F1            [ 2] 2554 	jra 1$
      000F70                       2555 2$: _drop 1 
      000F70 5B 01            [ 2]    1     addw sp,#1 
      000F72 81               [ 4] 2556 	ret
                                   2557 	
                                   2558 ;------------------------------
                                   2559 ; restore 'in.w' variable to 
                                   2560 ; its value before last call
                                   2561 ; to get_token.
                                   2562 ;------------------------------
      000F73                       2563 unget_token:
      000F73 CE 00 11         [ 2] 2564 	ldw x,in.w.saved
      000F76 CF 00 00         [ 2] 2565 	ldw in.w,x 
      000F79 81               [ 4] 2566 	ret 
                                   2567 
                                   2568 
                                   2569 ;******************************
                                   2570 ;  data stack manipulation
                                   2571 ;*****************************
                                   2572 ;----------------------	
                                   2573 ; push X on data stack 
                                   2574 ; input:
                                   2575 ;	X 
                                   2576 ; output:
                                   2577 ;	none 
                                   2578 ;----------------------	
      000F7A                       2579 dpush:
      000F7A                       2580     _dp_down
      000F7A 72 5A 00 1A      [ 1]    1     dec dstkptr+1 
      000F7E 72 5A 00 1A      [ 1]    2     dec dstkptr+1
      000F82 72 CF 00 19      [ 5] 2581     ldw [dstkptr],x  
      000F86 81               [ 4] 2582 	ret 
                                   2583 
                                   2584 
                                   2585 ;----------------------	
                                   2586 ; pop data stack in X 
                                   2587 ; input:
                                   2588 ;	none
                                   2589 ; output:
                                   2590 ;	X   
                                   2591 ;----------------------	
      000F87                       2592 dpop: 
      000F87 72 CE 00 19      [ 5] 2593     ldw x, [dstkptr]
      000F8B                       2594 	_dp_up
      000F8B 72 5C 00 1A      [ 1]    1     inc dstkptr+1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 51.
Hexadecimal [24-Bits]



      000F8F 72 5C 00 1A      [ 1]    2     inc dstkptr+1
      000F93 81               [ 4] 2595 	ret 
                                   2596 
                                   2597 ;-----------------------------
                                   2598 ; swap top 2 elements of dstack
                                   2599 ;  {n1 n2 -- n2 n1 }
                                   2600 ;-----------------------------
      000F94                       2601 dswap:
      000F94 72 CE 00 19      [ 5] 2602 	ldw x,[dstkptr]
      000F98 89               [ 2] 2603 	pushw x 
      000F99 AE 00 02         [ 2] 2604 	ldw x,#2 
      000F9C 72 DE 00 19      [ 5] 2605 	ldw x,([dstkptr],x) 
      000FA0 72 CF 00 19      [ 5] 2606 	ldw [dstkptr],x 
      000FA4 AE 00 02         [ 2] 2607 	ldw x,#2
      000FA7 90 85            [ 2] 2608 	popw y 
      000FA9 72 DF 00 19      [ 5] 2609 	ldw ([dstkptr],x),y 
      000FAD 81               [ 4] 2610 	ret
                                   2611 
                                   2612 ;-----------------------------
                                   2613 ; drop TOS 
                                   2614 ;-----------------------------
      000FAE                       2615 ddrop: ; { n -- }
      000FAE                       2616 	_dp_up 
      000FAE 72 5C 00 1A      [ 1]    1     inc dstkptr+1
      000FB2 72 5C 00 1A      [ 1]    2     inc dstkptr+1
      000FB6 81               [ 4] 2617 	ret
                                   2618 	
                                   2619 ;-----------------------------
                                   2620 ; duplicate TOS 
                                   2621 ;  dstack: { ix...n -- ix...n n }
                                   2622 ;-----------------------------
      000FB7                       2623 ddup:
      000FB7 72 CE 00 19      [ 5] 2624 	ldw x,[dstkptr]
      000FBB                       2625 	_dp_down
      000FBB 72 5A 00 1A      [ 1]    1     dec dstkptr+1 
      000FBF 72 5A 00 1A      [ 1]    2     dec dstkptr+1
      000FC3 72 CF 00 19      [ 5] 2626     ldw [dstkptr],x  
      000FC7 81               [ 4] 2627 	ret 
                                   2628 
                                   2629 
                                   2630 ;----------------------------------
                                   2631 ; pick value n from dstack 
                                   2632 ; put it on TOS
                                   2633 ; dstack: {ix,..,p -- ix,...,np }
                                   2634 ;-----------------------------------
      000FC8                       2635 dpick:
      000FC8 72 CE 00 19      [ 5] 2636 	ldw x,[dstkptr]
      000FCC 58               [ 2] 2637 	sllw x 
      000FCD 72 BB 00 19      [ 2] 2638 	addw x,dstkptr 
      000FD1 FE               [ 2] 2639 	ldw x,(x)
      000FD2 72 CF 00 19      [ 5] 2640 	ldw [dstkptr],x 
      000FD6 81               [ 4] 2641 	ret
                                   2642 
                                   2643 ;---------------------------
                                   2644 ;  fetch variable in X 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 52.
Hexadecimal [24-Bits]



                                   2645 ;  dstack:{ addr -- value }
                                   2646 ;---------------------------
      000FD7                       2647 fetch:
      000FD7 72 CE 00 19      [ 5] 2648 	ldw x,[dstkptr]
      000FDB FE               [ 2] 2649 	ldw x,(x)
      000FDC 72 CF 00 19      [ 5] 2650 	ldw [dstkptr],x
      000FE0 81               [ 4] 2651 	ret 
                                   2652 
                                   2653 ;----------------------------
                                   2654 ; store variable 
                                   2655 ; dstack: {addr value -- }
                                   2656 ;----------------------------
      000FE1                       2657 store:
      000FE1 CD 0F 87         [ 4] 2658 	call dpop 
      000FE4 90 93            [ 1] 2659 	ldw y,x   ; y=value 
      000FE6 CD 0F 87         [ 4] 2660 	call dpop 
      000FE9 FF               [ 2] 2661 	ldw (x),y 
      000FEA 81               [ 4] 2662 	ret 
                                   2663 
                                   2664 ;---------------------------------
                                   2665 ; drop n elements from data stack 
                                   2666 ; input: 
                                   2667 ;   X 		n 
                                   2668 ; output:
                                   2669 ;   none 
                                   2670 ;-------------------------------------
      000FEB                       2671 ddrop_n:
      000FEB 90 89            [ 2] 2672 	pushw y 
      000FED 90 CE 00 19      [ 2] 2673 	ldw y,dstkptr 
      000FF1 58               [ 2] 2674 	sllw x 
      000FF2 89               [ 2] 2675 	pushw x 
      000FF3 72 F9 01         [ 2] 2676 	addw y,(1,sp)
      000FF6 90 CF 00 19      [ 2] 2677 	ldw dstkptr,y 
      000FFA 85               [ 2] 2678 	popw x 
      000FFB 90 85            [ 2] 2679 	popw y
      000FFD 81               [ 4] 2680 	ret 
                                   2681 
      000FFE 0A 64 73 74 61 63 6B  2682 dstk_prompt: .asciz "\ndstack: " 
             3A 20 00
                                   2683 ;----------------------------
                                   2684 ; print dstack content 
                                   2685 ;---------------------------
                           000001  2686 	XSAVE=1
                           000002  2687 	VSIZE=2
      001008                       2688 dots:
      001008                       2689 	_vars VSIZE 
      001008 52 02            [ 2]    1     sub sp,#VSIZE 
      00100A AE 0F FE         [ 2] 2690 	ldw x,#dstk_prompt 
      00100D CD 01 B0         [ 4] 2691 	call puts
      001010 AE 17 7E         [ 2] 2692 	ldw x,#dstack_unf-CELL_SIZE
      001013 35 0A 00 07      [ 1] 2693 	mov base,#10 
      001017 C3 00 19         [ 2] 2694 1$:	cpw x,dstkptr 
      00101A 25 0D            [ 1] 2695 	jrult 4$ 
      00101C 1F 01            [ 2] 2696 	ldw (XSAVE,sp),x
      00101E FE               [ 2] 2697 	ldw  x,(x)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 53.
Hexadecimal [24-Bits]



      00101F CD 09 4F         [ 4] 2698 	call print_int 
      001022 1E 01            [ 2] 2699 	ldw x,(XSAVE,sp)
      001024 1D 00 02         [ 2] 2700 	subw x,#CELL_SIZE 
      001027 20 EE            [ 2] 2701 	jra 1$ 
      001029 A6 0D            [ 1] 2702 4$: ld a,#CR 
      00102B CD 01 9E         [ 4] 2703 	call putc 
      00102E                       2704 	_drop VSIZE
      00102E 5B 02            [ 2]    1     addw sp,#VSIZE 
      001030 4F               [ 1] 2705 	clr a 
      001031 81               [ 4] 2706 	ret
                                   2707 
      001032 0A 63 74 61 63 6B 3A  2708 cstk_prompt: .asciz "\nctack: "
             20 00
                                   2709 ;--------------------------------
                                   2710 ; print cstack content
                                   2711 ;--------------------------------
                           000001  2712 	XSAVE=1
                           000002  2713 	VSIZE=2 
      00103B                       2714 dotr:
      00103B                       2715 	_vars VSIZE 
      00103B 52 02            [ 2]    1     sub sp,#VSIZE 
      00103D AE 10 32         [ 2] 2716 	ldw x,#cstk_prompt
      001040 CD 01 B0         [ 4] 2717 	call puts 
      001043 96               [ 1] 2718 	ldw x,sp 
      001044 1C 00 07         [ 2] 2719 	addw x,#7 ; ignore XSAVE and 2 levels of return address.
      001047 1F 01            [ 2] 2720 	ldw (XSAVE,sp),x  
      001049 AE 17 FE         [ 2] 2721 	ldw x,#RAM_SIZE-2
      00104C 35 10 00 07      [ 1] 2722 	mov base,#16
      001050                       2723 dotr_loop:
      001050 13 01            [ 2] 2724 	cpw x,(XSAVE,sp)
      001052 2B 0B            [ 1] 2725 	jrmi 9$
      001054 89               [ 2] 2726 	pushw x  
      001055 FE               [ 2] 2727 	ldw x,(x)
      001056 CD 09 4F         [ 4] 2728 	call print_int 
      001059 85               [ 2] 2729 	popw x  
      00105A 1D 00 02         [ 2] 2730 	subw x,#CELL_SIZE
      00105D 20 F1            [ 2] 2731 	jra dotr_loop 
      00105F A6 0D            [ 1] 2732 9$:	ld a,#CR 
      001061 CD 01 9E         [ 4] 2733 	call putc 
      001064                       2734 	_drop VSIZE 
      001064 5B 02            [ 2]    1     addw sp,#VSIZE 
      001066 4F               [ 1] 2735 	clr a 
      001067 81               [ 4] 2736 	ret
                                   2737 
                                   2738 
                                   2739 ;--------------------------------
                                   2740 ;  add 2 integers
                                   2741 ;  input:
                                   2742 ;    N1     on cstack 
                                   2743 ;    N2     on cstack 
                                   2744 ;  output:
                                   2745 ;    X 		n2+n1 
                                   2746 ;--------------------------------
                                   2747 	;arugments on cstack 
      001068                       2748 	_argofs 0 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 54.
Hexadecimal [24-Bits]



                           000002     1     ARG_OFS=2+0 
      001068                       2749 	_arg N1 1 
                           000003     1     N1=ARG_OFS+1 
      001068                       2750 	_arg N2 3 
                           000005     1     N2=ARG_OFS+3 
      001068                       2751 add:
      001068 1E 05            [ 2] 2752 	ldw x ,(N2,sp)
      00106A 72 FB 03         [ 2] 2753 	addw x,(N1,sp)
      00106D 1F 03            [ 2] 2754 	ldw (N1,sp),x 
      00106F 81               [ 4] 2755 	ret 
                                   2756 
                                   2757 ;--------------------------------
                                   2758 ;  substract 2 ntegers
                                   2759 ;  input:
                                   2760 ;    N1     on cstack 
                                   2761 ;    N2     on cstack 
                                   2762 ;  output:
                                   2763 ;    X 		n2+n1 
                                   2764 ;--------------------------------
      001070                       2765 	_argofs 0 
                           000002     1     ARG_OFS=2+0 
      001070                       2766 	_arg N1 1 
                           000003     1     N1=ARG_OFS+1 
      001070                       2767 	_arg N2 3 
                           000005     1     N2=ARG_OFS+3 
      001070                       2768 substract:
      001070 1E 05            [ 2] 2769 	ldw x,(N2,sp)
      001072 72 F0 03         [ 2] 2770 	subw x,(N1,sp)
      001075 81               [ 4] 2771 	ret 
                                   2772 
                                   2773 ;-------------------------------------
                                   2774 ; multiply 2 integers
                                   2775 ; product overflow is ignored unless
                                   2776 ; MATH_OVF assembler flag is set to 1
                                   2777 ; input:
                                   2778 ;  	N1      on cstack
                                   2779 ;   N2 		on cstack 
                                   2780 ; output:
                                   2781 ;	X        N1*N2 
                                   2782 ;-------------------------------------
                                   2783 	;arguments 
      001076                       2784 	_argofs 3
                           000005     1     ARG_OFS=2+3 
      001076                       2785 	_arg N1_HB 1
                           000006     1     N1_HB=ARG_OFS+1 
      001076                       2786 	_arg N1_LB 2
                           000007     1     N1_LB=ARG_OFS+2 
      001076                       2787 	_arg N2_HB 3
                           000008     1     N2_HB=ARG_OFS+3 
      001076                       2788 	_arg N2_LB 4 
                           000009     1     N2_LB=ARG_OFS+4 
                                   2789    ; local variables 
                           000001  2790 	SIGN=1
                           000002  2791 	PROD=2
                           000003  2792 	VSIZE=3
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 55.
Hexadecimal [24-Bits]



      001076                       2793 multiply:
      001076                       2794 	_vars VSIZE 
      001076 52 03            [ 2]    1     sub sp,#VSIZE 
      001078 0F 01            [ 1] 2795 	clr (SIGN,sp)
      00107A 1E 06            [ 2] 2796 	ldw x,(N1_HB,sp)
      00107C 9E               [ 1] 2797 	ld a,xh  
      00107D A5 80            [ 1] 2798 	bcp a,#0x80 
      00107F 27 05            [ 1] 2799 	jreq 2$
      001081 03 01            [ 1] 2800 	cpl (SIGN,sp)
      001083 50               [ 2] 2801 	negw x 
      001084 1F 06            [ 2] 2802 	ldw (N1_HB,sp),x 
      001086 1E 08            [ 2] 2803 2$: ldw x,(N2_HB,sp)
      001088 9E               [ 1] 2804 	ld a,xh  
      001089 A5 80            [ 1] 2805 	bcp a,#0x80 
      00108B 27 05            [ 1] 2806 	jreq 3$
      00108D 03 01            [ 1] 2807 	cpl (SIGN,sp)
      00108F 50               [ 2] 2808 	negw x 
      001090 1F 08            [ 2] 2809 	ldw (N2_HB,sp),x 
                                   2810 ; N1_LB * N2_LB 	
      001092 7B 07            [ 1] 2811 3$:	ld a,(N1_LB,sp)
      001094 97               [ 1] 2812 	ld xl,a 
      001095 7B 09            [ 1] 2813 	ld a,(N2_LB,sp) 
      001097 42               [ 4] 2814 	mul x,a 
                           000000  2815 .if MATH_OVF 	
                                   2816 	ld a,xh 
                                   2817 	bcp a,#0x80 
                                   2818 	jreq 4$ 
                                   2819 	ld a,#ERR_MATH_OVF 
                                   2820 	jp tb_error
                                   2821 .endif 	 
      001098 1F 02            [ 2] 2822 4$:	ldw (PROD,sp),x
                                   2823 ; N1_LB * N2_HB	 
      00109A 7B 07            [ 1] 2824 	ld a,(N1_LB,sp) 
      00109C 97               [ 1] 2825 	ld xl,a 
      00109D 7B 08            [ 1] 2826 	ld a,(N2_HB,sp)
      00109F 42               [ 4] 2827 	mul x,a
      0010A0 9F               [ 1] 2828 	ld a,xl 
      0010A1 1B 02            [ 1] 2829 	add a,(PROD,sp)
                           000000  2830 .if MATH_OVF 	
                                   2831 	bcp a,#0x80 
                                   2832 	jreq 5$ 
                                   2833 	ld a,#ERR_MATH_OVF 
                                   2834 	jp tb_error
                                   2835 .endif 	 
      0010A3 6B 02            [ 1] 2836 5$:	ld (PROD,sp),a 
                                   2837 ; N1_HB * N2_LB 
      0010A5 7B 06            [ 1] 2838 	ld a,(N1_HB,sp)
      0010A7 97               [ 1] 2839 	ld xl,a 
      0010A8 7B 09            [ 1] 2840 	ld a,(N2_LB,sp)
      0010AA 42               [ 4] 2841 	mul x,a 
      0010AB 9F               [ 1] 2842 	ld a,xl 
      0010AC 1B 02            [ 1] 2843 	add a,(PROD,sp)
                           000000  2844 .if MATH_OVF 	
                                   2845 	bcp a,#0x80 
                                   2846 	jreq 6$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 56.
Hexadecimal [24-Bits]



                                   2847 	ld a,#ERR_MATH_OVF 
                                   2848 	jp tb_error
                                   2849 .endif 	 
      0010AE 6B 02            [ 1] 2850 6$:	ld (PROD,sp),a 
                                   2851 ; N1_HB * N2_HB 	
                                   2852 ; it is pointless to multiply N1_HB*N2_HB 
                                   2853 ; as this product is over 65535 or 0 
                                   2854 ;
                                   2855 ; sign adjust product
      0010B0 0D 01            [ 1] 2856 	tnz (SIGN,sp)
      0010B2 27 05            [ 1] 2857 	jreq 7$
      0010B4 1E 02            [ 2] 2858 	ldw x, (PROD,sp)
      0010B6 50               [ 2] 2859 	negw x
      0010B7 1F 02            [ 2] 2860 	ldw (PROD,sp),x  
      0010B9                       2861 7$: 
      0010B9 1E 02            [ 2] 2862 	ldw x,(PROD,sp) 
      0010BB                       2863 	_drop VSIZE 
      0010BB 5B 03            [ 2]    1     addw sp,#VSIZE 
      0010BD 81               [ 4] 2864 	ret
                                   2865 
                                   2866 ;----------------------------------
                                   2867 ;  euclidian divide n2/n1 
                                   2868 ; input:
                                   2869 ;    N2 	on cstack
                                   2870 ;    N1 	on cstack
                                   2871 ; output:
                                   2872 ;    X      n2/n1 
                                   2873 ;    Y      remainder 
                                   2874 ;----------------------------------
      0010BE                       2875 	_argofs 2
                           000004     1     ARG_OFS=2+2 
      0010BE                       2876 	_arg DIVISR 1
                           000005     1     DIVISR=ARG_OFS+1 
      0010BE                       2877 	_arg DIVIDND 3
                           000007     1     DIVIDND=ARG_OFS+3 
                                   2878 	; local variables
                           000001  2879 	SQUOT=1 ; sign quotient
                           000002  2880 	SDIVD=2 ; sign dividend  
                           000002  2881 	VSIZE=2
      0010BE                       2882 divide:
      0010BE                       2883 	_vars VSIZE 
      0010BE 52 02            [ 2]    1     sub sp,#VSIZE 
      0010C0 0F 01            [ 1] 2884 	clr (SQUOT,sp)
      0010C2 0F 02            [ 1] 2885 	clr (SDIVD,sp)
                                   2886 ; check for 0 divisor
      0010C4 1E 05            [ 2] 2887 	ldw x,(DIVISR,sp)
      0010C6 5D               [ 2] 2888 	tnzw x 
      0010C7 26 05            [ 1] 2889     jrne 0$
      0010C9 A6 04            [ 1] 2890 	ld a,#ERR_DIV0 
      0010CB CC 06 D9         [ 2] 2891 	jp tb_error 
                                   2892 ; check divisor sign 	
      0010CE 9E               [ 1] 2893 0$:	ld a,xh 
      0010CF A5 80            [ 1] 2894 	bcp a,#0x80 
      0010D1 27 03            [ 1] 2895 	jreq 1$
      0010D3 03 01            [ 1] 2896 	cpl (SQUOT,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 57.
Hexadecimal [24-Bits]



      0010D5 50               [ 2] 2897 	negw x 
      0010D6 1F 05            [ 2] 2898 1$:	ldw (DIVISR,sp),x
                                   2899 ; check dividend sign 	 
      0010D8 1E 07            [ 2] 2900     ldw x,(DIVIDND,sp)
      0010DA 9E               [ 1] 2901 	ld a,xh 
      0010DB A5 80            [ 1] 2902 	bcp a,#0x80 
      0010DD 27 05            [ 1] 2903 	jreq 2$ 
      0010DF 03 01            [ 1] 2904 	cpl (SQUOT,sp)
      0010E1 03 02            [ 1] 2905 	cpl (SDIVD,sp)
      0010E3 50               [ 2] 2906 	negw x 
      0010E4 16 05            [ 2] 2907 2$:	ldw y,(DIVISR,sp)
      0010E6 65               [ 2] 2908 	divw x,y
      0010E7 90 CF 00 09      [ 2] 2909 	ldw acc16,y 
                                   2910 ; if sign dividend is negative and remainder!=0 inc divisor 	 
      0010EB 0D 02            [ 1] 2911 	tnz (SDIVD,sp)
      0010ED 27 0B            [ 1] 2912 	jreq 7$
      0010EF 90 5D            [ 2] 2913 	tnzw y 
      0010F1 27 07            [ 1] 2914 	jreq 7$
      0010F3 5C               [ 1] 2915 	incw x
      0010F4 16 05            [ 2] 2916 	ldw y,(DIVISR,sp)
      0010F6 72 B2 00 09      [ 2] 2917 	subw y,acc16
      0010FA 0D 01            [ 1] 2918 7$: tnz (SQUOT,sp)
      0010FC 27 01            [ 1] 2919 	jreq 9$ 	 
      0010FE 50               [ 2] 2920 8$:	negw x 
      0010FF                       2921 9$: 
      0010FF                       2922 	_drop VSIZE 
      0010FF 5B 02            [ 2]    1     addw sp,#VSIZE 
      001101 81               [ 4] 2923 	ret 
                                   2924 
                                   2925 
                                   2926 ;----------------------------------
                                   2927 ;  remainder resulting from euclidian 
                                   2928 ;  division of n2/n1 
                                   2929 ; input:
                                   2930 ;   N1 		cstack 
                                   2931 ;   N2      cstack
                                   2932 ; output:
                                   2933 ;   X       N2%N1 
                                   2934 ;----------------------------------
                           000003  2935 	N1=3
                           000005  2936 	N2=5
                           000004  2937 	VSIZE=4
      001102                       2938 modulo:
      001102 1E 03            [ 2] 2939 	Ldw x,(N1,sp)
      001104 16 05            [ 2] 2940 	ldw y,(N2,sp)
      001106                       2941 	_vars VSIZE 
      001106 52 04            [ 2]    1     sub sp,#VSIZE 
      001108 1F 01            [ 2] 2942 	ldw (1,sp),x 
      00110A 17 03            [ 2] 2943 	ldw (3,sp),y 
      00110C CD 10 BE         [ 4] 2944 	call divide 
      00110F 93               [ 1] 2945 	ldw x,y
      001110                       2946 	_drop VSIZE 
      001110 5B 04            [ 2]    1     addw sp,#VSIZE 
      001112 81               [ 4] 2947 	ret 
                                   2948 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 58.
Hexadecimal [24-Bits]



                                   2949 
                                   2950 ;----------------------------------
                                   2951 ; search in kword_dict command name
                                   2952 ;  from its execution address 
                                   2953 ; input:
                                   2954 ;   X       	execution address 
                                   2955 ; output:
                                   2956 ;   X 			cstr*  | 0 
                                   2957 ;--------------------------------
                           000001  2958 	XADR=1 
                           000003  2959 	LINK=3 
                           000004  2960 	VSIZE=4
      001113                       2961 cmd_name:
      001113                       2962 	_vars VSIZE 
      001113 52 04            [ 2]    1     sub sp,#VSIZE 
      001115 72 5F 00 09      [ 1] 2963 	clr acc16 
      001119 1F 01            [ 2] 2964 	ldw (XADR,sp),x  
      00111B AE 20 AD         [ 2] 2965 	ldw x,#kword_dict	
      00111E 1F 03            [ 2] 2966 1$:	ldw (LINK,sp),x
      001120 E6 02            [ 1] 2967 	ld a,(2,x)
      001122 A4 0F            [ 1] 2968 	and a,#15 
      001124 C7 00 0A         [ 1] 2969 	ld acc8,a 
      001127 1C 00 03         [ 2] 2970 	addw x,#3
      00112A 72 BB 00 09      [ 2] 2971 	addw x,acc16
      00112E FE               [ 2] 2972 	ldw x,(x) ; execution address 
      00112F 13 01            [ 2] 2973 	cpw x,(XADR,sp)
      001131 27 0A            [ 1] 2974 	jreq 2$
      001133 1E 03            [ 2] 2975 	ldw x,(LINK,sp)
      001135 FE               [ 2] 2976 	ldw x,(x) 
      001136 1D 00 02         [ 2] 2977 	subw x,#2  
      001139 26 E3            [ 1] 2978 	jrne 1$
      00113B 20 05            [ 2] 2979 	jra 9$
      00113D 1E 03            [ 2] 2980 2$: ldw x,(LINK,sp)
      00113F 1C 00 02         [ 2] 2981 	addw x,#2 	
      001142                       2982 9$:	_drop VSIZE
      001142 5B 04            [ 2]    1     addw sp,#VSIZE 
      001144 81               [ 4] 2983 	ret
                                   2984 
                                   2985 
                                   2986 ;---------------------------------
                                   2987 ; input:
                                   2988 ;	X 		dictionary entry point 
                                   2989 ;  pad		.asciz name to search 
                                   2990 ; output:
                                   2991 ;  A 		TK_CMD|TK_FUNC|TK_NONE 
                                   2992 ;  X		execution address | 0 
                                   2993 ;---------------------------------
                           000001  2994 	NLEN=1 ; cmd length 
                           000002  2995 	YSAVE=2
                           000003  2996 	VSIZE=3 
      001145                       2997 search_dict:
      001145                       2998 	_vars VSIZE 
      001145 52 03            [ 2]    1     sub sp,#VSIZE 
      001147 90 93            [ 1] 2999 	ldw y,x 
      001149                       3000 search_next:	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 59.
Hexadecimal [24-Bits]



      001149 90 F6            [ 1] 3001 	ld a,(y)
      00114B A4 0F            [ 1] 3002 	and a,#0xf 
      00114D 6B 01            [ 1] 3003 	ld (NLEN,sp),a  
      00114F AE 17 18         [ 2] 3004 	ldw x,#pad 
      001152 17 02            [ 2] 3005 	ldw (YSAVE,sp),y
      001154 90 5C            [ 1] 3006 	incw y  
      001156                       3007 cp_loop:
      001156 F6               [ 1] 3008 	ld a,(x)
      001157 27 1E            [ 1] 3009 	jreq str_match 
      001159 0D 01            [ 1] 3010 	tnz (NLEN,sp)
      00115B 27 0B            [ 1] 3011 	jreq no_match  
      00115D 90 F1            [ 1] 3012 	cp a,(y)
      00115F 26 07            [ 1] 3013 	jrne no_match 
      001161 90 5C            [ 1] 3014 	incw y 
      001163 5C               [ 1] 3015 	incw x
      001164 0A 01            [ 1] 3016 	dec (NLEN,sp)
      001166 20 EE            [ 2] 3017 	jra cp_loop 
      001168                       3018 no_match:
      001168 16 02            [ 2] 3019 	ldw y,(YSAVE,sp) 
      00116A 72 A2 00 02      [ 2] 3020 	subw y,#2 ; move Y to link field
      00116E 4B 00            [ 1] 3021 	push #TK_NONE 
      001170 90 FE            [ 2] 3022 	ldw y,(y) ; next word link 
      001172 84               [ 1] 3023 	pop a ; TK_NONE 
      001173 27 24            [ 1] 3024 	jreq search_exit  ; not found  
                                   3025 ;try next 
      001175 20 D2            [ 2] 3026 	jra search_next
      001177                       3027 str_match:
      001177 16 02            [ 2] 3028 	ldw y,(YSAVE,sp)
      001179 90 F6            [ 1] 3029 	ld a,(y)
      00117B 6B 01            [ 1] 3030 	ld (NLEN,sp),a ; needed to test bit 7 
      00117D A4 7F            [ 1] 3031 	and a,#0x7f 
                                   3032 ; move y to procedure address field 	
      00117F 4C               [ 1] 3033 	inc a 
      001180 C7 00 0A         [ 1] 3034 	ld acc8,a 
      001183 72 5F 00 09      [ 1] 3035 	clr acc16 
      001187 72 B9 00 09      [ 2] 3036 	addw y,acc16 
      00118B 90 FE            [ 2] 3037 	ldw y,(y) ; routine entry point 
      00118D 7B 01            [ 1] 3038 	ld a,(NLEN,sp)
      00118F A5 80            [ 1] 3039 	bcp a,#0x80 
      001191 27 04            [ 1] 3040 	jreq 1$
      001193 A6 07            [ 1] 3041 	ld a,#TK_FUNC 
      001195 20 02            [ 2] 3042 	jra search_exit
      001197 A6 06            [ 1] 3043 1$: ld a,#TK_CMD 
      001199                       3044 search_exit: 
      001199 93               [ 1] 3045 	ldw x,y ; x=routine address 
      00119A                       3046 	_drop VSIZE 	 
      00119A 5B 03            [ 2]    1     addw sp,#VSIZE 
      00119C 81               [ 4] 3047 	ret 
                                   3048 
                                   3049 ;---------------------
                                   3050 ; check if next token
                                   3051 ;  is of expected type 
                                   3052 ; input:
                                   3053 ;   A 		 expected token attribute
                                   3054 ;  ouput:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 60.
Hexadecimal [24-Bits]



                                   3055 ;   none     if fail call tb_error 
                                   3056 ;--------------------
      00119D                       3057 expect:
      00119D 88               [ 1] 3058 	push a 
      00119E CD 07 BD         [ 4] 3059 	call next_token 
      0011A1 11 01            [ 1] 3060 	cp a,(1,sp)
      0011A3 27 03            [ 1] 3061 	jreq 1$
      0011A5 CC 06 D7         [ 2] 3062 	jp syntax_error
      0011A8 84               [ 1] 3063 1$: pop a 
      0011A9 81               [ 4] 3064 	ret 
                                   3065 
                                   3066 
                                   3067 ;-------------------------------
                                   3068 ; parse embedded BASIC routines 
                                   3069 ; arguments list.
                                   3070 ; arg_list::=  rel[','rel]*
                                   3071 ; all arguments are of integer type
                                   3072 ; input:
                                   3073 ;   none
                                   3074 ; output:
                                   3075 ;   A 			number of arguments pushed on dstack  
                                   3076 ;--------------------------------
                           000001  3077 	ARG_CNT=1 
      0011AA                       3078 arg_list:
      0011AA 4B 00            [ 1] 3079 	push #0  
      0011AC CD 12 E8         [ 4] 3080 1$: call relation
      0011AF A1 00            [ 1] 3081 	cp a,#TK_NONE 
      0011B1 27 19            [ 1] 3082 	jreq 5$
      0011B3 A1 02            [ 1] 3083 	cp a,#TK_INTGR
      0011B5 26 12            [ 1] 3084 	jrne 4$
      0011B7 CD 0F 7A         [ 4] 3085 3$: call dpush 
      0011BA 0C 01            [ 1] 3086     inc (ARG_CNT,sp)
      0011BC CD 07 BD         [ 4] 3087 	call next_token 
      0011BF A1 00            [ 1] 3088 	cp a,#TK_NONE 
      0011C1 27 09            [ 1] 3089 	jreq 5$ 
      0011C3 A1 0B            [ 1] 3090 	cp a,#TK_COMMA 
      0011C5 26 02            [ 1] 3091 	jrne 4$
      0011C7 20 E3            [ 2] 3092 	jra 1$ 
      0011C9 CD 0F 73         [ 4] 3093 4$:	call unget_token 
      0011CC 84               [ 1] 3094 5$:	pop a 
      0011CD 81               [ 4] 3095 	ret 
                                   3096 
                                   3097 
                                   3098 
                                   3099 ;--------------------------------
                                   3100 ;   BASIC commnands 
                                   3101 ;--------------------------------
                                   3102 
                                   3103 ;--------------------------------
                                   3104 ;  arithmetic and relational 
                                   3105 ;  routines
                                   3106 ;  operators precedence
                                   3107 ;  highest to lowest
                                   3108 ;  operators on same row have 
                                   3109 ;  same precedence and are executed
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 61.
Hexadecimal [24-Bits]



                                   3110 ;  from left to right.
                                   3111 ;	'*','/','%'
                                   3112 ;   '-','+'
                                   3113 ;   '=','>','<','>=','<=','<>','><'
                                   3114 ;   '<>' and '><' are equivalent for not equal.
                                   3115 ;--------------------------------
                                   3116 
                                   3117 ;---------------------
                                   3118 ; return array element
                                   3119 ; address from @(expr)
                                   3120 ; input:
                                   3121 ;   A 		TK_ARRAY
                                   3122 ; output:
                                   3123 ;   A 		TK_INTGR
                                   3124 ;	X 		element address 
                                   3125 ;----------------------
      0011CE                       3126 get_array_element:
      0011CE CD 0F AE         [ 4] 3127 	call ddrop 
      0011D1 A6 09            [ 1] 3128 	ld a,#TK_LPAREN 
      0011D3 CD 11 9D         [ 4] 3129 	call expect
      0011D6 CD 12 E8         [ 4] 3130 	call relation 
      0011D9 A1 02            [ 1] 3131 	cp a,#TK_INTGR 
      0011DB 27 03            [ 1] 3132 	jreq 1$
      0011DD CC 06 D7         [ 2] 3133 	jp syntax_error
      0011E0 89               [ 2] 3134 1$: pushw x 
      0011E1 A6 0A            [ 1] 3135 	ld a,#TK_RPAREN 
      0011E3 CD 11 9D         [ 4] 3136 	call expect
                                   3137 	; check for bounds 
      0011E6 85               [ 2] 3138 	popw x   
      0011E7 C3 00 22         [ 2] 3139 	cpw x,array_size 
      0011EA 23 05            [ 2] 3140 	jrule 3$
                                   3141 ; bounds {1..array_size}	
      0011EC A6 0A            [ 1] 3142 2$: ld a,#ERR_BAD_VALUE 
      0011EE CC 06 D9         [ 2] 3143 	jp tb_error 
      0011F1 5D               [ 2] 3144 3$: tnzw  x
      0011F2 27 F8            [ 1] 3145 	jreq 2$ 
      0011F4 58               [ 2] 3146 	sllw x 
      0011F5 89               [ 2] 3147 	pushw x 
      0011F6 CE 00 20         [ 2] 3148 	ldw x,array_addr  
      0011F9 72 F0 01         [ 2] 3149 	subw x,(1,sp)
      0011FC                       3150 	_drop 2   
      0011FC 5B 02            [ 2]    1     addw sp,#2 
      0011FE A6 02            [ 1] 3151 	ld a,#TK_INTGR
      001200 81               [ 4] 3152 	ret 
                                   3153 
                                   3154 ;***********************************
                                   3155 ;   expression parse,execute 
                                   3156 ;***********************************
                                   3157 ;-----------------------------------
                                   3158 ; factor ::= ['+'|'-'|e] var | @ |
                                   3159 ;			 integer | function |
                                   3160 ;			 '('relation')' 
                                   3161 ; output:
                                   3162 ;   A    token attribute 
                                   3163 ;   X 	 integer
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 62.
Hexadecimal [24-Bits]



                                   3164 ; ---------------------------------
                           000001  3165 	NEG=1
                           000001  3166 	VSIZE=1
      001201                       3167 factor:
      001201                       3168 	_vars VSIZE 
      001201 52 01            [ 2]    1     sub sp,#VSIZE 
      001203 CD 07 BD         [ 4] 3169 	call next_token
      001206 A1 02            [ 1] 3170 	cp a,#CMD_END 
      001208 2B 4A            [ 1] 3171 	jrmi 20$
      00120A 6B 01            [ 1] 3172 1$:	ld (NEG,sp),a 
      00120C A4 30            [ 1] 3173 	and a,#TK_GRP_MASK
      00120E A1 10            [ 1] 3174 	cp a,#TK_GRP_ADD 
      001210 27 04            [ 1] 3175 	jreq 2$
      001212 7B 01            [ 1] 3176 	ld a,(NEG,sp)
      001214 20 03            [ 2] 3177 	jra 4$  
      001216                       3178 2$:	
      001216 CD 07 BD         [ 4] 3179 	call next_token 
      001219                       3180 4$:	
      001219 A1 07            [ 1] 3181 	cp a,#TK_FUNC 
      00121B 26 03            [ 1] 3182 	jrne 5$ 
      00121D FD               [ 4] 3183 	call (x) 
      00121E 20 2B            [ 2] 3184 	jra 18$ 
      001220                       3185 5$:
      001220 A1 02            [ 1] 3186 	cp a,#TK_INTGR
      001222 26 02            [ 1] 3187 	jrne 6$
      001224 20 25            [ 2] 3188 	jra 18$
      001226                       3189 6$:
      001226 A1 04            [ 1] 3190 	cp a,#TK_ARRAY
      001228 26 06            [ 1] 3191 	jrne 10$
      00122A CD 11 CE         [ 4] 3192 	call get_array_element
      00122D FE               [ 2] 3193 	ldw x,(x)
      00122E 20 1B            [ 2] 3194 	jra 18$ 
      001230                       3195 10$:
      001230 A1 03            [ 1] 3196 	cp a,#TK_VAR 
      001232 26 03            [ 1] 3197 	jrne 12$
      001234 FE               [ 2] 3198 	ldw x,(x)
      001235 20 14            [ 2] 3199 	jra 18$
      001237                       3200 12$:			
      001237 A1 09            [ 1] 3201 	cp a,#TK_LPAREN
      001239 26 0A            [ 1] 3202 	jrne 16$
      00123B CD 12 E8         [ 4] 3203 	call relation
      00123E A6 0A            [ 1] 3204 	ld a,#TK_RPAREN 
      001240 CD 11 9D         [ 4] 3205 	call expect
      001243 20 06            [ 2] 3206 	jra 18$	
      001245                       3207 16$:
      001245 CD 0F 73         [ 4] 3208 	call unget_token
      001248 4F               [ 1] 3209 	clr a 
      001249 20 09            [ 2] 3210 	jra 20$ 
      00124B                       3211 18$: 
      00124B A6 11            [ 1] 3212 	ld a,#TK_MINUS 
      00124D 11 01            [ 1] 3213 	cp a,(NEG,sp)
      00124F 26 01            [ 1] 3214 	jrne 19$
      001251 50               [ 2] 3215 	negw x
      001252                       3216 19$:
      001252 A6 02            [ 1] 3217 	ld a,#TK_INTGR
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 63.
Hexadecimal [24-Bits]



      001254                       3218 20$:
      001254                       3219 	_drop VSIZE
      001254 5B 01            [ 2]    1     addw sp,#VSIZE 
      001256 81               [ 4] 3220 	ret
                                   3221 
                                   3222 ;-----------------------------------
                                   3223 ; term ::= factor [['*'|'/'|'%'] factor]* 
                                   3224 ; output:
                                   3225 ;   A    	token attribute 
                                   3226 ;	X		integer
                                   3227 ;-----------------------------------
                           000001  3228 	N1=1
                           000003  3229 	N2=3
                           000005  3230 	MULOP=5
                           000005  3231 	VSIZE=5
      001257                       3232 term:
      001257                       3233 	_vars VSIZE
      001257 52 05            [ 2]    1     sub sp,#VSIZE 
      001259 CD 12 01         [ 4] 3234 	call factor
      00125C A1 02            [ 1] 3235 	cp a,#CMD_END
      00125E 2B 41            [ 1] 3236 	jrmi term_exit
      001260                       3237 term01:	 ; check for  operator 
      001260 1F 03            [ 2] 3238 	ldw (N2,sp),x  ; save first factor 
      001262 CD 07 BD         [ 4] 3239 	call next_token
      001265 A1 02            [ 1] 3240 	cp a,#2
      001267 2B 34            [ 1] 3241 	jrmi 9$
      001269 6B 05            [ 1] 3242 0$:	ld (MULOP,sp),a
      00126B A4 30            [ 1] 3243 	and a,#TK_GRP_MASK
      00126D A1 20            [ 1] 3244 	cp a,#TK_GRP_MULT
      00126F 27 07            [ 1] 3245 	jreq 1$
      001271 7B 05            [ 1] 3246 	ld a,(MULOP,sp) 
      001273 CD 0F 73         [ 4] 3247 	call unget_token 
      001276 20 25            [ 2] 3248 	jra 9$
      001278                       3249 1$:	; got *|/|%
      001278 CD 12 01         [ 4] 3250 	call factor
      00127B A1 02            [ 1] 3251 	cp a,#TK_INTGR
      00127D 27 03            [ 1] 3252 	jreq 2$ 
      00127F CC 06 D7         [ 2] 3253 	jp syntax_error
      001282 1F 01            [ 2] 3254 2$:	ldw (N1,sp),x  
      001284 7B 05            [ 1] 3255 	ld a,(MULOP,sp) 
      001286 A1 20            [ 1] 3256 	cp a,#TK_MULT 
      001288 26 05            [ 1] 3257 	jrne 3$
      00128A CD 10 76         [ 4] 3258 	call multiply 
      00128D 20 D1            [ 2] 3259 	jra term01
      00128F A1 21            [ 1] 3260 3$: cp a,#TK_DIV 
      001291 26 05            [ 1] 3261 	jrne 4$ 
      001293 CD 10 BE         [ 4] 3262 	call divide 
      001296 20 C8            [ 2] 3263 	jra term01 
      001298 CD 11 02         [ 4] 3264 4$: call modulo
      00129B 20 C3            [ 2] 3265 	jra term01 
      00129D 1E 03            [ 2] 3266 9$: ldw x,(N2,sp)  
      00129F A6 02            [ 1] 3267 	ld a,#TK_INTGR 	
      0012A1                       3268 term_exit:
      0012A1                       3269 	_drop VSIZE 
      0012A1 5B 05            [ 2]    1     addw sp,#VSIZE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 64.
Hexadecimal [24-Bits]



      0012A3 81               [ 4] 3270 	ret 
                                   3271 
                                   3272 ;-------------------------------
                                   3273 ;  expr ::= term [['+'|'-'] term]*
                                   3274 ;  result range {-32768..32767}
                                   3275 ;  output:
                                   3276 ;   A    token attribute 
                                   3277 ;   X	 integer   
                                   3278 ;-------------------------------
                           000001  3279 	N1=1 
                           000003  3280 	N2=3
                           000005  3281 	OP=5 
                           000005  3282 	VSIZE=5 
      0012A4                       3283 expression:
      0012A4                       3284 	_vars VSIZE 
      0012A4 52 05            [ 2]    1     sub sp,#VSIZE 
      0012A6 CD 12 57         [ 4] 3285 	call term
      0012A9 A1 02            [ 1] 3286 	cp a,#CMD_END 
      0012AB 2B 38            [ 1] 3287 	jrmi expr_exit 
      0012AD 1F 03            [ 2] 3288 0$:	ldw (N2,sp),x 
      0012AF CD 07 BD         [ 4] 3289 	call next_token
      0012B2 A1 02            [ 1] 3290 	cp a,#2
      0012B4 2B 2B            [ 1] 3291 	jrmi 9$ 
      0012B6 6B 05            [ 1] 3292 1$:	ld (OP,sp),a  
      0012B8 A4 30            [ 1] 3293 	and a,#TK_GRP_MASK
      0012BA A1 10            [ 1] 3294 	cp a,#TK_GRP_ADD 
      0012BC 27 07            [ 1] 3295 	jreq 2$ 
      0012BE 7B 05            [ 1] 3296 	ld a,(OP,sp)
      0012C0 CD 0F 73         [ 4] 3297 	call unget_token
      0012C3 20 1C            [ 2] 3298 	jra 9$
      0012C5                       3299 2$: 
      0012C5 CD 12 57         [ 4] 3300 	call term
      0012C8 A1 02            [ 1] 3301 	cp a,#TK_INTGR 
      0012CA 27 03            [ 1] 3302 	jreq 3$
      0012CC CC 06 D7         [ 2] 3303 	jp syntax_error
      0012CF 1F 01            [ 2] 3304 3$:	ldw (N1,sp),x 
      0012D1 7B 05            [ 1] 3305 	ld a,(OP,sp)
      0012D3 A1 10            [ 1] 3306 	cp a,#TK_PLUS 
      0012D5 26 05            [ 1] 3307 	jrne 4$
      0012D7 CD 10 68         [ 4] 3308 	call add 
      0012DA 20 D1            [ 2] 3309 	jra 0$ 
      0012DC CD 10 70         [ 4] 3310 4$:	call substract
      0012DF 20 CC            [ 2] 3311 	jra 0$
      0012E1 1E 03            [ 2] 3312 9$: ldw x,(N2,sp)
      0012E3 A6 02            [ 1] 3313 	ld a,#TK_INTGR	
      0012E5                       3314 expr_exit:
      0012E5                       3315 	_drop VSIZE 
      0012E5 5B 05            [ 2]    1     addw sp,#VSIZE 
      0012E7 81               [ 4] 3316 	ret 
                                   3317 
                                   3318 ;---------------------------------------------
                                   3319 ; rel ::= expr rel_op expr
                                   3320 ; rel_op ::=  '=','<','>','>=','<=','<>','><'
                                   3321 ;  relation return 1 | 0  for true | false 
                                   3322 ;  output:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 65.
Hexadecimal [24-Bits]



                                   3323 ;    A 		token attribute  
                                   3324 ;	 X		1|0
                                   3325 ;---------------------------------------------
                           000001  3326 	N1=1
                           000003  3327 	N2=3
                           000005  3328 	RELOP=5
                           000005  3329 	VSIZE=5 
      0012E8                       3330 relation: 
      0012E8                       3331 	_vars VSIZE
      0012E8 52 05            [ 2]    1     sub sp,#VSIZE 
      0012EA CD 12 A4         [ 4] 3332 	call expression
      0012ED A1 02            [ 1] 3333 	cp a,#CMD_END  
      0012EF 2B 4B            [ 1] 3334 	jrmi rel_exit 
                                   3335 	; expect rel_op or leave 
      0012F1 1F 03            [ 2] 3336 	ldw (N2,sp),x 
      0012F3 CD 07 BD         [ 4] 3337 	call next_token 
      0012F6 A1 02            [ 1] 3338 	cp a,#2
      0012F8 2B 3E            [ 1] 3339 	jrmi 9$
      0012FA                       3340 1$:	
      0012FA 6B 05            [ 1] 3341 	ld (RELOP,sp),a 
      0012FC A4 30            [ 1] 3342 	and a,#TK_GRP_MASK
      0012FE A1 30            [ 1] 3343 	cp a,#TK_GRP_RELOP 
      001300 27 07            [ 1] 3344 	jreq 2$
      001302 7B 05            [ 1] 3345 	ld a,(RELOP,sp)
      001304 CD 0F 73         [ 4] 3346 	call unget_token  
      001307 20 2F            [ 2] 3347 	jra 9$
      001309                       3348 2$:	; expect another expression or error 
      001309 CD 12 A4         [ 4] 3349 	call expression
      00130C A1 02            [ 1] 3350 	cp a,#TK_INTGR 
      00130E 27 03            [ 1] 3351 	jreq 3$
      001310 CC 06 D7         [ 2] 3352 	jp syntax_error 
      001313 1F 01            [ 2] 3353 3$:	ldw (N1,sp),x 
      001315 CD 10 70         [ 4] 3354 	call substract
      001318 26 06            [ 1] 3355 	jrne 4$
      00131A 35 02 00 0A      [ 1] 3356 	mov acc8,#2 ; n1==n2
      00131E 20 0C            [ 2] 3357 	jra 6$ 
      001320                       3358 4$: 
      001320 2C 06            [ 1] 3359 	jrsgt 5$  
      001322 35 04 00 0A      [ 1] 3360 	mov acc8,#4 ; n1<2 
      001326 20 04            [ 2] 3361 	jra 6$
      001328                       3362 5$:
      001328 35 01 00 0A      [ 1] 3363 	mov acc8,#1 ; n1>n2 
      00132C                       3364 6$:
      00132C 5F               [ 1] 3365 	clrw x 
      00132D C6 00 0A         [ 1] 3366 	ld a, acc8  
      001330 14 05            [ 1] 3367 	and a,(RELOP,sp)
      001332 4D               [ 1] 3368 	tnz a 
      001333 27 05            [ 1] 3369 	jreq 10$
      001335 5C               [ 1] 3370 	incw x 
      001336                       3371 7$:	 
      001336 20 02            [ 2] 3372 	jra 10$  	
      001338 1E 03            [ 2] 3373 9$: ldw x,(N2,sp)
      00133A                       3374 10$:
      00133A A6 02            [ 1] 3375 	ld a,#TK_INTGR
      00133C                       3376 rel_exit: 	 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 66.
Hexadecimal [24-Bits]



      00133C                       3377 	_drop VSIZE
      00133C 5B 05            [ 2]    1     addw sp,#VSIZE 
      00133E 81               [ 4] 3378 	ret 
                                   3379 
                                   3380 ;--------------------------------
                                   3381 ; BASIC: SHOW 
                                   3382 ;  show content of dstack,cstack
                                   3383 ;--------------------------------
      00133F                       3384 show:
      00133F C6 00 07         [ 1] 3385 	ld a,base 
      001342 88               [ 1] 3386 	push a 
      001343 CD 10 08         [ 4] 3387 	call dots
      001346 CD 10 3B         [ 4] 3388 	call dotr 
      001349 84               [ 1] 3389 	pop a 
      00134A C7 00 07         [ 1] 3390 	ld base,a 
      00134D 4F               [ 1] 3391 	clr a 
      00134E 81               [ 4] 3392 	ret
                                   3393 
                                   3394 ;--------------------------------------------
                                   3395 ; BASIC: HEX 
                                   3396 ; select hexadecimal base for integer print
                                   3397 ;---------------------------------------------
      00134F                       3398 hex_base:
      00134F 35 10 00 07      [ 1] 3399 	mov base,#16 
      001353 81               [ 4] 3400 	ret 
                                   3401 
                                   3402 ;--------------------------------------------
                                   3403 ; BASIC: DEC 
                                   3404 ; select decimal base for integer print
                                   3405 ;---------------------------------------------
      001354                       3406 dec_base:
      001354 35 0A 00 07      [ 1] 3407 	mov base,#10
      001358 81               [ 4] 3408 	ret 
                                   3409 
                                   3410 ;------------------------
                                   3411 ; BASIC: SIZE 
                                   3412 ; return free size in text area
                                   3413 ; output:
                                   3414 ;   A 		TK_INTGR
                                   3415 ;   X 	    size integer
                                   3416 ;--------------------------
      001359                       3417 size:
      001359 AE 16 C8         [ 2] 3418 	ldw x,#tib 
      00135C 72 B0 00 1D      [ 2] 3419 	subw x,txtend 
      001360 A6 02            [ 1] 3420 	ld a,#TK_INTGR
      001362 81               [ 4] 3421 	ret 
                                   3422 
                                   3423 
                                   3424 ;------------------------
                                   3425 ; BASIC: UBOUND  
                                   3426 ; return array variable size 
                                   3427 ; output:
                                   3428 ;   A 		TK_INTGR
                                   3429 ;   X 	    array size 
                                   3430 ;--------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 67.
Hexadecimal [24-Bits]



      001363                       3431 ubound:
      001363 AE 16 C8         [ 2] 3432 	ldw x,#tib
      001366 72 B0 00 1D      [ 2] 3433 	subw x,txtend 
      00136A 54               [ 2] 3434 	srlw x 
      00136B CF 00 22         [ 2] 3435 	ldw array_size,x
      00136E A6 02            [ 1] 3436 	ld a,#TK_INTGR
      001370 81               [ 4] 3437 	ret 
                                   3438 
                                   3439 ;-----------------------------
                                   3440 ; BASIC: LET var=expr 
                                   3441 ; variable assignement 
                                   3442 ; output:
                                   3443 ;   A 		TK_NONE 
                                   3444 ;-----------------------------
      001371                       3445 let:
      001371 CD 07 BD         [ 4] 3446 	call next_token 
      001374 A1 03            [ 1] 3447 	cp a,#TK_VAR 
      001376 27 03            [ 1] 3448 	jreq let02
      001378 CC 06 D7         [ 2] 3449 	jp syntax_error
      00137B                       3450 let02:
      00137B CD 0F 7A         [ 4] 3451 	call dpush 
      00137E CD 07 BD         [ 4] 3452 	call next_token 
      001381 A1 32            [ 1] 3453 	cp a,#TK_EQUAL
      001383 27 03            [ 1] 3454 	jreq 1$
      001385 CC 06 D7         [ 2] 3455 	jp syntax_error
      001388                       3456 1$:	
      001388 CD 12 E8         [ 4] 3457 	call relation   
      00138B A1 02            [ 1] 3458 	cp a,#TK_INTGR 
      00138D 27 03            [ 1] 3459 	jreq 2$
      00138F CC 06 D7         [ 2] 3460 	jp syntax_error
      001392                       3461 2$:	
      001392 90 93            [ 1] 3462 	ldw y,x 
      001394 CD 0F 87         [ 4] 3463 	call dpop  
      001397 FF               [ 2] 3464 	ldw (x),y   
      001398 81               [ 4] 3465 	ret 
                                   3466 
                                   3467 ;----------------------------
                                   3468 ; BASIC: LIST [[start][,end]]
                                   3469 ; list program lines 
                                   3470 ; form start to end 
                                   3471 ; if empty argument list then 
                                   3472 ; list all.
                                   3473 ;----------------------------
                           000001  3474 	FIRST=1
                           000003  3475 	LAST=3 
                           000005  3476 	LN_PTR=5
                           000006  3477 	VSIZE=6 
      001399                       3478 list:
      001399                       3479 	_vars VSIZE
      001399 52 06            [ 2]    1     sub sp,#VSIZE 
      00139B CE 00 1B         [ 2] 3480 	ldw x,txtbgn 
      00139E C3 00 1D         [ 2] 3481 	cpw x,txtend 
      0013A1 2B 03            [ 1] 3482 	jrmi 1$
      0013A3 CC 14 19         [ 2] 3483 	jp list_exit ; nothing to list 
      0013A6 1F 05            [ 2] 3484 1$:	ldw (LN_PTR,sp),x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 68.
Hexadecimal [24-Bits]



      0013A8 FE               [ 2] 3485 	ldw x,(x) 
      0013A9 1F 01            [ 2] 3486 	ldw (FIRST,sp),x ; list from first line 
      0013AB AE 7F FF         [ 2] 3487 	ldw x,#0x7fff ; biggest line number 
      0013AE 1F 03            [ 2] 3488 	ldw (LAST,sp),x 
      0013B0 CD 11 AA         [ 4] 3489 	call arg_list
      0013B3 4D               [ 1] 3490 	tnz a
      0013B4 27 3F            [ 1] 3491 	jreq list_start 
      0013B6 A1 02            [ 1] 3492 	cp a,#2 
      0013B8 27 07            [ 1] 3493 	jreq 4$
      0013BA A1 01            [ 1] 3494 	cp a,#1 
      0013BC 27 06            [ 1] 3495 	jreq first_line 
      0013BE CC 06 D7         [ 2] 3496 	jp syntax_error 
      0013C1 CD 0F 94         [ 4] 3497 4$:	call dswap
      0013C4                       3498 first_line:
      0013C4 CD 0F 87         [ 4] 3499 	call dpop 
      0013C7 1F 01            [ 2] 3500 	ldw (FIRST,sp),x 
      0013C9 A1 01            [ 1] 3501 	cp a,#1 
      0013CB 27 05            [ 1] 3502 	jreq lines_skip 	
      0013CD                       3503 last_line:
      0013CD CD 0F 87         [ 4] 3504 	call dpop 
      0013D0 1F 03            [ 2] 3505 	ldw (LAST,sp),x 
      0013D2                       3506 lines_skip:
      0013D2 CE 00 1B         [ 2] 3507 	ldw x,txtbgn
      0013D5 1F 05            [ 2] 3508 2$:	ldw (LN_PTR,sp),x 
      0013D7 C3 00 1D         [ 2] 3509 	cpw x,txtend 
      0013DA 2A 3D            [ 1] 3510 	jrpl list_exit 
      0013DC FE               [ 2] 3511 	ldw x,(x) ;lineno 
      0013DD 13 01            [ 2] 3512 	cpw x,(FIRST,sp)
      0013DF 2A 14            [ 1] 3513 	jrpl list_start 
      0013E1 1E 05            [ 2] 3514 	ldw x,(LN_PTR,sp) 
      0013E3 1C 00 02         [ 2] 3515 	addw x,#2 
      0013E6 F6               [ 1] 3516 	ld a,(x)
      0013E7 5C               [ 1] 3517 	incw x 
      0013E8 C7 00 0A         [ 1] 3518 	ld acc8,a 
      0013EB 72 5F 00 09      [ 1] 3519 	clr acc16 
      0013EF 72 BB 00 09      [ 2] 3520 	addw x,acc16
      0013F3 20 E0            [ 2] 3521 	jra 2$ 
                                   3522 ; print loop
      0013F5                       3523 list_start:
      0013F5 1E 05            [ 2] 3524 	ldw x,(LN_PTR,sp)
      0013F7                       3525 3$:	
      0013F7 CD 14 30         [ 4] 3526 	call prt_basic_line
      0013FA 1E 05            [ 2] 3527 	ldw x,(LN_PTR,sp)
      0013FC E6 02            [ 1] 3528 	ld a,(2,x)
      0013FE C7 00 0A         [ 1] 3529 	ld acc8,a 
      001401 72 5F 00 09      [ 1] 3530 	clr acc16 
      001405 72 BB 00 09      [ 2] 3531 	addw x,acc16
      001409 C3 00 1D         [ 2] 3532 	cpw x,txtend 
      00140C 2A 0B            [ 1] 3533 	jrpl list_exit
      00140E 1F 05            [ 2] 3534 	ldw (LN_PTR,sp),x
      001410 FE               [ 2] 3535 	ldw x,(x)
      001411 13 03            [ 2] 3536 	cpw x,(LAST,sp)  
      001413 2C 04            [ 1] 3537 	jrsgt list_exit 
      001415 1E 05            [ 2] 3538 	ldw x,(LN_PTR,sp)
      001417 20 DE            [ 2] 3539 	jra 3$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 69.
Hexadecimal [24-Bits]



      001419                       3540 list_exit:
      001419                       3541 	_drop VSIZE 
      001419 5B 06            [ 2]    1     addw sp,#VSIZE 
      00141B 81               [ 4] 3542 	ret
                                   3543 
                                   3544 ;-------------------------
                                   3545 ; print counted string 
                                   3546 ; input:
                                   3547 ;   X 		address of string
                                   3548 ;--------------------------
      00141C                       3549 prt_cmd_name:
      00141C F6               [ 1] 3550 	ld a,(x)
      00141D 5C               [ 1] 3551 	incw x
      00141E A4 0F            [ 1] 3552 	and a,#15  
      001420 88               [ 1] 3553 	push a 
      001421 0D 01            [ 1] 3554 1$: tnz (1,sp) 
      001423 27 09            [ 1] 3555 	jreq 9$
      001425 F6               [ 1] 3556 	ld a,(x)
      001426 CD 01 9E         [ 4] 3557 	call putc 
      001429 5C               [ 1] 3558 	incw x
      00142A 0A 01            [ 1] 3559 	dec (1,sp)	 
      00142C 20 F3            [ 2] 3560 	jra 1$
      00142E 84               [ 1] 3561 9$: pop a 
      00142F 81               [ 4] 3562 	ret	
                                   3563 
                                   3564 ;--------------------------
                                   3565 ; decompile line from token list 
                                   3566 ; input:
                                   3567 ;   X 		pointer at line
                                   3568 ; output:
                                   3569 ;   none 
                                   3570 ;--------------------------	
                           000001  3571 	BASE_SAV=1
                           000002  3572 	WIDTH_SAV=2
                           000003  3573 	XSAVE=3
                           000005  3574 	LLEN=5
                           000005  3575 	VSIZE=5 
      001430                       3576 prt_basic_line:
      001430                       3577 	_vars VSIZE 
      001430 52 05            [ 2]    1     sub sp,#VSIZE 
      001432 C6 00 07         [ 1] 3578 	ld a,base
      001435 6B 01            [ 1] 3579 	ld (BASE_SAV,sp),a  
      001437 C6 00 25         [ 1] 3580 	ld a,tab_width 
      00143A 6B 02            [ 1] 3581 	ld (WIDTH_SAV,sp),a 
      00143C CF 00 14         [ 2] 3582 	ldw ptr16,x
      00143F FE               [ 2] 3583 	ldw x,(x)
      001440 35 0A 00 07      [ 1] 3584 	mov base,#10
      001444 35 05 00 25      [ 1] 3585 	mov tab_width,#5
      001448 CD 09 4F         [ 4] 3586 	call print_int ; print line number 
      00144B A6 20            [ 1] 3587 	ld a,#SPACE 
      00144D CD 01 9E         [ 4] 3588 	call putc 
      001450 72 5F 00 25      [ 1] 3589 	clr tab_width
      001454 AE 00 02         [ 2] 3590 	ldw x,#2
      001457 72 D6 00 14      [ 4] 3591 	ld a,([ptr16],x)
      00145B 6B 05            [ 1] 3592 	ld (LLEN,sp),a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 70.
Hexadecimal [24-Bits]



      00145D 5C               [ 1] 3593 	incw x
      00145E 9F               [ 1] 3594 1$:	ld a,xl 
      00145F 11 05            [ 1] 3595 	cp a,(LLEN,sp)
      001461 2B 03            [ 1] 3596 	jrmi 19$
      001463 CC 15 41         [ 2] 3597 	jp 90$
      001466                       3598 19$:	 
      001466 72 D6 00 14      [ 4] 3599 	ld a,([ptr16],x)
      00146A 5C               [ 1] 3600 	incw x 
      00146B 1F 03            [ 2] 3601 	ldw (XSAVE,sp),x 
      00146D A1 06            [ 1] 3602 	cp a,#TK_CMD 
      00146F 27 04            [ 1] 3603 	jreq 2$
      001471 A1 07            [ 1] 3604 	cp a,#TK_FUNC 
      001473 26 16            [ 1] 3605 	jrne 4$
      001475                       3606 2$:	
      001475 72 DE 00 14      [ 5] 3607 	ldw x,([ptr16],x)
      001479 CD 11 13         [ 4] 3608 	call cmd_name
      00147C CD 14 1C         [ 4] 3609 	call prt_cmd_name
      00147F A6 20            [ 1] 3610 	ld a,#SPACE 
      001481 CD 01 9E         [ 4] 3611 	call putc 
      001484 1E 03            [ 2] 3612 	ldw x,(XSAVE,sp)
      001486 1C 00 02         [ 2] 3613 	addw x,#2
      001489 20 D3            [ 2] 3614 	jra 1$
      00148B A1 08            [ 1] 3615 4$: cp a,#TK_QSTR 
      00148D 26 18            [ 1] 3616 	jrne 5$
      00148F A6 22            [ 1] 3617 	ld a,#'" 
      001491 CD 01 9E         [ 4] 3618 	call putc 
      001494 72 BB 00 14      [ 2] 3619 	addw x,ptr16
      001498 CD 01 B0         [ 4] 3620 	call puts 
      00149B A6 22            [ 1] 3621 	ld a,#'" 
      00149D CD 01 9E         [ 4] 3622 	call putc 
      0014A0 5C               [ 1] 3623 	incw x
      0014A1 72 B0 00 14      [ 2] 3624 	subw x,ptr16  
      0014A5 20 B7            [ 2] 3625 	jra 1$
      0014A7 A1 03            [ 1] 3626 5$:	cp a,#TK_VAR
      0014A9 26 15            [ 1] 3627 	jrne 6$ 
      0014AB 72 DE 00 14      [ 5] 3628 	ldw x,([ptr16],x)
      0014AF 1D 00 26         [ 2] 3629 	subw x,#vars 
      0014B2 9F               [ 1] 3630 	ld a,xl
      0014B3 44               [ 1] 3631 	srl a 
      0014B4 AB 41            [ 1] 3632 	add a,#'A 
      0014B6 CD 01 9E         [ 4] 3633 	call putc 
      0014B9 1E 03            [ 2] 3634 	ldw x,(XSAVE,sp)
      0014BB 1C 00 02         [ 2] 3635 	addw x,#2 
      0014BE 20 9E            [ 2] 3636 	jra 1$ 
      0014C0 A1 04            [ 1] 3637 6$: cp a,#TK_ARRAY 
      0014C2 26 09            [ 1] 3638 	jrne 7$
      0014C4 A6 40            [ 1] 3639 	ld a,#'@ 
      0014C6 CD 01 9E         [ 4] 3640 	call putc 
      0014C9 1E 03            [ 2] 3641 	ldw x,(XSAVE,sp)
      0014CB 20 91            [ 2] 3642 	jra 1$ 
      0014CD A1 02            [ 1] 3643 7$: cp a,#TK_INTGR 
      0014CF 26 14            [ 1] 3644 	jrne 8$
      0014D1 72 DE 00 14      [ 5] 3645 	ldw x,([ptr16],x)
      0014D5 CD 09 4F         [ 4] 3646 	call print_int
      0014D8 A6 20            [ 1] 3647 	ld a,#SPACE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 71.
Hexadecimal [24-Bits]



      0014DA CD 01 9E         [ 4] 3648 	call putc 
      0014DD 1E 03            [ 2] 3649 	ldw x,(XSAVE,sp)
      0014DF 1C 00 02         [ 2] 3650 	addw x,#2 
      0014E2 CC 14 5E         [ 2] 3651 	jp 1$
      0014E5 A1 31            [ 1] 3652 8$: cp a,#TK_GT 
      0014E7 2B 1A            [ 1] 3653 	jrmi 9$
      0014E9 A1 35            [ 1] 3654 	cp a,#TK_NE 
      0014EB 22 16            [ 1] 3655 	jrugt 9$
      0014ED A0 31            [ 1] 3656 	sub a,#TK_GT  
      0014EF 48               [ 1] 3657 	sll a 
      0014F0 90 5F            [ 1] 3658 	clrw y 
      0014F2 90 97            [ 1] 3659 	ld yl,a 
      0014F4 72 A9 15 5A      [ 2] 3660 	addw y,#relop_str 
      0014F8 90 FE            [ 2] 3661 	ldw y,(y)
      0014FA 93               [ 1] 3662 	ldw x,y 
      0014FB CD 01 B0         [ 4] 3663 	call puts 
      0014FE 1E 03            [ 2] 3664 	ldw x,(XSAVE,sp)
      001500 CC 14 5E         [ 2] 3665 	jp 1$
      001503 A1 10            [ 1] 3666 9$: cp a,#TK_PLUS 
      001505 26 04            [ 1] 3667 	jrne 10$
      001507 A6 2B            [ 1] 3668 	ld a,#'+
      001509 20 2E            [ 2] 3669 	jra 80$ 
      00150B A1 11            [ 1] 3670 10$: cp a,#TK_MINUS
      00150D 26 04            [ 1] 3671 	jrne 11$
      00150F A6 2D            [ 1] 3672 	ld a,#'-
      001511 20 26            [ 2] 3673 	jra 80$
      001513 A1 20            [ 1] 3674 11$: cp a,#TK_MULT 
      001515 2B 0E            [ 1] 3675 	jrmi 12$
      001517 A1 22            [ 1] 3676 	cp a,#TK_MOD 
      001519 22 0A            [ 1] 3677 	jrugt 12$
      00151B A0 20            [ 1] 3678 	sub a,#0x20
      00151D 5F               [ 1] 3679 	clrw x 
      00151E 97               [ 1] 3680 	ld xl,a 
      00151F 1C 15 57         [ 2] 3681 	addw x,#mul_char 
      001522 F6               [ 1] 3682 	ld a,(x)
      001523 20 14            [ 2] 3683 	jra 80$ 
      001525 A1 09            [ 1] 3684 12$: cp a,#TK_LPAREN 
      001527 2B 0E            [ 1] 3685 	jrmi 13$
      001529 A1 0C            [ 1] 3686 	cp a,#TK_SHARP 
      00152B 22 0A            [ 1] 3687 	jrugt 13$
      00152D A0 09            [ 1] 3688 	sub a,#TK_LPAREN
      00152F 5F               [ 1] 3689 	clrw x 
      001530 97               [ 1] 3690 	ld xl,a 
      001531 1C 15 53         [ 2] 3691 	addw x,#single_char 
      001534 F6               [ 1] 3692 	ld a,(x)
      001535 20 02            [ 2] 3693 	jra 80$
      001537 A6 3A            [ 1] 3694 13$: ld a,#':
      001539 CD 01 9E         [ 4] 3695 80$: call putc 
      00153C 1E 03            [ 2] 3696 	ldw x,(XSAVE,sp)
      00153E CC 14 5E         [ 2] 3697 	jp 1$ 
      001541                       3698 90$: 
      001541 A6 0D            [ 1] 3699 	ld a,#CR 
      001543 CD 01 9E         [ 4] 3700 	call putc
      001546 7B 02            [ 1] 3701 	ld a,(WIDTH_SAV,sp) 
      001548 C7 00 25         [ 1] 3702 	ld tab_width,a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 72.
Hexadecimal [24-Bits]



      00154B 7B 01            [ 1] 3703 	ld a,(BASE_SAV,sp) 
      00154D C7 00 07         [ 1] 3704 	ld base,a
      001550                       3705 	_drop VSIZE 
      001550 5B 05            [ 2]    1     addw sp,#VSIZE 
      001552 81               [ 4] 3706 	ret 	
      001553 28 29 2C 23           3707 single_char: .byte '(',')',',','#'
      001557 2A 2F 25              3708 mul_char: .byte '*','/','%'
      00155A 15 66 15 68 15 6A 15  3709 relop_str: .word gt,equal,ge,lt,le,ne 
             6D 15 6F 15 72
      001566 3E 00                 3710 gt: .asciz ">"
      001568 3D 00                 3711 equal: .asciz "="
      00156A 3E 3D 00              3712 ge: .asciz ">="
      00156D 3C 00                 3713 lt: .asciz "<"
      00156F 3C 3D 00              3714 le: .asciz "<="
      001572 3C 3E 00              3715 ne:  .asciz "<>"
                                   3716 
                                   3717 
                                   3718 ;---------------------------------
                                   3719 ; BASIC: PRINT|? arg_list 
                                   3720 ; print values from argument list
                                   3721 ;----------------------------------
                           000001  3722 	COMMA=1
                           000001  3723 	VSIZE=1
      001575                       3724 print:
      001575 4B 00            [ 1] 3725 push #0 ; local variable COMMA 
      001577                       3726 reset_comma:
      001577 0F 01            [ 1] 3727 	clr (COMMA,sp)
      001579                       3728 prt_loop:
      001579 CD 12 E8         [ 4] 3729 	call relation 
      00157C A1 01            [ 1] 3730 	cp a,#TK_COLON 
      00157E 27 59            [ 1] 3731 	jreq print_exit   
      001580 A1 02            [ 1] 3732 	cp a,#TK_INTGR 
      001582 26 05            [ 1] 3733 	jrne 0$ 
      001584 CD 09 4F         [ 4] 3734 	call print_int 
      001587 20 EE            [ 2] 3735 	jra reset_comma
      001589                       3736 0$: 	
      001589 CD 07 BD         [ 4] 3737 	call next_token
      00158C A1 00            [ 1] 3738 	cp a,#TK_NONE 
      00158E 27 49            [ 1] 3739 	jreq print_exit 
      001590 A1 08            [ 1] 3740 1$:	cp a,#TK_QSTR
      001592 26 0E            [ 1] 3741 	jrne 2$   
      001594 CD 01 B0         [ 4] 3742 	call puts
      001597 5C               [ 1] 3743 	incw x 
      001598 72 B0 00 03      [ 2] 3744 	subw x,basicptr 
      00159C 9F               [ 1] 3745 	ld a,xl 
      00159D C7 00 01         [ 1] 3746 	ld in,a  
      0015A0 20 D5            [ 2] 3747 	jra reset_comma
      0015A2 A1 05            [ 1] 3748 2$: cp a,#TK_CHAR 
      0015A4 26 06            [ 1] 3749 	jrne 3$
      0015A6 9F               [ 1] 3750 	ld a,xl 
      0015A7 CD 01 9E         [ 4] 3751 	call putc 
      0015AA 20 CB            [ 2] 3752 	jra reset_comma 
      0015AC                       3753 3$: 	
      0015AC A1 07            [ 1] 3754 	cp a,#TK_FUNC 
      0015AE 26 06            [ 1] 3755 	jrne 4$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 73.
Hexadecimal [24-Bits]



      0015B0 FD               [ 4] 3756 	call (x)
      0015B1 CD 09 4F         [ 4] 3757 	call print_int 
      0015B4 20 C1            [ 2] 3758 	jra reset_comma 
      0015B6                       3759 4$: 
      0015B6 A1 0B            [ 1] 3760 	cp a,#TK_COMMA 
      0015B8 26 05            [ 1] 3761 	jrne 5$
      0015BA 03 01            [ 1] 3762 	cpl (COMMA,sp) 
      0015BC CC 15 79         [ 2] 3763 	jp prt_loop   
      0015BF                       3764 5$: 
      0015BF A1 0C            [ 1] 3765 	cp a,#TK_SHARP
      0015C1 26 13            [ 1] 3766 	jrne 7$
      0015C3 CD 07 BD         [ 4] 3767 	call next_token
      0015C6 A1 02            [ 1] 3768 	cp a,#TK_INTGR 
      0015C8 27 03            [ 1] 3769 	jreq 6$
      0015CA CC 06 D7         [ 2] 3770 	jp syntax_error 
      0015CD                       3771 6$:
      0015CD 9F               [ 1] 3772 	ld a,xl 
      0015CE A4 0F            [ 1] 3773 	and a,#15 
      0015D0 C7 00 25         [ 1] 3774 	ld tab_width,a 
      0015D3 CC 15 77         [ 2] 3775 	jp reset_comma 
      0015D6                       3776 7$:	
      0015D6 CD 0F 73         [ 4] 3777 	call unget_token
      0015D9                       3778 print_exit:
      0015D9 0D 01            [ 1] 3779 	tnz (COMMA,sp)
      0015DB 26 05            [ 1] 3780 	jrne 9$
      0015DD A6 0D            [ 1] 3781 	ld a,#CR 
      0015DF CD 01 9E         [ 4] 3782     call putc 
      0015E2                       3783 9$:	_drop VSIZE 
      0015E2 5B 01            [ 2]    1     addw sp,#VSIZE 
      0015E4 81               [ 4] 3784 	ret 
                                   3785 
                                   3786 ;----------------------
                                   3787 ; 'save_context' and
                                   3788 ; 'rest_context' must be 
                                   3789 ; called at the same 
                                   3790 ; call stack depth 
                                   3791 ; i.e. SP must have the 
                                   3792 ; save value at  
                                   3793 ; entry point of both 
                                   3794 ; routine. 
                                   3795 ;---------------------
                           000006  3796 	CTXT_SIZE=6 ; size of saved data 
                                   3797 ;--------------------
                                   3798 ; save current BASIC
                                   3799 ; interpreter context 
                                   3800 ; on cstack 
                                   3801 ;--------------------
      0015E5                       3802 	_argofs 0 
                           000002     1     ARG_OFS=2+0 
      0015E5                       3803 	_arg BPTR 1
                           000003     1     BPTR=ARG_OFS+1 
      0015E5                       3804 	_arg LNO 3 
                           000005     1     LNO=ARG_OFS+3 
      0015E5                       3805 	_arg IN 5
                           000007     1     IN=ARG_OFS+5 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 74.
Hexadecimal [24-Bits]



      0015E5                       3806 	_arg CNT 6
                           000008     1     CNT=ARG_OFS+6 
      0015E5                       3807 save_context:
      0015E5 CE 00 03         [ 2] 3808 	ldw x,basicptr 
      0015E8 1F 03            [ 2] 3809 	ldw (BPTR,sp),x
      0015EA CE 00 05         [ 2] 3810 	ldw x,lineno 
      0015ED 1F 05            [ 2] 3811 	ldw (LNO,sp),x 
      0015EF C6 00 01         [ 1] 3812 	ld a,in 
      0015F2 6B 07            [ 1] 3813 	ld (IN,sp),a
      0015F4 C6 00 02         [ 1] 3814 	ld a,count 
      0015F7 6B 08            [ 1] 3815 	ld (CNT,sp),a  
      0015F9 81               [ 4] 3816 	ret
                                   3817 
                                   3818 ;-----------------------
                                   3819 ; restore previously saved 
                                   3820 ; BASIC interpreter context 
                                   3821 ; from cstack 
                                   3822 ;-------------------------
      0015FA                       3823 rest_context:
      0015FA 1E 03            [ 2] 3824 	ldw x,(BPTR,sp)
      0015FC CF 00 03         [ 2] 3825 	ldw basicptr,x 
      0015FF 1E 05            [ 2] 3826 	ldw x,(LNO,sp)
      001601 CF 00 05         [ 2] 3827 	ldw lineno,x 
      001604 7B 07            [ 1] 3828 	ld a,(IN,sp)
      001606 C7 00 01         [ 1] 3829 	ld in,a
      001609 7B 08            [ 1] 3830 	ld a,(CNT,sp)
      00160B C7 00 02         [ 1] 3831 	ld count,a  
      00160E 81               [ 4] 3832 	ret
                                   3833 
                                   3834 ;------------------------------------------
                                   3835 ; BASIC: INPUT [string],var[,[string],var]
                                   3836 ; input value in variables 
                                   3837 ; [string] optionally can be used as prompt 
                                   3838 ;-----------------------------------------
                           000001  3839 	CX_BPTR=1
                           000003  3840 	CX_LNO=3
                           000004  3841 	CX_IN=4
                           000005  3842 	CX_CNT=5
                           000006  3843 	SKIP=6
                           000007  3844 	VSIZE=7
      00160F                       3845 input_var:
      00160F 72 00 00 24 05   [ 2] 3846 	btjt flags,#FRUN,1$ 
      001614 A6 06            [ 1] 3847 	ld a,#ERR_RUN_ONLY 
      001616 CC 06 D9         [ 2] 3848 	jp tb_error 
      001619                       3849 1$:	_vars VSIZE 
      001619 52 07            [ 2]    1     sub sp,#VSIZE 
      00161B                       3850 input_loop:
      00161B 0F 06            [ 1] 3851 	clr (SKIP,sp)
      00161D CD 07 BD         [ 4] 3852 	call next_token 
      001620 A1 00            [ 1] 3853 	cp a,#TK_NONE 
      001622 27 5C            [ 1] 3854 	jreq input_exit 
      001624 A1 08            [ 1] 3855 	cp a,#TK_QSTR 
      001626 26 08            [ 1] 3856 	jrne 1$ 
      001628 CD 01 B0         [ 4] 3857 	call puts 
      00162B 03 06            [ 1] 3858 	cpl (SKIP,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 75.
Hexadecimal [24-Bits]



      00162D CD 07 BD         [ 4] 3859 	call next_token 
      001630 A1 03            [ 1] 3860 1$: cp a,#TK_VAR  
      001632 27 03            [ 1] 3861 	jreq 2$ 
      001634 CC 06 D7         [ 2] 3862 	jp syntax_error
      001637 CD 0F 7A         [ 4] 3863 2$:	call dpush 
      00163A 0D 06            [ 1] 3864 	tnz (SKIP,sp)
      00163C 26 0F            [ 1] 3865 	jrne 21$ 
      00163E A6 3A            [ 1] 3866 	ld a,#':
      001640 C7 17 19         [ 1] 3867 	ld pad+1,a 
      001643 72 5F 17 1A      [ 1] 3868 	clr pad+2
      001647 AE 17 18         [ 2] 3869 	ldw x,#pad 
      00164A CD 01 B0         [ 4] 3870 	call puts   
      00164D                       3871 21$:
      00164D CD 15 E5         [ 4] 3872 	call save_context 
      001650 AE 16 C8         [ 2] 3873 	ldw x,#tib 
      001653 CF 00 03         [ 2] 3874 	ldw basicptr,x  
      001656 72 5F 00 02      [ 1] 3875 	clr count  
      00165A CD 0A 3D         [ 4] 3876 	call readln 
      00165D 72 5F 00 01      [ 1] 3877 	clr in 
      001661 CD 12 E8         [ 4] 3878 	call relation 
      001664 A1 02            [ 1] 3879 	cp a,#TK_INTGR
      001666 27 03            [ 1] 3880 	jreq 3$ 
      001668 CC 06 D7         [ 2] 3881 	jp syntax_error
      00166B CD 0F 7A         [ 4] 3882 3$: call dpush 
      00166E CD 0F E1         [ 4] 3883 	call store 
      001671 CD 15 FA         [ 4] 3884 	call rest_context
      001674 CD 07 BD         [ 4] 3885 	call next_token 
      001677 A1 0B            [ 1] 3886 	cp a,#TK_COMMA 
      001679 26 02            [ 1] 3887 	jrne 4$
      00167B 20 9E            [ 2] 3888 	jra input_loop 
      00167D CD 0F 73         [ 4] 3889 4$:	call unget_token 
      001680                       3890 input_exit:
      001680                       3891 	_drop VSIZE 
      001680 5B 07            [ 2]    1     addw sp,#VSIZE 
      001682 81               [ 4] 3892 	ret 
                                   3893 
                                   3894 
                                   3895 ;---------------------
                                   3896 ; BASIC: REMARK | ' 
                                   3897 ; begin a comment 
                                   3898 ; comment are ignored 
                                   3899 ; use ' insted of REM 
                                   3900 ; This is never called
                                   3901 ; because get_token 
                                   3902 ; take care of skipping
                                   3903 ; comment. but required
                                   3904 ; for future use of 
                                   3905 ; keyword reverse search.  
                                   3906 ;---------------------- 
      001683                       3907 rem: 
      001683 81               [ 4] 3908 	ret 
                                   3909 
                                   3910 ;---------------------
                                   3911 ; BASIC: WAIT addr,mask[,xor_mask] 
                                   3912 ; read in loop 'addr'  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 76.
Hexadecimal [24-Bits]



                                   3913 ; apply & 'mask' to value 
                                   3914 ; loop while result==0.  
                                   3915 ; if 'xor_mask' given 
                                   3916 ; apply ^ in second  
                                   3917 ; loop while result==0 
                                   3918 ;---------------------
                           000001  3919 	XMASK=1 
                           000002  3920 	MASK=2
                           000003  3921 	ADDR=3
                           000004  3922 	VSIZE=4
      001684                       3923 wait: 
      001684                       3924 	_vars VSIZE
      001684 52 04            [ 2]    1     sub sp,#VSIZE 
      001686 0F 01            [ 1] 3925 	clr (XMASK,sp) 
      001688 CD 11 AA         [ 4] 3926 	call arg_list 
      00168B A1 02            [ 1] 3927 	cp a,#2
      00168D 24 03            [ 1] 3928 	jruge 0$
      00168F CC 06 D7         [ 2] 3929 	jp syntax_error 
      001692 A1 03            [ 1] 3930 0$:	cp a,#3
      001694 25 06            [ 1] 3931 	jrult 1$
      001696 CD 0F 87         [ 4] 3932 	call dpop 
      001699 9F               [ 1] 3933 	ld a,xl
      00169A 6B 01            [ 1] 3934 	ld (XMASK,sp),a 
      00169C CD 0F 87         [ 4] 3935 1$: call dpop ; mask 
      00169F 9F               [ 1] 3936 	ld a,xl 
      0016A0 6B 02            [ 1] 3937 	ld (MASK,sp),a 
      0016A2 CD 0F 87         [ 4] 3938 	call dpop ; address 
      0016A5 F6               [ 1] 3939 2$:	ld a,(x)
      0016A6 14 02            [ 1] 3940 	and a,(MASK,sp)
      0016A8 18 01            [ 1] 3941 	xor a,(XMASK,sp)
      0016AA 27 F9            [ 1] 3942 	jreq 2$ 
      0016AC                       3943 	_drop VSIZE 
      0016AC 5B 04            [ 2]    1     addw sp,#VSIZE 
      0016AE 81               [ 4] 3944 	ret 
                                   3945 
                                   3946 ;---------------------
                                   3947 ; BASIC: BSET addr,mask
                                   3948 ; set bits at 'addr' corresponding 
                                   3949 ; to those of 'mask' that are at 1.
                                   3950 ; arguments:
                                   3951 ; 	addr 		memory address RAM|PERIPHERAL 
                                   3952 ;   mask        mask|addr
                                   3953 ; output:
                                   3954 ;	none 
                                   3955 ;--------------------------
      0016AF                       3956 bit_set:
      0016AF CD 11 AA         [ 4] 3957 	call arg_list 
      0016B2 A1 02            [ 1] 3958 	cp a,#2	 
      0016B4 27 03            [ 1] 3959 	jreq 1$ 
      0016B6 CC 06 D7         [ 2] 3960 	jp syntax_error
      0016B9                       3961 1$: 
      0016B9 CD 0F 87         [ 4] 3962 	call dpop ; mask 
      0016BC 9F               [ 1] 3963 	ld a,xl 
      0016BD CD 0F 87         [ 4] 3964 	call dpop ; addr  
      0016C0 FA               [ 1] 3965 	or a,(x)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 77.
Hexadecimal [24-Bits]



      0016C1 F7               [ 1] 3966 	ld (x),a
      0016C2 81               [ 4] 3967 	ret 
                                   3968 
                                   3969 ;---------------------
                                   3970 ; BASIC: BRES addr,mask
                                   3971 ; reset bits at 'addr' corresponding 
                                   3972 ; to those of 'mask' that are at 1.
                                   3973 ; arguments:
                                   3974 ; 	addr 		memory address RAM|PERIPHERAL 
                                   3975 ;   mask	    ~mask&*addr  
                                   3976 ; output:
                                   3977 ;	none 
                                   3978 ;--------------------------
      0016C3                       3979 bit_reset:
      0016C3 CD 11 AA         [ 4] 3980 	call arg_list 
      0016C6 A1 02            [ 1] 3981 	cp a,#2  
      0016C8 27 03            [ 1] 3982 	jreq 1$ 
      0016CA CC 06 D7         [ 2] 3983 	jp syntax_error
      0016CD                       3984 1$: 
      0016CD CD 0F 87         [ 4] 3985 	call dpop ; mask 
      0016D0 9F               [ 1] 3986 	ld a,xl 
      0016D1 43               [ 1] 3987 	cpl a 
      0016D2 CD 0F 87         [ 4] 3988 	call dpop ; addr  
      0016D5 F4               [ 1] 3989 	and a,(x)
      0016D6 F7               [ 1] 3990 	ld (x),a 
      0016D7 81               [ 4] 3991 	ret 
                                   3992 
                                   3993 ;---------------------
                                   3994 ; BASIC: BRES addr,mask
                                   3995 ; toggle bits at 'addr' corresponding 
                                   3996 ; to those of 'mask' that are at 1.
                                   3997 ; arguments:
                                   3998 ; 	addr 		memory address RAM|PERIPHERAL 
                                   3999 ;   mask	    mask^*addr  
                                   4000 ; output:
                                   4001 ;	none 
                                   4002 ;--------------------------
      0016D8                       4003 bit_toggle:
      0016D8 CD 11 AA         [ 4] 4004 	call arg_list 
      0016DB A1 02            [ 1] 4005 	cp a,#2 
      0016DD 27 03            [ 1] 4006 	jreq 1$ 
      0016DF CC 06 D7         [ 2] 4007 	jp syntax_error
      0016E2 CD 0F 87         [ 4] 4008 1$: call dpop ; mask 
      0016E5 9F               [ 1] 4009 	ld a,xl 
      0016E6 CD 0F 87         [ 4] 4010 	call dpop ; addr  
      0016E9 F8               [ 1] 4011 	xor a,(x)
      0016EA F7               [ 1] 4012 	ld (x),a 
      0016EB 81               [ 4] 4013 	ret 
                                   4014 
                                   4015 
                                   4016 ;--------------------
                                   4017 ; BASIC: POKE addr,byte
                                   4018 ; put a byte at addr 
                                   4019 ;--------------------
      0016EC                       4020 poke:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 78.
Hexadecimal [24-Bits]



      0016EC CD 11 AA         [ 4] 4021 	call arg_list 
      0016EF A1 02            [ 1] 4022 	cp a,#2
      0016F1 27 03            [ 1] 4023 	jreq 1$
      0016F3 CC 06 D7         [ 2] 4024 	jp syntax_error
      0016F6                       4025 1$:	
      0016F6 CD 0F 87         [ 4] 4026 	call dpop 
      0016F9 9F               [ 1] 4027     ld a,xl 
      0016FA CD 0F 87         [ 4] 4028 	call dpop 
      0016FD F7               [ 1] 4029 	ld (x),a 
      0016FE 81               [ 4] 4030 	ret 
                                   4031 
                                   4032 ;-----------------------
                                   4033 ; BASIC: PEEK(addr)
                                   4034 ; get the byte at addr 
                                   4035 ; input:
                                   4036 ;	none 
                                   4037 ; output:
                                   4038 ;	X 		value 
                                   4039 ;-----------------------
      0016FF                       4040 peek:
      0016FF A6 09            [ 1] 4041 	ld a,#TK_LPAREN 
      001701 CD 11 9D         [ 4] 4042 	call expect 
      001704 CD 11 AA         [ 4] 4043 	call arg_list
      001707 A1 01            [ 1] 4044 	cp a,#1 
      001709 27 03            [ 1] 4045 	jreq 1$
      00170B CC 06 D7         [ 2] 4046 	jp syntax_error
      00170E A6 0A            [ 1] 4047 1$:	ld a,#TK_RPAREN 
      001710 CD 11 9D         [ 4] 4048 	call expect 
      001713 CD 0F 87         [ 4] 4049 	call dpop 
      001716 F6               [ 1] 4050 	ld a,(x)
      001717 5F               [ 1] 4051 	clrw x 
      001718 97               [ 1] 4052 	ld xl,a 
      001719 A6 02            [ 1] 4053 	ld a,#TK_INTGR
      00171B 81               [ 4] 4054 	ret 
                                   4055 
      00171C                       4056 if: 
      00171C CD 12 E8         [ 4] 4057 	call relation 
      00171F A1 02            [ 1] 4058 	cp a,#TK_INTGR
      001721 27 03            [ 1] 4059 	jreq 1$ 
      001723 CC 06 D7         [ 2] 4060 	jp syntax_error
      001726 4F               [ 1] 4061 1$:	clr a 
      001727 5D               [ 2] 4062 	tnzw x 
      001728 26 05            [ 1] 4063 	jrne 9$  
                                   4064 ;skip to next line
      00172A 55 00 02 00 01   [ 1] 4065 	mov in,count
      00172F 81               [ 4] 4066 9$:	ret 
                                   4067 
                                   4068 ;------------------------
                                   4069 ; BASIC: FOR var=expr 
                                   4070 ; set variable to expression 
                                   4071 ; leave variable address 
                                   4072 ; on dstack and set
                                   4073 ; FFOR bit in 'flags'
                                   4074 ;-----------------
                           000001  4075 	RETL1=1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 79.
Hexadecimal [24-Bits]



                           000003  4076 	INW=3
                           000005  4077 	BPTR=5
      001730                       4078 for: ; { -- var_addr }
      001730 A6 03            [ 1] 4079 	ld a,#TK_VAR 
      001732 CD 11 9D         [ 4] 4080 	call expect
      001735 CD 0F 7A         [ 4] 4081 	call dpush 
      001738 CD 13 7B         [ 4] 4082 	call let02 
      00173B 72 14 00 24      [ 1] 4083 	bset flags,#FFOR 
                                   4084 ; open space on cstack for BPTR and INW 
      00173F 85               [ 2] 4085 	popw x ; call return address 
      001740                       4086 	_vars 4
      001740 52 04            [ 2]    1     sub sp,#4 
      001742 89               [ 2] 4087 	pushw x  ; RETL1 
      001743 5F               [ 1] 4088 	clrw x 
      001744 1F 05            [ 2] 4089 	ldw (BPTR,sp),x 
      001746 1F 03            [ 2] 4090 	ldw (INW,sp),x 
      001748 CD 07 BD         [ 4] 4091 	call next_token 
      00174B A1 06            [ 1] 4092 	cp a,#TK_CMD 
      00174D 27 03            [ 1] 4093 	jreq 1$
      00174F CC 06 D7         [ 2] 4094 	jp syntax_error
      001752                       4095 1$:  
      001752 A3 17 5A         [ 2] 4096 	cpw x,#to 
      001755 27 03            [ 1] 4097 	jreq to
      001757 CC 06 D7         [ 2] 4098 	jp syntax_error 
                                   4099 
                                   4100 ;-----------------------------------
                                   4101 ; BASIC: TO expr 
                                   4102 ; second part of FOR loop initilization
                                   4103 ; leave limit on dstack and set 
                                   4104 ; FTO bit in 'flags'
                                   4105 ;-----------------------------------
      00175A                       4106 to: ; { var_addr -- var_addr limit step }
      00175A 72 04 00 24 03   [ 2] 4107 	btjt flags,#FFOR,1$
      00175F CC 06 D7         [ 2] 4108 	jp syntax_error
      001762 CD 12 E8         [ 4] 4109 1$: call relation  
      001765 A1 02            [ 1] 4110 	cp a,#TK_INTGR 
      001767 27 03            [ 1] 4111 	jreq 2$ 
      001769 CC 06 D7         [ 2] 4112 	jp syntax_error
      00176C                       4113 2$: 
      00176C CD 0F 7A         [ 4] 4114     call dpush ; limit
      00176F CE 00 00         [ 2] 4115 	ldw x,in.w 
      001772 CD 07 BD         [ 4] 4116 	call next_token
      001775 A1 00            [ 1] 4117 	cp a,#TK_NONE  
      001777 27 0C            [ 1] 4118 	jreq 4$ 
      001779 A1 06            [ 1] 4119 	cp a,#TK_CMD
      00177B 26 05            [ 1] 4120 	jrne 3$
      00177D A3 17 8A         [ 2] 4121 	cpw x,#step 
      001780 27 08            [ 1] 4122 	jreq step
      001782                       4123 3$:	
      001782 CD 0F 73         [ 4] 4124 	call unget_token   	 
      001785                       4125 4$:	
      001785 AE 00 01         [ 2] 4126 	ldw x,#1   ; default step  
      001788 20 12            [ 2] 4127 	jra store_loop_addr 
                                   4128 
                                   4129 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 80.
Hexadecimal [24-Bits]



                                   4130 ;----------------------------------
                                   4131 ; BASIC: STEP expr 
                                   4132 ; optional third par of FOR loop
                                   4133 ; initialization. 	
                                   4134 ;------------------------------------
      00178A                       4135 step: ; {var limit -- var limit step}
      00178A 72 04 00 24 03   [ 2] 4136 	btjt flags,#FFOR,1$
      00178F CC 06 D7         [ 2] 4137 	jp syntax_error
      001792 CD 12 E8         [ 4] 4138 1$: call relation
      001795 A1 02            [ 1] 4139 	cp a,#TK_INTGR
      001797 27 03            [ 1] 4140 	jreq store_loop_addr  
      001799 CC 06 D7         [ 2] 4141 	jp syntax_error
                                   4142 ; leave loop back entry point on cstack 
                                   4143 ; cstack is 2 call deep from interp_loop
      00179C                       4144 store_loop_addr:
      00179C CD 0F 7A         [ 4] 4145 	call dpush 
      00179F CE 00 03         [ 2] 4146 	ldw x,basicptr  
      0017A2 1F 05            [ 2] 4147 	ldw (BPTR,sp),x 
      0017A4 CE 00 00         [ 2] 4148 	ldw x,in.w 
      0017A7 1F 03            [ 2] 4149 	ldw (INW,sp),x   
      0017A9 72 15 00 24      [ 1] 4150 	bres flags,#FFOR 
      0017AD 72 5C 00 1F      [ 1] 4151 	inc loop_depth  
      0017B1 81               [ 4] 4152 	ret 
                                   4153 
                                   4154 ;--------------------------------
                                   4155 ; BASIC: NEXT var 
                                   4156 ; FOR loop control 
                                   4157 ; increment variable with step 
                                   4158 ; and compare with limit 
                                   4159 ; loop if threshold not crossed.
                                   4160 ; else clean both stacks. 
                                   4161 ; and decrement 'loop_depth' 
                                   4162 ;--------------------------------
      0017B2                       4163 next: ; {var limit step -- [var limit step ] }
      0017B2 72 5D 00 1F      [ 1] 4164 	tnz loop_depth 
      0017B6 26 03            [ 1] 4165 	jrne 1$ 
      0017B8 CC 06 D7         [ 2] 4166 	jp syntax_error 
      0017BB                       4167 1$: 
      0017BB A6 03            [ 1] 4168 	ld a,#TK_VAR 
      0017BD CD 11 9D         [ 4] 4169 	call expect
                                   4170 ; check for good variable after NEXT 	 
      0017C0 90 93            [ 1] 4171 	ldw y,x 
      0017C2 AE 00 04         [ 2] 4172 	ldw x,#4  
      0017C5 72 D3 00 19      [ 4] 4173 	cpw y,([dstkptr],x) ; compare variables address 
      0017C9 27 03            [ 1] 4174 	jreq 2$  
      0017CB CC 06 D7         [ 2] 4175 	jp syntax_error ; not the good one 
      0017CE                       4176 2$: ; increment variable 
      0017CE 93               [ 1] 4177 	ldw x,y
      0017CF FE               [ 2] 4178 	ldw x,(x)  ; get var value 
      0017D0 CF 00 09         [ 2] 4179 	ldw acc16,x 
      0017D3 72 CE 00 19      [ 5] 4180 	ldw x,[dstkptr] ; step
      0017D7 72 BB 00 09      [ 2] 4181 	addw x,acc16 ; var+step 
      0017DB 90 FF            [ 2] 4182 	ldw (y),x ; save var new value 
                                   4183 ; compare with limit 
      0017DD 90 93            [ 1] 4184 	ldw y,x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 81.
Hexadecimal [24-Bits]



      0017DF 72 CE 00 19      [ 5] 4185 	ldw x,[dstkptr] ; step in x 
      0017E3 5D               [ 2] 4186 	tnzw x  
      0017E4 2A 0B            [ 1] 4187 	jrpl 4$ ; positive step 
                                   4188 ;negative step 
      0017E6 AE 00 02         [ 2] 4189 	ldw x,#2
      0017E9 72 D3 00 19      [ 4] 4190 	cpw y,([dstkptr],x)
      0017ED 2F 24            [ 1] 4191 	jrslt loop_done
      0017EF 20 09            [ 2] 4192 	jra loop_back 
      0017F1                       4193 4$: ; positive step
      0017F1 AE 00 02         [ 2] 4194 	ldw x,#2 
      0017F4 72 D3 00 19      [ 4] 4195 	cpw y,([dstkptr],x)
      0017F8 2C 19            [ 1] 4196 	jrsgt loop_done
      0017FA                       4197 loop_back:
      0017FA 1E 05            [ 2] 4198 	ldw x,(BPTR,sp)
      0017FC CF 00 03         [ 2] 4199 	ldw basicptr,x 
      0017FF 72 01 00 24 09   [ 2] 4200 	btjf flags,#FRUN,1$ 
      001804 E6 02            [ 1] 4201 	ld a,(2,x)
      001806 C7 00 02         [ 1] 4202 	ld count,a
      001809 FE               [ 2] 4203 	ldw x,(x)
      00180A CF 00 05         [ 2] 4204 	ldw lineno,x
      00180D 1E 03            [ 2] 4205 1$:	ldw x,(INW,sp)
      00180F CF 00 00         [ 2] 4206 	ldw in.w,x 
      001812 81               [ 4] 4207 	ret 
      001813                       4208 loop_done:
                                   4209 	; remove var limit step on dstack 
      001813 CE 00 19         [ 2] 4210 	ldw x,dstkptr 
      001816 1C 00 06         [ 2] 4211 	addw x,#3*CELL_SIZE
      001819 CF 00 19         [ 2] 4212 	ldw dstkptr,x 
                                   4213 	; remove 2 return address on cstack 
      00181C 85               [ 2] 4214 	popw x
      00181D                       4215 	_drop 4
      00181D 5B 04            [ 2]    1     addw sp,#4 
      00181F 89               [ 2] 4216 	pushw x 
      001820 72 5A 00 1F      [ 1] 4217 	dec loop_depth 
      001824 81               [ 4] 4218 	ret 
                                   4219 
                                   4220 
                                   4221 ;------------------------
                                   4222 ; BASIC: GOTO lineno 
                                   4223 ; jump to lineno 
                                   4224 ; here cstack is 2 call deep from interp_loop 
                                   4225 ;------------------------
      001825                       4226 goto:
      001825 72 00 00 24 06   [ 2] 4227 	btjt flags,#FRUN,0$ 
      00182A A6 06            [ 1] 4228 	ld a,#ERR_RUN_ONLY
      00182C CC 06 D9         [ 2] 4229 	jp tb_error 
      00182F 81               [ 4] 4230 	ret 
      001830 20 23            [ 2] 4231 0$:	jra go_common
                                   4232 
                                   4233 ;--------------------
                                   4234 ; BASIC: GOSUB lineno
                                   4235 ; basic subroutine call
                                   4236 ; actual lineno and basicptr 
                                   4237 ; are saved on cstack
                                   4238 ; here cstack is 2 call deep from interp_loop 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 82.
Hexadecimal [24-Bits]



                                   4239 ;--------------------
                           000003  4240 	GOS_RET=3
      001832                       4241 gosub:
      001832 72 00 00 24 06   [ 2] 4242 	btjt flags,#FRUN,0$ 
      001837 A6 06            [ 1] 4243 	ld a,#ERR_RUN_ONLY
      001839 CC 06 D9         [ 2] 4244 	jp tb_error 
      00183C 81               [ 4] 4245 	ret 
      00183D 85               [ 2] 4246 0$:	popw x 
      00183E 52 02            [ 2] 4247 	sub sp,#2 
      001840 89               [ 2] 4248 	pushw x 
      001841 CE 00 03         [ 2] 4249 	ldw x,basicptr
      001844 E6 02            [ 1] 4250 	ld a,(2,x)
      001846 AB 03            [ 1] 4251 	add a,#3 
      001848 C7 00 0A         [ 1] 4252 	ld acc8,a 
      00184B 72 5F 00 09      [ 1] 4253 	clr acc16 
      00184F 72 BB 00 09      [ 2] 4254 	addw x,acc16
      001853 1F 03            [ 2] 4255 	ldw (GOS_RET,sp),x 
      001855                       4256 go_common: 
      001855 CD 12 E8         [ 4] 4257 	call relation 
      001858 A1 02            [ 1] 4258 	cp a,#TK_INTGR
      00185A 27 03            [ 1] 4259 	jreq 1$ 
      00185C CC 06 D7         [ 2] 4260 	jp syntax_error
      00185F                       4261 1$: 
      00185F CD 02 E0         [ 4] 4262 	call search_lineno  
      001862 5D               [ 2] 4263 	tnzw x 
      001863 26 05            [ 1] 4264 	jrne 2$ 
      001865 A6 05            [ 1] 4265 	ld a,#ERR_NO_LINE 
      001867 CC 06 D9         [ 2] 4266 	jp tb_error 
      00186A                       4267 2$: 
      00186A CF 00 03         [ 2] 4268 	ldw basicptr,x 
      00186D E6 02            [ 1] 4269 	ld a,(2,x)
      00186F AB 03            [ 1] 4270 	add a,#3 
      001871 C7 00 02         [ 1] 4271 	ld count,a 
      001874 FE               [ 2] 4272 	ldw x,(x)
      001875 CF 00 05         [ 2] 4273 	ldw lineno,x 
      001878 35 03 00 01      [ 1] 4274 	mov in,#3 
      00187C 81               [ 4] 4275 	ret 
                                   4276 
                                   4277 ;------------------------
                                   4278 ; BASIC: RETURN 
                                   4279 ; exit from a subroutine 
                                   4280 ; cstack is 2 level deep from interp_loop 
                                   4281 ;------------------------
      00187D                       4282 return:
      00187D 72 00 00 24 05   [ 2] 4283 	btjt flags,#FRUN,0$ 
      001882 A6 06            [ 1] 4284 	ld a,#ERR_RUN_ONLY
      001884 CC 06 D9         [ 2] 4285 	jp tb_error 
      001887                       4286 0$:	
      001887 1E 03            [ 2] 4287 	ldw x,(GOS_RET,sp) 
      001889 CF 00 03         [ 2] 4288 	ldw basicptr,x 
      00188C E6 02            [ 1] 4289 	ld a,(2,x)
      00188E AB 03            [ 1] 4290 	add a,#3 
      001890 C7 00 02         [ 1] 4291 	ld count,a 
      001893 35 03 00 01      [ 1] 4292 	mov in,#3
      001897 FE               [ 2] 4293 	ldw x,(x)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 83.
Hexadecimal [24-Bits]



      001898 CF 00 05         [ 2] 4294 	ldw lineno,x 
      00189B 4F               [ 1] 4295 	clr a 
      00189C 85               [ 2] 4296 	popw x 
      00189D                       4297 	_drop 2
      00189D 5B 02            [ 2]    1     addw sp,#2 
      00189F 89               [ 2] 4298 	pushw x
      0018A0 81               [ 4] 4299 	ret  
                                   4300 
                                   4301 
                                   4302 ;----------------------------------
                                   4303 ; BASIC: RUN
                                   4304 ; run BASIC program in RAM
                                   4305 ;----------------------------------- 
      0018A1                       4306 run: 
      0018A1 72 01 00 24 02   [ 2] 4307 	btjf flags,#FRUN,0$  
      0018A6 4F               [ 1] 4308 	clr a 
      0018A7 81               [ 4] 4309 	ret
      0018A8                       4310 0$: 
      0018A8 72 09 00 24 12   [ 2] 4311 	btjf flags,#FBREAK,1$
      0018AD                       4312 	_drop 2 
      0018AD 5B 02            [ 2]    1     addw sp,#2 
      0018AF CD 15 FA         [ 4] 4313 	call rest_context
      0018B2                       4314 	_drop CTXT_SIZE 
      0018B2 5B 06            [ 2]    1     addw sp,#CTXT_SIZE 
      0018B4 72 19 00 24      [ 1] 4315 	bres flags,#FBREAK 
      0018B8 72 10 00 24      [ 1] 4316 	bset flags,#FRUN 
      0018BC CC 07 8D         [ 2] 4317 	jp interp_loop 
      0018BF CE 00 1B         [ 2] 4318 1$:	ldw x,txtbgn
      0018C2 C3 00 1D         [ 2] 4319 	cpw x,txtend 
      0018C5 2B 02            [ 1] 4320 	jrmi 2$ 
      0018C7 4F               [ 1] 4321 	clr a 
      0018C8 81               [ 4] 4322 	ret 
      0018C9 CD 13 63         [ 4] 4323 2$: call ubound 
      0018CC                       4324 	_drop 2 
      0018CC 5B 02            [ 2]    1     addw sp,#2 
      0018CE CE 00 1B         [ 2] 4325 	ldw x,txtbgn 
      0018D1 CF 00 03         [ 2] 4326 	ldw basicptr,x 
      0018D4 E6 02            [ 1] 4327 	ld a,(2,x)
      0018D6 C7 00 02         [ 1] 4328 	ld count,a
      0018D9 FE               [ 2] 4329 	ldw x,(x)
      0018DA CF 00 05         [ 2] 4330 	ldw lineno,x
      0018DD 35 03 00 01      [ 1] 4331 	mov in,#3	
      0018E1 72 10 00 24      [ 1] 4332 	bset flags,#FRUN 
      0018E5 CC 07 8D         [ 2] 4333 	jp interp_loop 
                                   4334 
                                   4335 
                                   4336 ;----------------------
                                   4337 ; BASIC: STOP 
                                   4338 ; stop running program
                                   4339 ;---------------------- 
      0018E8                       4340 stop: 
                                   4341 ; clean dstack and cstack 
      0018E8 AE 17 FF         [ 2] 4342 	ldw x,#STACK_EMPTY 
      0018EB 94               [ 1] 4343 	ldw sp,x 
      0018EC 72 11 00 24      [ 1] 4344 	bres flags,#FRUN 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 84.
Hexadecimal [24-Bits]



      0018F0 72 19 00 24      [ 1] 4345 	bres flags,#FBREAK
      0018F4 CC 07 29         [ 2] 4346 	jp warm_start
                                   4347 
                                   4348 ;-----------------------
                                   4349 ; BASIC BEEP expr1,expr2
                                   4350 ; used MCU internal beeper 
                                   4351 ; to produce a sound
                                   4352 ; arguments:
                                   4353 ;    expr1   frequency, {1,2,4} mapping to 1K,2K,4K
                                   4354 ;    expr2   duration msec.
                                   4355 ;---------------------------
      0018F7                       4356 beep:
      0018F7 CD 11 AA         [ 4] 4357 	call arg_list 
      0018FA A1 02            [ 1] 4358 	cp a,#2 
      0018FC 27 03            [ 1] 4359 	jreq 2$
      0018FE CC 06 D7         [ 2] 4360 	jp syntax_error 
      001901 CE 00 19         [ 2] 4361 2$: ldw x,dstkptr 
      001904 EE 02            [ 2] 4362 	ldw x,(2,x);frequency 
      001906 9F               [ 1] 4363 	ld a,xl
      001907 4A               [ 1] 4364 	dec a 
      001908 4E               [ 1] 4365 	swap a 
      001909 48               [ 1] 4366 	sll a 
      00190A 48               [ 1] 4367 	sll a 
      00190B AB 3E            [ 1] 4368 	add a,#0x3e 
      00190D C7 50 F3         [ 1] 4369 	ld BEEP_CSR,a 
      001910 CD 0F 87         [ 4] 4370 	call dpop 
      001913 CD 1D DD         [ 4] 4371 	call pause02 
      001916 CD 0F AE         [ 4] 4372 	call ddrop 
      001919 A6 1F            [ 1] 4373 	ld a,#0x1f
      00191B C7 50 F3         [ 1] 4374 	ld BEEP_CSR,a 
      00191E 81               [ 4] 4375 	ret 
                                   4376 
                                   4377 ;-------------------------------
                                   4378 ; BASIC: PWRADC 0|1,divisor  
                                   4379 ; disable/enanble ADC 
                                   4380 ;-------------------------------
      00191F                       4381 power_adc:
      00191F CD 11 AA         [ 4] 4382 	call arg_list 
      001922 A1 02            [ 1] 4383 	cp a,#2	
      001924 27 03            [ 1] 4384 	jreq 1$
      001926 CC 06 D7         [ 2] 4385 	jp syntax_error 
      001929 AE 00 02         [ 2] 4386 1$: ldw x,#2
      00192C 72 DE 00 19      [ 5] 4387 	ldw x,([dstkptr],x) ; on|off
      001930 5D               [ 2] 4388 	tnzw x 
      001931 27 1C            [ 1] 4389 	jreq 2$ 
      001933 72 CE 00 19      [ 5] 4390 	ldw x,[dstkptr] ; channel
      001937 9F               [ 1] 4391 	ld a,xl
      001938 A4 07            [ 1] 4392 	and a,#7
      00193A 4E               [ 1] 4393 	swap a 
      00193B C7 54 01         [ 1] 4394 	ld ADC_CR1,a
      00193E 72 16 54 02      [ 1] 4395 	bset ADC_CR2,#ADC_CR2_ALIGN ; right 
      001942 72 10 54 01      [ 1] 4396 	bset ADC_CR1,#ADC_CR1_ADON 
      001946                       4397 	_usec_dly 7 
      001946 AE 00 1B         [ 2]    1     ldw x,#(16*7-2)/4
      001949 5A               [ 2]    2     decw x
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 85.
Hexadecimal [24-Bits]



      00194A 9D               [ 1]    3     nop 
      00194B 26 FA            [ 1]    4     jrne .-4
      00194D 20 04            [ 2] 4398 	jra 3$
      00194F 72 11 54 01      [ 1] 4399 2$: bres ADC_CR1,#ADC_CR1_ADON 
      001953 AE 00 02         [ 2] 4400 3$:	ldw x,#2
      001956 CD 0F EB         [ 4] 4401 	call ddrop_n 
      001959 81               [ 4] 4402 	ret
                                   4403 
                                   4404 ;-----------------------------
                                   4405 ; BASIC: RDADC(channel)
                                   4406 ; read adc channel 
                                   4407 ; output:
                                   4408 ;   A 		TK_INTGR 
                                   4409 ;   X 		value 
                                   4410 ;-----------------------------
      00195A                       4411 read_adc:
      00195A A6 09            [ 1] 4412 	ld a,#TK_LPAREN 
      00195C CD 11 9D         [ 4] 4413 	call expect 
      00195F CD 07 BD         [ 4] 4414 	call next_token 
      001962 A1 02            [ 1] 4415 	cp a,#TK_INTGR 
      001964 27 03            [ 1] 4416 	jreq 1$
      001966 CC 06 D7         [ 2] 4417 	jp syntax_error
      001969 89               [ 2] 4418 1$: pushw x 
      00196A A6 0A            [ 1] 4419 	ld a,#TK_RPAREN 
      00196C CD 11 9D         [ 4] 4420 	call expect 
      00196F 85               [ 2] 4421 	popw x 
      001970 A3 00 10         [ 2] 4422 	cpw x,#16 
      001973 25 05            [ 1] 4423 	jrult 2$
      001975 A6 0A            [ 1] 4424 	ld a,#ERR_BAD_VALUE
      001977 CC 06 D9         [ 2] 4425 	jp tb_error 
      00197A 9F               [ 1] 4426 2$: ld a,xl
      00197B C7 54 00         [ 1] 4427 	ld ADC_CSR,a 
      00197E 72 10 54 01      [ 1] 4428 	bset ADC_CR1,#ADC_CR1_ADON
      001982 72 0F 54 00 FB   [ 2] 4429 	btjf ADC_CSR,#ADC_CSR_EOC,.
      001987 CE 54 04         [ 2] 4430 	ldw x,ADC_DRH 
      00198A A6 02            [ 1] 4431 	ld a,#TK_INTGR
      00198C 81               [ 4] 4432 	ret 
                                   4433 
                                   4434 
                                   4435 ;-----------------------
                                   4436 ; BASIC: BREAK 
                                   4437 ; insert a breakpoint 
                                   4438 ; in pogram. 
                                   4439 ; the program is resumed
                                   4440 ; with RUN 
                                   4441 ;-------------------------
      00198D                       4442 break:
      00198D 72 00 00 24 02   [ 2] 4443 	btjt flags,#FRUN,2$
      001992 4F               [ 1] 4444 	clr a
      001993 81               [ 4] 4445 	ret 
      001994                       4446 2$:	 
                                   4447 ; create space on cstack to save context 
      001994 AE 19 BE         [ 2] 4448 	ldw x,#break_point 
      001997 CD 01 B0         [ 4] 4449 	call puts 
      00199A                       4450 	_drop 2 ;drop return address 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 86.
Hexadecimal [24-Bits]



      00199A 5B 02            [ 2]    1     addw sp,#2 
      00199C                       4451 	_vars CTXT_SIZE ; context size 
      00199C 52 06            [ 2]    1     sub sp,#CTXT_SIZE 
      00199E CD 15 E5         [ 4] 4452 	call save_context 
      0019A1 AE 16 C8         [ 2] 4453 	ldw x,#tib 
      0019A4 CF 00 03         [ 2] 4454 	ldw basicptr,x
      0019A7 7F               [ 1] 4455 	clr (x)
      0019A8 72 5F 00 02      [ 1] 4456 	clr count  
      0019AC 5F               [ 1] 4457 	clrw x 
      0019AD CF 00 05         [ 2] 4458 	ldw lineno,x 
      0019B0 CF 00 00         [ 2] 4459 	ldw in.w,x
      0019B3 72 11 00 24      [ 1] 4460 	bres flags,#FRUN 
      0019B7 72 18 00 24      [ 1] 4461 	bset flags,#FBREAK
      0019BB CC 07 8D         [ 2] 4462 	jp interp_loop 
      0019BE 0A 62 72 65 61 6B 20  4463 break_point: .asciz "\nbreak point, RUN to resume.\n"
             70 6F 69 6E 74 2C 20
             52 55 4E 20 74 6F 20
             72 65 73 75 6D 65 2E
             0A 00
                                   4464 
                                   4465 ;-----------------------
                                   4466 ; BASIC: NEW
                                   4467 ; from command line only 
                                   4468 ; free program memory
                                   4469 ; and clear variables 
                                   4470 ;------------------------
      0019DC                       4471 new: 
      0019DC 72 01 00 24 02   [ 2] 4472 	btjf flags,#FRUN,0$ 
      0019E1 4F               [ 1] 4473 	clr a 
      0019E2 81               [ 4] 4474 	ret 
      0019E3                       4475 0$:	
      0019E3 CD 05 A5         [ 4] 4476 	call clear_basic 
      0019E6 81               [ 4] 4477 	ret 
                                   4478 	 
                                   4479 ;;;;;;;;;;;;;;;;;;;;;;;;;
                                   4480 ;   file system routines
                                   4481 ;;;;;;;;;;;;;;;;;;;;;;;;;
                                   4482 
                                   4483 ;--------------------
                                   4484 ; input:
                                   4485 ;   X     increment 
                                   4486 ; output:
                                   4487 ;   farptr  incremented 
                                   4488 ;---------------------
      0019E7                       4489 incr_farptr:
      0019E7 72 BB 00 14      [ 2] 4490 	addw x,farptr+1 
      0019EB 24 04            [ 1] 4491 	jrnc 1$
      0019ED 72 5C 00 13      [ 1] 4492 	inc farptr 
      0019F1 CF 00 14         [ 2] 4493 1$:	ldw farptr+1,x  
      0019F4 81               [ 4] 4494 	ret 
                                   4495 
                                   4496 ;------------------------------
                                   4497 ; extended flash memory used as FLASH_DRIVE 
                                   4498 ; seek end of used flash drive   
                                   4499 ; starting at 0x10000 address.
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 87.
Hexadecimal [24-Bits]



                                   4500 ; 4 consecutives 0 bytes signal free space. 
                                   4501 ; input:
                                   4502 ;	none
                                   4503 ; output:
                                   4504 ;   ffree     free_addr| 0 if memory full.
                                   4505 ;------------------------------
      0019F5                       4506 seek_fdrive:
      0019F5 A6 01            [ 1] 4507 	ld a,#1
      0019F7 C7 00 13         [ 1] 4508 	ld farptr,a 
      0019FA 5F               [ 1] 4509 	clrw x 
      0019FB CF 00 14         [ 2] 4510 	ldw farptr+1,x 
      0019FE                       4511 1$:
      0019FE 5F               [ 1] 4512 	clrw x 
      0019FF 92 AF 00 13      [ 5] 4513 	ldf a,([farptr],x) 
      001A03 26 15            [ 1] 4514 	jrne 2$
      001A05 5C               [ 1] 4515 	incw x 
      001A06 92 AF 00 13      [ 5] 4516 	ldf a,([farptr],x)
      001A0A 26 0E            [ 1] 4517 	jrne 2$ 
      001A0C 5C               [ 1] 4518 	incw x 
      001A0D 92 AF 00 13      [ 5] 4519 	ldf a,([farptr],x)
      001A11 26 07            [ 1] 4520 	jrne 2$ 
      001A13 5C               [ 1] 4521 	incw x 
      001A14 92 AF 00 13      [ 5] 4522 	ldf a,([farptr],x)
      001A18 27 28            [ 1] 4523 	jreq 4$ 
      001A1A                       4524 2$: 
      001A1A 1C 00 01         [ 2] 4525 	addw x,#1
      001A1D CD 19 E7         [ 4] 4526 	call incr_farptr
      001A20 AE 02 7F         [ 2] 4527 	ldw x,#0x27f 
      001A23 C3 00 13         [ 2] 4528 	cpw x,farptr
      001A26 2A D6            [ 1] 4529 	jrpl 1$
      001A28 72 5F 00 16      [ 1] 4530 	clr ffree 
      001A2C 72 5F 00 17      [ 1] 4531 	clr ffree+1 
      001A30 72 5F 00 18      [ 1] 4532 	clr ffree+2 
      001A34 72 5F 00 08      [ 1] 4533 	clr acc24 
      001A38 72 5F 00 09      [ 1] 4534 	clr acc16
      001A3C 72 5F 00 0A      [ 1] 4535 	clr acc8 
      001A40 20 1A            [ 2] 4536 	jra 5$
      001A42                       4537 4$: ; copy farptr to ffree	 
      001A42 CE 00 14         [ 2] 4538 	ldw x,farptr+1 
      001A45 A3 00 00         [ 2] 4539 	cpw x,#fdrive 
      001A48 27 06            [ 1] 4540 	jreq 41$
                                   4541 	; there is a file, last 0 of that file must be skipped.
      001A4A AE 00 01         [ 2] 4542 	ldw x,#1
      001A4D CD 19 E7         [ 4] 4543 	call incr_farptr
      001A50                       4544 41$: 
      001A50 CE 00 13         [ 2] 4545 	ldw x,farptr 
      001A53 C6 00 15         [ 1] 4546 	ld a,farptr+2 
      001A56 CF 00 16         [ 2] 4547 	ldw ffree,x 
      001A59 C7 00 18         [ 1] 4548 	ld ffree+2,a  
      001A5C 81               [ 4] 4549 5$:	ret 
                                   4550 
                                   4551 ;-----------------------
                                   4552 ; compare file name 
                                   4553 ; with name pointed by Y  
                                   4554 ; input:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 88.
Hexadecimal [24-Bits]



                                   4555 ;   farptr   file name 
                                   4556 ;   Y        target name 
                                   4557 ; output:
                                   4558 ;   farptr 	 at file_name
                                   4559 ;   X 		 farptr[x] point at size field  
                                   4560 ;   Carry    0|1 no match|match  
                                   4561 ;----------------------
      001A5D                       4562 cmp_name:
      001A5D 5F               [ 1] 4563 	clrw x
      001A5E 92 AF 00 13      [ 5] 4564 1$:	ldf a,([farptr],x)
      001A62 90 F1            [ 1] 4565 	cp a,(y)
      001A64 26 08            [ 1] 4566 	jrne 4$
      001A66 4D               [ 1] 4567 	tnz a 
      001A67 27 12            [ 1] 4568 	jreq 9$ 
      001A69 5C               [ 1] 4569     incw x 
      001A6A 90 5C            [ 1] 4570 	incw y 
      001A6C 20 F0            [ 2] 4571 	jra 1$
      001A6E                       4572 4$: ;no match 
      001A6E 4D               [ 1] 4573 	tnz a 
      001A6F 27 07            [ 1] 4574 	jreq 5$
      001A71 5C               [ 1] 4575 	incw x 
      001A72 92 AF 00 13      [ 5] 4576 	ldf a,([farptr],x)
      001A76 20 F6            [ 2] 4577 	jra 4$  
      001A78 5C               [ 1] 4578 5$:	incw x ; farptr[x] point at 'size' field 
      001A79 98               [ 1] 4579 	rcf 
      001A7A 81               [ 4] 4580 	ret
      001A7B                       4581 9$: ; match  
      001A7B 5C               [ 1] 4582 	incw x  ; farptr[x] at 'size' field 
      001A7C 99               [ 1] 4583 	scf 
      001A7D 81               [ 4] 4584 	ret 
                                   4585 
                                   4586 ;-----------------------
                                   4587 ; search file in 
                                   4588 ; flash memory 
                                   4589 ; input:
                                   4590 ;   Y       file name  
                                   4591 ; output:
                                   4592 ;   farptr  addr at name|0
                                   4593 ;-----------------------
                           000001  4594 	FSIZE=1
                           000003  4595 	YSAVE=3
                           000004  4596 	VSIZE=4 
      001A7E                       4597 search_file: 
      001A7E                       4598 	_vars VSIZE
      001A7E 52 04            [ 2]    1     sub sp,#VSIZE 
      001A80 17 03            [ 2] 4599 	ldw (YSAVE,sp),y  
      001A82 5F               [ 1] 4600 	clrw x 
      001A83 CF 00 14         [ 2] 4601 	ldw farptr+1,x 
      001A86 35 01 00 13      [ 1] 4602 	mov farptr,#1
      001A8A                       4603 1$:	
                                   4604 ; check if farptr is after any file 
                                   4605 ; if  0 then so.
      001A8A 92 BC 00 13      [ 5] 4606 	ldf a,[farptr]
      001A8E 27 24            [ 1] 4607 	jreq 6$
      001A90 5F               [ 1] 4608 2$: clrw x 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 89.
Hexadecimal [24-Bits]



      001A91 16 03            [ 2] 4609 	ldw y,(YSAVE,sp) 
      001A93 CD 1A 5D         [ 4] 4610 	call cmp_name
      001A96 25 2C            [ 1] 4611 	jrc 9$
      001A98 92 AF 00 13      [ 5] 4612 	ldf a,([farptr],x)
      001A9C 6B 01            [ 1] 4613 	ld (FSIZE,sp),a 
      001A9E 5C               [ 1] 4614 	incw x 
      001A9F 92 AF 00 13      [ 5] 4615 	ldf a,([farptr],x)
      001AA3 6B 02            [ 1] 4616 	ld (FSIZE+1,sp),a 
      001AA5 5C               [ 1] 4617 	incw x 
      001AA6 72 FB 01         [ 2] 4618 	addw x,(FSIZE,sp) ; count to skip 
      001AA9 CD 19 E7         [ 4] 4619 	call incr_farptr ; now at next file 'name_field'
      001AAC AE 02 80         [ 2] 4620 	ldw x,#0x280
      001AAF C3 00 13         [ 2] 4621 	cpw x,farptr 
      001AB2 2A D6            [ 1] 4622 	jrpl 1$
      001AB4                       4623 6$: ; file not found 
      001AB4 72 5F 00 13      [ 1] 4624 	clr farptr
      001AB8 72 5F 00 14      [ 1] 4625 	clr farptr+1 
      001ABC 72 5F 00 15      [ 1] 4626 	clr farptr+2 
      001AC0                       4627 	_drop VSIZE 
      001AC0 5B 04            [ 2]    1     addw sp,#VSIZE 
      001AC2 98               [ 1] 4628 	rcf
      001AC3 81               [ 4] 4629 	ret
      001AC4                       4630 9$: ; file found  farptr[0] at 'name_field',farptr[x] at 'file_size' 
      001AC4                       4631 	_drop VSIZE 
      001AC4 5B 04            [ 2]    1     addw sp,#VSIZE 
      001AC6 99               [ 1] 4632 	scf 	
      001AC7 81               [ 4] 4633 	ret
                                   4634 
                                   4635 ;--------------------------------
                                   4636 ; BASIC: SAVE "name" 
                                   4637 ; save text program in 
                                   4638 ; flash memory used as 
                                   4639 ;--------------------------------
      001AC8                       4640 save:
      001AC8 72 01 00 24 05   [ 2] 4641 	btjf flags,#FRUN,0$ 
      001ACD A6 07            [ 1] 4642 	ld a,#ERR_CMD_ONLY 
      001ACF CC 06 D9         [ 2] 4643 	jp tb_error
      001AD2                       4644 0$:	 
      001AD2 CE 00 1D         [ 2] 4645 	ldw x,txtend 
      001AD5 72 B0 00 1B      [ 2] 4646 	subw x,txtbgn
      001AD9 26 02            [ 1] 4647 	jrne 10$
                                   4648 ; nothing to save 
      001ADB 4F               [ 1] 4649 	clr a 
      001ADC 81               [ 4] 4650 	ret 
      001ADD                       4651 10$:	
      001ADD C6 00 16         [ 1] 4652 	ld a,ffree 
      001AE0 CA 00 17         [ 1] 4653 	or a,ffree+1
      001AE3 CA 00 18         [ 1] 4654 	or a,ffree+2 
      001AE6 26 05            [ 1] 4655 	jrne 1$
      001AE8 A6 01            [ 1] 4656 	ld a,#ERR_MEM_FULL
      001AEA CC 06 D9         [ 2] 4657 	jp tb_error 
      001AED CD 07 BD         [ 4] 4658 1$: call next_token	
      001AF0 A1 08            [ 1] 4659 	cp a,#TK_QSTR
      001AF2 27 03            [ 1] 4660 	jreq 2$
      001AF4 CC 06 D7         [ 2] 4661 	jp syntax_error
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 90.
Hexadecimal [24-Bits]



      001AF7                       4662 2$: ; check for existing file of that name 
      001AF7 90 93            [ 1] 4663 	ldw y,x ; file name pointer 
      001AF9 CD 1A 7E         [ 4] 4664 	call search_file 
      001AFC 24 05            [ 1] 4665 	jrnc 3$ 
      001AFE A6 08            [ 1] 4666 	ld a,#ERR_DUPLICATE 
      001B00 CC 06 D9         [ 2] 4667 	jp tb_error 
      001B03                       4668 3$:	;** write file name to flash **
      001B03 CE 00 16         [ 2] 4669 	ldw x,ffree 
      001B06 C6 00 18         [ 1] 4670 	ld a,ffree+2 
      001B09 CF 00 13         [ 2] 4671 	ldw farptr,x 
      001B0C C7 00 15         [ 1] 4672 	ld farptr+2,a 
      001B0F AE 17 18         [ 2] 4673 	ldw x,#pad  
      001B12 CD 02 72         [ 4] 4674 	call strlen 
      001B15 5C               [ 1] 4675 	incw  x
      001B16 89               [ 2] 4676 	pushw x 
      001B17 5F               [ 1] 4677 	clrw x   
      001B18 90 AE 17 18      [ 2] 4678 	ldw y,#pad 
      001B1C CD 01 51         [ 4] 4679 	call write_block  
      001B1F                       4680 	_drop 2 ; drop pushed X 
      001B1F 5B 02            [ 2]    1     addw sp,#2 
                                   4681 ;** write file length after name **
      001B21 CE 00 1D         [ 2] 4682 	ldw x,txtend 
      001B24 72 B0 00 1B      [ 2] 4683 	subw x,txtbgn
      001B28 89               [ 2] 4684 	pushw x ; file size 
      001B29 5F               [ 1] 4685 	clrw x 
      001B2A 7B 01            [ 1] 4686 	ld a,(1,sp)
      001B2C CD 00 DC         [ 4] 4687 	call write_byte 
      001B2F 5C               [ 1] 4688 	incw x 
      001B30 7B 02            [ 1] 4689 	ld a,(2,sp)
      001B32 CD 00 DC         [ 4] 4690 	call write_byte
      001B35 5C               [ 1] 4691 	incw x  
      001B36 CD 19 E7         [ 4] 4692 	call incr_farptr ; move farptr after SIZE field 
                                   4693 ;** write BASIC text **
                                   4694 ; copy BSIZE, cstack:{... bsize -- ... bsize bsize }	
      001B39 1E 01            [ 2] 4695 	ldw x,(1,sp)
      001B3B 89               [ 2] 4696 	pushw x 
      001B3C 5F               [ 1] 4697 	clrw x 
      001B3D 90 CE 00 1B      [ 2] 4698 	ldw y,txtbgn  ; BASIC text to save 
      001B41 CD 01 51         [ 4] 4699 	call write_block 
      001B44                       4700 	_drop 2 ;  drop BSIZE argument
      001B44 5B 02            [ 2]    1     addw sp,#2 
                                   4701 ; save farptr in ffree
      001B46 CE 00 13         [ 2] 4702 	ldw x,farptr 
      001B49 C6 00 15         [ 1] 4703 	ld a,farptr+2 
      001B4C CF 00 16         [ 2] 4704 	ldw ffree,x 
      001B4F C7 00 18         [ 1] 4705 	ld ffree+2,a
                                   4706 ; write 4 zero bytes as a safe gard 
      001B52 5F               [ 1] 4707     clrw x 
      001B53 4F               [ 1] 4708 	clr a 
      001B54 CD 00 DC         [ 4] 4709 	call write_byte 
      001B57 5C               [ 1] 4710 	incw x 
      001B58 4F               [ 1] 4711 	clr a 
      001B59 CD 00 DC         [ 4] 4712 	call write_byte
      001B5C 5C               [ 1] 4713 	incw x 
      001B5D 4F               [ 1] 4714 	clr a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 91.
Hexadecimal [24-Bits]



      001B5E CD 00 DC         [ 4] 4715 	call write_byte
                                   4716 ; display saved size  
      001B61 85               [ 2] 4717 	popw x ; first copy of BSIZE 
      001B62 A6 02            [ 1] 4718 	ld a,#TK_INTGR 
      001B64 81               [ 4] 4719 	ret 
                                   4720 
                                   4721 
                                   4722 ;------------------------
                                   4723 ; BASIC: LOAD "file" 
                                   4724 ; load file to RAM 
                                   4725 ; for execution 
                                   4726 ;------------------------
      001B65                       4727 load:
      001B65 72 01 00 24 07   [ 2] 4728 	btjf flags,#FRUN,0$ 
      001B6A 27 05            [ 1] 4729 	jreq 0$ 
      001B6C A6 07            [ 1] 4730 	ld a,#ERR_CMD_ONLY 
      001B6E CC 06 D9         [ 2] 4731 	jp tb_error 
      001B71                       4732 0$:	
      001B71 CD 07 BD         [ 4] 4733 	call next_token 
      001B74 A1 08            [ 1] 4734 	cp a,#TK_QSTR
      001B76 27 03            [ 1] 4735 	jreq 1$
      001B78 CC 06 D7         [ 2] 4736 	jp syntax_error 
      001B7B                       4737 1$:	
      001B7B 90 93            [ 1] 4738 	ldw y,x 
      001B7D CD 1A 7E         [ 4] 4739 	call search_file 
      001B80 25 05            [ 1] 4740 	jrc 2$ 
      001B82 A6 09            [ 1] 4741 	ld a,#ERR_NOT_FILE
      001B84 CC 06 D9         [ 2] 4742 	jp tb_error  
      001B87                       4743 2$:	
      001B87 CD 19 E7         [ 4] 4744 	call incr_farptr  
      001B8A CD 05 A5         [ 4] 4745 	call clear_basic  
      001B8D 5F               [ 1] 4746 	clrw x
      001B8E 92 AF 00 13      [ 5] 4747 	ldf a,([farptr],x)
      001B92 90 95            [ 1] 4748 	ld yh,a 
      001B94 5C               [ 1] 4749 	incw x  
      001B95 92 AF 00 13      [ 5] 4750 	ldf a,([farptr],x)
      001B99 5C               [ 1] 4751 	incw x 
      001B9A 90 97            [ 1] 4752 	ld yl,a 
      001B9C 72 B9 00 1B      [ 2] 4753 	addw y,txtbgn
      001BA0 90 CF 00 1D      [ 2] 4754 	ldw txtend,y
      001BA4 90 CE 00 1B      [ 2] 4755 	ldw y,txtbgn
      001BA8                       4756 3$:	; load BASIC text 	
      001BA8 92 AF 00 13      [ 5] 4757 	ldf a,([farptr],x)
      001BAC 90 F7            [ 1] 4758 	ld (y),a 
      001BAE 5C               [ 1] 4759 	incw x 
      001BAF 90 5C            [ 1] 4760 	incw y 
      001BB1 90 C3 00 1D      [ 2] 4761 	cpw y,txtend 
      001BB5 2B F1            [ 1] 4762 	jrmi 3$
                                   4763 ; return loaded size 	 
      001BB7 CE 00 1D         [ 2] 4764 	ldw x,txtend 
      001BBA 72 B0 00 1B      [ 2] 4765 	subw x,txtbgn
      001BBE CD 09 4F         [ 4] 4766 	call print_int 
      001BC1 81               [ 4] 4767 	ret 
                                   4768 
                                   4769 ;-----------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 92.
Hexadecimal [24-Bits]



                                   4770 ; BASIC: FORGET ["file_name"] 
                                   4771 ; erase file_name and all others 
                                   4772 ; after it. 
                                   4773 ; without argument erase all files 
                                   4774 ;-----------------------------------
      001BC2                       4775 forget:
      001BC2 CD 07 BD         [ 4] 4776 	call next_token 
      001BC5 A1 00            [ 1] 4777 	cp a,#TK_NONE 
      001BC7 27 1B            [ 1] 4778 	jreq 3$ 
      001BC9 A1 08            [ 1] 4779 	cp a,#TK_QSTR
      001BCB 27 03            [ 1] 4780 	jreq 1$
      001BCD CC 06 D7         [ 2] 4781 	jp syntax_error
      001BD0 90 93            [ 1] 4782 1$: ldw y,x
      001BD2 CD 1A 7E         [ 4] 4783 	call search_file
      001BD5 25 05            [ 1] 4784 	jrc 2$
      001BD7 A6 09            [ 1] 4785 	ld a,#ERR_NOT_FILE 
      001BD9 CC 06 D9         [ 2] 4786 	jp tb_error 
      001BDC                       4787 2$: 
      001BDC CE 00 13         [ 2] 4788 	ldw x,farptr
      001BDF C6 00 15         [ 1] 4789 	ld a,farptr+2
      001BE2 20 0B            [ 2] 4790 	jra 4$ 
      001BE4                       4791 3$: ; forget all files 
      001BE4 AE 00 00         [ 2] 4792 	ldw x,#fdrive
      001BE7 4F               [ 1] 4793 	clr a 
      001BE8 01               [ 1] 4794 	rrwa x 
      001BE9 CF 00 13         [ 2] 4795 	ldw farptr,x 
      001BEC C7 00 15         [ 1] 4796 	ld farptr+2,a 
      001BEF                       4797 4$:
      001BEF CF 00 16         [ 2] 4798 	ldw ffree,x 
      001BF2 C7 00 18         [ 1] 4799 	ld ffree+2,a 
      001BF5 5F               [ 1] 4800 5$:	clrw x 
      001BF6 4F               [ 1] 4801 	clr a  
      001BF7 CD 00 DC         [ 4] 4802 	call write_byte 
      001BFA AE 00 01         [ 2] 4803 	ldw x,#1 
      001BFD CD 19 E7         [ 4] 4804 	call incr_farptr
      001C00 C6 00 13         [ 1] 4805 	ld a,farptr
      001C03 C1 00 16         [ 1] 4806 	cp a,ffree 
      001C06 2B ED            [ 1] 4807 	jrmi 5$ 
      001C08 CE 00 14         [ 2] 4808 	ldw x,farptr+1 
      001C0B C3 00 17         [ 2] 4809 	cpw x,ffree+1
      001C0E 2B E5            [ 1] 4810 	jrmi 5$
      001C10 81               [ 4] 4811 	ret 
                                   4812 
                                   4813 ;----------------------
                                   4814 ; BASIC: DIR 
                                   4815 ; list saved files 
                                   4816 ;----------------------
                           000001  4817 	COUNT=1 ; files counter 
                           000002  4818 	VSIZE=2 
      001C11                       4819 directory:
      001C11                       4820 	_vars VSIZE 
      001C11 52 02            [ 2]    1     sub sp,#VSIZE 
      001C13 5F               [ 1] 4821 	clrw x 
      001C14 1F 01            [ 2] 4822 	ldw (COUNT,sp),x 
      001C16 CF 00 14         [ 2] 4823 	ldw farptr+1,x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 93.
Hexadecimal [24-Bits]



      001C19 35 01 00 13      [ 1] 4824 	mov farptr,#1 
      001C1D                       4825 dir_loop:
      001C1D 5F               [ 1] 4826 	clrw x 
      001C1E 92 AF 00 13      [ 5] 4827 	ldf a,([farptr],x)
      001C22 27 38            [ 1] 4828 	jreq 8$ 
      001C24                       4829 1$: ;name loop 	
      001C24 92 AF 00 13      [ 5] 4830 	ldf a,([farptr],x)
      001C28 27 06            [ 1] 4831 	jreq 2$ 
      001C2A CD 01 9E         [ 4] 4832 	call putc 
      001C2D 5C               [ 1] 4833 	incw x 
      001C2E 20 F4            [ 2] 4834 	jra 1$
      001C30 5C               [ 1] 4835 2$: incw x ; skip ending 0. 
      001C31 A6 20            [ 1] 4836 	ld a,#SPACE 
      001C33 CD 01 9E         [ 4] 4837 	call putc 
                                   4838 ; get file size 	
      001C36 92 AF 00 13      [ 5] 4839 	ldf a,([farptr],x)
      001C3A 90 95            [ 1] 4840 	ld yh,a 
      001C3C 5C               [ 1] 4841 	incw x 
      001C3D 92 AF 00 13      [ 5] 4842 	ldf a,([farptr],x)
      001C41 5C               [ 1] 4843 	incw x 
      001C42 90 97            [ 1] 4844 	ld yl,a 
      001C44 90 89            [ 2] 4845 	pushw y 
      001C46 72 FB 01         [ 2] 4846 	addw x,(1,sp)
      001C49 CD 19 E7         [ 4] 4847 	call incr_farptr 
      001C4C 85               [ 2] 4848 	popw x ; file size 
      001C4D CD 09 4F         [ 4] 4849 	call print_int 
      001C50 A6 0D            [ 1] 4850 	ld a,#CR 
      001C52 CD 01 9E         [ 4] 4851 	call putc
      001C55 1E 01            [ 2] 4852 	ldw x,(COUNT,sp)
      001C57 5C               [ 1] 4853 	incw x
      001C58 1F 01            [ 2] 4854 	ldw (COUNT,sp),x  
      001C5A 20 C1            [ 2] 4855 	jra dir_loop 
      001C5C                       4856 8$: ; print number of files 
      001C5C 1E 01            [ 2] 4857 	ldw x,(COUNT,sp)
      001C5E CD 09 4F         [ 4] 4858 	call print_int 
      001C61 AE 1C 91         [ 2] 4859 	ldw x,#file_count 
      001C64 CD 01 B0         [ 4] 4860 	call puts  
                                   4861 ; print drive free space 	
      001C67 A6 FF            [ 1] 4862 	ld a,#0xff 
      001C69 C0 00 18         [ 1] 4863 	sub a,ffree+2 
      001C6C C7 00 0A         [ 1] 4864 	ld acc8,a 
      001C6F A6 7F            [ 1] 4865 	ld a,#0x7f 
      001C71 C2 00 17         [ 1] 4866 	sbc a,ffree+1 
      001C74 C7 00 09         [ 1] 4867 	ld acc16,a 
      001C77 A6 02            [ 1] 4868 	ld a,#2 
      001C79 C2 00 16         [ 1] 4869 	sbc a,ffree 
      001C7C C7 00 08         [ 1] 4870 	ld acc24,a 
      001C7F 5F               [ 1] 4871 	clrw x  
      001C80 A6 06            [ 1] 4872 	ld a,#6 
      001C82 97               [ 1] 4873 	ld xl,a 
      001C83 A6 0A            [ 1] 4874 	ld a,#10 
      001C85 CD 09 07         [ 4] 4875 	call prti24 
      001C88 AE 1C 99         [ 2] 4876 	ldw x,#drive_free
      001C8B CD 01 B0         [ 4] 4877 	call puts 
      001C8E                       4878 	_drop VSIZE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 94.
Hexadecimal [24-Bits]



      001C8E 5B 02            [ 2]    1     addw sp,#VSIZE 
      001C90 81               [ 4] 4879 	ret
      001C91 20 66 69 6C 65 73 0A  4880 file_count: .asciz " files\n"
             00
      001C99 20 62 79 74 65 73 20  4881 drive_free: .asciz " bytes free\n" 
             66 72 65 65 0A 00
                                   4882 
                                   4883 ;---------------------
                                   4884 ; BASIC: WRITE expr1,expr2[,expr]* 
                                   4885 ; write 1 or more byte to FLASH or EEPROM
                                   4886 ; starting at address  
                                   4887 ; input:
                                   4888 ;   expr1  	is address 
                                   4889 ;   expr2   is byte to write
                                   4890 ; output:
                                   4891 ;   none 
                                   4892 ;---------------------
                           000001  4893 	ADDR=1
                           000002  4894 	VSIZ=2 
      001CA6                       4895 write:
      001CA6                       4896 	_vars VSIZE 
      001CA6 52 02            [ 2]    1     sub sp,#VSIZE 
      001CA8 72 5F 00 13      [ 1] 4897 	clr farptr ; expect 16 bits address 
      001CAC CD 12 A4         [ 4] 4898 	call expression
      001CAF A1 02            [ 1] 4899 	cp a,#TK_INTGR 
      001CB1 27 03            [ 1] 4900 	jreq 0$
      001CB3 CC 06 D7         [ 2] 4901 	jp syntax_error
      001CB6 1F 01            [ 2] 4902 0$: ldw (ADDR,sp),x 
      001CB8 CD 07 BD         [ 4] 4903 	call next_token 
      001CBB A1 0B            [ 1] 4904 	cp a,#TK_COMMA 
      001CBD 27 02            [ 1] 4905 	jreq 1$ 
      001CBF 20 19            [ 2] 4906 	jra 9$ 
      001CC1 CD 12 A4         [ 4] 4907 1$:	call expression
      001CC4 A1 02            [ 1] 4908 	cp a,#TK_INTGR
      001CC6 27 03            [ 1] 4909 	jreq 2$
      001CC8 CC 06 D7         [ 2] 4910 	jp syntax_error
      001CCB 9F               [ 1] 4911 2$:	ld a,xl 
      001CCC 1E 01            [ 2] 4912 	ldw x,(ADDR,sp) 
      001CCE CF 00 14         [ 2] 4913 	ldw farptr+1,x 
      001CD1 5F               [ 1] 4914 	clrw x 
      001CD2 CD 00 DC         [ 4] 4915 	call write_byte
      001CD5 1E 01            [ 2] 4916 	ldw x,(ADDR,sp)
      001CD7 5C               [ 1] 4917 	incw x 
      001CD8 20 DC            [ 2] 4918 	jra 0$ 
      001CDA                       4919 9$:
      001CDA                       4920 	_drop VSIZE
      001CDA 5B 02            [ 2]    1     addw sp,#VSIZE 
      001CDC 81               [ 4] 4921 	ret 
                                   4922 
                                   4923 
                                   4924 ;---------------------
                                   4925 ;BASIC: CHAR(expr)
                                   4926 ; évaluate expression 
                                   4927 ; and take the 7 least 
                                   4928 ; bits as ASCII character
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 95.
Hexadecimal [24-Bits]



                                   4929 ;---------------------
      001CDD                       4930 char:
      001CDD A6 09            [ 1] 4931 	ld a,#TK_LPAREN 
      001CDF CD 11 9D         [ 4] 4932 	call expect 
      001CE2 CD 12 E8         [ 4] 4933 	call relation 
      001CE5 A1 02            [ 1] 4934 	cp a,#TK_INTGR 
      001CE7 27 03            [ 1] 4935 	jreq 1$
      001CE9 CC 06 D7         [ 2] 4936 	jp syntax_error
      001CEC 89               [ 2] 4937 1$:	pushw x 
      001CED A6 0A            [ 1] 4938 	ld a,#TK_RPAREN 
      001CEF CD 11 9D         [ 4] 4939 	call expect
      001CF2 85               [ 2] 4940 	popw x  
      001CF3 9F               [ 1] 4941 	ld a,xl 
      001CF4 A4 7F            [ 1] 4942 	and a,#0x7f 
      001CF6 97               [ 1] 4943 	ld xl,a
      001CF7 A6 05            [ 1] 4944 	ld a,#TK_CHAR
      001CF9 81               [ 4] 4945 	ret
                                   4946 
                                   4947 ;---------------------
                                   4948 ; BASIC: ASC(string|char)
                                   4949 ; extract first character 
                                   4950 ; of string argument 
                                   4951 ; return it as TK_INTGR 
                                   4952 ;---------------------
      001CFA                       4953 ascii:
      001CFA A6 09            [ 1] 4954 	ld a,#TK_LPAREN
      001CFC CD 11 9D         [ 4] 4955 	call expect 
      001CFF CD 07 BD         [ 4] 4956 	call next_token 
      001D02 A1 08            [ 1] 4957 	cp a,#TK_QSTR 
      001D04 27 07            [ 1] 4958 	jreq 1$
      001D06 A1 05            [ 1] 4959 	cp a,#TK_CHAR 
      001D08 27 06            [ 1] 4960 	jreq 2$ 
      001D0A CC 06 D7         [ 2] 4961 	jp syntax_error
      001D0D                       4962 1$: 
      001D0D F6               [ 1] 4963 	ld a,(x)
      001D0E 20 01            [ 2] 4964 	jra 3$
      001D10                       4965 2$: 
      001D10 9F               [ 1] 4966 	ld a,xl 
      001D11 97               [ 1] 4967 3$:	ld xl,a 
      001D12 4F               [ 1] 4968 	clr a  
      001D13 95               [ 1] 4969 	ld xh,a 
      001D14 89               [ 2] 4970 	pushw x  
      001D15 A6 0A            [ 1] 4971 	ld a,#TK_RPAREN 
      001D17 CD 11 9D         [ 4] 4972 	call expect 
      001D1A 85               [ 2] 4973 	popw x 
      001D1B A6 02            [ 1] 4974 	ld a,#TK_INTGR 
      001D1D 81               [ 4] 4975 	ret 
                                   4976 
                                   4977 ;---------------------
                                   4978 ;BASIC: KEY
                                   4979 ; wait for a character 
                                   4980 ; received from STDIN 
                                   4981 ; input:
                                   4982 ;	none 
                                   4983 ; output:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 96.
Hexadecimal [24-Bits]



                                   4984 ;	X 		ASCII character 
                                   4985 ;---------------------
      001D1E                       4986 key:
      001D1E CD 01 A7         [ 4] 4987 	call getc 
      001D21 5F               [ 1] 4988 	clrw x 
      001D22 97               [ 1] 4989 	ld xl,a 
      001D23 A6 02            [ 1] 4990 	ld a,#TK_INTGR
      001D25 81               [ 4] 4991 	ret
                                   4992 
                                   4993 ;----------------------
                                   4994 ; BASIC: QKEY
                                   4995 ; Return true if there 
                                   4996 ; is a character in 
                                   4997 ; waiting in STDIN 
                                   4998 ; input:
                                   4999 ;  none 
                                   5000 ; output:
                                   5001 ;   X 		0|1 
                                   5002 ;-----------------------
      001D26                       5003 qkey: 
      001D26 5F               [ 1] 5004 	clrw x 
      001D27 72 0B 52 40 01   [ 2] 5005 	btjf UART3_SR,#UART_SR_RXNE,9$ 
      001D2C 5C               [ 1] 5006 	incw x 
      001D2D A6 02            [ 1] 5007 9$: ld a,#TK_INTGR
      001D2F 81               [ 4] 5008 	ret 
                                   5009 
                                   5010 ;---------------------
                                   5011 ; BASIC: GPIO(expr,reg)
                                   5012 ; return gpio address 
                                   5013 ; expr {0..8}
                                   5014 ; input:
                                   5015 ;   none 
                                   5016 ; output:
                                   5017 ;   X 		gpio register address
                                   5018 ;----------------------------
      001D30                       5019 gpio:
      001D30 A6 09            [ 1] 5020 	ld a,#TK_LPAREN 
      001D32 CD 11 9D         [ 4] 5021 	call expect 
      001D35 CD 11 AA         [ 4] 5022 	call arg_list
      001D38 A1 02            [ 1] 5023 	cp a,#2
      001D3A 27 03            [ 1] 5024 	jreq 1$
      001D3C CC 06 D7         [ 2] 5025 	jp syntax_error  
      001D3F                       5026 1$:	
      001D3F A6 0A            [ 1] 5027 	ld a,#TK_RPAREN 
      001D41 CD 11 9D         [ 4] 5028 	call expect 
      001D44 AE 00 02         [ 2] 5029 	ldw x,#2
      001D47 72 DE 00 19      [ 5] 5030 	ldw x,([dstkptr],x) ; port 
      001D4B 2B 1B            [ 1] 5031 	jrmi bad_port
      001D4D A3 00 09         [ 2] 5032 	cpw x,#9
      001D50 2A 16            [ 1] 5033 	jrpl bad_port
      001D52 A6 05            [ 1] 5034 	ld a,#5
      001D54 42               [ 4] 5035 	mul x,a
      001D55 1C 50 00         [ 2] 5036 	addw x,#GPIO_BASE 
      001D58 89               [ 2] 5037 	pushw x 
      001D59 CD 0F 87         [ 4] 5038 	call dpop 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 97.
Hexadecimal [24-Bits]



      001D5C 72 FB 01         [ 2] 5039 	addw x,(1,sp)
      001D5F 1F 01            [ 2] 5040 	ldw (1,sp),x  
      001D61 CD 0F AE         [ 4] 5041 	call ddrop  
      001D64 85               [ 2] 5042 	popw x 
      001D65 A6 02            [ 1] 5043 	ld a,#TK_INTGR
      001D67 81               [ 4] 5044 	ret
      001D68                       5045 bad_port:
      001D68 A6 0A            [ 1] 5046 	ld a,#ERR_BAD_VALUE
      001D6A CC 06 D9         [ 2] 5047 	jp tb_error
                                   5048 
                                   5049 ;----------------------
                                   5050 ; BASIC: ODR 
                                   5051 ; return offset of gpio
                                   5052 ; ODR register: 0
                                   5053 ; ---------------------
      001D6D                       5054 port_odr:
      001D6D AE 00 00         [ 2] 5055 	ldw x,#GPIO_ODR
      001D70 A6 02            [ 1] 5056 	ld a,#TK_INTGR
      001D72 81               [ 4] 5057 	ret
                                   5058 
                                   5059 ;----------------------
                                   5060 ; BASIC: IDR 
                                   5061 ; return offset of gpio
                                   5062 ; IDR register: 1
                                   5063 ; ---------------------
      001D73                       5064 port_idr:
      001D73 AE 00 01         [ 2] 5065 	ldw x,#GPIO_IDR
      001D76 A6 02            [ 1] 5066 	ld a,#TK_INTGR
      001D78 81               [ 4] 5067 	ret
                                   5068 
                                   5069 ;----------------------
                                   5070 ; BASIC: DDR 
                                   5071 ; return offset of gpio
                                   5072 ; DDR register: 2
                                   5073 ; ---------------------
      001D79                       5074 port_ddr:
      001D79 AE 00 02         [ 2] 5075 	ldw x,#GPIO_DDR
      001D7C A6 02            [ 1] 5076 	ld a,#TK_INTGR
      001D7E 81               [ 4] 5077 	ret
                                   5078 
                                   5079 ;----------------------
                                   5080 ; BASIC: CRL  
                                   5081 ; return offset of gpio
                                   5082 ; CR1 register: 3
                                   5083 ; ---------------------
      001D7F                       5084 port_cr1:
      001D7F AE 00 03         [ 2] 5085 	ldw x,#GPIO_CR1
      001D82 A6 02            [ 1] 5086 	ld a,#TK_INTGR
      001D84 81               [ 4] 5087 	ret
                                   5088 
                                   5089 ;----------------------
                                   5090 ; BASIC: CRH  
                                   5091 ; return offset of gpio
                                   5092 ; CR2 register: 4
                                   5093 ; ---------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 98.
Hexadecimal [24-Bits]



      001D85                       5094 port_cr2:
      001D85 AE 00 04         [ 2] 5095 	ldw x,#GPIO_CR2
      001D88 A6 02            [ 1] 5096 	ld a,#TK_INTGR
      001D8A 81               [ 4] 5097 	ret
                                   5098 
                                   5099 ;-------------------------
                                   5100 ; BASIC: UFLASH 
                                   5101 ; return user flash address
                                   5102 ; input:
                                   5103 ;  none 
                                   5104 ; output:
                                   5105 ;	A		TK_INTGR
                                   5106 ;   X 		user address 
                                   5107 ;---------------------------
      001D8B                       5108 uflash:
      001D8B AE 21 00         [ 2] 5109 	ldw x,#user_space 
      001D8E A6 02            [ 1] 5110 	ld a,#TK_INTGR 
      001D90 81               [ 4] 5111 	ret 
                                   5112 
                                   5113 ;-------------------------
                                   5114 ; BASIC: EEPROM 
                                   5115 ; return eeprom address
                                   5116 ; input:
                                   5117 ;  none 
                                   5118 ; output:
                                   5119 ;	A		TK_INTGR
                                   5120 ;   X 		eeprom address 
                                   5121 ;---------------------------
      001D91                       5122 eeprom:
      001D91 AE 40 00         [ 2] 5123 	ldw x,#EEPROM_BASE 
      001D94 A6 02            [ 1] 5124 	ld a,#TK_INTGR 
      001D96 81               [ 4] 5125 	ret 
                                   5126 
                                   5127 ;---------------------
                                   5128 ; BASIC: USR(addr[,arg])
                                   5129 ; execute a function written 
                                   5130 ; in binary code.
                                   5131 ; binary fonction should 
                                   5132 ; return token attribute in A 
                                   5133 ; and value in X. 
                                   5134 ; input:
                                   5135 ;   addr	routine address 
                                   5136 ;   arg 	is an optional argument 
                                   5137 ; output:
                                   5138 ;   A 		token attribute 
                                   5139 ;   X       returned value 
                                   5140 ;---------------------
      001D97                       5141 usr:
      001D97 90 89            [ 2] 5142 	pushw y 	
      001D99 A6 09            [ 1] 5143 	ld a,#TK_LPAREN 
      001D9B CD 11 9D         [ 4] 5144 	call expect 
      001D9E CD 11 AA         [ 4] 5145 	call arg_list 
      001DA1 A1 01            [ 1] 5146 	cp a,#1 
      001DA3 2A 03            [ 1] 5147 	jrpl 2$ 
      001DA5 CC 06 D7         [ 2] 5148 	jp syntax_error 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 99.
Hexadecimal [24-Bits]



      001DA8 A6 0A            [ 1] 5149 2$: ld a,#TK_RPAREN
      001DAA CD 11 9D         [ 4] 5150 	call expect 
      001DAD CD 0F 87         [ 4] 5151 	call dpop 
      001DB0 A1 02            [ 1] 5152 	cp a,#2 
      001DB2 2B 05            [ 1] 5153 	jrmi 4$
      001DB4 90 93            [ 1] 5154 	ldw y,x ; y=arg 
      001DB6 CD 0F 87         [ 4] 5155 	call dpop ;x=addr 
      001DB9 51               [ 1] 5156 4$:	exgw y,x ; y=addr,x=arg 
      001DBA 90 FD            [ 4] 5157 	call (y)
      001DBC 90 85            [ 2] 5158 	popw y 
      001DBE 81               [ 4] 5159 	ret 
                                   5160 
                                   5161 ;------------------------------
                                   5162 ; BASIC: BYE 
                                   5163 ; halt mcu in its lowest power mode 
                                   5164 ; wait for reset or external interrupt
                                   5165 ; do a cold start on wakeup.
                                   5166 ;------------------------------
      001DBF                       5167 bye:
      001DBF 72 0D 52 40 FB   [ 2] 5168 	btjf UART3_SR,#UART_SR_TC,.
      001DC4 8E               [10] 5169 	halt
      001DC5 CC 05 1A         [ 2] 5170 	jp cold_start  
                                   5171 
                                   5172 ;----------------------------------
                                   5173 ; BASIC: SLEEP 
                                   5174 ; halt mcu until reset or external
                                   5175 ; interrupt.
                                   5176 ; Resume progam after SLEEP command
                                   5177 ;----------------------------------
      001DC8                       5178 sleep:
      001DC8 72 0D 52 40 FB   [ 2] 5179 	btjf UART3_SR,#UART_SR_TC,.
      001DCD 72 16 00 24      [ 1] 5180 	bset flags,#FSLEEP
      001DD1 8E               [10] 5181 	halt 
      001DD2 81               [ 4] 5182 	ret 
                                   5183 
                                   5184 ;-------------------------------
                                   5185 ; BASIC: PAUSE expr 
                                   5186 ; suspend execution for n msec.
                                   5187 ; input:
                                   5188 ;	none
                                   5189 ; output:
                                   5190 ;	none 
                                   5191 ;------------------------------
      001DD3                       5192 pause:
      001DD3 CD 12 A4         [ 4] 5193 	call expression
      001DD6 A1 02            [ 1] 5194 	cp a,#TK_INTGR
      001DD8 27 03            [ 1] 5195 	jreq pause02 
      001DDA CC 06 D7         [ 2] 5196 	jp syntax_error
      001DDD                       5197 pause02: 
      001DDD 5D               [ 2] 5198 1$: tnzw x 
      001DDE 27 04            [ 1] 5199 	jreq 2$
      001DE0 8F               [10] 5200 	wfi 
      001DE1 5A               [ 2] 5201 	decw x 
      001DE2 26 F9            [ 1] 5202 	jrne 1$
      001DE4 4F               [ 1] 5203 2$:	clr a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 100.
Hexadecimal [24-Bits]



      001DE5 81               [ 4] 5204 	ret 
                                   5205 
                                   5206 ;------------------------------
                                   5207 ; BASIC: TICKS
                                   5208 ; return msec ticks counter value 
                                   5209 ; input:
                                   5210 ; 	none 
                                   5211 ; output:
                                   5212 ;	X 		TK_INTGR
                                   5213 ;-------------------------------
      001DE6                       5214 get_ticks:
      001DE6 CE 00 0B         [ 2] 5215 	ldw x,ticks 
      001DE9 A6 02            [ 1] 5216 	ld a,#TK_INTGR
      001DEB 81               [ 4] 5217 	ret 
                                   5218 
                                   5219 
                                   5220 
                                   5221 ;------------------------------
                                   5222 ; BASIC: ABS(expr)
                                   5223 ; return absolute value of expr.
                                   5224 ; input:
                                   5225 ;   none
                                   5226 ; output:
                                   5227 ;   X     	positive integer
                                   5228 ;-------------------------------
      001DEC                       5229 abs:
      001DEC A6 09            [ 1] 5230 	ld a,#TK_LPAREN
      001DEE CD 11 9D         [ 4] 5231 	call expect 
      001DF1 CD 11 AA         [ 4] 5232 	call arg_list
      001DF4 A1 01            [ 1] 5233 	cp a,#1 
      001DF6 27 03            [ 1] 5234 	jreq 0$ 
      001DF8 CC 06 D7         [ 2] 5235 	jp syntax_error
      001DFB                       5236 0$:  
      001DFB A6 0A            [ 1] 5237 	ld a,#TK_RPAREN 
      001DFD CD 11 9D         [ 4] 5238 	call expect 
      001E00 CD 0F 87         [ 4] 5239     call dpop   
      001E03 9E               [ 1] 5240 	ld a,xh 
      001E04 A5 80            [ 1] 5241 	bcp a,#0x80 
      001E06 27 01            [ 1] 5242 	jreq 2$ 
      001E08 50               [ 2] 5243 	negw x 
      001E09 A6 02            [ 1] 5244 2$: ld a,#TK_INTGR 
      001E0B 81               [ 4] 5245 	ret 
                                   5246 
                                   5247 ;------------------------------
                                   5248 ; BASIC: RND(expr)
                                   5249 ; return random number 
                                   5250 ; between 1 and expr inclusive
                                   5251 ; xorshift16 ref: http://b2d-f9r.blogspot.com/2010/08/16-bit-xorshift-rng-now-with-more.html
                                   5252 ; input:
                                   5253 ; 	none 
                                   5254 ; output:
                                   5255 ;	X 		random positive integer 
                                   5256 ;------------------------------
      001E0C                       5257 random:
      001E0C A6 09            [ 1] 5258 	ld a,#TK_LPAREN 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 101.
Hexadecimal [24-Bits]



      001E0E CD 11 9D         [ 4] 5259 	call expect 
      001E11 CD 11 AA         [ 4] 5260 	call arg_list 
      001E14 A1 01            [ 1] 5261 	cp a,#1
      001E16 27 03            [ 1] 5262 	jreq 1$
      001E18 CC 06 D7         [ 2] 5263 	jp syntax_error
      001E1B A6 0A            [ 1] 5264 1$: ld a,#TK_RPAREN
      001E1D CD 11 9D         [ 4] 5265 	call expect 
      001E20 CD 0F 87         [ 4] 5266 	call dpop 
      001E23 89               [ 2] 5267 	pushw x 
      001E24 9E               [ 1] 5268 	ld a,xh 
      001E25 A5 80            [ 1] 5269 	bcp a,#0x80 
      001E27 27 05            [ 1] 5270 	jreq 2$
      001E29 A6 0A            [ 1] 5271 	ld a,#ERR_BAD_VALUE
      001E2B CC 06 D9         [ 2] 5272 	jp tb_error
      001E2E                       5273 2$: 
                                   5274 ; acc16=(x<<5)^x 
      001E2E CE 00 0D         [ 2] 5275 	ldw x,seedx 
      001E31 58               [ 2] 5276 	sllw x 
      001E32 58               [ 2] 5277 	sllw x 
      001E33 58               [ 2] 5278 	sllw x 
      001E34 58               [ 2] 5279 	sllw x 
      001E35 58               [ 2] 5280 	sllw x 
      001E36 9E               [ 1] 5281 	ld a,xh 
      001E37 C8 00 0D         [ 1] 5282 	xor a,seedx 
      001E3A C7 00 09         [ 1] 5283 	ld acc16,a 
      001E3D 9F               [ 1] 5284 	ld a,xl 
      001E3E C8 00 0E         [ 1] 5285 	xor a,seedx+1 
      001E41 C7 00 0A         [ 1] 5286 	ld acc8,a 
                                   5287 ; seedx=seedy 
      001E44 CE 00 0F         [ 2] 5288 	ldw x,seedy 
      001E47 CF 00 0D         [ 2] 5289 	ldw seedx,x  
                                   5290 ; seedy=seedy^(seedy>>1)
      001E4A 90 54            [ 2] 5291 	srlw y 
      001E4C 90 9E            [ 1] 5292 	ld a,yh 
      001E4E C8 00 0F         [ 1] 5293 	xor a,seedy 
      001E51 C7 00 0F         [ 1] 5294 	ld seedy,a  
      001E54 90 9F            [ 1] 5295 	ld a,yl 
      001E56 C8 00 10         [ 1] 5296 	xor a,seedy+1 
      001E59 C7 00 10         [ 1] 5297 	ld seedy+1,a 
                                   5298 ; acc16>>3 
      001E5C CE 00 09         [ 2] 5299 	ldw x,acc16 
      001E5F 54               [ 2] 5300 	srlw x 
      001E60 54               [ 2] 5301 	srlw x 
      001E61 54               [ 2] 5302 	srlw x 
                                   5303 ; x=acc16^x 
      001E62 9E               [ 1] 5304 	ld a,xh 
      001E63 C8 00 09         [ 1] 5305 	xor a,acc16 
      001E66 95               [ 1] 5306 	ld xh,a 
      001E67 9F               [ 1] 5307 	ld a,xl 
      001E68 C8 00 0A         [ 1] 5308 	xor a,acc8 
      001E6B 97               [ 1] 5309 	ld xl,a 
                                   5310 ; seedy=x^seedy 
      001E6C C8 00 10         [ 1] 5311 	xor a,seedy+1
      001E6F 97               [ 1] 5312 	ld xl,a 
      001E70 9E               [ 1] 5313 	ld a,xh 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 102.
Hexadecimal [24-Bits]



      001E71 C8 00 0F         [ 1] 5314 	xor a,seedy
      001E74 95               [ 1] 5315 	ld xh,a 
      001E75 CF 00 0F         [ 2] 5316 	ldw seedy,x 
                                   5317 ; return seedy modulo expr + 1 
      001E78 90 85            [ 2] 5318 	popw y 
      001E7A 65               [ 2] 5319 	divw x,y 
      001E7B 93               [ 1] 5320 	ldw x,y 
      001E7C 5C               [ 1] 5321 	incw x 
      001E7D A6 02            [ 1] 5322 	ld a,#TK_INTGR
      001E7F 81               [ 4] 5323 	ret 
                                   5324 
                                   5325 ;---------------------------------
                                   5326 ; BASIC: WORDS 
                                   5327 ; affiche la listes des mots du
                                   5328 ; dictionnaire.
                                   5329 ;---------------------------------
                           000001  5330 	WLEN=1
                           000002  5331 	LLEN=2  
                           000002  5332 	VSIZE=2 
      001E80                       5333 words:
      001E80                       5334 	_vars VSIZE
      001E80 52 02            [ 2]    1     sub sp,#VSIZE 
      001E82 0F 02            [ 1] 5335 	clr (LLEN,sp)
      001E84 90 AE 20 AF      [ 2] 5336 	ldw y,#kword_dict+2
      001E88 93               [ 1] 5337 0$:	ldw x,y
      001E89 F6               [ 1] 5338 	ld a,(x)
      001E8A A4 0F            [ 1] 5339 	and a,#15 
      001E8C 6B 01            [ 1] 5340 	ld (WLEN,sp),a 
      001E8E 5C               [ 1] 5341 1$:	incw x 
      001E8F F6               [ 1] 5342 	ld a,(x)
      001E90 CD 01 9E         [ 4] 5343 	call putc 
      001E93 0C 02            [ 1] 5344 	inc (LLEN,sp)
      001E95 0A 01            [ 1] 5345 	dec (WLEN,sp)
      001E97 26 F5            [ 1] 5346 	jrne 1$
      001E99 A6 46            [ 1] 5347 	ld a,#70
      001E9B 11 02            [ 1] 5348 	cp a,(LLEN,sp)
      001E9D 2B 09            [ 1] 5349 	jrmi 2$   
      001E9F A6 20            [ 1] 5350 	ld a,#SPACE 
      001EA1 CD 01 9E         [ 4] 5351 	call putc 
      001EA4 0C 02            [ 1] 5352 	inc (LLEN,sp) 
      001EA6 20 07            [ 2] 5353 	jra 3$
      001EA8 A6 0D            [ 1] 5354 2$: ld a,#CR 
      001EAA CD 01 9E         [ 4] 5355 	call putc 
      001EAD 0F 02            [ 1] 5356 	clr (LLEN,sp)
      001EAF 72 A2 00 02      [ 2] 5357 3$:	subw y,#2 
      001EB3 90 FE            [ 2] 5358 	ldw y,(y)
      001EB5 26 D1            [ 1] 5359 	jrne 0$  
      001EB7                       5360 	_drop VSIZE 
      001EB7 5B 02            [ 2]    1     addw sp,#VSIZE 
      001EB9 81               [ 4] 5361 	ret 
                                   5362 
                                   5363 
                                   5364 ;*********************************
                                   5365 
                                   5366 ;------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 103.
Hexadecimal [24-Bits]



                                   5367 ;      dictionary 
                                   5368 ; format:
                                   5369 ;   link:   2 bytes 
                                   5370 ;   name_length+flags:  1 byte, bits 0:4 lenght,5:8 flags  
                                   5371 ;   cmd_name: 16 byte max 
                                   5372 ;   code_address: 2 bytes 
                                   5373 ;------------------------------
                           000080  5374 	FFUNC=128 ; function flag 
                                   5375 	.macro _dict_entry len,name,cmd 
                                   5376 	.word LINK 
                                   5377 	LINK=.
                                   5378 name:
                                   5379 	.byte len 	
                                   5380 	.ascii "name"
                                   5381 	.word cmd 
                                   5382 	.endm 
                                   5383 
                           000000  5384 	LINK=0
      001EBA                       5385 kword_end:
      001EBA                       5386 	_dict_entry,3,BYE,bye 
      001EBA 00 00                    1 	.word LINK 
                           001EBC     2 	LINK=.
      001EBC                          3 BYE:
      001EBC 03                       4 	.byte 3 	
      001EBD 42 59 45                 5 	.ascii "BYE"
      001EC0 1D BF                    6 	.word bye 
      001EC2                       5387 	_dict_entry,5,WORDS,words 
      001EC2 1E BC                    1 	.word LINK 
                           001EC4     2 	LINK=.
      001EC4                          3 WORDS:
      001EC4 05                       4 	.byte 5 	
      001EC5 57 4F 52 44 53           5 	.ascii "WORDS"
      001ECA 1E 80                    6 	.word words 
      001ECC                       5388 	_dict_entry,5,SLEEP,sleep 
      001ECC 1E C4                    1 	.word LINK 
                           001ECE     2 	LINK=.
      001ECE                          3 SLEEP:
      001ECE 05                       4 	.byte 5 	
      001ECF 53 4C 45 45 50           5 	.ascii "SLEEP"
      001ED4 1D C8                    6 	.word sleep 
      001ED6                       5389 	_dict_entry,6,FORGET,forget 
      001ED6 1E CE                    1 	.word LINK 
                           001ED8     2 	LINK=.
      001ED8                          3 FORGET:
      001ED8 06                       4 	.byte 6 	
      001ED9 46 4F 52 47 45 54        5 	.ascii "FORGET"
      001EDF 1B C2                    6 	.word forget 
      001EE1                       5390 	_dict_entry,3,DIR,directory 
      001EE1 1E D8                    1 	.word LINK 
                           001EE3     2 	LINK=.
      001EE3                          3 DIR:
      001EE3 03                       4 	.byte 3 	
      001EE4 44 49 52                 5 	.ascii "DIR"
      001EE7 1C 11                    6 	.word directory 
      001EE9                       5391 	_dict_entry,4,LOAD,load 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 104.
Hexadecimal [24-Bits]



      001EE9 1E E3                    1 	.word LINK 
                           001EEB     2 	LINK=.
      001EEB                          3 LOAD:
      001EEB 04                       4 	.byte 4 	
      001EEC 4C 4F 41 44              5 	.ascii "LOAD"
      001EF0 1B 65                    6 	.word load 
      001EF2                       5392 	_dict_entry,4,SAVE,save
      001EF2 1E EB                    1 	.word LINK 
                           001EF4     2 	LINK=.
      001EF4                          3 SAVE:
      001EF4 04                       4 	.byte 4 	
      001EF5 53 41 56 45              5 	.ascii "SAVE"
      001EF9 1A C8                    6 	.word save 
      001EFB                       5393 	_dict_entry,5,WRITE,write  
      001EFB 1E F4                    1 	.word LINK 
                           001EFD     2 	LINK=.
      001EFD                          3 WRITE:
      001EFD 05                       4 	.byte 5 	
      001EFE 57 52 49 54 45           5 	.ascii "WRITE"
      001F03 1C A6                    6 	.word write 
      001F05                       5394 	_dict_entry,3,NEW,new
      001F05 1E FD                    1 	.word LINK 
                           001F07     2 	LINK=.
      001F07                          3 NEW:
      001F07 03                       4 	.byte 3 	
      001F08 4E 45 57                 5 	.ascii "NEW"
      001F0B 19 DC                    6 	.word new 
      001F0D                       5395 	_dict_entry,5,BREAK,break 
      001F0D 1F 07                    1 	.word LINK 
                           001F0F     2 	LINK=.
      001F0F                          3 BREAK:
      001F0F 05                       4 	.byte 5 	
      001F10 42 52 45 41 4B           5 	.ascii "BREAK"
      001F15 19 8D                    6 	.word break 
      001F17                       5396 	_dict_entry,4,BEEP,beep 
      001F17 1F 0F                    1 	.word LINK 
                           001F19     2 	LINK=.
      001F19                          3 BEEP:
      001F19 04                       4 	.byte 4 	
      001F1A 42 45 45 50              5 	.ascii "BEEP"
      001F1E 18 F7                    6 	.word beep 
      001F20                       5397 	_dict_entry,4,STOP,stop 
      001F20 1F 19                    1 	.word LINK 
                           001F22     2 	LINK=.
      001F22                          3 STOP:
      001F22 04                       4 	.byte 4 	
      001F23 53 54 4F 50              5 	.ascii "STOP"
      001F27 18 E8                    6 	.word stop 
      001F29                       5398     _dict_entry,4,SHOW,show 
      001F29 1F 22                    1 	.word LINK 
                           001F2B     2 	LINK=.
      001F2B                          3 SHOW:
      001F2B 04                       4 	.byte 4 	
      001F2C 53 48 4F 57              5 	.ascii "SHOW"
      001F30 13 3F                    6 	.word show 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 105.
Hexadecimal [24-Bits]



      001F32                       5399 	_dict_entry 3,RUN,run
      001F32 1F 2B                    1 	.word LINK 
                           001F34     2 	LINK=.
      001F34                          3 RUN:
      001F34 03                       4 	.byte 3 	
      001F35 52 55 4E                 5 	.ascii "RUN"
      001F38 18 A1                    6 	.word run 
      001F3A                       5400 	_dict_entry 4,LIST,list
      001F3A 1F 34                    1 	.word LINK 
                           001F3C     2 	LINK=.
      001F3C                          3 LIST:
      001F3C 04                       4 	.byte 4 	
      001F3D 4C 49 53 54              5 	.ascii "LIST"
      001F41 13 99                    6 	.word list 
      001F43                       5401 	_dict_entry,3+FFUNC,USR,usr
      001F43 1F 3C                    1 	.word LINK 
                           001F45     2 	LINK=.
      001F45                          3 USR:
      001F45 83                       4 	.byte 3+FFUNC 	
      001F46 55 53 52                 5 	.ascii "USR"
      001F49 1D 97                    6 	.word usr 
      001F4B                       5402 	_dict_entry,6+FFUNC,EEPROM,eeprom 
      001F4B 1F 45                    1 	.word LINK 
                           001F4D     2 	LINK=.
      001F4D                          3 EEPROM:
      001F4D 86                       4 	.byte 6+FFUNC 	
      001F4E 45 45 50 52 4F 4D        5 	.ascii "EEPROM"
      001F54 1D 91                    6 	.word eeprom 
      001F56                       5403 	_dict_entry,6+FFUNC,UFLASH,uflash 
      001F56 1F 4D                    1 	.word LINK 
                           001F58     2 	LINK=.
      001F58                          3 UFLASH:
      001F58 86                       4 	.byte 6+FFUNC 	
      001F59 55 46 4C 41 53 48        5 	.ascii "UFLASH"
      001F5F 1D 8B                    6 	.word uflash 
      001F61                       5404 	_dict_entry,3+FFUNC,ODR,port_odr
      001F61 1F 58                    1 	.word LINK 
                           001F63     2 	LINK=.
      001F63                          3 ODR:
      001F63 83                       4 	.byte 3+FFUNC 	
      001F64 4F 44 52                 5 	.ascii "ODR"
      001F67 1D 6D                    6 	.word port_odr 
      001F69                       5405 	_dict_entry,3+FFUNC,IDR,port_idr
      001F69 1F 63                    1 	.word LINK 
                           001F6B     2 	LINK=.
      001F6B                          3 IDR:
      001F6B 83                       4 	.byte 3+FFUNC 	
      001F6C 49 44 52                 5 	.ascii "IDR"
      001F6F 1D 73                    6 	.word port_idr 
      001F71                       5406 	_dict_entry,3+FFUNC,DDR,port_ddr 
      001F71 1F 6B                    1 	.word LINK 
                           001F73     2 	LINK=.
      001F73                          3 DDR:
      001F73 83                       4 	.byte 3+FFUNC 	
      001F74 44 44 52                 5 	.ascii "DDR"
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 106.
Hexadecimal [24-Bits]



      001F77 1D 79                    6 	.word port_ddr 
      001F79                       5407 	_dict_entry,3+FFUNC,CRL,port_cr1 
      001F79 1F 73                    1 	.word LINK 
                           001F7B     2 	LINK=.
      001F7B                          3 CRL:
      001F7B 83                       4 	.byte 3+FFUNC 	
      001F7C 43 52 4C                 5 	.ascii "CRL"
      001F7F 1D 7F                    6 	.word port_cr1 
      001F81                       5408 	_dict_entry,3+FFUNC,CRH,port_cr2
      001F81 1F 7B                    1 	.word LINK 
                           001F83     2 	LINK=.
      001F83                          3 CRH:
      001F83 83                       4 	.byte 3+FFUNC 	
      001F84 43 52 48                 5 	.ascii "CRH"
      001F87 1D 85                    6 	.word port_cr2 
      001F89                       5409 	_dict_entry,4+FFUNC,GPIO,gpio 
      001F89 1F 83                    1 	.word LINK 
                           001F8B     2 	LINK=.
      001F8B                          3 GPIO:
      001F8B 84                       4 	.byte 4+FFUNC 	
      001F8C 47 50 49 4F              5 	.ascii "GPIO"
      001F90 1D 30                    6 	.word gpio 
      001F92                       5410 	_dict_entry,6,PWRADC,power_adc 
      001F92 1F 8B                    1 	.word LINK 
                           001F94     2 	LINK=.
      001F94                          3 PWRADC:
      001F94 06                       4 	.byte 6 	
      001F95 50 57 52 41 44 43        5 	.ascii "PWRADC"
      001F9B 19 1F                    6 	.word power_adc 
      001F9D                       5411 	_dict_entry,5+FFUNC,RDADC,read_adc
      001F9D 1F 94                    1 	.word LINK 
                           001F9F     2 	LINK=.
      001F9F                          3 RDADC:
      001F9F 85                       4 	.byte 5+FFUNC 	
      001FA0 52 44 41 44 43           5 	.ascii "RDADC"
      001FA5 19 5A                    6 	.word read_adc 
      001FA7                       5412 	_dict_entry,3+FFUNC,ASC,ascii  
      001FA7 1F 9F                    1 	.word LINK 
                           001FA9     2 	LINK=.
      001FA9                          3 ASC:
      001FA9 83                       4 	.byte 3+FFUNC 	
      001FAA 41 53 43                 5 	.ascii "ASC"
      001FAD 1C FA                    6 	.word ascii 
      001FAF                       5413 	_dict_entry,4+FFUNC,CHAR,char
      001FAF 1F A9                    1 	.word LINK 
                           001FB1     2 	LINK=.
      001FB1                          3 CHAR:
      001FB1 84                       4 	.byte 4+FFUNC 	
      001FB2 43 48 41 52              5 	.ascii "CHAR"
      001FB6 1C DD                    6 	.word char 
      001FB8                       5414 	_dict_entry,4+FFUNC,QKEY,qkey  
      001FB8 1F B1                    1 	.word LINK 
                           001FBA     2 	LINK=.
      001FBA                          3 QKEY:
      001FBA 84                       4 	.byte 4+FFUNC 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 107.
Hexadecimal [24-Bits]



      001FBB 51 4B 45 59              5 	.ascii "QKEY"
      001FBF 1D 26                    6 	.word qkey 
      001FC1                       5415 	_dict_entry,3+FFUNC,KEY,key 
      001FC1 1F BA                    1 	.word LINK 
                           001FC3     2 	LINK=.
      001FC3                          3 KEY:
      001FC3 83                       4 	.byte 3+FFUNC 	
      001FC4 4B 45 59                 5 	.ascii "KEY"
      001FC7 1D 1E                    6 	.word key 
      001FC9                       5416 	_dict_entry,4+FFUNC,SIZE,size
      001FC9 1F C3                    1 	.word LINK 
                           001FCB     2 	LINK=.
      001FCB                          3 SIZE:
      001FCB 84                       4 	.byte 4+FFUNC 	
      001FCC 53 49 5A 45              5 	.ascii "SIZE"
      001FD0 13 59                    6 	.word size 
      001FD2                       5417 	_dict_entry,3,HEX,hex_base
      001FD2 1F CB                    1 	.word LINK 
                           001FD4     2 	LINK=.
      001FD4                          3 HEX:
      001FD4 03                       4 	.byte 3 	
      001FD5 48 45 58                 5 	.ascii "HEX"
      001FD8 13 4F                    6 	.word hex_base 
      001FDA                       5418 	_dict_entry,3,DEC,dec_base
      001FDA 1F D4                    1 	.word LINK 
                           001FDC     2 	LINK=.
      001FDC                          3 DEC:
      001FDC 03                       4 	.byte 3 	
      001FDD 44 45 43                 5 	.ascii "DEC"
      001FE0 13 54                    6 	.word dec_base 
      001FE2                       5419 	_dict_entry,5+FFUNC,TICKS,get_ticks
      001FE2 1F DC                    1 	.word LINK 
                           001FE4     2 	LINK=.
      001FE4                          3 TICKS:
      001FE4 85                       4 	.byte 5+FFUNC 	
      001FE5 54 49 43 4B 53           5 	.ascii "TICKS"
      001FEA 1D E6                    6 	.word get_ticks 
      001FEC                       5420 	_dict_entry,3+FFUNC,ABS,abs
      001FEC 1F E4                    1 	.word LINK 
                           001FEE     2 	LINK=.
      001FEE                          3 ABS:
      001FEE 83                       4 	.byte 3+FFUNC 	
      001FEF 41 42 53                 5 	.ascii "ABS"
      001FF2 1D EC                    6 	.word abs 
      001FF4                       5421 	_dict_entry,3+FFUNC,RND,random 
      001FF4 1F EE                    1 	.word LINK 
                           001FF6     2 	LINK=.
      001FF6                          3 RND:
      001FF6 83                       4 	.byte 3+FFUNC 	
      001FF7 52 4E 44                 5 	.ascii "RND"
      001FFA 1E 0C                    6 	.word random 
      001FFC                       5422 	_dict_entry,5,PAUSE,pause 
      001FFC 1F F6                    1 	.word LINK 
                           001FFE     2 	LINK=.
      001FFE                          3 PAUSE:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 108.
Hexadecimal [24-Bits]



      001FFE 05                       4 	.byte 5 	
      001FFF 50 41 55 53 45           5 	.ascii "PAUSE"
      002004 1D D3                    6 	.word pause 
      002006                       5423 	_dict_entry,4,BSET,bit_set 
      002006 1F FE                    1 	.word LINK 
                           002008     2 	LINK=.
      002008                          3 BSET:
      002008 04                       4 	.byte 4 	
      002009 42 53 45 54              5 	.ascii "BSET"
      00200D 16 AF                    6 	.word bit_set 
      00200F                       5424 	_dict_entry,4,BRES,bit_reset
      00200F 20 08                    1 	.word LINK 
                           002011     2 	LINK=.
      002011                          3 BRES:
      002011 04                       4 	.byte 4 	
      002012 42 52 45 53              5 	.ascii "BRES"
      002016 16 C3                    6 	.word bit_reset 
      002018                       5425 	_dict_entry,5,BTOGL,bit_toggle
      002018 20 11                    1 	.word LINK 
                           00201A     2 	LINK=.
      00201A                          3 BTOGL:
      00201A 05                       4 	.byte 5 	
      00201B 42 54 4F 47 4C           5 	.ascii "BTOGL"
      002020 16 D8                    6 	.word bit_toggle 
      002022                       5426 	_dict_entry 4,WAIT,wait 
      002022 20 1A                    1 	.word LINK 
                           002024     2 	LINK=.
      002024                          3 WAIT:
      002024 04                       4 	.byte 4 	
      002025 57 41 49 54              5 	.ascii "WAIT"
      002029 16 84                    6 	.word wait 
      00202B                       5427 	_dict_entry 6,REMARK,rem 
      00202B 20 24                    1 	.word LINK 
                           00202D     2 	LINK=.
      00202D                          3 REMARK:
      00202D 06                       4 	.byte 6 	
      00202E 52 45 4D 41 52 4B        5 	.ascii "REMARK"
      002034 16 83                    6 	.word rem 
      002036                       5428 	_dict_entry 5,PRINT,print 
      002036 20 2D                    1 	.word LINK 
                           002038     2 	LINK=.
      002038                          3 PRINT:
      002038 05                       4 	.byte 5 	
      002039 50 52 49 4E 54           5 	.ascii "PRINT"
      00203E 15 75                    6 	.word print 
      002040                       5429 	_dict_entry,2,IF,if 
      002040 20 38                    1 	.word LINK 
                           002042     2 	LINK=.
      002042                          3 IF:
      002042 02                       4 	.byte 2 	
      002043 49 46                    5 	.ascii "IF"
      002045 17 1C                    6 	.word if 
      002047                       5430 	_dict_entry,5,GOSUB,gosub 
      002047 20 42                    1 	.word LINK 
                           002049     2 	LINK=.
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 109.
Hexadecimal [24-Bits]



      002049                          3 GOSUB:
      002049 05                       4 	.byte 5 	
      00204A 47 4F 53 55 42           5 	.ascii "GOSUB"
      00204F 18 32                    6 	.word gosub 
      002051                       5431 	_dict_entry,4,GOTO,goto 
      002051 20 49                    1 	.word LINK 
                           002053     2 	LINK=.
      002053                          3 GOTO:
      002053 04                       4 	.byte 4 	
      002054 47 4F 54 4F              5 	.ascii "GOTO"
      002058 18 25                    6 	.word goto 
      00205A                       5432 	_dict_entry,3,FOR,for 
      00205A 20 53                    1 	.word LINK 
                           00205C     2 	LINK=.
      00205C                          3 FOR:
      00205C 03                       4 	.byte 3 	
      00205D 46 4F 52                 5 	.ascii "FOR"
      002060 17 30                    6 	.word for 
      002062                       5433 	_dict_entry,2,TO,to
      002062 20 5C                    1 	.word LINK 
                           002064     2 	LINK=.
      002064                          3 TO:
      002064 02                       4 	.byte 2 	
      002065 54 4F                    5 	.ascii "TO"
      002067 17 5A                    6 	.word to 
      002069                       5434 	_dict_entry,4,STEP,step 
      002069 20 64                    1 	.word LINK 
                           00206B     2 	LINK=.
      00206B                          3 STEP:
      00206B 04                       4 	.byte 4 	
      00206C 53 54 45 50              5 	.ascii "STEP"
      002070 17 8A                    6 	.word step 
      002072                       5435 	_dict_entry,4,NEXT,next 
      002072 20 6B                    1 	.word LINK 
                           002074     2 	LINK=.
      002074                          3 NEXT:
      002074 04                       4 	.byte 4 	
      002075 4E 45 58 54              5 	.ascii "NEXT"
      002079 17 B2                    6 	.word next 
      00207B                       5436 	_dict_entry,6+FFUNC,UBOUND,ubound 
      00207B 20 74                    1 	.word LINK 
                           00207D     2 	LINK=.
      00207D                          3 UBOUND:
      00207D 86                       4 	.byte 6+FFUNC 	
      00207E 55 42 4F 55 4E 44        5 	.ascii "UBOUND"
      002084 13 63                    6 	.word ubound 
      002086                       5437 	_dict_entry,6,RETURN,return 
      002086 20 7D                    1 	.word LINK 
                           002088     2 	LINK=.
      002088                          3 RETURN:
      002088 06                       4 	.byte 6 	
      002089 52 45 54 55 52 4E        5 	.ascii "RETURN"
      00208F 18 7D                    6 	.word return 
      002091                       5438 	_dict_entry,4+FFUNC,PEEK,peek 
      002091 20 88                    1 	.word LINK 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 110.
Hexadecimal [24-Bits]



                           002093     2 	LINK=.
      002093                          3 PEEK:
      002093 84                       4 	.byte 4+FFUNC 	
      002094 50 45 45 4B              5 	.ascii "PEEK"
      002098 16 FF                    6 	.word peek 
      00209A                       5439 	_dict_entry,4,POKE,poke 
      00209A 20 93                    1 	.word LINK 
                           00209C     2 	LINK=.
      00209C                          3 POKE:
      00209C 04                       4 	.byte 4 	
      00209D 50 4F 4B 45              5 	.ascii "POKE"
      0020A1 16 EC                    6 	.word poke 
      0020A3                       5440 	_dict_entry,5,INPUT,input_var  
      0020A3 20 9C                    1 	.word LINK 
                           0020A5     2 	LINK=.
      0020A5                          3 INPUT:
      0020A5 05                       4 	.byte 5 	
      0020A6 49 4E 50 55 54           5 	.ascii "INPUT"
      0020AB 16 0F                    6 	.word input_var 
      0020AD                       5441 kword_dict:
      0020AD                       5442 	_dict_entry 3,LET,let 
      0020AD 20 A5                    1 	.word LINK 
                           0020AF     2 	LINK=.
      0020AF                          3 LET:
      0020AF 03                       4 	.byte 3 	
      0020B0 4C 45 54                 5 	.ascii "LET"
      0020B3 13 71                    6 	.word let 
                                   5443 	
                                   5444 
      002100                       5445 	.bndry 128 ; align on FLASH block.
                                   5446 ; free space for user application  
      002100                       5447 user_space:
                                   5448 ; USR() function test
      002100 89               [ 2] 5449 	pushw x 
      002101 72 1A 50 0A      [ 1] 5450 	bset PC_ODR,#5 
      002105 85               [ 2] 5451 	popw x 
      002106 CD 1D DD         [ 4] 5452 	call pause02 
      002109 72 1B 50 0A      [ 1] 5453 	bres PC_ODR,#5 
      00210D 81               [ 4] 5454 	ret
                                   5455 
                                   5456 	.area FLASH_DRIVE (ABS)
      010000                       5457 	.org 0x10000
      010000                       5458 fdrive:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 111.
Hexadecimal [24-Bits]

Symbol Table

    .__.$$$.=  002710 L   |     .__.ABS.=  000000 G   |     .__.CPU.=  000000 L
    .__.H$L.=  000001 L   |   5 ABS        001FEE R   |     ADC_CR1 =  005401 
    ADC_CR1_=  000000     |     ADC_CR1_=  000001     |     ADC_CR1_=  000004 
    ADC_CR1_=  000005     |     ADC_CR1_=  000006     |     ADC_CR2 =  005402 
    ADC_CR2_=  000003     |     ADC_CR2_=  000004     |     ADC_CR2_=  000005 
    ADC_CR2_=  000006     |     ADC_CR2_=  000001     |     ADC_CR3 =  005403 
    ADC_CR3_=  000007     |     ADC_CR3_=  000006     |     ADC_CSR =  005400 
    ADC_CSR_=  000006     |     ADC_CSR_=  000004     |     ADC_CSR_=  000000 
    ADC_CSR_=  000001     |     ADC_CSR_=  000002     |     ADC_CSR_=  000003 
    ADC_CSR_=  000007     |     ADC_CSR_=  000005     |     ADC_DRH =  005404 
    ADC_DRL =  005405     |     ADC_TDRH=  005406     |     ADC_TDRL=  005407 
    ADDR    =  000001     |     ADD_SPAC=  000003     |     AFR     =  004803 
    AFR0_ADC=  000000     |     AFR1_TIM=  000001     |     AFR2_CCO=  000002 
    AFR3_TIM=  000003     |     AFR4_TIM=  000004     |     AFR5_TIM=  000005 
    AFR6_I2C=  000006     |     AFR7_BEE=  000007     |     ARG_CNT =  000001 
    ARG_OFS =  000002     |   5 ASC        001FA9 R   |     ATTRIB  =  000002 
    AWU_APR =  0050F1     |     AWU_CSR1=  0050F0     |     AWU_TBR =  0050F2 
    B0_MASK =  000001     |     B115200 =  000006     |     B19200  =  000003 
    B1_MASK =  000002     |     B230400 =  000007     |     B2400   =  000000 
    B2_MASK =  000004     |     B38400  =  000004     |     B3_MASK =  000008 
    B460800 =  000008     |     B4800   =  000001     |     B4_MASK =  000010 
    B57600  =  000005     |     B5_MASK =  000020     |     B6_MASK =  000040 
    B7_MASK =  000080     |     B921600 =  000009     |     B9600   =  000002 
    BASE    =  000002     |     BASE_SAV=  000001     |   5 BEEP       001F19 R
    BEEP_BIT=  000004     |     BEEP_CSR=  0050F3     |     BEEP_MAS=  000010 
    BEEP_POR=  00000F     |     BELL    =  000007     |     BINARY  =  000001 
    BIT0    =  000000     |     BIT1    =  000001     |     BIT2    =  000002 
    BIT3    =  000003     |     BIT4    =  000004     |     BIT5    =  000005 
    BIT6    =  000006     |     BIT7    =  000007     |     BLOCK_ER=  000000 
    BLOCK_SI=  000080     |     BOOT_ROM=  006000     |     BOOT_ROM=  007FFF 
    BPTR    =  000005     |   5 BREAK      001F0F R   |   5 BRES       002011 R
  5 BSET       002008 R   |     BSIZE   =  000005     |     BSP     =  000008 
  5 BTOGL      00201A R   |     BTW     =  000001     |     BUFIDX  =  000003 
  5 BYE        001EBC R   |     C       =  000001     |     CAN_DGR =  005426 
    CAN_FPSR=  005427     |     CAN_IER =  005425     |     CAN_MCR =  005420 
    CAN_MSR =  005421     |     CAN_P0  =  005428     |     CAN_P1  =  005429 
    CAN_P2  =  00542A     |     CAN_P3  =  00542B     |     CAN_P4  =  00542C 
    CAN_P5  =  00542D     |     CAN_P6  =  00542E     |     CAN_P7  =  00542F 
    CAN_P8  =  005430     |     CAN_P9  =  005431     |     CAN_PA  =  005432 
    CAN_PB  =  005433     |     CAN_PC  =  005434     |     CAN_PD  =  005435 
    CAN_PE  =  005436     |     CAN_PF  =  005437     |     CAN_RFR =  005424 
    CAN_TPR =  005423     |     CAN_TSR =  005422     |     CC_C    =  000000 
    CC_H    =  000004     |     CC_I0   =  000003     |     CC_I1   =  000005 
    CC_N    =  000002     |     CC_V    =  000007     |     CC_Z    =  000001 
    CELL_SIZ=  000002     |     CFG_GCR =  007F60     |     CFG_GCR_=  000001 
    CFG_GCR_=  000000     |   5 CHAR       001FB1 R   |     CLKOPT  =  004807 
    CLKOPT_C=  000002     |     CLKOPT_E=  000003     |     CLKOPT_P=  000000 
    CLKOPT_P=  000001     |     CLK_CCOR=  0050C9     |     CLK_CKDI=  0050C6 
    CLK_CKDI=  000000     |     CLK_CKDI=  000001     |     CLK_CKDI=  000002 
    CLK_CKDI=  000003     |     CLK_CKDI=  000004     |     CLK_CMSR=  0050C3 
    CLK_CSSR=  0050C8     |     CLK_ECKR=  0050C1     |     CLK_ECKR=  000000 
    CLK_ECKR=  000001     |     CLK_HSIT=  0050CC     |     CLK_ICKR=  0050C0 
    CLK_ICKR=  000002     |     CLK_ICKR=  000000     |     CLK_ICKR=  000001 
    CLK_ICKR=  000003     |     CLK_ICKR=  000004     |     CLK_ICKR=  000005 
    CLK_PCKE=  0050C7     |     CLK_PCKE=  000000     |     CLK_PCKE=  000001 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 112.
Hexadecimal [24-Bits]

Symbol Table

    CLK_PCKE=  000007     |     CLK_PCKE=  000005     |     CLK_PCKE=  000006 
    CLK_PCKE=  000004     |     CLK_PCKE=  000002     |     CLK_PCKE=  000003 
    CLK_PCKE=  0050CA     |     CLK_PCKE=  000003     |     CLK_PCKE=  000002 
    CLK_PCKE=  000007     |     CLK_SWCR=  0050C5     |     CLK_SWCR=  000000 
    CLK_SWCR=  000001     |     CLK_SWCR=  000002     |     CLK_SWCR=  000003 
    CLK_SWIM=  0050CD     |     CLK_SWR =  0050C4     |     CLK_SWR_=  0000B4 
    CLK_SWR_=  0000E1     |     CLK_SWR_=  0000D2     |     CMD_END =  000002 
    CNT     =  000008     |     COMMA   =  000001     |     COUNT   =  000001 
    CPU_A   =  007F00     |     CPU_CCR =  007F0A     |     CPU_PCE =  007F01 
    CPU_PCH =  007F02     |     CPU_PCL =  007F03     |     CPU_SPH =  007F08 
    CPU_SPL =  007F09     |     CPU_XH  =  007F04     |     CPU_XL  =  007F05 
    CPU_YH  =  007F06     |     CPU_YL  =  007F07     |     CR      =  00000D 
  5 CRH        001F83 R   |   5 CRL        001F7B R   |     CTRL_A  =  000001 
    CTRL_B  =  000002     |     CTRL_C  =  000003     |     CTRL_D  =  000004 
    CTRL_E  =  000005     |     CTRL_F  =  000006     |     CTRL_G  =  000007 
    CTRL_H  =  000008     |     CTRL_I  =  000009     |     CTRL_J  =  00000A 
    CTRL_K  =  00000B     |     CTRL_L  =  00000C     |     CTRL_M  =  00000D 
    CTRL_N  =  00000E     |     CTRL_O  =  00000F     |     CTRL_P  =  000010 
    CTRL_Q  =  000011     |     CTRL_R  =  000012     |     CTRL_S  =  000013 
    CTRL_T  =  000014     |     CTRL_U  =  000015     |     CTRL_V  =  000016 
    CTRL_W  =  000017     |     CTRL_X  =  000018     |     CTRL_Y  =  000019 
    CTRL_Z  =  00001A     |     CTXT_SIZ=  000006     |     CURR    =  000002 
    CX_BPTR =  000001     |     CX_CNT  =  000005     |     CX_IN   =  000004 
    CX_LNO  =  000003     |     DBG_A   =  000005     |     DBG_CC  =  000006 
    DBG_X   =  000003     |     DBG_Y   =  000001     |   5 DDR        001F73 R
    DEBUG   =  000001     |     DEBUG_BA=  007F00     |     DEBUG_EN=  007FFF 
  5 DEC        001FDC R   |     DEST    =  000001     |     DEVID_BA=  0048CD 
    DEVID_EN=  0048D8     |     DEVID_LO=  0048D2     |     DEVID_LO=  0048D3 
    DEVID_LO=  0048D4     |     DEVID_LO=  0048D5     |     DEVID_LO=  0048D6 
    DEVID_LO=  0048D7     |     DEVID_LO=  0048D8     |     DEVID_WA=  0048D1 
    DEVID_XH=  0048CE     |     DEVID_XL=  0048CD     |     DEVID_YH=  0048D0 
    DEVID_YL=  0048CF     |   5 DIR        001EE3 R   |     DIVIDND =  000007 
    DIVISR  =  000005     |     DM_BK1RE=  007F90     |     DM_BK1RH=  007F91 
    DM_BK1RL=  007F92     |     DM_BK2RE=  007F93     |     DM_BK2RH=  007F94 
    DM_BK2RL=  007F95     |     DM_CR1  =  007F96     |     DM_CR2  =  007F97 
    DM_CSR1 =  007F98     |     DM_CSR2 =  007F99     |     DM_ENFCT=  007F9A 
    DSTACK_S=  000040     |   5 EEPROM     001F4D R   |     EEPROM_B=  004000 
    EEPROM_E=  0047FF     |     EEPROM_S=  000800     |     ERR_BAD_=  00000A 
    ERR_CMD_=  000007     |     ERR_DIV0=  000004     |     ERR_DUPL=  000008 
    ERR_MATH=  000003     |     ERR_MEM_=  000001     |     ERR_NONE=  000000 
    ERR_NOT_=  000009     |     ERR_NO_A=  00000B     |     ERR_NO_L=  000005 
    ERR_RUN_=  000006     |     ERR_SYNT=  000002     |     ESC     =  00001B 
    EXTI_CR1=  0050A0     |     EXTI_CR2=  0050A1     |     FBREAK  =  000004 
    FCOMP   =  000005     |     FF      =  00000C     |     FFOR    =  000002 
    FFUNC   =  000080     |     FHSE    =  7A1200     |     FHSI    =  F42400 
    FIRST   =  000001     |     FLASH_BA=  008000     |     FLASH_CR=  00505A 
    FLASH_CR=  000002     |     FLASH_CR=  000000     |     FLASH_CR=  000003 
    FLASH_CR=  000001     |     FLASH_CR=  00505B     |     FLASH_CR=  000005 
    FLASH_CR=  000004     |     FLASH_CR=  000007     |     FLASH_CR=  000000 
    FLASH_CR=  000006     |     FLASH_DU=  005064     |     FLASH_DU=  0000AE 
    FLASH_DU=  000056     |     FLASH_EN=  027FFF     |     FLASH_FP=  00505D 
    FLASH_FP=  000000     |     FLASH_FP=  000001     |     FLASH_FP=  000002 
    FLASH_FP=  000003     |     FLASH_FP=  000004     |     FLASH_FP=  000005 
    FLASH_IA=  00505F     |     FLASH_IA=  000003     |     FLASH_IA=  000002 
    FLASH_IA=  000006     |     FLASH_IA=  000001     |     FLASH_IA=  000000 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 113.
Hexadecimal [24-Bits]

Symbol Table

    FLASH_NC=  00505C     |     FLASH_NF=  00505E     |     FLASH_NF=  000000 
    FLASH_NF=  000001     |     FLASH_NF=  000002     |     FLASH_NF=  000003 
    FLASH_NF=  000004     |     FLASH_NF=  000005     |     FLASH_PU=  005062 
    FLASH_PU=  000056     |     FLASH_PU=  0000AE     |     FLASH_SI=  020000 
    FLASH_WS=  00480D     |     FLSI    =  01F400     |   5 FOR        00205C R
  5 FORGET     001ED8 R   |     FRUN    =  000000     |     FSIZE   =  000001 
    FSLEEP  =  000003     |     FTRAP   =  000001     |   5 GOSUB      002049 R
    GOS_RET =  000003     |   5 GOTO       002053 R   |   5 GPIO       001F8B R
    GPIO_BAS=  005000     |     GPIO_CR1=  000003     |     GPIO_CR2=  000004 
    GPIO_DDR=  000002     |     GPIO_IDR=  000001     |     GPIO_ODR=  000000 
    GPIO_SIZ=  000005     |   5 HEX        001FD4 R   |     HSECNT  =  004809 
    I2C_CCRH=  00521C     |     I2C_CCRH=  000080     |     I2C_CCRH=  0000C0 
    I2C_CCRH=  000080     |     I2C_CCRH=  000000     |     I2C_CCRH=  000001 
    I2C_CCRH=  000000     |     I2C_CCRL=  00521B     |     I2C_CCRL=  00001A 
    I2C_CCRL=  000002     |     I2C_CCRL=  00000D     |     I2C_CCRL=  000050 
    I2C_CCRL=  000090     |     I2C_CCRL=  0000A0     |     I2C_CR1 =  005210 
    I2C_CR1_=  000006     |     I2C_CR1_=  000007     |     I2C_CR1_=  000000 
    I2C_CR2 =  005211     |     I2C_CR2_=  000002     |     I2C_CR2_=  000003 
    I2C_CR2_=  000000     |     I2C_CR2_=  000001     |     I2C_CR2_=  000007 
    I2C_DR  =  005216     |     I2C_FREQ=  005212     |     I2C_ITR =  00521A 
    I2C_ITR_=  000002     |     I2C_ITR_=  000000     |     I2C_ITR_=  000001 
    I2C_OARH=  005214     |     I2C_OARH=  000001     |     I2C_OARH=  000002 
    I2C_OARH=  000006     |     I2C_OARH=  000007     |     I2C_OARL=  005213 
    I2C_OARL=  000000     |     I2C_OAR_=  000813     |     I2C_OAR_=  000009 
    I2C_PECR=  00521E     |     I2C_READ=  000001     |     I2C_SR1 =  005217 
    I2C_SR1_=  000003     |     I2C_SR1_=  000001     |     I2C_SR1_=  000002 
    I2C_SR1_=  000006     |     I2C_SR1_=  000000     |     I2C_SR1_=  000004 
    I2C_SR1_=  000007     |     I2C_SR2 =  005218     |     I2C_SR2_=  000002 
    I2C_SR2_=  000001     |     I2C_SR2_=  000000     |     I2C_SR2_=  000003 
    I2C_SR2_=  000005     |     I2C_SR3 =  005219     |     I2C_SR3_=  000001 
    I2C_SR3_=  000007     |     I2C_SR3_=  000004     |     I2C_SR3_=  000000 
    I2C_SR3_=  000002     |     I2C_TRIS=  00521D     |     I2C_TRIS=  000005 
    I2C_TRIS=  000005     |     I2C_TRIS=  000005     |     I2C_TRIS=  000011 
    I2C_TRIS=  000011     |     I2C_TRIS=  000011     |     I2C_WRIT=  000000 
  5 IDR        001F6B R   |   5 IF         002042 R   |     IN      =  000007 
    INCR    =  000001     |   5 INPUT      0020A5 R   |     INPUT_DI=  000000 
    INPUT_EI=  000001     |     INPUT_FL=  000000     |     INPUT_PU=  000001 
    INT_ADC2=  000016     |     INT_AUAR=  000012     |     INT_AWU =  000001 
    INT_CAN_=  000008     |     INT_CAN_=  000009     |     INT_CLK =  000002 
    INT_EXTI=  000003     |     INT_EXTI=  000004     |     INT_EXTI=  000005 
    INT_EXTI=  000006     |     INT_EXTI=  000007     |     INT_FLAS=  000018 
    INT_I2C =  000013     |     INT_SPI =  00000A     |     INT_TIM1=  00000C 
    INT_TIM1=  00000B     |     INT_TIM2=  00000E     |     INT_TIM2=  00000D 
    INT_TIM3=  000010     |     INT_TIM3=  00000F     |     INT_TIM4=  000017 
    INT_TLI =  000000     |     INT_UART=  000011     |     INT_UART=  000015 
    INT_UART=  000014     |     INT_VECT=  008060     |     INT_VECT=  00800C 
    INT_VECT=  008028     |     INT_VECT=  00802C     |     INT_VECT=  008010 
    INT_VECT=  008014     |     INT_VECT=  008018     |     INT_VECT=  00801C 
    INT_VECT=  008020     |     INT_VECT=  008024     |     INT_VECT=  008068 
    INT_VECT=  008054     |     INT_VECT=  008000     |     INT_VECT=  008030 
    INT_VECT=  008038     |     INT_VECT=  008034     |     INT_VECT=  008040 
    INT_VECT=  00803C     |     INT_VECT=  008048     |     INT_VECT=  008044 
    INT_VECT=  008064     |     INT_VECT=  008008     |     INT_VECT=  008004 
    INT_VECT=  008050     |     INT_VECT=  00804C     |     INT_VECT=  00805C 
    INT_VECT=  008058     |     INW     =  000003     |     ITC_SPR1=  007F70 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 114.
Hexadecimal [24-Bits]

Symbol Table

    ITC_SPR2=  007F71     |     ITC_SPR3=  007F72     |     ITC_SPR4=  007F73 
    ITC_SPR5=  007F74     |     ITC_SPR6=  007F75     |     ITC_SPR7=  007F76 
    ITC_SPR8=  007F77     |     IWDG_KR =  0050E0     |     IWDG_PR =  0050E1 
    IWDG_RLR=  0050E2     |   5 KEY        001FC3 R   |     LAST    =  000003 
    LB      =  000002     |     LED2_BIT=  000005     |     LED2_MAS=  000020 
    LED2_POR=  00500A     |     LEN     =  000005     |   5 LET        0020AF R
    LINENO  =  000005     |   5 LINK    =  0020AF R   |   5 LIST       001F3C R
    LL      =  000002     |     LLEN    =  000002     |     LL_HB   =  000001 
    LNO     =  000005     |     LN_PTR  =  000005     |   5 LOAD       001EEB R
    MAJOR   =  000001     |     MASK    =  000002     |     MATH_OVF=  000000 
    MINOR   =  000000     |     MULOP   =  000005     |     N1      =  000001 
    N1_HB   =  000006     |     N1_LB   =  000007     |     N2      =  000003 
    N2_HB   =  000008     |     N2_LB   =  000009     |     NAFR    =  004804 
    NCLKOPT =  004808     |     NEG     =  000001     |   5 NEW        001F07 R
  5 NEXT       002074 R   |     NFLASH_W=  00480E     |     NHSECNT =  00480A 
    NL      =  00000A     |     NLEN    =  000001     |     NOPT1   =  004802 
    NOPT2   =  004804     |     NOPT3   =  004806     |     NOPT4   =  004808 
    NOPT5   =  00480A     |     NOPT6   =  00480C     |     NOPT7   =  00480E 
    NOPTBL  =  00487F     |     NUBC    =  004802     |     NWDGOPT =  004806 
    NWDGOPT_=  FFFFFFFD     |     NWDGOPT_=  FFFFFFFC     |     NWDGOPT_=  FFFFFFFF 
    NWDGOPT_=  FFFFFFFE     |   5 NonHandl   000009 R   |   5 ODR        001F63 R
    OP      =  000005     |     OPT     =  000002     |     OPT0    =  004800 
    OPT1    =  004801     |     OPT2    =  004803     |     OPT3    =  004805 
    OPT4    =  004807     |     OPT5    =  004809     |     OPT6    =  00480B 
    OPT7    =  00480D     |     OPTBL   =  00487E     |     OPTION_B=  004800 
    OPTION_E=  00487F     |     OPTION_S=  000080     |     OUTPUT_F=  000001 
    OUTPUT_O=  000000     |     OUTPUT_P=  000001     |     OUTPUT_S=  000000 
    OVFH    =  000001     |     OVFL    =  000002     |     PA      =  000000 
    PAD_SIZE=  000028     |   5 PAUSE      001FFE R   |     PA_BASE =  005000 
    PA_CR1  =  005003     |     PA_CR2  =  005004     |     PA_DDR  =  005002 
    PA_IDR  =  005001     |     PA_ODR  =  005000     |     PB      =  000005 
    PB_BASE =  005005     |     PB_CR1  =  005008     |     PB_CR2  =  005009 
    PB_DDR  =  005007     |     PB_IDR  =  005006     |     PB_ODR  =  005005 
    PC      =  00000A     |     PC_BASE =  00500A     |     PC_CR1  =  00500D 
    PC_CR2  =  00500E     |     PC_DDR  =  00500C     |     PC_IDR  =  00500B 
    PC_ODR  =  00500A     |     PD      =  00000F     |     PD_BASE =  00500F 
    PD_CR1  =  005012     |     PD_CR2  =  005013     |     PD_DDR  =  005011 
    PD_IDR  =  005010     |     PD_ODR  =  00500F     |     PE      =  000014 
  5 PEEK       002093 R   |     PE_BASE =  005014     |     PE_CR1  =  005017 
    PE_CR2  =  005018     |     PE_DDR  =  005016     |     PE_IDR  =  005015 
    PE_ODR  =  005014     |     PF      =  000019     |     PF_BASE =  005019 
    PF_CR1  =  00501C     |     PF_CR2  =  00501D     |     PF_DDR  =  00501B 
    PF_IDR  =  00501A     |     PF_ODR  =  005019     |     PG      =  00001E 
    PG_BASE =  00501E     |     PG_CR1  =  005021     |     PG_CR2  =  005022 
    PG_DDR  =  005020     |     PG_IDR  =  00501F     |     PG_ODR  =  00501E 
    PH      =  000023     |     PH_BASE =  005023     |     PH_CR1  =  005026 
    PH_CR2  =  005027     |     PH_DDR  =  005025     |     PH_IDR  =  005024 
    PH_ODR  =  005023     |     PI      =  000028     |     PI_BASE =  005028 
    PI_CR1  =  00502B     |     PI_CR2  =  00502C     |     PI_DDR  =  00502A 
    PI_IDR  =  005029     |     PI_ODR  =  005028     |   5 POKE       00209C R
    PREV    =  000001     |   5 PRINT      002038 R   |     PROD    =  000002 
    PSIZE   =  000001     |   5 PWRADC     001F94 R   |   5 QKEY       001FBA R
    RAM_BASE=  000000     |     RAM_END =  0017FF     |     RAM_SIZE=  001800 
  5 RDADC      001F9F R   |   5 REG_A      0008F9 R   |   5 REG_CC     0008FD R
  5 REG_EPC    0008EC R   |   5 REG_SP     000902 R   |   5 REG_X      0008F5 R
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 115.
Hexadecimal [24-Bits]

Symbol Table

  5 REG_Y      0008F1 R   |     RELOP   =  000005     |   5 REMARK     00202D R
    RETL1   =  000001     |   5 RETURN     002088 R   |   5 RND        001FF6 R
    ROP     =  004800     |     RST_SR  =  0050B3     |   5 RUN        001F34 R
    RXCHAR  =  000001     |     R_A     =  000007     |     R_CC    =  000008 
    R_X     =  000005     |     R_Y     =  000003     |   5 SAVE       001EF4 R
    SDIVD   =  000002     |     SFR_BASE=  005000     |     SFR_END =  0057FF 
    SHARP   =  000023     |   5 SHOW       001F2B R   |     SIGN    =  000001 
  5 SIZE       001FCB R   |     SKIP    =  000006     |   5 SLEEP      001ECE R
    SPACE   =  000020     |     SPI_CR1 =  005200     |     SPI_CR2 =  005201 
    SPI_CRCP=  005205     |     SPI_DR  =  005204     |     SPI_ICR =  005202 
    SPI_RXCR=  005206     |     SPI_SR  =  005203     |     SPI_TXCR=  005207 
    SQUOT   =  000001     |     SRC     =  000003     |     STACK_EM=  0017FF 
    STACK_SI=  000080     |   5 STATES     0008AF R   |   5 STEP       00206B R
  5 STOP       001F22 R   |     SWIM_CSR=  007F80     |     TAB     =  000009 
    TAB_WIDT=  000004     |     TCHAR   =  000001     |     TEMP    =  000003 
    TIB_SIZE=  000050     |     TICK    =  000027     |   5 TICKS      001FE4 R
    TIM1_ARR=  005262     |     TIM1_ARR=  005263     |     TIM1_BKR=  00526D 
    TIM1_CCE=  00525C     |     TIM1_CCE=  00525D     |     TIM1_CCM=  005258 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  005259 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  00525A 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  00525B 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCR=  005265 
    TIM1_CCR=  005266     |     TIM1_CCR=  005267     |     TIM1_CCR=  005268 
    TIM1_CCR=  005269     |     TIM1_CCR=  00526A     |     TIM1_CCR=  00526B 
    TIM1_CCR=  00526C     |     TIM1_CNT=  00525E     |     TIM1_CNT=  00525F 
    TIM1_CR1=  005250     |     TIM1_CR2=  005251     |     TIM1_CR2=  000000 
    TIM1_CR2=  000002     |     TIM1_CR2=  000004     |     TIM1_CR2=  000005 
    TIM1_CR2=  000006     |     TIM1_DTR=  00526E     |     TIM1_EGR=  005257 
    TIM1_EGR=  000007     |     TIM1_EGR=  000001     |     TIM1_EGR=  000002 
    TIM1_EGR=  000003     |     TIM1_EGR=  000004     |     TIM1_EGR=  000005 
    TIM1_EGR=  000006     |     TIM1_EGR=  000000     |     TIM1_ETR=  005253 
    TIM1_ETR=  000006     |     TIM1_ETR=  000000     |     TIM1_ETR=  000001 
    TIM1_ETR=  000002     |     TIM1_ETR=  000003     |     TIM1_ETR=  000007 
    TIM1_ETR=  000004     |     TIM1_ETR=  000005     |     TIM1_IER=  005254 
    TIM1_IER=  000007     |     TIM1_IER=  000001     |     TIM1_IER=  000002 
    TIM1_IER=  000003     |     TIM1_IER=  000004     |     TIM1_IER=  000005 
    TIM1_IER=  000006     |     TIM1_IER=  000000     |     TIM1_OIS=  00526F 
    TIM1_PSC=  005260     |     TIM1_PSC=  005261     |     TIM1_RCR=  005264 
    TIM1_SMC=  005252     |     TIM1_SMC=  000007     |     TIM1_SMC=  000000 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 116.
Hexadecimal [24-Bits]

Symbol Table

    TIM1_SMC=  000001     |     TIM1_SMC=  000002     |     TIM1_SMC=  000004 
    TIM1_SMC=  000005     |     TIM1_SMC=  000006     |     TIM1_SR1=  005255 
    TIM1_SR1=  000007     |     TIM1_SR1=  000001     |     TIM1_SR1=  000002 
    TIM1_SR1=  000003     |     TIM1_SR1=  000004     |     TIM1_SR1=  000005 
    TIM1_SR1=  000006     |     TIM1_SR1=  000000     |     TIM1_SR2=  005256 
    TIM1_SR2=  000001     |     TIM1_SR2=  000002     |     TIM1_SR2=  000003 
    TIM1_SR2=  000004     |     TIM2_ARR=  00530D     |     TIM2_ARR=  00530E 
    TIM2_CCE=  005308     |     TIM2_CCE=  005309     |     TIM2_CCM=  005305 
    TIM2_CCM=  005306     |     TIM2_CCM=  005307     |     TIM2_CCR=  00530F 
    TIM2_CCR=  005310     |     TIM2_CCR=  005311     |     TIM2_CCR=  005312 
    TIM2_CCR=  005313     |     TIM2_CCR=  005314     |     TIM2_CNT=  00530A 
    TIM2_CNT=  00530B     |     TIM2_CR1=  005300     |     TIM2_EGR=  005304 
    TIM2_IER=  005301     |     TIM2_PSC=  00530C     |     TIM2_SR1=  005302 
    TIM2_SR2=  005303     |     TIM3_ARR=  00532B     |     TIM3_ARR=  00532C 
    TIM3_CCE=  005327     |     TIM3_CCE=  000000     |     TIM3_CCE=  000001 
    TIM3_CCE=  000004     |     TIM3_CCE=  000005     |     TIM3_CCE=  000000 
    TIM3_CCE=  000001     |     TIM3_CCM=  005325     |     TIM3_CCM=  005326 
    TIM3_CCM=  000000     |     TIM3_CCM=  000004     |     TIM3_CCM=  000003 
    TIM3_CCR=  00532D     |     TIM3_CCR=  00532E     |     TIM3_CCR=  00532F 
    TIM3_CCR=  005330     |     TIM3_CNT=  005328     |     TIM3_CNT=  005329 
    TIM3_CR1=  005320     |     TIM3_CR1=  000007     |     TIM3_CR1=  000000 
    TIM3_CR1=  000003     |     TIM3_CR1=  000001     |     TIM3_CR1=  000002 
    TIM3_EGR=  005324     |     TIM3_IER=  005321     |     TIM3_PSC=  00532A 
    TIM3_SR1=  005322     |     TIM3_SR2=  005323     |     TIM4_ARR=  005346 
    TIM4_CNT=  005344     |     TIM4_CR1=  005340     |     TIM4_CR1=  000007 
    TIM4_CR1=  000000     |     TIM4_CR1=  000003     |     TIM4_CR1=  000001 
    TIM4_CR1=  000002     |     TIM4_EGR=  005343     |     TIM4_EGR=  000000 
    TIM4_IER=  005341     |     TIM4_IER=  000000     |     TIM4_PSC=  005345 
    TIM4_PSC=  000000     |     TIM4_PSC=  000007     |     TIM4_PSC=  000004 
    TIM4_PSC=  000001     |     TIM4_PSC=  000005     |     TIM4_PSC=  000002 
    TIM4_PSC=  000006     |     TIM4_PSC=  000003     |     TIM4_PSC=  000000 
    TIM4_PSC=  000001     |     TIM4_PSC=  000002     |     TIM4_SR =  005342 
    TIM4_SR_=  000000     |     TIM_CR1_=  000007     |     TIM_CR1_=  000000 
    TIM_CR1_=  000006     |     TIM_CR1_=  000005     |     TIM_CR1_=  000004 
    TIM_CR1_=  000003     |     TIM_CR1_=  000001     |     TIM_CR1_=  000002 
    TK_ARRAY=  000004     |     TK_CHAR =  000005     |     TK_CMD  =  000006 
    TK_COLON=  000001     |     TK_COMMA=  00000B     |     TK_DIV  =  000021 
    TK_EQUAL=  000032     |     TK_FUNC =  000007     |     TK_GE   =  000033 
    TK_GRP_A=  000010     |     TK_GRP_M=  000030     |     TK_GRP_M=  000000 
    TK_GRP_M=  000020     |     TK_GRP_R=  000030     |     TK_GT   =  000031 
    TK_INTGR=  000002     |     TK_LE   =  000036     |     TK_LPARE=  000009 
    TK_LT   =  000034     |     TK_MINUS=  000011     |     TK_MOD  =  000022 
    TK_MULT =  000020     |     TK_NE   =  000035     |     TK_NONE =  000000 
    TK_PLUS =  000010     |     TK_QSTR =  000008     |     TK_RPARE=  00000A 
    TK_SHARP=  00000C     |     TK_VAR  =  000003     |   5 TO         002064 R
  5 Timer4Up   000019 R   |   5 TrapHand   00000A R   |     U8      =  000003 
    UART1   =  000000     |     UART1_BA=  005230     |     UART1_BR=  005232 
    UART1_BR=  005233     |     UART1_CR=  005234     |     UART1_CR=  005235 
    UART1_CR=  005236     |     UART1_CR=  005237     |     UART1_CR=  005238 
    UART1_DR=  005231     |     UART1_GT=  005239     |     UART1_PO=  000000 
    UART1_PS=  00523A     |     UART1_RX=  000004     |     UART1_SR=  005230 
    UART1_TX=  000005     |     UART3   =  000001     |     UART3_BA=  005240 
    UART3_BR=  005242     |     UART3_BR=  005243     |     UART3_CR=  005244 
    UART3_CR=  005245     |     UART3_CR=  005246     |     UART3_CR=  005247 
    UART3_CR=  004249     |     UART3_DR=  005241     |     UART3_PO=  00000F 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 117.
Hexadecimal [24-Bits]

Symbol Table

    UART3_RX=  000006     |     UART3_SR=  005240     |     UART3_TX=  000005 
    UART_BRR=  000002     |     UART_BRR=  000003     |     UART_CR1=  000004 
    UART_CR1=  000004     |     UART_CR1=  000002     |     UART_CR1=  000000 
    UART_CR1=  000001     |     UART_CR1=  000007     |     UART_CR1=  000006 
    UART_CR1=  000005     |     UART_CR1=  000003     |     UART_CR2=  000005 
    UART_CR2=  000004     |     UART_CR2=  000002     |     UART_CR2=  000005 
    UART_CR2=  000001     |     UART_CR2=  000000     |     UART_CR2=  000006 
    UART_CR2=  000003     |     UART_CR2=  000007     |     UART_CR3=  000006 
    UART_CR3=  000003     |     UART_CR3=  000001     |     UART_CR3=  000002 
    UART_CR3=  000000     |     UART_CR3=  000006     |     UART_CR3=  000004 
    UART_CR3=  000005     |     UART_CR4=  000007     |     UART_CR4=  000000 
    UART_CR4=  000001     |     UART_CR4=  000002     |     UART_CR4=  000003 
    UART_CR4=  000004     |     UART_CR4=  000006     |     UART_CR4=  000005 
    UART_CR5=  000008     |     UART_CR5=  000003     |     UART_CR5=  000001 
    UART_CR5=  000002     |     UART_CR5=  000004     |     UART_CR5=  000005 
    UART_CR6=  000009     |     UART_CR6=  000004     |     UART_CR6=  000007 
    UART_CR6=  000001     |     UART_CR6=  000002     |     UART_CR6=  000000 
    UART_CR6=  000005     |     UART_DR =  000001     |     UART_GTR=  000009 
    UART_PSC=  00000A     |     UART_SR =  000000     |     UART_SR_=  000001 
    UART_SR_=  000004     |     UART_SR_=  000002     |     UART_SR_=  000003 
    UART_SR_=  000000     |     UART_SR_=  000005     |     UART_SR_=  000006 
    UART_SR_=  000007     |     UBC     =  004801     |   5 UBOUND     00207D R
  5 UFLASH     001F58 R   |   5 USER_ABO   00007E R   |   5 USR        001F45 R
    USR_BTN_=  000004     |     USR_BTN_=  000010     |     USR_BTN_=  005015 
  5 UserButt   000025 R   |     VSIZ    =  000002     |     VSIZE   =  000002 
    VT      =  00000B     |   5 WAIT       002024 R   |     WDGOPT  =  004805 
    WDGOPT_I=  000002     |     WDGOPT_L=  000003     |     WDGOPT_W=  000000 
    WDGOPT_W=  000001     |     WIDTH   =  000001     |     WIDTH_SA=  000002 
    WLEN    =  000001     |   5 WORDS      001EC4 R   |   5 WRITE      001EFD R
    WWDG_CR =  0050D1     |     WWDG_WR =  0050D2     |     XADR    =  000001 
    XMASK   =  000001     |     XSAVE   =  000003     |     YSAVE   =  000003 
  5 abs        001DEC R   |   1 acc16      000009 R   |   1 acc24      000008 R
  1 acc8       00000A R   |   5 accept_c   000AA7 R   |   5 add        001068 R
  5 ansi_seq   000A65 R   |   5 arg_list   0011AA R   |   1 array_ad   000020 R
  1 array_si   000022 R   |   5 ascii      001CFA R   |   5 at_tst     000D9F R
  5 atoi24     000EB4 R   |   5 atoi_exi   000F22 R   |   5 bad_port   001D68 R
  1 base       000007 R   |   1 basicptr   000003 R   |   5 beep       0018F7 R
  5 bin_exit   000C9A R   |   5 bit_rese   0016C3 R   |   5 bit_set    0016AF R
  5 bit_togg   0016D8 R   |   5 bkslsh_t   000D4A R   |   5 bksp       0001BA R
  5 break      00198D R   |   5 break_po   0019BE R   |   5 bye        001DBF R
  5 char       001CDD R   |   5 check_fu   0003EC R   |   5 clear_ba   0005A5 R
  5 clear_va   0004B5 R   |   5 clock_in   000099 R   |   5 cmd_itf    000ACB R
  5 cmd_name   001113 R   |   5 cmp_name   001A5D R   |   5 cold_sta   00051A R
  5 colon_ts   000D73 R   |   5 comma_ts   000D7E R   |   5 compile    0003FB R
  5 convert_   000C00 R   |   1 count      000002 R   |   5 cp_loop    001156 R
  5 create_g   000338 R   |   5 cstk_pro   001032 R   |   5 dash_tst   000D94 R
  5 ddrop      000FAE R   |   5 ddrop_n    000FEB R   |   5 ddup       000FB7 R
  5 dec_base   001354 R   |   5 del_back   000A98 R   |   5 del_line   00030B R
  5 del_ln     000A89 R   |   5 delete     0001CA R   |   5 dir_loop   001C1D R
  5 director   001C11 R   |   5 divide     0010BE R   |   5 divu24_8   0009F2 R
  5 dotr       00103B R   |   5 dotr_loo   001050 R   |   5 dots       001008 R
  5 dpick      000FC8 R   |   5 dpop       000F87 R   |   5 dpush      000F7A R
  5 drive_fr   001C99 R   |   3 dstack     001740 R   |   3 dstack_u   001780 R
  5 dstk_pro   000FFE R   |   1 dstkptr    000019 R   |   5 dswap      000F94 R
  5 eeprom     001D91 R   |   5 eql_tst    000E01 R   |   5 equal      001568 R
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 118.
Hexadecimal [24-Bits]

Symbol Table

  5 err_bad_   000686 R   |   5 err_cmd_   000647 R   |   5 err_div0   000609 R
  5 err_dupl   000662 R   |   5 err_math   0005EF R   |   5 err_mem_   0005D2 R
  5 err_msg    0005BA R   |   5 err_no_a   000693 R   |   5 err_no_l   000619 R
  5 err_not_   000674 R   |   5 err_run_   000630 R   |   5 err_synt   0005E0 R
  5 expect     00119D R   |   5 expr_exi   0012E5 R   |   5 expressi   0012A4 R
  5 factor     001201 R   |   1 farptr     000013 R   |   7 fdrive     010000 R
  5 fetch      000FD7 R   |   5 fetchc     000BB8 R   |   1 ffree      000016 R
  5 file_cou   001C91 R   |   5 final_te   000A5F R   |   5 first_li   0013C4 R
  1 flags      000024 R   |   5 for        001730 R   |   5 forget     001BC2 R
  1 free_ram   00005A R   |   5 ge         00156A R   |   5 get_arra   0011CE R
  5 get_tick   001DE6 R   |   5 get_toke   000CE7 R   |   5 getc       0001A7 R
  5 go_commo   001855 R   |   5 gosub      001832 R   |   5 goto       001825 R
  5 gpio       001D30 R   |   5 gt         001566 R   |   5 gt_tst     000E0C R
  5 hex_base   00134F R   |   5 hse_cloc   000187 R   |   5 hsi_cloc   000191 R
  5 if         00171C R   |   1 in         000001 R   |   1 in.w       000000 R
  1 in.w.sav   000011 R   |   5 incr_far   0019E7 R   |   5 input_ex   001680 R
  5 input_lo   00161B R   |   5 input_va   00160F R   |   5 insert_l   000369 R
  5 insert_l   0003E9 R   |   5 interp     000749 R   |   5 interp_l   00078D R
  5 invalid    000B10 R   |   5 invalid_   000B8E R   |   5 is_alpha   0004C3 R
  5 is_digit   000E9F R   |   5 itoa       0009AB R   |   5 itoa_loo   0009C3 R
  5 key        001D1E R   |   5 kword_di   0020AD R   |   5 kword_en   001EBA R
  5 last_lin   0013CD R   |   5 le         00156F R   |   5 ledoff     0007FF R
  5 ledon      0007FA R   |   5 ledtoggl   000804 R   |   5 left_arr   000A65 R
  5 left_par   00080D R   |   5 let        001371 R   |   5 let02      00137B R
  1 lineno     000005 R   |   5 lines_sk   0013D2 R   |   5 list       001399 R
  5 list_exi   001419 R   |   5 list_sta   0013F5 R   |   5 load       001B65 R
  5 loop_bac   0017FA R   |   1 loop_dep   00001F R   |   5 loop_don   001813 R
  5 lt         00156D R   |   5 lt_tst     000E45 R   |   5 mem_peek   000B2D R
  5 modulo     001102 R   |   5 move       00029E R   |   5 move_dow   0002BC R
  5 move_exi   0002DD R   |   5 move_loo   0002C1 R   |   5 move_up    0002AE R
  5 mul_char   001557 R   |   5 multiply   001076 R   |   5 mulu24_8   000F26 R
  5 nbr_tst    000D20 R   |   5 ne         001572 R   |   5 neg_acc2   000A1A R
  5 new        0019DC R   |   5 next       0017B2 R   |   5 next_tok   0007BD R
  5 no_match   001168 R   |   5 none       000CE7 R   |   5 number     000BBE GR
  5 other      000E7D R   |   3 pad        001718 R   |   5 parse_bi   000C7A R
  5 parse_in   000C3F R   |   5 parse_ke   000CA2 R   |   5 parse_qu   000BC5 R
  5 pause      001DD3 R   |   5 pause02    001DDD R   |   5 peek       0016FF R
  5 peek_byt   000B58 R   |   5 plus_tst   000DD5 R   |   5 poke       0016EC R
  5 port_cr1   001D7F R   |   5 port_cr2   001D85 R   |   5 port_ddr   001D79 R
  5 port_idr   001D73 R   |   5 port_odr   001D6D R   |   5 power_ad   00191F R
  5 prcnt_ts   000DF6 R   |   5 print      001575 R   |   5 print_ex   0015D9 R
  5 print_fa   000B9D R   |   5 print_in   00094F R   |   5 print_re   00085C R
  5 print_st   000B20 R   |   5 prt_basi   001430 R   |   5 prt_cmd_   00141C R
  5 prt_loop   001579 R   |   5 prt_peek   00024E R   |   5 prt_reg1   00083D R
  5 prt_reg8   000818 R   |   5 prt_regs   0001E4 R   |   5 prti24     000907 R
  1 ptr16      000014 R   |   1 ptr8       000015 R   |   5 putc       00019E R
  5 puts       0001B0 R   |   5 qkey       001D26 R   |   5 qmark_ts   000DAA R
  5 random     001E0C R   |   5 read_adc   00195A R   |   5 readln     000A3D R
  5 readln_l   000A43 R   |   5 readln_q   000ABC R   |   5 regs_sta   000227 R
  5 rel_exit   00133C R   |   5 relation   0012E8 R   |   5 relop_st   00155A R
  5 rem        001683 R   |   5 repl       000AD9 R   |   5 repl_exi   000B01 R
  5 reprint    000A65 R   |   5 reset_co   001577 R   |   5 rest_con   0015FA R
  5 return     00187D R   |   5 right_ar   000A65 R   |   5 rparnt_t   000D68 R
  5 rt_msg     0006C7 R   |   5 run        0018A1 R   |   5 save       001AC8 R
  5 save_con   0015E5 R   |   5 search_d   001145 R   |   5 search_e   001199 R
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 119.
Hexadecimal [24-Bits]

Symbol Table

  5 search_f   001A7E R   |   5 search_l   0002E0 R   |   5 search_l   0002EB R
  5 search_n   001149 R   |   1 seedx      00000D R   |   1 seedy      00000F R
  5 seek_fdr   0019F5 R   |   5 sharp_ts   000D89 R   |   5 show       00133F R
  5 single_c   001553 R   |   5 size       001359 R   |   5 skip       000F60 R
  5 slash_ts   000DEB R   |   5 sleep      001DC8 R   |   5 software   0004D4 R
  5 spaces     0001D8 R   |   3 stack_fu   001780 R   |   3 stack_un   001800 R
  5 star_tst   000DE0 R   |   5 step       00178A R   |   5 stop       0018E8 R
  5 store      000FE1 R   |   5 store_lo   00179C R   |   5 str_matc   001177 R
  5 str_tst    000D0F R   |   5 strcmp     00027F R   |   5 strcpy     000290 R
  5 strlen     000272 R   |   5 substrac   001070 R   |   5 syntax_e   0006D7 R
  1 tab_widt   000025 R   |   5 tb_error   0006D9 R   |   5 term       001257 R
  5 term01     001260 R   |   5 term_exi   0012A1 R   |   5 test_p     000B18 R
  3 tib        0016C8 R   |   5 tick_tst   000DC1 R   |   1 ticks      00000B R
  5 timer4_i   0000AF R   |   5 to         00175A R   |   5 to_upper   000EA8 GR
  5 token_ch   000E8C R   |   5 token_ex   000E9C R   |   1 txtbgn     00001B R
  1 txtend     00001D R   |   5 uart3_in   000174 R   |   5 uart3_se   000180 R
  5 uart_ena   000199 R   |   5 ubound     001363 R   |   5 uflash     001D8B R
  5 unget_to   000F73 R   |   5 unlock_e   0000C0 R   |   5 unlock_f   0000CE R
  5 user_spa   002100 R   |   5 usr        001D97 R   |   1 vars       000026 R
  5 wait       001684 R   |   5 warm_sta   000729 R   |   5 words      001E80 R
  5 write      001CA6 R   |   5 write_bl   000151 R   |   5 write_by   0000DC R
  5 write_ee   000118 R   |   5 write_ex   00014C R   |   5 write_fl   000102 R

ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 120.
Hexadecimal [24-Bits]

Area Table

   0 _CODE      size      0   flags    0
   1 DATA       size     5A   flags    0
   2 SSEG       size      0   flags    8
   3 SSEG0      size    138   flags    8
   4 HOME       size     80   flags    0
   5 CODE       size   210E   flags    0
   6 FLASH_DR   size      0   flags    8
   7 FLASH_DR   size      0   flags    8

